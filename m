Return-path: <linux-media-owner@vger.kernel.org>
Received: from mail.renesas.com ([202.234.163.13]:42086 "EHLO
	mail02.idc.renesas.com" rhost-flags-OK-OK-OK-FAIL) by vger.kernel.org
	with ESMTP id S1750979AbZCLAnH (ORCPT
	<rfc822;linux-media@vger.kernel.org>);
	Wed, 11 Mar 2009 20:43:07 -0400
Date: Thu, 12 Mar 2009 09:42:56 +0900
From: morimoto.kuninori@renesas.com
Subject: Re: [PATCH] ov772x: Add extra setting method
In-reply-to: <Pine.LNX.4.64.0903111232340.4818@axis700.grange>
To: Guennadi Liakhovetski <g.liakhovetski@gmx.de>
Cc: Linux Media Mailing List <linux-media@vger.kernel.org>,
	Magnus <magnus.damm@gmail.com>, Hans Verkuil <hverkuil@xs4all.nl>
Message-id: <uprgnr2pb.wl%morimoto.kuninori@renesas.com>
MIME-version: 1.0 (generated by SEMI 1.14.6 - "Maruoka")
Content-type: text/plain; charset=US-ASCII
References: <u63irl9dx.wl%morimoto.kuninori@renesas.com>
 <Pine.LNX.4.64.0903030843090.5059@axis700.grange>
 <uwsb6kjnl.wl%morimoto.kuninori@renesas.com>
 <Pine.LNX.4.64.0903111232340.4818@axis700.grange>
Sender: linux-media-owner@vger.kernel.org
List-ID: <linux-media.vger.kernel.org>


Dear Guennadi

Thank you for comment

> Ok, this is indeed a lot, still, we should do this properly. After a 
> discussion with Hans on IRC the general conclusion was "noone outside of 
> the device driver shall even know device registers." I think, we shall 
> split this huge array in at least 3 groups:
> 
> 1. default, that's also valid for other setups with this chip. as you 
> describe this, this set might be empty...
> 
> 2. settings, for which controls exist, or can be meaningfully added. For 
> example, there are controls for gain, exposure, auto white balance,...
> 
> 3. a configuration struct with meaningfully named _and_ documented fields. 
> I.e., plese, do not name fields like "r17" or similar:-) This becomes even 
> more important in the absence of a publicly available datasheet. Also, the 
> struct field -- register relationship doesn't have to be one-to-one. I.e., 
> might well be that one field affects several registers, or several fields 
> affect one register.

Hmm. maybe I could understand.
Following is a (very) rough composition.

Is "defaults" so important ?
Normal ov772x driver do default settings in init time.

And sorry. I'm very busy now.
So I will try to this problem in future.

---------- rough composition -------------

struct ov772x_AWB_gain {
       unsigned char blue;  /* blue  channel gain */
       unsigned char red;   /* red   channel gain */
       unsigned char green; /* green channel gain */
};

struct ov772x_Average_level {
       unsigned char ub;  /* U/B  Average lebel */
       unsigned char ygb; /* Y/Gb Average lebel */
       unsigned char vr;  /* V/R  Average lebel */
};

... a lot of more ...

struct ov772x_extra_settings {
       /* 1 */
       const struct regval_list defaults;       /* maybe empty */
       /* 2 */
       const struct ov772x_AWB_gain      awb;   /* for control */
       const struct ov772x_Average_level lebel; /* for control */
       ...
};

Best regards
--
Kuninori Morimoto
 
