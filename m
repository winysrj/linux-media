Return-path: <linux-media-owner@vger.kernel.org>
Received: from mail-fx0-f221.google.com ([209.85.220.221]:51576 "EHLO
	mail-fx0-f221.google.com" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
	with ESMTP id S1754325AbZLOPtq (ORCPT
	<rfc822;linux-media@vger.kernel.org>);
	Tue, 15 Dec 2009 10:49:46 -0500
Received: by fxm21 with SMTP id 21so52fxm.21
        for <linux-media@vger.kernel.org>; Tue, 15 Dec 2009 07:49:44 -0800 (PST)
MIME-Version: 1.0
Date: Tue, 15 Dec 2009 16:49:44 +0100
Message-ID: <846899810912150749q38d8a1ffy96b135cf355fe8eb@mail.gmail.com>
Subject: [PATCH v2] isl6421.c - added tone control and temporary diseqc
	overcurrent
From: HoP <jpetrous@gmail.com>
To: Mauro Carvalho Chehab <mchehab@redhat.com>, o.endriss@gmx.de,
	patrick.boettcher@desy.de, kraxel@bytesex.org
Cc: ajurik@quick.cz, hermann pitton <hermann-pitton@arcor.de>,
	linux-media@vger.kernel.org
Content-Type: multipart/mixed; boundary=001485f6c5c6c3c29b047ac656a9
Sender: linux-media-owner@vger.kernel.org
List-ID: <linux-media.vger.kernel.org>

--001485f6c5c6c3c29b047ac656a9
Content-Type: text/plain; charset=ISO-8859-1

Hi Mauro,

I have finally found some time for reworking our patch
with regards of notes I got in disscussion.

BTW, I learnt that sending patch for review to original
authors is right thing (tm), so I have added Oliver,
as isl6421.c author, Patrick as flexcop author, Gerd
as cx88/saa7134 author (I hope I found correct persons,
if no please ignore posting).

Regards

/Honza

---

isl6421.c - added tone control and temporary diseqc overcurrent

Signed-off-by: Jan Petrous <jpetrous@gmail.com>
Signed-off-by: Ales Jurik <ajurik@quick.cz>

--001485f6c5c6c3c29b047ac656a9
Content-Type: application/octet-stream; name="isl6421-v2.patch"
Content-Disposition: attachment; filename="isl6421-v2.patch"
Content-Transfer-Encoding: base64
X-Attachment-Id: f_g38uezif0

ZGlmZiAtciA3OWZjMzJiYmEwYTAgbGludXgvZHJpdmVycy9tZWRpYS9kdmIvYjJjMi9mbGV4Y29w
LWZlLXR1bmVyLmMKLS0tIGEvbGludXgvZHJpdmVycy9tZWRpYS9kdmIvYjJjMi9mbGV4Y29wLWZl
LXR1bmVyLmMJTW9uIERlYyAxNCAxNzo0MzoxMyAyMDA5IC0wMjAwCisrKyBiL2xpbnV4L2RyaXZl
cnMvbWVkaWEvZHZiL2IyYzIvZmxleGNvcC1mZS10dW5lci5jCVR1ZSBEZWMgMTUgMTY6MzY6MTQg
MjAwOSArMDEwMApAQCAtMzAyLDYgKzMwMiwxMiBAQCBzdGF0aWMgc3RydWN0IGl0ZDEwMDBfY29u
ZmlnIHNreXN0YXIyX3JlCiAJLmkyY19hZGRyZXNzID0gMHg2MSwKIH07CiAKK3N0YXRpYyBzdHJ1
Y3QgaXNsNjQyMV9jb25maWcgc2t5c3RhcjJfcmV2Ml83X2lzbDY0MjFfY29uZmlnID0geworCS5p
MmNfYWRkcmVzcyA9IDB4MDgsCisJLm92ZXJyaWRlX3NldCA9IDB4MDEsCisJLm92ZXJyaWRlX2Ns
ZWFyID0gMHgwMSwKK307CisKIHN0YXRpYyBpbnQgc2t5c3RhcjJfcmV2MjdfYXR0YWNoKHN0cnVj
dCBmbGV4Y29wX2RldmljZSAqZmMsCiAJc3RydWN0IGkyY19hZGFwdGVyICppMmMpCiB7CkBAIC0z
MjUsNyArMzMxLDcgQEAgc3RhdGljIGludCBza3lzdGFyMl9yZXYyN19hdHRhY2goc3RydWN0IAog
CS8qIGVuYWJsZSBub19iYXNlX2FkZHIgLSBubyByZXBlYXRlZCBzdGFydCB3aGVuIHJlYWRpbmcg
Ki8KIAlmYy0+ZmNfaTJjX2FkYXBbMl0ubm9fYmFzZV9hZGRyID0gMTsKIAlpZiAoIWR2Yl9hdHRh
Y2goaXNsNjQyMV9hdHRhY2gsIGZjLT5mZSwgJmZjLT5mY19pMmNfYWRhcFsyXS5pMmNfYWRhcCwK
LQkJCTB4MDgsIDEsIDEpKSB7CisJCQkmc2t5c3RhcjJfcmV2Ml83X2lzbDY0MjFfY29uZmlnKSkg
ewogCQllcnIoIklTTDY0MjEgY291bGQgTk9UIGJlIGF0dGFjaGVkIik7CiAJCWdvdG8gZmFpbF9p
c2w7CiAJfQpAQCAtMzY4LDYgKzM3NCwxMiBAQCBzdGF0aWMgY29uc3Qgc3RydWN0IGN4MjQxMTNf
Y29uZmlnIHNreXN0CiAJLnh0YWxfa2h6ID0gMTAxMTEsCiB9OwogCitzdGF0aWMgc3RydWN0IGlz
bDY0MjFfY29uZmlnIHNreXN0YXIyX3JldjJfOF9pc2w2NDIxX2NvbmZpZyA9IHsKKwkuaTJjX2Fk
ZHJlc3MgPSAweDA4LAorCS5vdmVycmlkZV9zZXQgPSAweDAwLAorCS5vdmVycmlkZV9jbGVhciA9
IDB4MDAsCit9OworCiBzdGF0aWMgaW50IHNreXN0YXIyX3JldjI4X2F0dGFjaChzdHJ1Y3QgZmxl
eGNvcF9kZXZpY2UgKmZjLAogCXN0cnVjdCBpMmNfYWRhcHRlciAqaTJjKQogewpAQCAtMzkxLDcg
KzQwMyw3IEBAIHN0YXRpYyBpbnQgc2t5c3RhcjJfcmV2MjhfYXR0YWNoKHN0cnVjdCAKIAogCWZj
LT5mY19pMmNfYWRhcFsyXS5ub19iYXNlX2FkZHIgPSAxOwogCWlmICghZHZiX2F0dGFjaChpc2w2
NDIxX2F0dGFjaCwgZmMtPmZlLCAmZmMtPmZjX2kyY19hZGFwWzJdLmkyY19hZGFwLAotCQkJMHgw
OCwgMCwgMCkpIHsKKwkJCSZza3lzdGFyMl9yZXYyXzhfaXNsNjQyMV9jb25maWcpKSB7CiAJCWVy
cigiSVNMNjQyMSBjb3VsZCBOT1QgYmUgYXR0YWNoZWQiKTsKIAkJZmMtPmZjX2kyY19hZGFwWzJd
Lm5vX2Jhc2VfYWRkciA9IDA7CiAJCXJldHVybiAwOwpkaWZmIC1yIDc5ZmMzMmJiYTBhMCBsaW51
eC9kcml2ZXJzL21lZGlhL2R2Yi9mcm9udGVuZHMvaXNsNjQyMS5jCi0tLSBhL2xpbnV4L2RyaXZl
cnMvbWVkaWEvZHZiL2Zyb250ZW5kcy9pc2w2NDIxLmMJTW9uIERlYyAxNCAxNzo0MzoxMyAyMDA5
IC0wMjAwCisrKyBiL2xpbnV4L2RyaXZlcnMvbWVkaWEvZHZiL2Zyb250ZW5kcy9pc2w2NDIxLmMJ
VHVlIERlYyAxNSAxNjozNjoxNCAyMDA5ICswMTAwCkBAIC0zLDYgKzMsOSBAQAogICoKICAqIENv
cHlyaWdodCAoQykgMjAwNiBBbmRyZXcgZGUgUXVpbmNleQogICogQ29weXJpZ2h0IChDKSAyMDA2
IE9saXZlciBFbmRyaXNzCisgKiBDb3B5cmlnaHQgKEMpIDIwMDkgQWxlcyBKdXJpayBhbmQgSmFu
IFBldHJvdXMgKGFkZGVkIG9wdGlvbmFsIDIyayB0b25lCisgKiAgICAgICAgICAgICAgICAgICAg
c3VwcG9ydCBhbmQgdGVtcG9yYXJ5IGRpc2VxYyBvdmVyY3VycmVudCBlbmFibGUgdW50aWwKKyAq
ICAgICAgICAgICAgICAgICAgICBuZXh0IGNvbW1hbmQgLSBzZXQgdm9sdGFnZSBvciB0b25lKQog
ICoKICAqIFRoaXMgcHJvZ3JhbSBpcyBmcmVlIHNvZnR3YXJlOyB5b3UgY2FuIHJlZGlzdHJpYnV0
ZSBpdCBhbmQvb3IKICAqIG1vZGlmeSBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5l
cmFsIFB1YmxpYyBMaWNlbnNlCkBAIC0zNiwzNyArMzksODggQEAKICNpbmNsdWRlICJpc2w2NDIx
LmgiCiAKIHN0cnVjdCBpc2w2NDIxIHsKLQl1OAkJCWNvbmZpZzsKLQl1OAkJCW92ZXJyaWRlX29y
OwotCXU4CQkJb3ZlcnJpZGVfYW5kOwotCXN0cnVjdCBpMmNfYWRhcHRlcgkqaTJjOwotCXU4CQkJ
aTJjX2FkZHI7CisJY29uc3Qgc3RydWN0IGlzbDY0MjFfY29uZmlnCSpjb25maWc7CisJdTgJCQkJ
cmVnMTsKKworCXN0cnVjdCBpMmNfYWRhcHRlciAqaTJjOworCisJaW50ICgqZGlzZXFjX3NlbmRf
bWFzdGVyX2NtZF9vcmlnKShzdHJ1Y3QgZHZiX2Zyb250ZW5kICpmZSwKKwkJCXN0cnVjdCBkdmJf
ZGlzZXFjX21hc3Rlcl9jbWQgKmNtZCk7CiB9OwogCiBzdGF0aWMgaW50IGlzbDY0MjFfc2V0X3Zv
bHRhZ2Uoc3RydWN0IGR2Yl9mcm9udGVuZCAqZmUsIGZlX3NlY192b2x0YWdlX3Qgdm9sdGFnZSkK
IHsKIAlzdHJ1Y3QgaXNsNjQyMSAqaXNsNjQyMSA9IChzdHJ1Y3QgaXNsNjQyMSAqKSBmZS0+c2Vj
X3ByaXY7Ci0Jc3RydWN0IGkyY19tc2cgbXNnID0gewkuYWRkciA9IGlzbDY0MjEtPmkyY19hZGRy
LCAuZmxhZ3MgPSAwLAotCQkJCS5idWYgPSAmaXNsNjQyMS0+Y29uZmlnLAotCQkJCS5sZW4gPSBz
aXplb2YoaXNsNjQyMS0+Y29uZmlnKSB9OworCXN0cnVjdCBpMmNfbXNnIG1zZyA9IHsJLmFkZHIg
PSBpc2w2NDIxLT5jb25maWctPmkyY19hZGRyLCAuZmxhZ3MgPSAwLAorCQkJCS5idWYgPSAmaXNs
NjQyMS0+cmVnMSwKKwkJCQkubGVuID0gc2l6ZW9mKGlzbDY0MjEtPnJlZzEpIH07CiAKLQlpc2w2
NDIxLT5jb25maWcgJj0gfihJU0w2NDIxX1ZTRUwxIHwgSVNMNjQyMV9FTjEpOworCWlzbDY0MjEt
PnJlZzEgJj0gfihJU0w2NDIxX1ZTRUwxIHwgSVNMNjQyMV9FTjEpOwogCiAJc3dpdGNoKHZvbHRh
Z2UpIHsKIAljYXNlIFNFQ19WT0xUQUdFX09GRjoKIAkJYnJlYWs7CiAJY2FzZSBTRUNfVk9MVEFH
RV8xMzoKLQkJaXNsNjQyMS0+Y29uZmlnIHw9IElTTDY0MjFfRU4xOworCQlpc2w2NDIxLT5yZWcx
IHw9IElTTDY0MjFfRU4xOwogCQlicmVhazsKIAljYXNlIFNFQ19WT0xUQUdFXzE4OgotCQlpc2w2
NDIxLT5jb25maWcgfD0gKElTTDY0MjFfRU4xIHwgSVNMNjQyMV9WU0VMMSk7CisJCWlzbDY0MjEt
PnJlZzEgfD0gKElTTDY0MjFfRU4xIHwgSVNMNjQyMV9WU0VMMSk7CiAJCWJyZWFrOwogCWRlZmF1
bHQ6CiAJCXJldHVybiAtRUlOVkFMOwogCX07CiAKLQlpc2w2NDIxLT5jb25maWcgfD0gaXNsNjQy
MS0+b3ZlcnJpZGVfb3I7Ci0JaXNsNjQyMS0+Y29uZmlnICY9IGlzbDY0MjEtPm92ZXJyaWRlX2Fu
ZDsKKwlpc2w2NDIxLT5yZWcxIHw9IGlzbDY0MjEtPmNvbmZpZy0+b3ZlcnJpZGVfc2V0OworCWlz
bDY0MjEtPnJlZzEgJj0gfmlzbDY0MjEtPmNvbmZpZy0+b3ZlcnJpZGVfY2xlYXI7CisKKwlyZXR1
cm4gKGkyY190cmFuc2Zlcihpc2w2NDIxLT5pMmMsICZtc2csIDEpID09IDEpID8gMCA6IC1FSU87
Cit9CisKK3N0YXRpYyBpbnQgaXNsNjQyMV9zZW5kX2Rpc2VxYyhzdHJ1Y3QgZHZiX2Zyb250ZW5k
ICpmZSwKKwkJCQlzdHJ1Y3QgZHZiX2Rpc2VxY19tYXN0ZXJfY21kICpjbWQpCit7CisJc3RydWN0
IGlzbDY0MjEgKmlzbDY0MjEgPSAoc3RydWN0IGlzbDY0MjEgKikgZmUtPnNlY19wcml2OworCXN0
cnVjdCBpMmNfbXNnIG1zZyA9IHsJLmFkZHIgPSBpc2w2NDIxLT5jb25maWctPmkyY19hZGRyLCAu
ZmxhZ3MgPSAwLAorCQkJCS5idWYgPSAmaXNsNjQyMS0+cmVnMSwKKwkJCQkubGVuID0gc2l6ZW9m
KGlzbDY0MjEtPnJlZzEpIH07CisKKwlpc2w2NDIxLT5yZWcxIHw9IElTTDY0MjFfRENMOworCisJ
aXNsNjQyMS0+cmVnMSB8PSBpc2w2NDIxLT5jb25maWctPm92ZXJyaWRlX3NldDsKKwlpc2w2NDIx
LT5yZWcxICY9IH5pc2w2NDIxLT5jb25maWctPm92ZXJyaWRlX2NsZWFyOworCisJaWYgKGkyY190
cmFuc2Zlcihpc2w2NDIxLT5pMmMsICZtc2csIDEpICE9IDEpCisJCXJldHVybiAtRUlPOworCisJ
aXNsNjQyMS0+cmVnMSAmPSB+SVNMNjQyMV9EQ0w7CisKKwlyZXR1cm4gaXNsNjQyMS0+ZGlzZXFj
X3NlbmRfbWFzdGVyX2NtZF9vcmlnKGZlLCBjbWQpOworfQorCitzdGF0aWMgaW50IGlzbDY0MjFf
c2V0X3RvbmUoc3RydWN0IGR2Yl9mcm9udGVuZCAqZmUsIGZlX3NlY190b25lX21vZGVfdCB0b25l
KQoreworCXN0cnVjdCBpc2w2NDIxICppc2w2NDIxID0gKHN0cnVjdCBpc2w2NDIxICopIGZlLT5z
ZWNfcHJpdjsKKwlzdHJ1Y3QgaTJjX21zZyBtc2cgPSB7CS5hZGRyID0gaXNsNjQyMS0+Y29uZmln
LT5pMmNfYWRkciwgLmZsYWdzID0gMCwKKwkJCQkuYnVmID0gJmlzbDY0MjEtPnJlZzEsCisJCQkJ
LmxlbiA9IHNpemVvZihpc2w2NDIxLT5yZWcxKSB9OworCisJaXNsNjQyMS0+cmVnMSAmPSB+KElT
TDY0MjFfRU5UMSk7CisKKwlwcmludGsoS0VSTl9JTkZPICIlczogJXNcbiIsIF9fZnVuY19fLCAo
KHRvbmUgPT0gU0VDX1RPTkVfT0ZGKSA/CisJCQkJIk9mZiIgOiAiT24iKSk7CisKKwlzd2l0Y2gg
KHRvbmUpIHsKKwljYXNlIFNFQ19UT05FX09OOgorCQlpc2w2NDIxLT5yZWcxIHw9IElTTDY0MjFf
RU5UMTsKKwkJYnJlYWs7CisJY2FzZSBTRUNfVE9ORV9PRkY6CisJCWJyZWFrOworCWRlZmF1bHQ6
CisJCXJldHVybiAtRUlOVkFMOworCX07CisKKwlpc2w2NDIxLT5yZWcxIHw9IGlzbDY0MjEtPmNv
bmZpZy0+b3ZlcnJpZGVfc2V0OworCWlzbDY0MjEtPnJlZzEgJj0gfmlzbDY0MjEtPmNvbmZpZy0+
b3ZlcnJpZGVfY2xlYXI7CiAKIAlyZXR1cm4gKGkyY190cmFuc2Zlcihpc2w2NDIxLT5pMmMsICZt
c2csIDEpID09IDEpID8gMCA6IC1FSU87CiB9CkBAIC03NCw0OSArMTI4LDUyIEBAIHN0YXRpYyBp
bnQgaXNsNjQyMV9lbmFibGVfaGlnaF9sbmJfdm9sdGEKIHN0YXRpYyBpbnQgaXNsNjQyMV9lbmFi
bGVfaGlnaF9sbmJfdm9sdGFnZShzdHJ1Y3QgZHZiX2Zyb250ZW5kICpmZSwgbG9uZyBhcmcpCiB7
CiAJc3RydWN0IGlzbDY0MjEgKmlzbDY0MjEgPSAoc3RydWN0IGlzbDY0MjEgKikgZmUtPnNlY19w
cml2OwotCXN0cnVjdCBpMmNfbXNnIG1zZyA9IHsJLmFkZHIgPSBpc2w2NDIxLT5pMmNfYWRkciwg
LmZsYWdzID0gMCwKLQkJCQkuYnVmID0gJmlzbDY0MjEtPmNvbmZpZywKLQkJCQkubGVuID0gc2l6
ZW9mKGlzbDY0MjEtPmNvbmZpZykgfTsKKwlzdHJ1Y3QgaTJjX21zZyBtc2cgPSB7CS5hZGRyID0g
aXNsNjQyMS0+Y29uZmlnLT5pMmNfYWRkciwgLmZsYWdzID0gMCwKKwkJCQkuYnVmID0gJmlzbDY0
MjEtPnJlZzEsCisJCQkJLmxlbiA9IHNpemVvZihpc2w2NDIxLT5yZWcxKSB9OwogCiAJaWYgKGFy
ZykKLQkJaXNsNjQyMS0+Y29uZmlnIHw9IElTTDY0MjFfTExDMTsKKwkJaXNsNjQyMS0+cmVnMSB8
PSBJU0w2NDIxX0xMQzE7CiAJZWxzZQotCQlpc2w2NDIxLT5jb25maWcgJj0gfklTTDY0MjFfTExD
MTsKKwkJaXNsNjQyMS0+cmVnMSAmPSB+SVNMNjQyMV9MTEMxOwogCi0JaXNsNjQyMS0+Y29uZmln
IHw9IGlzbDY0MjEtPm92ZXJyaWRlX29yOwotCWlzbDY0MjEtPmNvbmZpZyAmPSBpc2w2NDIxLT5v
dmVycmlkZV9hbmQ7CisJaXNsNjQyMS0+cmVnMSB8PSBpc2w2NDIxLT5jb25maWctPm92ZXJyaWRl
X3NldDsKKwlpc2w2NDIxLT5yZWcxICY9IH5pc2w2NDIxLT5jb25maWctPm92ZXJyaWRlX2NsZWFy
OwogCiAJcmV0dXJuIChpMmNfdHJhbnNmZXIoaXNsNjQyMS0+aTJjLCAmbXNnLCAxKSA9PSAxKSA/
IDAgOiAtRUlPOwogfQogCiBzdGF0aWMgdm9pZCBpc2w2NDIxX3JlbGVhc2Uoc3RydWN0IGR2Yl9m
cm9udGVuZCAqZmUpCiB7CisJc3RydWN0IGlzbDY0MjEgKmlzbDY0MjEgPSAoc3RydWN0IGlzbDY0
MjEgKikgZmUtPnNlY19wcml2OworCiAJLyogcG93ZXIgb2ZmICovCiAJaXNsNjQyMV9zZXRfdm9s
dGFnZShmZSwgU0VDX1ZPTFRBR0VfT0ZGKTsKKworCWlmIChpc2w2NDIxLT5jb25maWctPmRpc2Fi
bGVfb3ZlcmN1cnJlbnRfcHJvdGVjdGlvbikKKwkJZmUtPm9wcy5kaXNlcWNfc2VuZF9tYXN0ZXJf
Y21kID0KKwkJCWlzbDY0MjEtPmRpc2VxY19zZW5kX21hc3Rlcl9jbWRfb3JpZzsKIAogCS8qIGZy
ZWUgKi8KIAlrZnJlZShmZS0+c2VjX3ByaXYpOwogCWZlLT5zZWNfcHJpdiA9IE5VTEw7CiB9CiAK
LXN0cnVjdCBkdmJfZnJvbnRlbmQgKmlzbDY0MjFfYXR0YWNoKHN0cnVjdCBkdmJfZnJvbnRlbmQg
KmZlLCBzdHJ1Y3QgaTJjX2FkYXB0ZXIgKmkyYywgdTggaTJjX2FkZHIsCi0JCSAgIHU4IG92ZXJy
aWRlX3NldCwgdTggb3ZlcnJpZGVfY2xlYXIpCitzdHJ1Y3QgZHZiX2Zyb250ZW5kICppc2w2NDIx
X2F0dGFjaChzdHJ1Y3QgZHZiX2Zyb250ZW5kICpmZSwKKwkJCQkJICAgc3RydWN0IGkyY19hZGFw
dGVyICppMmMsCisJCQkJCSAgIGNvbnN0IHN0cnVjdCBpc2w2NDIxX2NvbmZpZyAqY29uZmlnKQog
ewogCXN0cnVjdCBpc2w2NDIxICppc2w2NDIxID0ga21hbGxvYyhzaXplb2Yoc3RydWN0IGlzbDY0
MjEpLCBHRlBfS0VSTkVMKTsKKwogCWlmICghaXNsNjQyMSkKIAkJcmV0dXJuIE5VTEw7CiAKLQkv
KiBkZWZhdWx0IGNvbmZpZ3VyYXRpb24gKi8KLQlpc2w2NDIxLT5jb25maWcgPSBJU0w2NDIxX0lT
RUwxOworCWlzbDY0MjEtPmNvbmZpZwk9IGNvbmZpZzsKIAlpc2w2NDIxLT5pMmMgPSBpMmM7Ci0J
aXNsNjQyMS0+aTJjX2FkZHIgPSBpMmNfYWRkcjsKIAlmZS0+c2VjX3ByaXYgPSBpc2w2NDIxOwog
Ci0JLyogYml0cyB3aGljaCBzaG91bGQgYmUgZm9yY2VkIHRvICcxJyAqLwotCWlzbDY0MjEtPm92
ZXJyaWRlX29yID0gb3ZlcnJpZGVfc2V0OwotCi0JLyogYml0cyB3aGljaCBzaG91bGQgYmUgZm9y
Y2VkIHRvICcwJyAqLwotCWlzbDY0MjEtPm92ZXJyaWRlX2FuZCA9IH5vdmVycmlkZV9jbGVhcjsK
KwkvKiBkZWZhdWx0IGNvbmZpZ3VyYXRpb24gKi8KKwlpc2w2NDIxLT5yZWcxID0gSVNMNjQyMV9J
U0VMMTsKIAogCS8qIGRldGVjdCBpZiBpdCBpcyBwcmVzZW50IG9yIG5vdCAqLwogCWlmIChpc2w2
NDIxX3NldF92b2x0YWdlKGZlLCBTRUNfVk9MVEFHRV9PRkYpKSB7CkBAIC0xMzEsMTEgKzE4OCwz
OCBAQCBzdHJ1Y3QgZHZiX2Zyb250ZW5kICppc2w2NDIxX2F0dGFjaChzdHJ1CiAJLyogb3ZlcnJp
ZGUgZnJvbnRlbmQgb3BzICovCiAJZmUtPm9wcy5zZXRfdm9sdGFnZSA9IGlzbDY0MjFfc2V0X3Zv
bHRhZ2U7CiAJZmUtPm9wcy5lbmFibGVfaGlnaF9sbmJfdm9sdGFnZSA9IGlzbDY0MjFfZW5hYmxl
X2hpZ2hfbG5iX3ZvbHRhZ2U7CisJaWYgKGNvbmZpZy0+dG9uZV9jb250cm9sKQorCQlmZS0+b3Bz
LnNldF90b25lID0gaXNsNjQyMV9zZXRfdG9uZTsKKworCXByaW50ayhLRVJOX0lORk8gIklTTDY0
MjEgYXR0YWNoZWQgb24gYWRkcj0leFxuIiwgY29uZmlnLT5pMmNfYWRkcik7CisKKwlpZiAoY29u
ZmlnLT5kaXNhYmxlX292ZXJjdXJyZW50X3Byb3RlY3Rpb24pIHsKKwkJaWYgKChjb25maWctPm92
ZXJyaWRlX3NldCAmIElTTDY0MjFfRENMKSB8fAorCQkJCShjb25maWctPm92ZXJyaWRlX2NsZWFy
ICYgSVNMNjQyMV9EQ0wpKSB7CisJCQkvKiB0aGVyZSBpcyBubyBzZW5zZSB0byB1c2Ugb3ZlcmN1
cnJlbnRfZW5hYmxlCisJCQkgKiB3aXRoIERDTCBiaXQgc2V0IGluIGFueSBvdmVycmlkZSBieXRl
ICovCisJCQlpZiAoY29uZmlnLT5vdmVycmlkZV9zZXQgJiBJU0w2NDIxX0RDTCkKKwkJCQlwcmlu
dGsoS0VSTl9XQVJOSU5HICJJU0w2NDIxIG92ZXJjdXJyZW50X2VuYWJsZSIKKwkJCQkJCSIgd2l0
aCBEQ0wgYml0IGluIG92ZXJyaWRlX3NldCwiCisJCQkJCQkiIG92ZXJjdXJyZW50X2VuYWJsZSBp
Z25vcmVkXG4iKTsKKwkJCWlmIChjb25maWctPm92ZXJyaWRlX2NsZWFyICYgSVNMNjQyMV9EQ0wp
CisJCQkJcHJpbnRrKEtFUk5fV0FSTklORyAiSVNMNjQyMSBvdmVyY3VycmVudF9lbmFibGUiCisJ
CQkJCQkiIHdpdGggRENMIGJpdCBpbiBvdmVycmlkZV9jbGVhciwiCisJCQkJCQkiIG92ZXJjdXJy
ZW50X2VuYWJsZSBpZ25vcmVkXG4iKTsKKwkJfSBlbHNlIHsKKwkJCXByaW50ayhLRVJOX1dBUk5J
TkcgIklTTDY0MjEgb3ZlcmN1cnJlbnRfZW5hYmxlICIKKwkJCQkJIiBhY3RpdmF0ZWQuIFdBUk5J
Tkc6IGl0IGNhbiBiZSAiCisJCQkJCSIgZGFuZ2Vyb3VzIGZvciB5b3VyIGhhcmR3YXJlISIpOwor
CQkJaXNsNjQyMS0+ZGlzZXFjX3NlbmRfbWFzdGVyX2NtZF9vcmlnID0KKwkJCQlmZS0+b3BzLmRp
c2VxY19zZW5kX21hc3Rlcl9jbWQ7CisJCQlmZS0+b3BzLmRpc2VxY19zZW5kX21hc3Rlcl9jbWQg
PSBpc2w2NDIxX3NlbmRfZGlzZXFjOworCQl9CisJfQogCiAJcmV0dXJuIGZlOwogfQogRVhQT1JU
X1NZTUJPTChpc2w2NDIxX2F0dGFjaCk7CiAKIE1PRFVMRV9ERVNDUklQVElPTigiRHJpdmVyIGZv
ciBsbmIgc3VwcGx5IGFuZCBjb250cm9sIGljIGlzbDY0MjEiKTsKLU1PRFVMRV9BVVRIT1IoIkFu
ZHJldyBkZSBRdWluY2V5ICYgT2xpdmVyIEVuZHJpc3MiKTsKK01PRFVMRV9BVVRIT1IoIkFuZHJl
dyBkZSBRdWluY2V5LE9saXZlciBFbmRyaXNzLEFsZXMgSnVyaWssSmFuIFBldHJvdXMiKTsKIE1P
RFVMRV9MSUNFTlNFKCJHUEwiKTsKZGlmZiAtciA3OWZjMzJiYmEwYTAgbGludXgvZHJpdmVycy9t
ZWRpYS9kdmIvZnJvbnRlbmRzL2lzbDY0MjEuaAotLS0gYS9saW51eC9kcml2ZXJzL21lZGlhL2R2
Yi9mcm9udGVuZHMvaXNsNjQyMS5oCU1vbiBEZWMgMTQgMTc6NDM6MTMgMjAwOSAtMDIwMAorKysg
Yi9saW51eC9kcml2ZXJzL21lZGlhL2R2Yi9mcm9udGVuZHMvaXNsNjQyMS5oCVR1ZSBEZWMgMTUg
MTY6MzY6MTQgMjAwOSArMDEwMApAQCAtMzksMTQgKzM5LDQwIEBACiAjZGVmaW5lIElTTDY0MjFf
SVNFTDEJMHgyMAogI2RlZmluZSBJU0w2NDIxX0RDTAkweDQwCiAKK3N0cnVjdCBpc2w2NDIxX2Nv
bmZpZyB7CisJLyogSTJDIGFkZHJlc3MgKi8KKwl1OCBpMmNfYWRkcjsKKworCS8qIEVuYWJsZSBE
SVNFcUMgdG9uZSBjb250cm9sIG1vZGUgKi8KKwlib29sIHRvbmVfY29udHJvbDsKKworCS8qCisJ
ICogRGlzYWJsZSBpc2w2NDIxIG92ZXJjdXJyZW50IHByb3RlY3Rpb24uCisJICoKKwkgKiBXQVJO
SU5HOiBEb24ndCBkaXNhYmxlIHRoZSBwcm90ZWN0aW9uIHVubGVzcyB5b3UgYXJlIDEwMCUgc3Vy
ZSBhYm91dAorCSAqICAgICAgICAgIHdoYXQgeW91J3JlIGRvaW5nLCBvdGhlcndpc2UgeW91IG1h
eSBkYW1hZ2UgeW91ciBib2FyZC4KKwkgKiAgICAgICAgICBPbmx5IGEgZmV3IGRlc2lnbnMgcmVx
dWlyZSB0byBkaXNhYmxlIHRoZSBwcm90ZWN0aW9uLCBzaW5jZQorCSAqICAgICAgICAgIHRoZSBo
YXJkd2FyZSBkZXNpZ25lciBvcHRlZCB0byB1c2UgYSBoYXJkd2FyZSBwcm90ZWN0aW9uIGluc3Rl
YWQKKwkgKi8KKwlib29sIGRpc2FibGVfb3ZlcmN1cnJlbnRfcHJvdGVjdGlvbjsKKworCS8qIGJp
dHMgd2hpY2ggc2hvdWxkIGJlIGZvcmNlZCB0byAnMScgKi8KKwl1OCBvdmVycmlkZV9zZXQ7CisK
KwkvKiBiaXRzIHdoaWNoIHNob3VsZCBiZSBmb3JjZWQgdG8gJzAnICovCisJdTggb3ZlcnJpZGVf
Y2xlYXI7Cit9OworCisKICNpZiBkZWZpbmVkKENPTkZJR19EVkJfSVNMNjQyMSkgfHwgKGRlZmlu
ZWQoQ09ORklHX0RWQl9JU0w2NDIxX01PRFVMRSkgJiYgZGVmaW5lZChNT0RVTEUpKQogLyogb3Zl
cnJpZGVfc2V0IGFuZCBvdmVycmlkZV9jbGVhciBjb250cm9sIHdoaWNoIHN5c3RlbSByZWdpc3Rl
ciBiaXRzIChhYm92ZSkgdG8gYWx3YXlzIHNldCAmIGNsZWFyICovCi1leHRlcm4gc3RydWN0IGR2
Yl9mcm9udGVuZCAqaXNsNjQyMV9hdHRhY2goc3RydWN0IGR2Yl9mcm9udGVuZCAqZmUsIHN0cnVj
dCBpMmNfYWRhcHRlciAqaTJjLCB1OCBpMmNfYWRkciwKLQkJCSAgdTggb3ZlcnJpZGVfc2V0LCB1
OCBvdmVycmlkZV9jbGVhcik7CitleHRlcm4gc3RydWN0IGR2Yl9mcm9udGVuZCAqaXNsNjQyMV9h
dHRhY2goc3RydWN0IGR2Yl9mcm9udGVuZCAqZmUsCisJCQkJCSAgIHN0cnVjdCBpMmNfYWRhcHRl
ciAqaTJjLAorCQkJCQkgICBjb25zdCBzdHJ1Y3QgaXNsNjQyMV9jb25maWcgKmNvbmZpZyk7CiAj
ZWxzZQotc3RhdGljIGlubGluZSBzdHJ1Y3QgZHZiX2Zyb250ZW5kICppc2w2NDIxX2F0dGFjaChz
dHJ1Y3QgZHZiX2Zyb250ZW5kICpmZSwgc3RydWN0IGkyY19hZGFwdGVyICppMmMsIHU4IGkyY19h
ZGRyLAotCQkJCQkJICB1OCBvdmVycmlkZV9zZXQsIHU4IG92ZXJyaWRlX2NsZWFyKQoteworc3Rh
dGljIHN0cnVjdCBkdmJfZnJvbnRlbmQgKmlzbDY0MjFfYXR0YWNoKHN0cnVjdCBkdmJfZnJvbnRl
bmQgKmZlLAorCQkJCQkgICBzdHJ1Y3QgaTJjX2FkYXB0ZXIgKmkyYywKKwkJCQkJICAgY29uc3Qg
c3RydWN0IGlzbDY0MjFfY29uZmlnICpjb25maWcpOwogCXByaW50ayhLRVJOX1dBUk5JTkcgIiVz
OiBkcml2ZXIgZGlzYWJsZWQgYnkgS2NvbmZpZ1xuIiwgX19mdW5jX18pOwogCXJldHVybiBOVUxM
OwogfQpkaWZmIC1yIDc5ZmMzMmJiYTBhMCBsaW51eC9kcml2ZXJzL21lZGlhL3ZpZGVvL2N4ODgv
Y3g4OC1kdmIuYwotLS0gYS9saW51eC9kcml2ZXJzL21lZGlhL3ZpZGVvL2N4ODgvY3g4OC1kdmIu
YwlNb24gRGVjIDE0IDE3OjQzOjEzIDIwMDkgLTAyMDAKKysrIGIvbGludXgvZHJpdmVycy9tZWRp
YS92aWRlby9jeDg4L2N4ODgtZHZiLmMJVHVlIERlYyAxNSAxNjozNjoxNCAyMDA5ICswMTAwCkBA
IC00NTYsNiArNDU2LDEyIEBAIHN0YXRpYyBzdHJ1Y3QgY3gyNDEyM19jb25maWcgaGF1cHBhdWdl
X24KIAkuc2V0X3RzX3BhcmFtcyA9IGN4MjQxMjNfc2V0X3RzX3BhcmFtLAogfTsKIAorc3RhdGlj
IHN0cnVjdCBpc2w2NDIxX2NvbmZpZyBoYXVwcGF1Z2Vfbm92YXNfaXNsNjQyMV9jb25maWcgPSB7
CisJLmkyY19hZGRyZXNzID0gMHgwOCwKKwkub3ZlcnJpZGVfc2V0ID0gSVNMNjQyMV9EQ0wsCisJ
Lm92ZXJyaWRlX2NsZWFyID0gMHgwMCwKK307CisKIHN0YXRpYyBzdHJ1Y3QgY3gyNDEyM19jb25m
aWcga3dvcmxkX2R2YnNfMTAwX2NvbmZpZyA9IHsKIAkuZGVtb2RfYWRkcmVzcyA9IDB4MTUsCiAJ
LnNldF90c19wYXJhbXMgPSBjeDI0MTIzX3NldF90c19wYXJhbSwKQEAgLTYxNCw2ICs2MjAsMTIg
QEAgc3RhdGljIHN0cnVjdCBjeDI0MTE2X2NvbmZpZyBoYXVwcGF1Z2VfaAogCS5yZXNldF9kZXZp
Y2UgICAgICAgICAgID0gY3gyNDExNl9yZXNldF9kZXZpY2UsCiB9OwogCitzdGF0aWMgc3RydWN0
IGlzbDY0MjFfY29uZmlnIGhhdXBwYXVnZV9odnI0MDAwX2lzbDY0MjFfY29uZmlnID0geworCS5p
MmNfYWRkcmVzcyA9IDB4MDgsCisJLm92ZXJyaWRlX3NldCA9IElTTDY0MjFfRENMLAorCS5vdmVy
cmlkZV9jbGVhciA9IDB4MDAsCit9OworCiBzdGF0aWMgc3RydWN0IGN4MjQxMTZfY29uZmlnIHRl
dmlpX3M0NjBfY29uZmlnID0gewogCS5kZW1vZF9hZGRyZXNzID0gMHg1NSwKIAkuc2V0X3RzX3Bh
cmFtcyA9IGN4MjQxMTZfc2V0X3RzX3BhcmFtLApAQCAtNzU3LDcgKzc2OSw3IEBAIHN0YXRpYyBp
bnQgZHZiX3JlZ2lzdGVyKHN0cnVjdCBjeDg4MDJfZGUKIAkJCWlmICghZHZiX2F0dGFjaChpc2w2
NDIxX2F0dGFjaCwKIAkJCQkJZmUwLT5kdmIuZnJvbnRlbmQsCiAJCQkJCSZkZXYtPmNvcmUtPmky
Y19hZGFwLAotCQkJCQkweDA4LCBJU0w2NDIxX0RDTCwgMHgwMCkpCisJCQkJCSZoYXVwcGF1Z2Vf
bm92YXNfaXNsNjQyMV9jb25maWcpKQogCQkJCWdvdG8gZnJvbnRlbmRfZGV0YWNoOwogCQl9CiAJ
CS8qIE1GRSBmcm9udGVuZCAyICovCkBAIC05OTUsNyArMTAwNyw4IEBAIHN0YXRpYyBpbnQgZHZi
X3JlZ2lzdGVyKHN0cnVjdCBjeDg4MDJfZGUKIAkJCQkJICAgICAgICZjb3JlLT5pMmNfYWRhcCk7
CiAJCWlmIChmZTAtPmR2Yi5mcm9udGVuZCkgewogCQkJaWYgKCFkdmJfYXR0YWNoKGlzbDY0MjFf
YXR0YWNoLCBmZTAtPmR2Yi5mcm9udGVuZCwKLQkJCQkJJmNvcmUtPmkyY19hZGFwLCAweDA4LCBJ
U0w2NDIxX0RDTCwgMHgwMCkpCisJCQkJCSZjb3JlLT5pMmNfYWRhcCwKKwkJCQkJJmhhdXBwYXVn
ZV9ub3Zhc19pc2w2NDIxX2NvbmZpZykpCiAJCQkJZ290byBmcm9udGVuZF9kZXRhY2g7CiAJCX0K
IAkJYnJlYWs7CkBAIC0xMTAwLDcgKzExMTMsNyBAQCBzdGF0aWMgaW50IGR2Yl9yZWdpc3Rlcihz
dHJ1Y3QgY3g4ODAyX2RlCiAJCQlpZiAoIWR2Yl9hdHRhY2goaXNsNjQyMV9hdHRhY2gsCiAJCQkJ
CWZlMC0+ZHZiLmZyb250ZW5kLAogCQkJCQkmZGV2LT5jb3JlLT5pMmNfYWRhcCwKLQkJCQkJMHgw
OCwgSVNMNjQyMV9EQ0wsIDB4MDApKQorCQkJCQkmaGF1cHBhdWdlX2h2cjQwMDBfaXNsNjQyMV9j
b25maWcpKQogCQkJCWdvdG8gZnJvbnRlbmRfZGV0YWNoOwogCQl9CiAJCS8qIE1GRSBmcm9udGVu
ZCAyICovCkBAIC0xMTI4LDcgKzExNDEsNyBAQCBzdGF0aWMgaW50IGR2Yl9yZWdpc3RlcihzdHJ1
Y3QgY3g4ODAyX2RlCiAJCQlpZiAoIWR2Yl9hdHRhY2goaXNsNjQyMV9hdHRhY2gsCiAJCQkJCWZl
MC0+ZHZiLmZyb250ZW5kLAogCQkJCQkmZGV2LT5jb3JlLT5pMmNfYWRhcCwKLQkJCQkJMHgwOCwg
SVNMNjQyMV9EQ0wsIDB4MDApKQorCQkJCQkmaGF1cHBhdWdlX2h2cjQwMDBfaXNsNjQyMV9jb25m
aWcpKQogCQkJCWdvdG8gZnJvbnRlbmRfZGV0YWNoOwogCQl9CiAJCWJyZWFrOwpkaWZmIC1yIDc5
ZmMzMmJiYTBhMCBsaW51eC9kcml2ZXJzL21lZGlhL3ZpZGVvL3NhYTcxMzQvc2FhNzEzNC1kdmIu
YwotLS0gYS9saW51eC9kcml2ZXJzL21lZGlhL3ZpZGVvL3NhYTcxMzQvc2FhNzEzNC1kdmIuYwlN
b24gRGVjIDE0IDE3OjQzOjEzIDIwMDkgLTAyMDAKKysrIGIvbGludXgvZHJpdmVycy9tZWRpYS92
aWRlby9zYWE3MTM0L3NhYTcxMzQtZHZiLmMJVHVlIERlYyAxNSAxNjozNjoxNCAyMDA5ICswMTAw
CkBAIC03MTYsNiArNzE2LDEyIEBAIHN0YXRpYyBzdHJ1Y3QgdGRhMTAwNHhfY29uZmlnIGxpZmV2
aWV3X3QKIAkucmVxdWVzdF9maXJtd2FyZSA9IHBoaWxpcHNfdGRhMTAwNHhfcmVxdWVzdF9maXJt
d2FyZQogfTsKIAorc3RhdGljIHN0cnVjdCBpc2w2NDIxX2NvbmZpZyBsaWZldmlld190cmlvX2lz
bDY0MjFfY29uZmlnID0geworCS5pMmNfYWRkcmVzcyA9IDB4MDgsCisJLm92ZXJyaWRlX3NldCA9
IDB4MDAsCisJLm92ZXJyaWRlX2NsZWFyID0gMHgwMCwKK307CisKIHN0YXRpYyBzdHJ1Y3QgdGRh
MTAwNHhfY29uZmlnIHRldmlvbl9kdmJ0MjIwcmZfY29uZmlnID0gewogCS5kZW1vZF9hZGRyZXNz
ID0gMHgwOCwKIAkuaW52ZXJ0ICAgICAgICA9IDEsCkBAIC04OTUsNiArOTAxLDEyIEBAIHN0YXRp
YyBzdHJ1Y3QgdGRhMTAwODZfY29uZmlnIGZseWR2YnMgPSAKIAkuaW52ZXJ0ID0gMCwKIAkuZGlz
ZXFjX3RvbmUgPSAwLAogCS54dGFsX2ZyZXEgPSBUREExMDA4Nl9YVEFMXzE2TSwKK307CisKK3N0
YXRpYyBzdHJ1Y3QgaXNsNjQyMV9jb25maWcgZmx5ZHZic19pc2w2NDIxX2NvbmZpZyA9IHsKKwku
aTJjX2FkZHJlc3MgPSAweDA4LAorCS5vdmVycmlkZV9zZXQgPSAweDAwLAorCS5vdmVycmlkZV9j
bGVhciA9IDB4MDAsCiB9OwogCiBzdGF0aWMgc3RydWN0IHRkYTEwMDg2X2NvbmZpZyBzZDE4Nzhf
NG0gPSB7CkBAIC0xMjQ4LDcgKzEyNjAsNyBAQCBzdGF0aWMgaW50IGR2Yl9pbml0KHN0cnVjdCBz
YWE3MTM0X2RldiAqCiAJCQkJCWdvdG8gZGV0dGFjaF9mcm9udGVuZDsKIAkJCQl9CiAJCQkJaWYg
KGR2Yl9hdHRhY2goaXNsNjQyMV9hdHRhY2gsIGZlMC0+ZHZiLmZyb250ZW5kLCAmZGV2LT5pMmNf
YWRhcCwKLQkJCQkJCQkJCQkweDA4LCAwLCAwKSA9PSBOVUxMKSB7CisJCQkJCQkJCQkmbGlmZXZp
ZXdfdHJpb19pc2w2NDIxX2NvbmZpZykgPT0gTlVMTCkgewogCQkJCQl3cHJpbnRrKCIlczogTGlm
ZXZpZXcgVHJpbywgTm8gSVNMNjQyMSBmb3VuZCFcbiIsIF9fZnVuY19fKTsKIAkJCQkJZ290byBk
ZXR0YWNoX2Zyb250ZW5kOwogCQkJCX0KQEAgLTEzNDksNyArMTM2MSw4IEBAIHN0YXRpYyBpbnQg
ZHZiX2luaXQoc3RydWN0IHNhYTcxMzRfZGV2ICoKIAkJCQlnb3RvIGRldHRhY2hfZnJvbnRlbmQ7
CiAJCQl9CiAJCQlpZiAoZHZiX2F0dGFjaChpc2w2NDIxX2F0dGFjaCwgZmUwLT5kdmIuZnJvbnRl
bmQsCi0JCQkJICAgICAgICZkZXYtPmkyY19hZGFwLCAweDA4LCAwLCAwKSA9PSBOVUxMKSB7CisJ
CQkJICAgICAgICZkZXYtPmkyY19hZGFwLAorCQkJCSAgICAgICAmZmx5ZHZic19pc2w2NDIxX2Nv
bmZpZykgPT0gTlVMTCkgewogCQkJCXdwcmludGsoIiVzOiBObyBJU0w2NDIxIGZvdW5kIVxuIiwg
X19mdW5jX18pOwogCQkJCWdvdG8gZGV0dGFjaF9mcm9udGVuZDsKIAkJCX0K
--001485f6c5c6c3c29b047ac656a9--
