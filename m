Return-path: <linux-media-owner@vger.kernel.org>
Received: from mail.renesas.com ([202.234.163.13]:59126 "EHLO
	mail03.idc.renesas.com" rhost-flags-OK-OK-OK-FAIL) by vger.kernel.org
	with ESMTP id S1754120AbZJMFuO (ORCPT
	<rfc822;linux-media@vger.kernel.org>);
	Tue, 13 Oct 2009 01:50:14 -0400
Date: Tue, 13 Oct 2009 14:49:34 +0900
From: Kuninori Morimoto <morimoto.kuninori@renesas.com>
Subject: [PATCH 5/5] soc-camera: tw9910: Add revision control on
 tw9910_set_hsync
To: Guennadi Liakhovetski <g.liakhovetski@gmx.de>
Cc: Linux Media Mailing List <linux-media@vger.kernel.org>
Message-id: <ubpkbkfm9.wl%morimoto.kuninori@renesas.com>
MIME-version: 1.0 (generated by SEMI 1.14.6 - "Maruoka")
Content-type: text/plain; charset=US-ASCII
Sender: linux-media-owner@vger.kernel.org
List-ID: <linux-media.vger.kernel.org>

10 - 3 bit hsync control are same as Rev0/Rev1.
But only rev1 can control more 3 bit for hsync.
This patch modify this problem

Signed-off-by: Kuninori Morimoto <morimoto.kuninori@renesas.com>
---
 drivers/media/video/tw9910.c |   26 +++++++++++++++++---------
 1 files changed, 17 insertions(+), 9 deletions(-)

diff --git a/drivers/media/video/tw9910.c b/drivers/media/video/tw9910.c
index 59158bb..a688c11 100644
--- a/drivers/media/video/tw9910.c
+++ b/drivers/media/video/tw9910.c
@@ -349,6 +349,7 @@ static int tw9910_set_scale(struct i2c_client *client,
 static int tw9910_set_hsync(struct i2c_client *client,
 			    const u16 start, const u16 end)
 {
+	struct tw9910_priv *priv = to_tw9910(client);
 	int ret;
 
 	/* bit 10 - 3 */
@@ -363,15 +364,22 @@ static int tw9910_set_hsync(struct i2c_client *client,
 	if (ret < 0)
 		return ret;
 
-	/* bit 2 - 0 */
-	ret = i2c_smbus_read_byte_data(client, HSLOWCTL);
-	if (ret < 0)
-		return ret;
+	/* FIXME
+	 *
+	 * So far only revisions 0 and 1 have been seen
+	 */
+	if (1 == priv->rev) {
 
-	ret = i2c_smbus_write_byte_data(client, HSLOWCTL,
-					(ret   & 0x88)        |
-					(start & 0x0007) << 4 |
-					(end   & 0x0007));
+		/* bit 2 - 0 */
+		ret = i2c_smbus_read_byte_data(client, HSLOWCTL);
+		if (ret < 0)
+			return ret;
+
+		ret = i2c_smbus_write_byte_data(client, HSLOWCTL,
+						(ret   & 0x88)        |
+						(start & 0x0007) << 4 |
+						(end   & 0x0007));
+	}
 
 	return ret;
 }
-- 
1.6.0.4

