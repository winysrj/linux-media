Return-path: <linux-media-owner@vger.kernel.org>
Received: from mail6.sea5.speakeasy.net ([69.17.117.8]:47242 "EHLO
	mail6.sea5.speakeasy.net" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
	with ESMTP id S1751732AbZBRLJW (ORCPT
	<rfc822;linux-media@vger.kernel.org>);
	Wed, 18 Feb 2009 06:09:22 -0500
Received: from shell2.sea5.speakeasy.net ([69.17.116.3])
          (envelope-sender <xyzzy@speakeasy.org>)
          by mail6.sea5.speakeasy.net (qmail-ldap-1.03) with AES256-SHA encrypted SMTP
          for <linux-media@vger.kernel.org>; 18 Feb 2009 11:09:19 -0000
Date: Wed, 18 Feb 2009 03:09:19 -0800 (PST)
From: Trent Piepho <xyzzy@speakeasy.org>
To: linux-media@vger.kernel.org
Subject: not demuxing from interrupt context
Message-ID: <Pine.LNX.4.58.0902180305300.24268@shell2.speakeasy.net>
MIME-Version: 1.0
Content-Type: MULTIPART/MIXED; BOUNDARY="289735540-1341994823-1234955359=:24268"
Sender: linux-media-owner@vger.kernel.org
List-ID: <linux-media.vger.kernel.org>

  This message is in MIME format.  The first part should be readable text,
  while the remaining parts are likely unreadable without MIME-aware tools.
  Send mail to mime@docserver.cac.washington.edu for more info.

--289735540-1341994823-1234955359=:24268
Content-Type: TEXT/PLAIN; charset=US-ASCII

Here's an attempt to fix the pluto2 driver to not do this.  I don't have
the hardware or information about the hardware so I'm not sure if it's
right.  It's not that major of an undertaking.  It would have been easier
if the driver was already double buffering like it should have been.
--289735540-1341994823-1234955359=:24268
Content-Type: TEXT/PLAIN; charset=US-ASCII; name="pluto2-demux.patch"
Content-Transfer-Encoding: BASE64
Content-ID: <Pine.LNX.4.58.0902180309190.24268@shell2.speakeasy.net>
Content-Description: 
Content-Disposition: attachment; filename="pluto2-demux.patch"

IyBIRyBjaGFuZ2VzZXQgcGF0Y2gNCiMgVXNlciBUcmVudCBQaWVwaG8gPHh5
enp5QHNwZWFrZWFzeS5vcmc+DQojIERhdGUgMTIzNDk1NTMwNSAyODgwMA0K
IyBOb2RlIElEIGE1YWVhMWE4YjViYzE4NjZkMzU1OTI5NGE0Y2FmZjkwZjc4
NDdlZTMNCiMgUGFyZW50ICA5NjA5ODViYTMwYzY5YzAzZmIwMzBlZGQ0NTFi
YjI2ODQ2Y2E3NWEwDQpwbHV0bzI6IERlbXV4IHBhY2tldHMgZnJvbSBhIHdv
cmsgcXVldWUNCg0KRnJvbTogVHJlbnQgUGllcGhvIDx4eXp6eUBzcGVha2Vh
c3kub3JnPg0KDQpUaGlzIGRyaXZlciB3YXMgZGVtdXhpbmcgdGhlIHRyYW5z
cG9ydCBzdHJlYW0gZnJvbSBpdHMgaW50ZXJydXB0IGhhbmRsZXIuDQpUaGlz
IGlzIHByb2JsZW1hdGljIGFzIGRlbXV4aW5nIG11c3QgYmUgbG9ja2VkIGFn
YWluc3QgZGVtdXhlciBhY2Nlc3MgZnJvbQ0KcHJvY2VzcyBjb250ZXh0LiAg
SWYgZGVtdXhpbmcgaXMgZG9uZSBmcm9tIGludGVycnVwdCBjb250ZXh0IHRo
ZW4gbG9jYWwNCmlycXMgbXVzdCBiZSBkaXNhYmxlZCB3aGVuIHRoZSBkZW11
eGVyIGxvY2sgaXMgaGVsZC4gIEhvd2V2ZXIsIGRlbXV4aW5nIGlzDQp0b28g
bGVuZ3RoeSB0byBiZSBydW4gd2l0aCBJUlFzIG9mZi4NCg0KU29tZSBwcm9i
bGVtcyBhcmUgZXhwb3NlZCB3aXRoIHRoZSBzaW1wbGUgd2F5IHRoaXMgZHJp
dmVyIGRvZXMgRE1BLiAgSXQgaGFzDQphIHNpbmdsZSBETUEgYnVmZmVyLiAg
SXQgZ2V0cyBhbiBpbnRlcnJ1cHQgYWZ0ZXIgOCBUUyBwYWNrZXRzLCBwcm9j
ZXNzZXMNCihkZW11eGVzKSB0aG9zZSwgYW5kIHRoZW4gcmVzZXRzIHRoZSBk
ZXZpY2UncyBETUEgcG9pbnRlciBiYWNrIHRvIHRoZSBzdGFydA0Kb2YgdGhl
IGJ1ZmZlci4NCg0KUHJvY2Vzc2luZyB0aGUgcGFja2V0cyBtYXkgdGFrZSBh
IHdoaWxlLCBlLmcuLCB3aGVuIHRoZSBkZW11eGVyIGxvY2sgaXMNCmhlbGQg
YnkgYSBwcm9jZXNzLiAgSWYgbmV3IHBhY2tldHMgYXJlIHJlY2VpdmVkIGJl
Zm9yZSBwcm9jZXNzaW5nIGlzDQpmaW5pc2hlZCBhbmQgdGhlIERNQSBwb2lu
dGVyIGlzIHJlc2V0IHNvbWV0aGluZyB3aWxsIGhhdmUgdG8gYnJlYWsuICBN
YXliZQ0KdGhlIGNhcmQgd2lsbCBidWZmZXIgdGhlIHBhY2tldHMgdW50aWwg
dGhlIGludGVycnVwdCBpcyBhY2tlZCBhbmQgbG9zZSB0aGVtDQp3aGVuIGl0
cyBpbnRlcm5hbCBidWZmZXIgb3ZlcmZsb3dzPyAgTWF5YmUgaXQgd2lsbCBr
ZWVwIERNQWluZywgcGFzdCB0aGUNCmVuZCBvZiBvZiB0aGUgRE1BIGJ1ZmZl
cj8NCg0KSSd2ZSBnaXZlbiB0aGUgZHJpdmVyIHR3byBETUEgYnVmZmVycyB0
aGF0IGl0IHN3aXRjaGVzIGJldHdlZW4sIHRob3VnaCBpdA0KY2FuIGVhc2ls
eSBiZSBpbmNyZWFzZWQuICBXaGVuIGFuIGludGVycnVwdCBpcyByZWNlaXZl
ZCBpdCB3aWxsIHN3aXRjaCB0bw0KdGhlIG5leHQgYnVmZmVyIGFuZCBxdWV1
ZSBhbmQgd29yayBmdW5jdGlvbiB0byBkZWFsIHdpdGggdGhlIG9sZCBvbmUu
ICBUaGUNCndvcmsgZnVuY3Rpb24gYWxsb3dzIHRoZSBidWZmZXIgdG8gYmUg
ZGVtdXhlZCBmcm9tIHByb2Nlc3MgY29udGV4dC4NCg0KVGhlIGRyaXZlciB3
YXMgcmVxdWVzdGluZyB0aGUgSVJRIGJlZm9yZSBpdCB3YXMgZmluaXNoZWQg
c2V0dGluZyB1cC4gIFRoaXMNCmlzIGEgYmFkIGlkZWEgYXMgc2hhcmVkIElS
UXMgbWVhbiB0aGUgaW50ZXJydXB0IGhhbmRsZXIgY2FuIGdldCBjYWxsZWQg
YXMNCnNvb24gYXMgdGhlIElSUSBpcyByZXF1ZXN0ZWQsIGV2ZW4gaWYgdGhl
IGRldmljZSdzIElSUXMgaGF2ZW4ndCBiZWVuDQplbmFibGVkIHlldC4gIEl0
J3MgdmVyeSBlYXN5IHRvIHB1dCBjb2RlIGluIHRoZSBpbnRlcnJ1cHQgaGFu
ZGxlciB0aGF0IHdpbGwNCmNyYXNoIGlmIHRoZSBkcml2ZXIgaGFzbid0IGJl
ZW4gcHJvcGVybHkgc2V0dXAgeWV0Lg0KDQpUaGVyZSB3YXMgc29tZSBjb2Rl
IHRoYXQgYXR0ZW1wdHMgdG8gY291bnQgdGhlIG51bWJlciBvZiBUUyBwYWNr
ZXRzIGluIHRoZQ0KYnVmZmVyIGJ5IGxvb2tpbmcgZm9yIHN0YXJ0IGJ5dGVz
LiAgSXQgZGlkbid0IHRha2UgaW50byBhY2NvdW50IHRoZSBidWZmZXINCnNp
emUgYW5kIHdvdWxkIGtlZXAgZ29pbmcgcGFzdCB0aGUgZW5kIG9mIHRoZSBi
dWZmZXIgaWYgaXQgaGFwcGVuZWQgdG8gZmluZA0Kc3RhcnQgYnl0ZXMuICBV
bmxpa2VseSwgYnV0IHBvc3NpYmxlLg0KDQpQcmlvcml0eTogbm9ybWFsDQoN
ClNpZ25lZC1vZmYtYnk6IFRyZW50IFBpZXBobyA8eHl6enlAc3BlYWtlYXN5
Lm9yZz4NCg0KZGlmZiAtciA5NjA5ODViYTMwYzYgLXIgYTVhZWExYThiNWJj
IGxpbnV4L2RyaXZlcnMvbWVkaWEvZHZiL3BsdXRvMi9wbHV0bzIuYw0KLS0t
IGEvbGludXgvZHJpdmVycy9tZWRpYS9kdmIvcGx1dG8yL3BsdXRvMi5jCVR1
ZSBGZWIgMTAgMjE6MzE6NTkgMjAwOSArMDEwMA0KKysrIGIvbGludXgvZHJp
dmVycy9tZWRpYS9kdmIvcGx1dG8yL3BsdXRvMi5jCVdlZCBGZWIgMTggMDM6
MDg6MjUgMjAwOSAtMDgwMA0KQEAgLTg4LDEyICs4OCwyMSBAQCBEVkJfREVG
SU5FX01PRF9PUFRfQURBUFRFUl9OUihhZGFwdGVyX25yDQogDQogI2RlZmlu
ZSBUU19ETUFfUEFDS0VUUwkJKDgpDQogI2RlZmluZSBUU19ETUFfQllURVMJ
CSgxODggKiBUU19ETUFfUEFDS0VUUykNCisjZGVmaW5lIFRTX0RNQV9CVUZG
RVJTCQkoMikNCisjaWYgVFNfRE1BX0JZVEVTICsgMTg4ID4gUEFHRV9TSVpF
DQorI2Vycm9yICJETUEgYnVmZmVyIGxhcmdlciB0aGFuIG9uZSBwYWdlIg0K
KyNlbmRpZg0KIA0KICNkZWZpbmUgSTJDX0FERFJfVERBMTAwNDYJMHgxMA0K
ICNkZWZpbmUgSTJDX0FERFJfVFVBNjAzNAkweGMyDQogI2RlZmluZSBOSFdG
SUxURVJTCQk4DQogDQogc3RydWN0IHBsdXRvIHsNCisJLyogZG1hIGJ1ZmZl
ciwgYXQgc3RhcnQgc28gaXQncyBhbGlnbmVkLiAgRWFjaCBidWYgZ2V0cyBp
dHMgb3duDQorCSAqIHBhZ2UsIGV2ZW4gdGhvdWdoIHRoZXkgYXJlIHNtYWxs
ZXIuICAqLw0KKwl1OCBkbWFfYnVmW1RTX0RNQV9CVUZGRVJTXVtQQUdFX1NJ
WkVdOw0KKwlzdHJ1Y3Qgd29ya19zdHJ1Y3Qgd29yazsNCisNCiAJLyogcGNp
ICovDQogCXN0cnVjdCBwY2lfZGV2ICpwZGV2Ow0KIAl1OCBfX2lvbWVtICpp
b19tZW07DQpAQCAtMTE4LDkgKzEyNywxMiBAQCBzdHJ1Y3QgcGx1dG8gew0K
IAl1bnNpZ25lZCBpbnQgb3ZlcmZsb3c7DQogDQogCS8qIGRtYSAqLw0KLQlk
bWFfYWRkcl90IGRtYV9hZGRyOw0KLQl1OCBkbWFfYnVmW1RTX0RNQV9CWVRF
U107DQotCXU4IGR1bW15WzQwOTZdOw0KKwlkbWFfYWRkcl90IGRtYV9hZGRy
W1RTX0RNQV9CVUZGRVJTXTsNCisJYXRvbWljX3QgbnBhY2tldHNbVFNfRE1B
X0JVRkZFUlNdOw0KKwl1bnNpZ25lZCBpbnQgZG1hX2J1Zl9udW0sIGRteF9i
dWZfbnVtOw0KKw0KKwlzdHJ1Y3Qgd29ya3F1ZXVlX3N0cnVjdCAqZG1hcTsN
CisJY2hhciB3cW5hbWVbMTZdOw0KIH07DQogDQogc3RhdGljIGlubGluZSBz
dHJ1Y3QgcGx1dG8gKmZlZWRfdG9fcGx1dG8oc3RydWN0IGR2Yl9kZW11eF9m
ZWVkICpmZWVkKQ0KQEAgLTIzMiwyNiArMjQ0LDM2IEBAIHN0YXRpYyB2b2lk
IHBsdXRvX3Jlc2V0X3RzKHN0cnVjdCBwbHV0byANCiAJfQ0KIH0NCiANCi1z
dGF0aWMgdm9pZCBwbHV0b19zZXRfZG1hX2FkZHIoc3RydWN0IHBsdXRvICpw
bHV0bykNCi17DQotCXBsdXRvX3dyaXRlcmVnKHBsdXRvLCBSRUdfUENBUiwg
cGx1dG8tPmRtYV9hZGRyKTsNCitzdGF0aWMgdm9pZCBwbHV0b19zZXRfZG1h
X2FkZHIoc3RydWN0IHBsdXRvICpwbHV0bywgdW5zaWduZWQgaW50IG51bSkN
Cit7DQorCXBsdXRvX3dyaXRlcmVnKHBsdXRvLCBSRUdfUENBUiwgcGx1dG8t
PmRtYV9hZGRyW251bV0pOw0KIH0NCiANCiBzdGF0aWMgaW50IF9fZGV2aW5p
dCBwbHV0b19kbWFfbWFwKHN0cnVjdCBwbHV0byAqcGx1dG8pDQogew0KLQlw
bHV0by0+ZG1hX2FkZHIgPSBwY2lfbWFwX3NpbmdsZShwbHV0by0+cGRldiwg
cGx1dG8tPmRtYV9idWYsDQorCWludCByOw0KKw0KKwlwbHV0by0+ZG1hX2Fk
ZHJbMF0gPSBwY2lfbWFwX3NpbmdsZShwbHV0by0+cGRldiwgcGx1dG8tPmRt
YV9idWZbMF0sDQogCQkJVFNfRE1BX0JZVEVTLCBQQ0lfRE1BX0ZST01ERVZJ
Q0UpOw0KLQ0KLSNpZiBMSU5VWF9WRVJTSU9OX0NPREUgPCBLRVJORUxfVkVS
U0lPTigyLCA2LCAyNykNCi0JcmV0dXJuIHBjaV9kbWFfbWFwcGluZ19lcnJv
cihwbHV0by0+ZG1hX2FkZHIpOw0KLSNlbHNlDQotCXJldHVybiBwY2lfZG1h
X21hcHBpbmdfZXJyb3IocGx1dG8tPnBkZXYsIHBsdXRvLT5kbWFfYWRkcik7
DQotI2VuZGlmDQorCXIgPSBwY2lfZG1hX21hcHBpbmdfZXJyb3IocGx1dG8t
PnBkZXYsIHBsdXRvLT5kbWFfYWRkclswXSk7DQorCWlmIChyKQ0KKwkJcmV0
dXJuIHI7DQorDQorCXBsdXRvLT5kbWFfYWRkclsxXSA9IHBjaV9tYXBfc2lu
Z2xlKHBsdXRvLT5wZGV2LCBwbHV0by0+ZG1hX2J1ZlsxXSwNCisJCQlUU19E
TUFfQllURVMsIFBDSV9ETUFfRlJPTURFVklDRSk7DQorCXIgPSBwY2lfZG1h
X21hcHBpbmdfZXJyb3IocGx1dG8tPnBkZXYsIHBsdXRvLT5kbWFfYWRkclsx
XSk7DQorCWlmIChyKQ0KKwkJcGNpX3VubWFwX3NpbmdsZShwbHV0by0+cGRl
diwgcGx1dG8tPmRtYV9hZGRyWzBdLA0KKwkJCQkgVFNfRE1BX0JZVEVTLCBQ
Q0lfRE1BX0ZST01ERVZJQ0UpOw0KKw0KKwlyZXR1cm4gcjsNCiB9DQogDQog
c3RhdGljIHZvaWQgcGx1dG9fZG1hX3VubWFwKHN0cnVjdCBwbHV0byAqcGx1
dG8pDQogew0KLQlwY2lfdW5tYXBfc2luZ2xlKHBsdXRvLT5wZGV2LCBwbHV0
by0+ZG1hX2FkZHIsDQorCXBjaV91bm1hcF9zaW5nbGUocGx1dG8tPnBkZXYs
IHBsdXRvLT5kbWFfYWRkclswXSwNCisJCQlUU19ETUFfQllURVMsIFBDSV9E
TUFfRlJPTURFVklDRSk7DQorCXBjaV91bm1hcF9zaW5nbGUocGx1dG8tPnBk
ZXYsIHBsdXRvLT5kbWFfYWRkclsxXSwNCiAJCQlUU19ETUFfQllURVMsIFBD
SV9ETUFfRlJPTURFVklDRSk7DQogfQ0KIA0KQEAgLTI4OSw5ICszMTEsMTIg
QEAgc3RhdGljIGludCBwbHV0b19zdG9wX2ZlZWQoc3RydWN0IGR2Yl9kZQ0K
IA0KIHN0YXRpYyB2b2lkIHBsdXRvX2RtYV9lbmQoc3RydWN0IHBsdXRvICpw
bHV0bywgdW5zaWduZWQgaW50IG5icGFja2V0cykNCiB7DQorCXVuc2lnbmVk
IGludCBibnVtID0gcGx1dG8tPmRtYV9idWZfbnVtICUgVFNfRE1BX0JVRkZF
UlM7DQorCXVuc2lnbmVkIGludCBuZXdibnVtOw0KKw0KIAkvKiBzeW5jaHJv
bml6ZSB0aGUgRE1BIHRyYW5zZmVyIHdpdGggdGhlIENQVQ0KIAkgKiBmaXJz
dCBzbyB0aGF0IHdlIHNlZSB1cGRhdGVkIGNvbnRlbnRzLiAqLw0KLQlwY2lf
ZG1hX3N5bmNfc2luZ2xlX2Zvcl9jcHUocGx1dG8tPnBkZXYsIHBsdXRvLT5k
bWFfYWRkciwNCisJcGNpX2RtYV9zeW5jX3NpbmdsZV9mb3JfY3B1KHBsdXRv
LT5wZGV2LCBwbHV0by0+ZG1hX2FkZHJbYm51bV0sDQogCQkJVFNfRE1BX0JZ
VEVTLCBQQ0lfRE1BX0ZST01ERVZJQ0UpOw0KIA0KIAkvKiBXb3JrYXJvdW5k
IGZvciBicm9rZW4gaGFyZHdhcmU6DQpAQCAtMzA1LDI4ICszMzAsNzMgQEAg
c3RhdGljIHZvaWQgcGx1dG9fZG1hX2VuZChzdHJ1Y3QgcGx1dG8gKg0KIAkg
KiAgICAgaGFzIGJlZW4gdHJhbnNmZXJlZC4gT25seSBhIHJlc2V0IHNlZW1z
IHRvIHNvbHZlIHRoaXMNCiAJICovDQogCWlmICgobmJwYWNrZXRzID09IDAp
IHx8IChuYnBhY2tldHMgPiBUU19ETUFfUEFDS0VUUykpIHsNCi0JCXVuc2ln
bmVkIGludCBpID0gMDsNCi0JCXdoaWxlIChwbHV0by0+ZG1hX2J1ZltpXSA9
PSAweDQ3KQ0KLQkJCWkgKz0gMTg4Ow0KLQkJbmJwYWNrZXRzID0gaSAvIDE4
ODsNCi0JCWlmIChpID09IDApIHsNCisJCXVuc2lnbmVkIGludCBpOw0KKw0K
KwkJZm9yIChpID0gMCwgbmJwYWNrZXRzID0gMDsNCisJCSAgICAgaSA8IHNp
emVvZihwbHV0by0+ZG1hX2J1ZltibnVtXSkgJiYgcGx1dG8tPmRtYV9idWZb
Ym51bV1baV0gPT0gMHg0NzsNCisJCSAgICAgaSArPSAxODgsIG5icGFja2V0
cysrKQ0KKwkJCTsNCisNCisJCWlmIChuYnBhY2tldHMgPT0gMCkgew0KIAkJ
CXBsdXRvX3Jlc2V0X3RzKHBsdXRvLCAxKTsNCi0JCQlkZXZfcHJpbnRrKEtF
Uk5fREVCVUcsICZwbHV0by0+cGRldi0+ZGV2LCAicmVzZXR0aW5nIFRTIGJl
Y2F1c2Ugb2YgaW52YWxpZCBwYWNrZXQgY291bnRlclxuIik7DQorCQkJZGV2
X2RiZygmcGx1dG8tPnBkZXYtPmRldiwNCisJCQkJInJlc2V0dGluZyBUUyBi
ZWNhdXNlIG9mIGludmFsaWQgcGFja2V0IGNvdW50ZXJcbiIpOw0KIAkJfQ0K
IAl9DQogDQotCWR2Yl9kbXhfc3dmaWx0ZXJfcGFja2V0cygmcGx1dG8tPmRl
bXV4LCBwbHV0by0+ZG1hX2J1ZiwgbmJwYWNrZXRzKTsNCisJLyogTWFyayBi
dWZmZXIgYXMgdXNlZCAqLw0KKwlhdG9taWNfc2V0KCZwbHV0by0+bnBhY2tl
dHNbYm51bV0sIG5icGFja2V0cyk7DQorDQorCWlmIChuYnBhY2tldHMpIHsN
CisJCS8qIFN3aXRjaCB0byB0aGUgbmV4dCBidWZmZXIgKi8NCisJCXBsdXRv
LT5kbWFfYnVmX251bSsrOw0KKw0KKwkJLyogcXVldWUgc2VuZGluZyBidWZm
ZXIgdG8gZGVtdXhlciAqLw0KKwkJcXVldWVfd29yayhwbHV0by0+ZG1hcSwg
JnBsdXRvLT53b3JrKTsNCisJfQ0KKwluZXdibnVtID0gcGx1dG8tPmRtYV9i
dWZfbnVtICUgVFNfRE1BX0JVRkZFUlM7DQorDQorCWlmIChhdG9taWNfcmVh
ZCgmcGx1dG8tPm5wYWNrZXRzW25ld2JudW1dKSkNCisJCWRldl93YXJuKCZw
bHV0by0+cGRldi0+ZGV2LCAiT3ZlcmZsb3csIGJ1ZmZlciBub3QgcmVhZHki
KTsNCisJCS8qIHNob3VsZCBwcm9iYWJseSBkbyBzb21ldGhpbmcgaGVyZSAq
Lw0KKw0KKwkvKiBTeW5jIHRoZSBuZXcgYnVmZmVyIGFuZCBnaXZlIGl0IGJh
Y2sgdG8gdGhlIGNhcmQgKi8NCisJcGNpX2RtYV9zeW5jX3NpbmdsZV9mb3Jf
ZGV2aWNlKHBsdXRvLT5wZGV2LCBwbHV0by0+ZG1hX2FkZHJbbmV3Ym51bV0s
DQorCQkJCSAgICAgICBUU19ETUFfQllURVMsIFBDSV9ETUFfRlJPTURFVklD
RSk7DQorDQorCS8qIHJlc2V0IHRoZSBkbWEgYWRkcmVzcyAqLw0KKwlwbHV0
b19zZXRfZG1hX2FkZHIocGx1dG8sIG5ld2JudW0pOw0KK30NCisNCisjaWYg
TElOVVhfVkVSU0lPTl9DT0RFIDwgS0VSTkVMX1ZFUlNJT04oMiw2LDIwKQ0K
K3N0YXRpYyB2b2lkIHBsdXRvX2RteF9idWZmZXIodm9pZCAqX3BsdXRvKQ0K
KyNlbHNlDQorc3RhdGljIHZvaWQgcGx1dG9fZG14X2J1ZmZlcihzdHJ1Y3Qg
d29ya19zdHJ1Y3QgKndvcmspDQorI2VuZGlmDQorew0KKyNpZiBMSU5VWF9W
RVJTSU9OX0NPREUgPCBLRVJORUxfVkVSU0lPTigyLDYsMjApDQorCXN0cnVj
dCBwbHV0byAqcGx1dG8gPSBfcGx1dG87DQorI2Vsc2UNCisJc3RydWN0IHBs
dXRvICpwbHV0byA9IGNvbnRhaW5lcl9vZih3b3JrLCBzdHJ1Y3QgcGx1dG8s
IHdvcmspOw0KKyNlbmRpZg0KKwl1bnNpZ25lZCBpbnQgYm51bSA9IHBsdXRv
LT5kbXhfYnVmX251bSAlIFRTX0RNQV9CVUZGRVJTOw0KKwl1bnNpZ25lZCBp
bnQgbnBhY2tldHMgPSBhdG9taWNfcmVhZCgmcGx1dG8tPm5wYWNrZXRzW2Ju
dW1dKTsNCisJdW5zaWduZWQgaW50IGk7DQorDQorCWlmICghbnBhY2tldHMp
DQorCQlyZXR1cm47DQorDQorCWR2Yl9kbXhfc3dmaWx0ZXJfcGFja2V0cygm
cGx1dG8tPmRlbXV4LCBwbHV0by0+ZG1hX2J1ZltibnVtXSwgbnBhY2tldHMp
Ow0KIA0KIAkvKiBjbGVhciB0aGUgZG1hIGJ1ZmZlci4gdGhpcyBpcyBuZWVk
ZWQgdG8gYmUgYWJsZSB0byBpZGVudGlmeQ0KIAkgKiBuZXcgdmFsaWQgdHMg
cGFja2V0cyBhYm92ZSAqLw0KLQltZW1zZXQocGx1dG8tPmRtYV9idWYsIDAs
IG5icGFja2V0cyAqIDE4OCk7DQotDQotCS8qIHJlc2V0IHRoZSBkbWEgYWRk
cmVzcyAqLw0KLQlwbHV0b19zZXRfZG1hX2FkZHIocGx1dG8pOw0KLQ0KLQkv
KiBzeW5jIHRoZSBidWZmZXIgYW5kIGdpdmUgaXQgYmFjayB0byB0aGUgY2Fy
ZCAqLw0KLQlwY2lfZG1hX3N5bmNfc2luZ2xlX2Zvcl9kZXZpY2UocGx1dG8t
PnBkZXYsIHBsdXRvLT5kbWFfYWRkciwNCi0JCQlUU19ETUFfQllURVMsIFBD
SV9ETUFfRlJPTURFVklDRSk7DQorCWZvciAoaSA9IDAsIG5wYWNrZXRzKys7
IG5wYWNrZXRzOyBucGFja2V0cy0tLCBpICs9IDE4OCkNCisJCXBsdXRvLT5k
bWFfYnVmW2JudW1dW2ldID0gMDsNCisNCisJLyogTWFyayBidWZmZXIgYXMg
ZW1wdHkgKi8NCisJYXRvbWljX3NldCgmcGx1dG8tPm5wYWNrZXRzW2JudW1d
LCAwKTsNCisNCisJcGx1dG8tPmRteF9idWZfbnVtKys7DQogfQ0KIA0KICNp
ZiBMSU5VWF9WRVJTSU9OX0NPREUgPCBLRVJORUxfVkVSU0lPTigyLDYsMTkp
DQpAQCAtMzQ5LDIwICs0MTksMTkgQEAgc3RhdGljIGlycXJldHVybl90IHBs
dXRvX2lycShpbnQgaXJxLCB2bw0KIAkJcmV0dXJuIElSUV9IQU5ETEVEOw0K
IAl9DQogDQorCS8qIG92ZXJmbG93IGludGVycnVwdCAqLw0KKwlpZiAodHNj
ciAmIFRTQ1JfT1ZSKQ0KKwkJcGx1dG8tPm92ZXJmbG93Kys7DQorDQogCS8q
IGRtYSBlbmQgaW50ZXJydXB0ICovDQogCWlmICh0c2NyICYgVFNDUl9ERSkg
ew0KIAkJcGx1dG9fZG1hX2VuZChwbHV0bywgKHRzY3IgJiBUU0NSX05CUEFD
S0VUUykgPj4gMjQpOw0KLQkJLyogb3ZlcmZsb3cgaW50ZXJydXB0ICovDQot
CQlpZiAodHNjciAmIFRTQ1JfT1ZSKQ0KLQkJCXBsdXRvLT5vdmVyZmxvdysr
Ow0KIAkJaWYgKHBsdXRvLT5vdmVyZmxvdykgew0KIAkJCWRldl9lcnIoJnBs
dXRvLT5wZGV2LT5kZXYsICJvdmVyZmxvdyBpcnEgKCVkKVxuIiwNCiAJCQkJ
CXBsdXRvLT5vdmVyZmxvdyk7DQogCQkJcGx1dG9fcmVzZXRfdHMocGx1dG8s
IDEpOw0KIAkJCXBsdXRvLT5vdmVyZmxvdyA9IDA7DQogCQl9DQotCX0gZWxz
ZSBpZiAodHNjciAmIFRTQ1JfT1ZSKSB7DQotCQlwbHV0by0+b3ZlcmZsb3cr
KzsNCiAJfQ0KIA0KIAkvKiBBQ0sgdGhlIGludGVycnVwdCAqLw0KQEAgLTQx
Miw3ICs0ODEsNyBAQCBzdGF0aWMgaW50IF9fZGV2aW5pdCBwbHV0b19od19p
bml0KHN0cnVjDQogI2VuZGlmDQogCS8qIG1hcCBETUEgYW5kIHNldCBhZGRy
ZXNzICovDQogCXBsdXRvX2RtYV9tYXAocGx1dG8pOw0KLQlwbHV0b19zZXRf
ZG1hX2FkZHIocGx1dG8pOw0KKwlwbHV0b19zZXRfZG1hX2FkZHIocGx1dG8s
IDApOw0KIA0KIAkvKiBlbmFibGUgaW50ZXJydXB0cyAqLw0KIAlwbHV0b19l
bmFibGVfaXJxcyhwbHV0byk7DQpAQCAtNjEwLDcgKzY3OSw3IEBAIHN0YXRp
YyBpbnQgX19kZXZpbml0IHBsdXRvMl9wcm9iZShzdHJ1Y3QNCiANCiAJcGx1
dG8gPSBremFsbG9jKHNpemVvZihzdHJ1Y3QgcGx1dG8pLCBHRlBfS0VSTkVM
KTsNCiAJaWYgKCFwbHV0bykNCi0JCWdvdG8gb3V0Ow0KKwkJcmV0dXJuIC1F
Tk9NRU07DQogDQogCXBsdXRvLT5wZGV2ID0gcGRldjsNCiANCkBAIC02Mzks
MTMgKzcwOCw5IEBAIHN0YXRpYyBpbnQgX19kZXZpbml0IHBsdXRvMl9wcm9i
ZShzdHJ1Y3QNCiANCiAJcGNpX3NldF9kcnZkYXRhKHBkZXYsIHBsdXRvKTsN
CiANCi0JcmV0ID0gcmVxdWVzdF9pcnEocGRldi0+aXJxLCBwbHV0b19pcnEs
IElSUUZfU0hBUkVELCBEUklWRVJfTkFNRSwgcGx1dG8pOw0KKwlyZXQgPSBw
bHV0b19od19pbml0KHBsdXRvKTsNCiAJaWYgKHJldCA8IDApDQogCQlnb3Rv
IGVycl9wY2lfaW91bm1hcDsNCi0NCi0JcmV0ID0gcGx1dG9faHdfaW5pdChw
bHV0byk7DQotCWlmIChyZXQgPCAwKQ0KLQkJZ290byBlcnJfZnJlZV9pcnE7
DQogDQogCS8qIGkyYyAqLw0KIAlpMmNfc2V0X2FkYXBkYXRhKCZwbHV0by0+
aTJjX2FkYXAsIHBsdXRvKTsNCkBAIC03MjEsOSArNzg2LDI3IEBAIHN0YXRp
YyBpbnQgX19kZXZpbml0IHBsdXRvMl9wcm9iZShzdHJ1Y3QNCiAJCWdvdG8g
ZXJyX2Rpc2Nvbm5lY3RfZnJvbnRlbmQ7DQogDQogCWR2Yl9uZXRfaW5pdChk
dmJfYWRhcHRlciwgJnBsdXRvLT5kdmJuZXQsIGRteCk7DQotb3V0Og0KLQly
ZXR1cm4gcmV0Ow0KLQ0KKw0KKyNpZiBMSU5VWF9WRVJTSU9OX0NPREUgPCBL
RVJORUxfVkVSU0lPTigyLDYsMjApDQorCUlOSVRfV09SSygmcGx1dG8tPndv
cmssIHBsdXRvX2RteF9idWZmZXIsIHBsdXRvKTsNCisjZWxzZQ0KKwlJTklU
X1dPUksoJnBsdXRvLT53b3JrLCBwbHV0b19kbXhfYnVmZmVyKTsNCisjZW5k
aWYNCisJc3ByaW50ZihwbHV0by0+d3FuYW1lLCAiJXNbJWRdIGR2YiIsIGR2
Yl9hZGFwdGVyLT5uYW1lLCBkdmJfYWRhcHRlci0+bnVtKTsNCisJcGx1dG8t
PmRtYXEgPSBjcmVhdGVfc2luZ2xldGhyZWFkX3dvcmtxdWV1ZShwbHV0by0+
d3FuYW1lKTsNCisJaWYgKCFwbHV0by0+ZG1hcSkNCisJCWdvdG8gZXJyX2R2
Yl9uZXQ7DQorDQorCXJldCA9IHJlcXVlc3RfaXJxKHBkZXYtPmlycSwgcGx1
dG9faXJxLCBJUlFGX1NIQVJFRCwgRFJJVkVSX05BTUUsIHBsdXRvKTsNCisJ
aWYgKHJldCA8IDApDQorCQlnb3RvIGVycl93b3JrcXVldWU7DQorDQorCXJl
dHVybiAwOw0KKw0KK2Vycl93b3JrcXVldWU6DQorCWRlc3Ryb3lfd29ya3F1
ZXVlKHBsdXRvLT5kbWFxKTsNCitlcnJfZHZiX25ldDoNCisJZHZiX25ldF9y
ZWxlYXNlKCZwbHV0by0+ZHZibmV0KTsNCiBlcnJfZGlzY29ubmVjdF9mcm9u
dGVuZDoNCiAJZG14LT5kaXNjb25uZWN0X2Zyb250ZW5kKGRteCk7DQogZXJy
X3JlbW92ZV9tZW1fZnJvbnRlbmQ6DQpAQCAtNzQwLDggKzgyMyw2IEBAIGVy
cl9pMmNfZGVsX2FkYXB0ZXI6DQogCWkyY19kZWxfYWRhcHRlcigmcGx1dG8t
PmkyY19hZGFwKTsNCiBlcnJfcGx1dG9faHdfZXhpdDoNCiAJcGx1dG9faHdf
ZXhpdChwbHV0byk7DQotZXJyX2ZyZWVfaXJxOg0KLQlmcmVlX2lycShwZGV2
LT5pcnEsIHBsdXRvKTsNCiBlcnJfcGNpX2lvdW5tYXA6DQogCXBjaV9pb3Vu
bWFwKHBkZXYsIHBsdXRvLT5pb19tZW0pOw0KIGVycl9wY2lfcmVsZWFzZV9y
ZWdpb25zOg0KQEAgLTc1MSw3ICs4MzIsNyBAQCBlcnJfa2ZyZWU6DQogZXJy
X2tmcmVlOg0KIAlwY2lfc2V0X2RydmRhdGEocGRldiwgTlVMTCk7DQogCWtm
cmVlKHBsdXRvKTsNCi0JZ290byBvdXQ7DQorCXJldHVybiByZXQ7DQogfQ0K
IA0KIHN0YXRpYyB2b2lkIF9fZGV2ZXhpdCBwbHV0bzJfcmVtb3ZlKHN0cnVj
dCBwY2lfZGV2ICpwZGV2KQ0KZGlmZiAtciA5NjA5ODViYTMwYzYgLXIgYTVh
ZWExYThiNWJjIHY0bC9jb21wYXQuaA0KLS0tIGEvdjRsL2NvbXBhdC5oCVR1
ZSBGZWIgMTAgMjE6MzE6NTkgMjAwOSArMDEwMA0KKysrIGIvdjRsL2NvbXBh
dC5oCVdlZCBGZWIgMTggMDM6MDg6MjUgMjAwOSAtMDgwMA0KQEAgLTQyMSw0
ICs0MjEsOCBAQCBzdGF0aWMgaW5saW5lIGludCB1c2JfZW5kcG9pbnRfdHlw
ZShjb25zDQogCX0gd2hpbGUgKDApDQogI2VuZGlmDQogDQotI2VuZGlmDQor
I2lmIExJTlVYX1ZFUlNJT05fQ09ERSA8IEtFUk5FTF9WRVJTSU9OKDIsIDYs
IDI3KQ0KKyNkZWZpbmUgcGNpX2RtYV9tYXBwaW5nX2Vycm9yKGRldiwgYWRk
cikJcGNpX2RtYV9tYXBwaW5nX2Vycm9yKGFkZHIpDQorI2VuZGlmDQorDQor
I2VuZGlmDQo=

--289735540-1341994823-1234955359=:24268--
