Return-path: <linux-media-owner@vger.kernel.org>
Received: from yw-out-2324.google.com ([74.125.46.31]:52997 "EHLO
	yw-out-2324.google.com" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
	with ESMTP id S1752700AbZFQXS2 (ORCPT
	<rfc822;linux-media@vger.kernel.org>);
	Wed, 17 Jun 2009 19:18:28 -0400
Received: by yw-out-2324.google.com with SMTP id 5so377701ywb.1
        for <linux-media@vger.kernel.org>; Wed, 17 Jun 2009 16:18:30 -0700 (PDT)
MIME-Version: 1.0
Date: Wed, 17 Jun 2009 18:18:30 -0500
Message-ID: <ccdf9f470906171618r26518ce7pa97d747e301009ca@mail.gmail.com>
Subject: [Patch] New utility program atsc_epg added to dvb-apps utility suite.
From: Yufei Yuan <yfyuan@gmail.com>
To: Linux Media Mailing List <linux-media@vger.kernel.org>
Content-Type: multipart/mixed; boundary=0016362835a65fc86e046c9382e4
Sender: linux-media-owner@vger.kernel.org
List-ID: <linux-media.vger.kernel.org>

--0016362835a65fc86e046c9382e4
Content-Type: text/plain; charset=ISO-2022-JP
Content-Transfer-Encoding: 7bit

Hi,

I am not sure if this is the correct mailing list to send this patch.
>From the LinuxTV website, it seems that currently dvb-apps project has
no owner.

A new utility atsc_epg is added into the dvb-apps utility suite. It
parses PSIP information carried in OTA ATSC channels, and constructs a
basic EPG in a terminal window. Changes were also made to files to
please GCC4.4.

The patch is against latest revision 1278 from the dvb-apps repository.

Regards,
Yufei Yuan

-- 
好学近乎智，力行近乎仁，知耻近乎勇。
Eagerness in learning is close to intelligence.
Commitment in doing is close to nobleness.
Realization of shamefulness is close to courageousness.

--0016362835a65fc86e046c9382e4
Content-Type: application/octet-stream; name="atsc_epg_base_1278.patch"
Content-Disposition: attachment; filename="atsc_epg_base_1278.patch"
Content-Transfer-Encoding: base64
X-Attachment-Id: f_fw2nq8am0

IyBIRyBjaGFuZ2VzZXQgcGF0Y2gKIyBVc2VyIFl1ZmVpIFl1YW4gPHlmeXVhbkBnbWFpbC5jb20+
CiMgRGF0ZSAxMjQ1MjU5NzQ0IDE4MDAwCiMgTm9kZSBJRCA0ODYwNTM5NzkxMmJhZjgzNGYyZmZi
ZTk1ZDQ0YzUxZmFlZDM4MmM2CiMgUGFyZW50ICBlZTRmMmRiYjhmMjhlOTMzNTFkMDBhYTM4YjBi
ZDM2NDY5MTU1NzY5ClB1bGxpbmcgRVRUIGluZm9ybWF0aW9uIGNhbiBub3cgYmUgaW50ZXJydXB0
ZWQgdXNpbmcgQ3RybCtDIGFuZCBzdGlsbCBoYXZlIHBhcnRpYWwgcHJpbnRvdXQuCgpkaWZmIC1y
IGVlNGYyZGJiOGYyOCAtciA0ODYwNTM5NzkxMmIgdXRpbC9hdHNjX2VwZy9SRUFETUUKLS0tIGEv
dXRpbC9hdHNjX2VwZy9SRUFETUUJTW9uIEp1biAxNSAyMjoxMzoyMCAyMDA5IC0wNTAwCisrKyBi
L3V0aWwvYXRzY19lcGcvUkVBRE1FCVdlZCBKdW4gMTcgMTI6Mjk6MDQgMjAwOSAtMDUwMApAQCAt
Myw2ICszLDggQEAKIGF0c2NfZXBnIGlzIGEgc21hbGwgdXRpbGl0eSBmb3Igb2J0YWluaW5nIGlu
Zm9ybWF0aW9uIHN1Y2ggYXMgcHJvZ3JhbXMsIEVQRyAKIChlbGVjdHJvbmljIHByb2dyYW0gZ3Vp
ZGUpIGZyb20gYW4gQVRTQyBjaGFubmVsLiAKIAorUHVsbGluZyB0aGUgZGV0YWlsZWQgaW5mb3Jt
YXRpb24sIGkuZS4sIG9wdGlvbiAnLXQnLCBtYXkgdGFrZSBmYWlybHkgbG9uZyB0aW1lLCBvciBu
ZXZlciBlbmRpbmcsIHdoaWNoIGlzIGEgYnVnIG9mIHRoZSBQU0lQIGdlbmVyYXRvci4gQ3RybCtD
IGNhbiBiZSB1c2VkIHRvIGFib3J0IGFuZCB0aGUgcmVjZWl2ZWQgcGFydHMgd2lsbCBiZSBwcmlu
dGVkLgorCiBFbmpveSwKIFl1ZmVpCiAKZGlmZiAtciBlZTRmMmRiYjhmMjggLXIgNDg2MDUzOTc5
MTJiIHV0aWwvYXRzY19lcGcvYXRzY19lcGcuYwotLS0gYS91dGlsL2F0c2NfZXBnL2F0c2NfZXBn
LmMJTW9uIEp1biAxNSAyMjoxMzoyMCAyMDA5IC0wNTAwCisrKyBiL3V0aWwvYXRzY19lcGcvYXRz
Y19lcGcuYwlXZWQgSnVuIDE3IDEyOjI5OjA0IDIwMDkgLTA1MDAKQEAgLTIzLDYgKzIzLDcgQEAK
ICNpbmNsdWRlIDx1bmlzdGQuaD4KICNpbmNsdWRlIDxzdHJpbmcuaD4KICNpbmNsdWRlIDx0aW1l
Lmg+CisjaW5jbHVkZSA8c2lnbmFsLmg+CiAjaW5jbHVkZSA8c3lzL3R5cGVzLmg+CiAjaW5jbHVk
ZSA8c3lzL3N0YXQuaD4KICNpbmNsdWRlIDxmY250bC5oPgpAQCAtNTMsOCArNTQsMTAgQEAKIHN0
YXRpYyBpbnQgcGVyaW9kID0gMTI7IC8qIGhvdXJzICovCiBzdGF0aWMgaW50IGZyZXF1ZW5jeTsK
IHN0YXRpYyBpbnQgZW5hYmxlX2V0dCA9IDA7CitzdGF0aWMgaW50IGN0cmxfYyA9IDA7CiBzdGF0
aWMgY29uc3QgY2hhciAqbW9kdWxhdGlvbiA9IE5VTEw7CiBzdGF0aWMgY2hhciBzZXBhcmF0b3Jb
ODBdOwordm9pZCAoKm9sZF9oYW5kbGVyKShpbnQpOwogCiBzdHJ1Y3QgYXRzY19zdHJpbmdfYnVm
ZmVyIHsKICAgICBpbnQgYnVmX2xlbjsKQEAgLTc1LDYgKzc4LDggQEAKIHN0cnVjdCBhdHNjX2Vp
dF9zZWN0aW9uX2luZm8gewogICAgIHVpbnQ4X3Qgc2VjdGlvbl9udW07CiAgICAgdWludDhfdCBu
dW1fZXZlbnRzOworICAgIHVpbnQ4X3QgbnVtX2V0bXM7CisgICAgdWludDhfdCBudW1fcmVjZWl2
ZWRfZXRtczsKICAgICBzdHJ1Y3QgYXRzY19ldmVudF9pbmZvICoqZXZlbnRzOwogfTsKIApAQCAt
MTYxLDYgKzE2NiwxNCBAQAogICAgIE5VTEwsIE5VTEwKIH07CiAKK3N0YXRpYyB2b2lkIGludF9o
YW5kbGVyKGludCBzaWdfbnVtKSAKK3sKKyAgICBpZihTSUdJTlQgIT0gc2lnX251bSkgeworICAg
ICAgICByZXR1cm47CisgICAgfQorICAgIGN0cmxfYyA9IDE7Cit9CisKIC8qIHNoYW1lbGVzc2x5
IHN0b2xlbiBmcm9tIGR2YnNub29wLCBidXQgbW9kaWZpZWQgKi8KIHN0YXRpYyB1aW50MzJfdCBn
ZXRfYml0cyhjb25zdCB1aW50OF90ICpidWYsIGludCBzdGFydGJpdCwgaW50IGJpdGxlbikKIHsK
QEAgLTQyOCw4MiArNDQxLDEwMCBAQAogCiBzdGF0aWMgaW50IHBhcnNlX2V0dChpbnQgZG14ZmQs
IGludCBpbmRleCwgdWludDE2X3QgcGlkKSAKIHsKKyAgICB1aW50OF90IGN1cnJfaW5kZXg7Cisg
ICAgdWludDMyX3Qgc2VjdGlvbl9wYXR0ZXJuOwogICAgIGNvbnN0IGVudW0gYXRzY19zZWN0aW9u
X3RhZyB0YWcgPSBzdGFnX2F0c2NfZXh0ZW5kZWRfdGV4dDsKKyAgICBzdHJ1Y3QgYXRzY19laXRf
aW5mbyAqZWl0OworICAgIHN0cnVjdCBhdHNjX2VpdF9zZWN0aW9uX2luZm8gKnNlY3Rpb247CiAg
ICAgc3RydWN0IGF0c2NfZXR0X3NlY3Rpb24gKmV0dDsKICAgICBzdHJ1Y3QgYXRzY19jaGFubmVs
X2luZm8gKmNoYW5uZWw7CiAgICAgc3RydWN0IGF0c2NfZXZlbnRfaW5mbyAqZXZlbnQ7CiAgICAg
c3RydWN0IGF0c2NfdGV4dCAqdGV4dDsKICAgICBzdHJ1Y3QgYXRzY190ZXh0X3N0cmluZyAqc3Ry
OwogICAgIHVpbnQxNl90IHNvdXJjZV9pZCwgZXZlbnRfaWQ7Ci0gICAgaW50IGksIGosIGssIHJl
dDsKKyAgICBpbnQgaSwgaiwgaywgYywgcmV0OwogCi0gICAgcmV0ID0gYXRzY19zY2FuX3RhYmxl
KGRteGZkLCBwaWQsIHRhZywgKHZvaWQgKiopJmV0dCk7Ci0gICAgZnByaW50ZihzdGRvdXQsICIu
Iik7Ci0gICAgZmZsdXNoKHN0ZG91dCk7Ci0gICAgaWYoMCA+IHJldCkgewotICAgICAgICBmcHJp
bnRmKHN0ZGVyciwgIiVzKCk6IGVycm9yIGNhbGxpbmcgYXRzY19zY2FuX3RhYmxlKClcbiIsIF9f
RlVOQ1RJT05fXyk7Ci0gICAgICAgIHJldHVybiAtMTsKLSAgICB9Ci0gICAgaWYoMCA9PSByZXQp
IHsKLSAgICAgICAgZnByaW50ZihzdGRvdXQsICJubyBFSVQgJWQgaW4gJWQgc2Vjb25kc1xuIiwg
aW5kZXgsIFRJTUVPVVQpOworICAgIGlmKDB4RkZGRiA9PSBndWlkZS5ldHRfcGlkW2luZGV4XSkg
ewogICAgICAgICByZXR1cm4gMDsKICAgICB9CiAKLSAgICBzb3VyY2VfaWQgPSBldHQtPkVUTV9z
b3VyY2VfaWQ7Ci0gICAgZXZlbnRfaWQgPSBldHQtPkVUTV9zdWJfaWQ7Ci0gICAgY2hhbm5lbCA9
IE5VTEw7Ci0gICAgZm9yKGkgPSAwOyBpIDwgZ3VpZGUubnVtX2NoYW5uZWxzOyBpKyspIHsKLSAg
ICAgICAgaWYoc291cmNlX2lkID09IGd1aWRlLmNoW2ldLnNyY19pZCkgewotICAgICAgICAgICAg
Y2hhbm5lbCA9ICZndWlkZS5jaFtpXTsKLSAgICAgICAgICAgIGJyZWFrOwotICAgICAgICB9Ci0g
ICAgfQotICAgIGlmKE5VTEwgPT0gY2hhbm5lbCkgewotICAgICAgICByZXR1cm4gMDsKLSAgICB9
CisgICAgZm9yKGMgPSAwOyBjIDwgZ3VpZGUubnVtX2NoYW5uZWxzOyBjKyspIHsKKyAgICAgICAg
Y2hhbm5lbCA9ICZndWlkZS5jaFtjXTsKKyAgICAgICAgZWl0ID0gJmNoYW5uZWwtPmVpdFtpbmRl
eF07CiAKLSAgICBldmVudCA9IE5VTEw7Ci0gICAgZm9yKGkgPSAwOyBpIDwgY2hhbm5lbC0+bnVt
X2VpdHM7IGkrKykgewotICAgICAgICBzdHJ1Y3QgYXRzY19laXRfaW5mbyAqZWl0ID0gJmNoYW5u
ZWwtPmVpdFtpXTsKKyAgICAgICAgc2VjdGlvbl9wYXR0ZXJuID0gMDsKKyAgICAgICAgd2hpbGUo
c2VjdGlvbl9wYXR0ZXJuICE9ICh1aW50MzJfdCkoKDEgPDwgZWl0LT5udW1fZWl0X3NlY3Rpb25z
KSAtIDEpKSB7CisgICAgICAgICAgICBpZihjdHJsX2MpIHsKKyAgICAgICAgICAgICAgICByZXR1
cm4gMDsKKyAgICAgICAgICAgIH0KKyAgICAgICAgICAgIHJldCA9IGF0c2Nfc2Nhbl90YWJsZShk
bXhmZCwgcGlkLCB0YWcsICh2b2lkICoqKSZldHQpOworICAgICAgICAgICAgZnByaW50ZihzdGRv
dXQsICIuIik7CisgICAgICAgICAgICBmZmx1c2goc3Rkb3V0KTsKKyAgICAgICAgICAgIGlmKDAg
PiByZXQpIHsKKyAgICAgICAgICAgICAgICBmcHJpbnRmKHN0ZGVyciwgIiVzKCk6IGVycm9yIGNh
bGxpbmcgYXRzY19zY2FuX3RhYmxlKClcbiIsIF9fRlVOQ1RJT05fXyk7CisgICAgICAgICAgICAg
ICAgcmV0dXJuIC0xOworICAgICAgICAgICAgfQorICAgICAgICAgICAgaWYoMCA9PSByZXQpIHsK
KyAgICAgICAgICAgICAgICBmcHJpbnRmKHN0ZG91dCwgIm5vIEVUVCAlZCBpbiAlZCBzZWNvbmRz
XG4iLCBpbmRleCwgVElNRU9VVCk7CisgICAgICAgICAgICAgICAgcmV0dXJuIDA7CisgICAgICAg
ICAgICB9CiAKLSAgICAgICAgZm9yKGogPSAwOyBqIDwgZWl0LT5udW1fZWl0X3NlY3Rpb25zOyBq
KyspIHsKLSAgICAgICAgICAgIHN0cnVjdCBhdHNjX2VpdF9zZWN0aW9uX2luZm8gKnNlY3Rpb24g
PSAmZWl0LT5zZWN0aW9uW2pdOworICAgICAgICAgICAgc291cmNlX2lkID0gZXR0LT5FVE1fc291
cmNlX2lkOworICAgICAgICAgICAgZXZlbnRfaWQgPSBldHQtPkVUTV9zdWJfaWQ7CisgICAgICAg
ICAgICBpZihzb3VyY2VfaWQgIT0gY2hhbm5lbC0+c3JjX2lkKSB7CisgICAgICAgICAgICAgICAg
Y29udGludWU7CisgICAgICAgICAgICB9CiAKLSAgICAgICAgICAgIGZvcihrID0gMDsgayA8IHNl
Y3Rpb24tPm51bV9ldmVudHM7IGsrKykgewotICAgICAgICAgICAgICAgIGlmKHNlY3Rpb24tPmV2
ZW50c1trXSAmJiBzZWN0aW9uLT5ldmVudHNba10tPmlkID09IGV2ZW50X2lkKSB7Ci0gICAgICAg
ICAgICAgICAgICAgIGV2ZW50ID0gc2VjdGlvbi0+ZXZlbnRzW2tdOworICAgICAgICAgICAgZXZl
bnQgPSBOVUxMOworICAgICAgICAgICAgZm9yKGogPSAwOyBqIDwgZWl0LT5udW1fZWl0X3NlY3Rp
b25zOyBqKyspIHsKKyAgICAgICAgICAgICAgICBzZWN0aW9uID0gJmVpdC0+c2VjdGlvbltqXTsK
KworICAgICAgICAgICAgICAgIGZvcihrID0gMDsgayA8IHNlY3Rpb24tPm51bV9ldmVudHM7IGsr
KykgeworICAgICAgICAgICAgICAgICAgICBpZihzZWN0aW9uLT5ldmVudHNba10gJiYgc2VjdGlv
bi0+ZXZlbnRzW2tdLT5pZCA9PSBldmVudF9pZCkgeworICAgICAgICAgICAgICAgICAgICAgICAg
ZXZlbnQgPSBzZWN0aW9uLT5ldmVudHNba107CisgICAgICAgICAgICAgICAgICAgICAgICBicmVh
azsKKyAgICAgICAgICAgICAgICAgICAgfQorICAgICAgICAgICAgICAgIH0KKyAgICAgICAgICAg
ICAgICBpZihldmVudCkgeworICAgICAgICAgICAgICAgICAgICBjdXJyX2luZGV4ID0gajsKICAg
ICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg
fQotICAgICAgICAgICAgaWYoZXZlbnQpIHsKLSAgICAgICAgICAgICAgICBicmVhazsKKyAgICAg
ICAgICAgIGlmKE5VTEwgPT0gZXZlbnQpIHsKKyAgICAgICAgICAgICAgICBjb250aW51ZTsKKyAg
ICAgICAgICAgIH0KKyAgICAgICAgICAgIGlmKHNlY3Rpb25fcGF0dGVybiAmICgxIDw8IGN1cnJf
aW5kZXgpKSB7CisgICAgICAgICAgICAgICAgLyogdGhlIHNlY3Rpb24gaGFzIGJlZW4gZmlsbGVk
LCBzbyBza2lwLCBub3QgY29uc2lkZXIgdmVyc2lvbiB5ZXQgKi8KKyAgICAgICAgICAgICAgICBj
b250aW51ZTsKKyAgICAgICAgICAgIH0KKyAgICAgICAgICAgIGlmKGV2ZW50LT5tc2dfbGVuKSB7
CisgICAgICAgICAgICAgICAgLyogdGhlIG1lc3NhZ2UgaGFzIGJlZW4gZmlsbGVkICovCisgICAg
ICAgICAgICAgICAgY29udGludWU7CisgICAgICAgICAgICB9CisKKyAgICAgICAgICAgIHRleHQg
PSBhdHNjX2V0dF9zZWN0aW9uX2V4dGVuZGVkX3RleHRfbWVzc2FnZShldHQpOworICAgICAgICAg
ICAgYXRzY190ZXh0X3N0cmluZ3NfZm9yX2VhY2godGV4dCwgc3RyLCBpKSB7CisgICAgICAgICAg
ICAgICAgc3RydWN0IGF0c2NfdGV4dF9zdHJpbmdfc2VnbWVudCAqc2VnOworCisgICAgICAgICAg
ICAgICAgYXRzY190ZXh0X3N0cmluZ19zZWdtZW50c19mb3JfZWFjaChzdHIsIHNlZywgaikgewor
ICAgICAgICAgICAgICAgICAgICBldmVudC0+bXNnX3BvcyA9IGNoYW5uZWwtPm1zZ19idWYuYnVm
X3BvczsKKyAgICAgICAgICAgICAgICAgICAgaWYoMCA+IGF0c2NfdGV4dF9zZWdtZW50X2RlY29k
ZShzZWcsIAorICAgICAgICAgICAgICAgICAgICAgICAgKHVpbnQ4X3QgKiopJmNoYW5uZWwtPm1z
Z19idWYuc3RyaW5nLCAKKyAgICAgICAgICAgICAgICAgICAgICAgIChzaXplX3QgKikmY2hhbm5l
bC0+bXNnX2J1Zi5idWZfbGVuLCAKKyAgICAgICAgICAgICAgICAgICAgICAgIChzaXplX3QgKikm
Y2hhbm5lbC0+bXNnX2J1Zi5idWZfcG9zKSkgeworICAgICAgICAgICAgICAgICAgICAgICAgZnBy
aW50ZihzdGRlcnIsICIlcygpOiBlcnJvciBjYWxsaW5nIGF0c2NfdGV4dF9zZWdtZW50X2RlY29k
ZSgpXG4iLCAKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICBfX0ZVTkNUSU9OX18pOworICAg
ICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIC0xOworICAgICAgICAgICAgICAgICAgICB9Cisg
ICAgICAgICAgICAgICAgICAgIGV2ZW50LT5tc2dfbGVuID0gMSArIGNoYW5uZWwtPm1zZ19idWYu
YnVmX3BvcyAtIGV2ZW50LT5tc2dfcG9zOworICAgICAgICAgICAgICAgIH0KKyAgICAgICAgICAg
IH0KKyAgICAgICAgICAgIGlmKCsrc2VjdGlvbi0+bnVtX3JlY2VpdmVkX2V0bXMgPT0gc2VjdGlv
bi0+bnVtX2V0bXMpIHsKKyAgICAgICAgICAgICAgICBzZWN0aW9uX3BhdHRlcm4gfD0gMSA8PCBj
dXJyX2luZGV4OwogICAgICAgICAgICAgfQogICAgICAgICB9Ci0gICAgICAgIGlmKGV2ZW50KSB7
Ci0gICAgICAgICAgICBicmVhazsKLSAgICAgICAgfQotICAgIH0KLSAgICBpZihOVUxMID09IGV2
ZW50KSB7Ci0gICAgICAgIHJldHVybiAwOwogICAgIH0KIAotICAgIHRleHQgPSBhdHNjX2V0dF9z
ZWN0aW9uX2V4dGVuZGVkX3RleHRfbWVzc2FnZShldHQpOwotICAgIGF0c2NfdGV4dF9zdHJpbmdz
X2Zvcl9lYWNoKHRleHQsIHN0ciwgaSkgewotICAgICAgICBzdHJ1Y3QgYXRzY190ZXh0X3N0cmlu
Z19zZWdtZW50ICpzZWc7Ci0KLSAgICAgICAgYXRzY190ZXh0X3N0cmluZ19zZWdtZW50c19mb3Jf
ZWFjaChzdHIsIHNlZywgaikgewotICAgICAgICAgICAgZXZlbnQtPm1zZ19wb3MgPSBjaGFubmVs
LT5tc2dfYnVmLmJ1Zl9wb3M7Ci0gICAgICAgICAgICBpZigwID4gYXRzY190ZXh0X3NlZ21lbnRf
ZGVjb2RlKHNlZywgCi0gICAgICAgICAgICAgICAgKHVpbnQ4X3QgKiopJmNoYW5uZWwtPm1zZ19i
dWYuc3RyaW5nLCAKLSAgICAgICAgICAgICAgICAoc2l6ZV90ICopJmNoYW5uZWwtPm1zZ19idWYu
YnVmX2xlbiwgCi0gICAgICAgICAgICAgICAgKHNpemVfdCAqKSZjaGFubmVsLT5tc2dfYnVmLmJ1
Zl9wb3MpKSB7Ci0gICAgICAgICAgICAgICAgZnByaW50ZihzdGRlcnIsICIlcygpOiBlcnJvciBj
YWxsaW5nIGF0c2NfdGV4dF9zZWdtZW50X2RlY29kZSgpXG4iLCAKLSAgICAgICAgICAgICAgICAg
ICAgX19GVU5DVElPTl9fKTsKLSAgICAgICAgICAgICAgICByZXR1cm4gLTE7Ci0gICAgICAgICAg
ICB9Ci0gICAgICAgICAgICBldmVudC0+bXNnX2xlbiA9IDEgKyBjaGFubmVsLT5tc2dfYnVmLmJ1
Zl9wb3MgLSBldmVudC0+bXNnX3BvczsKLSAgICAgICAgfQotICAgIH0KICAgICByZXR1cm4gMDsK
IH0KIApAQCAtNjE0LDYgKzY0NSw4IEBACiAKICAgICAgICAgICAgIHNlY3Rpb24tPnNlY3Rpb25f
bnVtID0gc2VjdGlvbl9udW07CiAgICAgICAgICAgICBzZWN0aW9uLT5udW1fZXZlbnRzID0gZWl0
LT5udW1fZXZlbnRzX2luX3NlY3Rpb247CisgICAgICAgICAgICBzZWN0aW9uLT5udW1fZXRtcyA9
IDA7CisgICAgICAgICAgICBzZWN0aW9uLT5udW1fcmVjZWl2ZWRfZXRtcyA9IDA7CiAgICAgICAg
ICAgICBpZihOVUxMID09IChzZWN0aW9uLT5ldmVudHMgPSBjYWxsb2Moc2VjdGlvbi0+bnVtX2V2
ZW50cywgCiAgICAgICAgICAgICAgICAgc2l6ZW9mKHN0cnVjdCBhdHNjX2V2ZW50X2luZm8gKikp
KSkgewogICAgICAgICAgICAgICAgIGZwcmludGYoc3RkZXJyLCAiJXMoKTogZXJyb3IgY2FsbGlu
ZyBjYWxsb2MoKVxuIiwgX19GVU5DVElPTl9fKTsKQEAgLTYzOSw2ICs2NzIsMTAgQEAKICAgICAg
ICAgICAgICAgICBlbmRfdGltZSA9IHN0YXJ0X3RpbWUgKyBlLT5sZW5ndGhfaW5fc2Vjb25kczsK
ICAgICAgICAgICAgICAgICBsb2NhbHRpbWVfcigmc3RhcnRfdGltZSwgJmVfaW5mby0+c3RhcnQp
OwogICAgICAgICAgICAgICAgIGxvY2FsdGltZV9yKCZlbmRfdGltZSwgJmVfaW5mby0+ZW5kKTsK
KyAgICAgICAgICAgICAgICBpZigwICE9IGUtPkVUTV9sb2NhdGlvbiAmJiAzICE9IGUtPkVUTV9s
b2NhdGlvbikgeworICAgICAgICAgICAgICAgICAgICAvKiBGSVhNRSBhc3N1bWUgMSBhbmQgMiBp
cyBpbnRlcmNoYW5nYWJsZSBhcyBvZiBub3cgKi8KKyAgICAgICAgICAgICAgICAgICAgc2VjdGlv
bi0+bnVtX2V0bXMrKzsKKyAgICAgICAgICAgICAgICB9CiAKICAgICAgICAgICAgICAgICB0aXRs
ZSA9IGF0c2NfZWl0X2V2ZW50X25hbWVfdGl0bGVfdGV4dChlKTsKICAgICAgICAgICAgICAgICBh
dHNjX3RleHRfc3RyaW5nc19mb3JfZWFjaCh0aXRsZSwgc3RyLCBqKSB7CkBAIC04NjgsNiArOTA1
LDkgQEAKICAgICBwb2xsZmQuZmQgPSBkbXhmZDsKICAgICBwb2xsZmQuZXZlbnRzID0gUE9MTElO
IHwgUE9MTEVSUiB8UE9MTFBSSTsKICAgICBpZigocmV0ID0gcG9sbCgmcG9sbGZkLCAxLCBUSU1F
T1VUICogMTAwMCkpIDwgMCkgeworICAgICAgICBpZihjdHJsX2MpIHsKKyAgICAgICAgICAgIHJl
dHVybiAwOworICAgICAgICB9CiAgICAgICAgIGZwcmludGYoc3RkZXJyLCAiJXMoKTogZXJyb3Ig
Y2FsbGluZyBwb2xsKClcbiIsIF9fRlVOQ1RJT05fXyk7CiAgICAgICAgIHJldHVybiAtMTsKICAg
ICB9CkBAIC0xMDAzLDYgKzEwNDMsNyBAQAogICAgIH0KICAgICBmcHJpbnRmKHN0ZG91dCwgIlxu
Iik7CiAKKyAgICBvbGRfaGFuZGxlciA9IHNpZ25hbChTSUdJTlQsIGludF9oYW5kbGVyKTsKICAg
ICBpZihlbmFibGVfZXR0KSB7CiAgICAgICAgIGZwcmludGYoc3Rkb3V0LCAicmVjZWl2aW5nIEVU
VCAiKTsKICAgICAgICAgZm9yKGkgPSAwOyBpIDwgZ3VpZGUuY2hbMF0ubnVtX2VpdHM7IGkrKykg
ewpAQCAtMTAxMiw5ICsxMDUzLDEzIEBACiAgICAgICAgICAgICAgICAgICAgIHJldHVybiAtMTsK
ICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICB9CisgICAgICAgICAgICBpZihjdHJsX2Mp
IHsKKyAgICAgICAgICAgICAgICBicmVhazsKKyAgICAgICAgICAgIH0KICAgICAgICAgfQogICAg
ICAgICBmcHJpbnRmKHN0ZG91dCwgIlxuIik7CiAgICAgfQorICAgIHNpZ25hbChTSUdJTlQsIG9s
ZF9oYW5kbGVyKTsKIAogICAgIGlmKHByaW50X2d1aWRlKCkpIHsKICAgICAgICAgZnByaW50Zihz
dGRlcnIsICIlcygpOiBlcnJvciBjYWxsaW5nIHByaW50X2d1aWRlKClcbiIsIF9fRlVOQ1RJT05f
Xyk7CiMgSEcgY2hhbmdlc2V0IHBhdGNoCiMgVXNlciBZdWZlaSBZdWFuIDx5Znl1YW5AZ21haWwu
Y29tPgojIERhdGUgMTI0NTEyMjAwMCAxODAwMAojIE5vZGUgSUQgZWU0ZjJkYmI4ZjI4ZTkzMzUx
ZDAwYWEzOGIwYmQzNjQ2OTE1NTc2OQojIFBhcmVudCAgMzg2MDljYjBkOWM1ODZjNzhhODBiNzE3
M2Y4MGFhMzJlMzU1YTgxMQpIZWxwIGluZm9ybWF0aW9uIHByaW50IGZpeGVkLgoKZGlmZiAtciAz
ODYwOWNiMGQ5YzUgLXIgZWU0ZjJkYmI4ZjI4IHV0aWwvYXRzY19lcGcvYXRzY19lcGcuYwotLS0g
YS91dGlsL2F0c2NfZXBnL2F0c2NfZXBnLmMJTW9uIEp1biAxNSAyMDozMjowOCAyMDA5IC0wNTAw
CisrKyBiL3V0aWwvYXRzY19lcGcvYXRzY19lcGcuYwlNb24gSnVuIDE1IDIyOjEzOjIwIDIwMDkg
LTA1MDAKQEAgLTE4NywxNSArMTg3LDE1IEBACiAKIHN0YXRpYyB2b2lkIHVzYWdlKHZvaWQpCiB7
Ci0gICAgZnByaW50ZihzdGRlcnIsICJ1c2FnZTogJXMgWy1hIDxuPl0gLWYgPGZyZXF1ZW5jeT4g
Wy1wIDxwZXJpb2Q+XVstbSA8bW9kdWxhdGlvbj5dIFstaF1cbiIsIAotICAgICAgICBwcm9ncmFt
KTsKKyAgICBmcHJpbnRmKHN0ZGVyciwgInVzYWdlOiAlcyBbLWEgPG4+XSAtZiA8ZnJlcXVlbmN5
PiBbLXAgPHBlcmlvZD5dIiAKKyAgICAgICAgIiBbLW0gPG1vZHVsYXRpb24+XSBbLXRdIFstaF1c
biIsIHByb2dyYW0pOwogfQogCiBzdGF0aWMgdm9pZCBoZWxwKHZvaWQpCiB7CiAgICAgZnByaW50
ZihzdGRlcnIsCiAgICAgIlxuaGVscDpcbiIKLSAgICAgICAgIiVzIFstYSA8bj5dIC1mIDxmcmVx
dWVuY3k+IFstbSA8bW9kdWxhdGlvbj5dIFstdF0gWy1oXVxuIgorICAgICAgICAiJXMgWy1hIDxu
Pl0gLWYgPGZyZXF1ZW5jeT4gWy1wIDxwZXJpb2Q+XSBbLW0gPG1vZHVsYXRpb24+XSBbLXRdIFst
aF1cbiIKICAgICAgICAgIiAgLWE6IGFkYXB0ZXIgaW5kZXggdG8gdXNlLCAoZGVmYXVsdCAwKVxu
IgogICAgICAgICAiICAtZjogdHVuaW5nIGZyZXF1ZW5jeVxuIgogICAgICAgICAiICAtcDogcGVy
aW9kIGluIGhvdXJzLCAoZGVmYXVsdCAxMilcbiIKIyBIRyBjaGFuZ2VzZXQgcGF0Y2gKIyBVc2Vy
IFl1ZmVpIFl1YW4gPHlmeXVhbkBnbWFpbC5jb20+CiMgRGF0ZSAxMjQ1MTE1OTI4IDE4MDAwCiMg
Tm9kZSBJRCAzODYwOWNiMGQ5YzU4NmM3OGE4MGI3MTczZjgwYWEzMmUzNTVhODExCiMgUGFyZW50
ICA5YjVjNzMxNDk4MDg1YTBmOWUwMzI0MjA5MmY3NDg5ZjVhYzA5MjMwCjEuIEEgbmV3IHV0aWxp
dHkgYXRzY19lcGcgaXMgYWRkZWQuCjIuIE1ha2VmaWxlIGFuZCBQZXJsIHNjcmlwdCBjaGFuZ2Vk
IHRvIGJlIGNvbXBpbGVkIHdpdGggR0NDIDQuNC4KCmRpZmYgLXIgOWI1YzczMTQ5ODA4IC1yIDM4
NjA5Y2IwZDljNSB1dGlsL01ha2VmaWxlCi0tLSBhL3V0aWwvTWFrZWZpbGUJV2VkIEp1biAxMCAy
MDoyMzoxNSAyMDA5ICswMjAwCisrKyBiL3V0aWwvTWFrZWZpbGUJTW9uIEp1biAxNSAyMDozMjow
OCAyMDA5IC0wNTAwCkBAIC0zLDYgKzMsNyBAQAogLlBIT05ZOiBhbGwgY2xlYW4gaW5zdGFsbAog
CiBhbGwgY2xlYW4gaW5zdGFsbDoKKwkkKE1BS0UpIC1DIGF0c2NfZXBnICRACiAJJChNQUtFKSAt
QyBhdjcxMTBfbG9hZGtleXMgJEAKIAkkKE1BS0UpIC1DIGRpYjMwMDAtd2F0Y2ggJEAKIAkkKE1B
S0UpIC1DIGRzdC11dGlscyAkQApkaWZmIC1yIDliNWM3MzE0OTgwOCAtciAzODYwOWNiMGQ5YzUg
dXRpbC9hdHNjX2VwZy9NYWtlZmlsZQotLS0gL2Rldi9udWxsCVRodSBKYW4gMDEgMDA6MDA6MDAg
MTk3MCArMDAwMAorKysgYi91dGlsL2F0c2NfZXBnL01ha2VmaWxlCU1vbiBKdW4gMTUgMjA6MzI6
MDggMjAwOSAtMDUwMApAQCAtMCwwICsxLDE1IEBACisjIE1ha2VmaWxlIGZvciBsaW51eHR2Lm9y
ZyBkdmItYXBwcy91dGlsL2F0c2NfZXBnCisKK2JpbmFyaWVzID0gYXRzY19lcGcKKworaW5zdF9i
aW4gPSAkKGJpbmFyaWVzKQorCitDUFBGTEFHUyArPSAtSS4uLy4uL2xpYiAtc3RkPWM5OSAtRF9Q
T1NJWF9TT1VSQ0UKK0xERkxBR1MgICs9IC1zdGF0aWMgLUwuLi8uLi9saWIvbGliZHZiYXBpIC1M
Li4vLi4vbGliL2xpYnVjc2kKK0xETElCUyAgICs9IC1sZHZiYXBpIC1sdWNzaQorCisuUEhPTlk6
IGFsbAorCithbGw6ICQoYmluYXJpZXMpCisKK2luY2x1ZGUgLi4vLi4vTWFrZS5ydWxlcwpkaWZm
IC1yIDliNWM3MzE0OTgwOCAtciAzODYwOWNiMGQ5YzUgdXRpbC9hdHNjX2VwZy9SRUFETUUKLS0t
IC9kZXYvbnVsbAlUaHUgSmFuIDAxIDAwOjAwOjAwIDE5NzAgKzAwMDAKKysrIGIvdXRpbC9hdHNj
X2VwZy9SRUFETUUJTW9uIEp1biAxNSAyMDozMjowOCAyMDA5IC0wNTAwCkBAIC0wLDAgKzEsOCBA
QAorSGkgdGhlcmUsCisKK2F0c2NfZXBnIGlzIGEgc21hbGwgdXRpbGl0eSBmb3Igb2J0YWluaW5n
IGluZm9ybWF0aW9uIHN1Y2ggYXMgcHJvZ3JhbXMsIEVQRyAKKyhlbGVjdHJvbmljIHByb2dyYW0g
Z3VpZGUpIGZyb20gYW4gQVRTQyBjaGFubmVsLiAKKworRW5qb3ksCitZdWZlaQorCmRpZmYgLXIg
OWI1YzczMTQ5ODA4IC1yIDM4NjA5Y2IwZDljNSB1dGlsL2F0c2NfZXBnL2F0c2NfZXBnLmMKLS0t
IC9kZXYvbnVsbAlUaHUgSmFuIDAxIDAwOjAwOjAwIDE5NzAgKzAwMDAKKysrIGIvdXRpbC9hdHNj
X2VwZy9hdHNjX2VwZy5jCU1vbiBKdW4gMTUgMjA6MzI6MDggMjAwOSAtMDUwMApAQCAtMCwwICsx
LDEwNTggQEAKKy8qCisgKiBhdHNjX2VwZyB1dGlsaXR5CisgKiAKKyAqIENvcHlyaWdodCAoQykg
MjAwOSBZdWZlaSBZdWFuIDx5Znl1YW5AZ21haWwuY29tPgorICogVGhpcyBwcm9ncmFtIGlzIGZy
ZWUgc29mdHdhcmU7IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnkKKyAqIGl0
IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVi
bGlzaGVkIGJ5CisgKiB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uOyBlaXRoZXIgdmVyc2lv
biAyIG9mIHRoZSBMaWNlbnNlLCBvcgorICogKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVy
c2lvbi4KKyAqCisgKiBUaGlzIHByb2dyYW0gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhh
dCBpdCB3aWxsIGJlIHVzZWZ1bCwKKyAqIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91
dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mCisgKiBNRVJDSEFOVEFCSUxJVFkgb3IgRklU
TkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlCisgKgorICogR05VIEdlbmVy
YWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy4KKyAqCisgKiBZb3Ugc2hvdWxkIGhh
dmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZQorICog
YWxvbmcgd2l0aCB0aGlzIHByb2dyYW07IGlmIG5vdCwgd3JpdGUgdG8gdGhlIEZyZWUgU29mdHdh
cmUKKyAqIEZvdW5kYXRpb24sIEluYy4sIDY3NSBNYXNzIEF2ZSwgQ2FtYnJpZGdlLCBNQSAwMjEz
OSwgVVNBLgorICovCisKKyNpbmNsdWRlIDxzdGRpby5oPgorI2luY2x1ZGUgPHN0ZGxpYi5oPgor
I2luY2x1ZGUgPHVuaXN0ZC5oPgorI2luY2x1ZGUgPHN0cmluZy5oPgorI2luY2x1ZGUgPHRpbWUu
aD4KKyNpbmNsdWRlIDxzeXMvdHlwZXMuaD4KKyNpbmNsdWRlIDxzeXMvc3RhdC5oPgorI2luY2x1
ZGUgPGZjbnRsLmg+CisjaW5jbHVkZSA8c3lzL2lvY3RsLmg+CisjaW5jbHVkZSA8c3lzL3BvbGwu
aD4KKyNpbmNsdWRlIDxlcnJuby5oPgorI2luY2x1ZGUgPGdldG9wdC5oPgorI2luY2x1ZGUgPHN0
ZGFyZy5oPgorI2luY2x1ZGUgPGxpYmR2YmFwaS9kdmJmZS5oPgorI2luY2x1ZGUgPGxpYmR2YmFw
aS9kdmJkZW11eC5oPgorI2luY2x1ZGUgPGxpYnVjc2kvZHZiL3NlY3Rpb24uaD4KKyNpbmNsdWRl
IDxsaWJ1Y3NpL2F0c2Mvc2VjdGlvbi5oPgorI2luY2x1ZGUgPGxpYnVjc2kvYXRzYy90eXBlcy5o
PgorCisjZGVmaW5lIFRJTUVPVVQgICAgICAgICAgICAgICAgICAgICA2MAorI2RlZmluZSBSUlRf
VElNRU9VVCAgICAgICAgICAgICAgICAgNjAKKyNkZWZpbmUgTUFYX05VTV9FVkVOVF9UQUJMRVMg
ICAgICAgIDEyOAorI2RlZmluZSBUSVRMRV9CVUZGRVJfTEVOICAgICAgICAgICAgNDA5NgorI2Rl
ZmluZSBNRVNTQUdFX0JVRkZFUl9MRU4gICAgICAgICAgKDE2ICogMTAyNCkKKyNkZWZpbmUgTUFY
X05VTV9DSEFOTkVMUyAgICAgICAgICAgIDE2CisjZGVmaW5lIE1BWF9OVU1fRVZFTlRTX1BFUl9D
SEFOTkVMICAoNCAqIDI0ICogNykKKworc3RhdGljIGludCBhdHNjX3NjYW5fdGFibGUoaW50IGRt
eGZkLCB1aW50MTZfdCBwaWQsIGVudW0gYXRzY19zZWN0aW9uX3RhZyB0YWcsIAorICAgIHZvaWQg
Kip0YWJsZV9zZWN0aW9uKTsKKworc3RhdGljIGNvbnN0IGNoYXIgKnByb2dyYW07CitzdGF0aWMg
aW50IGFkYXB0ZXIgPSAwOworc3RhdGljIGludCBwZXJpb2QgPSAxMjsgLyogaG91cnMgKi8KK3N0
YXRpYyBpbnQgZnJlcXVlbmN5Oworc3RhdGljIGludCBlbmFibGVfZXR0ID0gMDsKK3N0YXRpYyBj
b25zdCBjaGFyICptb2R1bGF0aW9uID0gTlVMTDsKK3N0YXRpYyBjaGFyIHNlcGFyYXRvcls4MF07
CisKK3N0cnVjdCBhdHNjX3N0cmluZ19idWZmZXIgeworICAgIGludCBidWZfbGVuOworICAgIGlu
dCBidWZfcG9zOworICAgIGNoYXIgKnN0cmluZzsKK307CisKK3N0cnVjdCBhdHNjX2V2ZW50X2lu
Zm8geworICAgIHVpbnQxNl90IGlkOworICAgIHN0cnVjdCB0bSBzdGFydDsKKyAgICBzdHJ1Y3Qg
dG0gZW5kOworICAgIGludCB0aXRsZV9wb3M7CisgICAgaW50IHRpdGxlX2xlbjsKKyAgICBpbnQg
bXNnX3BvczsKKyAgICBpbnQgbXNnX2xlbjsKK307CisKK3N0cnVjdCBhdHNjX2VpdF9zZWN0aW9u
X2luZm8geworICAgIHVpbnQ4X3Qgc2VjdGlvbl9udW07CisgICAgdWludDhfdCBudW1fZXZlbnRz
OworICAgIHN0cnVjdCBhdHNjX2V2ZW50X2luZm8gKipldmVudHM7Cit9OworCitzdHJ1Y3QgYXRz
Y19laXRfaW5mbyB7CisgICAgaW50IG51bV9laXRfc2VjdGlvbnM7CisgICAgc3RydWN0IGF0c2Nf
ZWl0X3NlY3Rpb25faW5mbyAqc2VjdGlvbjsKK307CisKK3N0cnVjdCBhdHNjX2NoYW5uZWxfaW5m
byB7CisgICAgdWludDhfdCBudW1fZWl0czsKKyAgICB1aW50OF90IHNlcnZpY2VfdHlwZTsKKyAg
ICBjaGFyIHNob3J0X25hbWVbOF07CisgICAgdWludDE2X3QgbWFqb3JfbnVtOworICAgIHVpbnQx
Nl90IG1pbm9yX251bTsKKyAgICB1aW50MTZfdCB0c2lkOworICAgIHVpbnQxNl90IHByb2dfbnVt
OworICAgIHVpbnQxNl90IHNyY19pZDsKKyAgICBzdHJ1Y3QgYXRzY19laXRfaW5mbyAqZWl0Owor
ICAgIHN0cnVjdCBhdHNjX2V2ZW50X2luZm8gKmxhc3RfZXZlbnQ7CisgICAgaW50IGV2ZW50X2lu
Zm9faW5kZXg7CisgICAgc3RydWN0IGF0c2NfZXZlbnRfaW5mbyBlW01BWF9OVU1fRVZFTlRTX1BF
Ul9DSEFOTkVMXTsgCisgICAgc3RydWN0IGF0c2Nfc3RyaW5nX2J1ZmZlciB0aXRsZV9idWY7Cisg
ICAgc3RydWN0IGF0c2Nfc3RyaW5nX2J1ZmZlciBtc2dfYnVmOworfTsKKworc3RydWN0IGF0c2Nf
dmlydHVhbF9jaGFubmVsc19pbmZvIHsKKyAgICBpbnQgbnVtX2NoYW5uZWxzOworICAgIHVpbnQx
Nl90IGVpdF9waWRbTUFYX05VTV9FVkVOVF9UQUJMRVNdOworICAgIHVpbnQxNl90IGV0dF9waWRb
TUFYX05VTV9FVkVOVF9UQUJMRVNdOworICAgIHN0cnVjdCBhdHNjX2NoYW5uZWxfaW5mbyBjaFtN
QVhfTlVNX0NIQU5ORUxTXTsKK30gZ3VpZGU7CisKK3N0cnVjdCBtZ3RfdGFibGVfbmFtZSB7Cisg
ICAgdWludDE2X3QgcmFuZ2U7CisgICAgY29uc3QgY2hhciAqc3RyaW5nOworfTsKKworc3RydWN0
IG1ndF90YWJsZV9uYW1lIG1ndF90YWJfbmFtZV9hcnJheVtdID0geworICAgIHsweDAwMDAsICJ0
ZXJyZXN0cmlhbCBWQ1Qgd2l0aCBjdXJyZW50X25leHRfaW5kaWN0b3I9MSJ9LAorICAgIHsweDAw
MDEsICJ0ZXJyZXN0cmlhbCBWQ1Qgd2l0aCBjdXJyZW50X25leHRfaW5kaWN0b3I9MCJ9LAorICAg
IHsweDAwMDIsICJjYWJsZSBWQ1Qgd2l0aCBjdXJyZW50X25leHRfaW5kaWN0b3I9MSJ9LAorICAg
IHsweDAwMDMsICJjYWJsZSBWQ1Qgd2l0aCBjdXJyZW50X25leHRfaW5kaWN0b3I9MCJ9LAorICAg
IHsweDAwMDQsICJjaGFubmVsIEVUVCJ9LAorICAgIHsweDAwMDUsICJEQ0NTQ1QifSwKKyAgICB7
MHgwMEZGLCAicmVzZXJ2ZWQgZm9yIGZ1dHVyZSBBVFNDIHVzZSJ9LAorICAgIHsweDAxN0YsICJF
SVQifSwKKyAgICB7MHgwMUZGLCAicmVzZXJ2ZWQgZm9yIGZ1dHVyZSBBVFNDIHVzZSJ9LAorICAg
IHsweDAyN0YsICJldmVudCBFVFQifSwKKyAgICB7MHgwMkZGLCAicmVzZXJ2ZWQgZm9yIGZ1dHVy
ZSBBVFNDIHVzZSJ9LCAvKiBGSVhNRSAqLworICAgIHsweDAzRkYsICJSUlQgd2l0aCByYXRpbmcg
cmVnaW9uIn0sCisgICAgezB4MEZGRiwgInVzZXIgcHJpdmF0ZSJ9LAorICAgIHsweDEzRkYsICJy
ZXNlcnZlZCBmb3IgZnV0dXJlIEFUU0MgdXNlIn0sCisgICAgezB4MTRGRiwgIkRDQ1Qgd2l0aCBk
Y2NfaWQifSwKKyAgICB7MHhGRkZGLCAicmVzZXJ2ZWQgZm9yIGZ1dHVyZSBBVFNDIHVzZSJ9Cit9
OworCitjb25zdCBjaGFyICpjaGFubmVsX21vZHVsYXRpb25fbW9kZVtdID0geworICAgICIiLAor
ICAgICJhbmFsb2ciLAorICAgICJTQ1RFIG1vZGUgMSIsCisgICAgIlNDVEUgbW9kZSAyIiwKKyAg
ICAiQVRTQyA4VlNCIiwKKyAgICAiQVRTQyAxNlZTQiIKK307CisKK2NvbnN0IGNoYXIgKmNoYW5u
ZWxfc2VydmljZV90eXBlW10gPSB7CisgICAgIiIsCisgICAgImFuYWxvZyBUViIsCisgICAgIkFU
U0MgZGlnaXRhbCBUViIsCisgICAgIkFUU0MgYXVkaW8iLAorICAgICJBVFNDIGRhdGEtb25seSIK
K307CisKK3ZvaWQgKigqdGFibGVfY2FsbGJhY2tbMTZdKShzdHJ1Y3QgYXRzY19zZWN0aW9uX3Bz
aXAgKikgPSAKK3sKKyAgICBOVUxMLCBOVUxMLCBOVUxMLCBOVUxMLCBOVUxMLCBOVUxMLCBOVUxM
LAorICAgICh2b2lkICooKikoc3RydWN0IGF0c2Nfc2VjdGlvbl9wc2lwICopKWF0c2NfbWd0X3Nl
Y3Rpb25fY29kZWMsCisgICAgKHZvaWQgKigqKShzdHJ1Y3QgYXRzY19zZWN0aW9uX3BzaXAgKikp
YXRzY190dmN0X3NlY3Rpb25fY29kZWMsCisgICAgKHZvaWQgKigqKShzdHJ1Y3QgYXRzY19zZWN0
aW9uX3BzaXAgKikpYXRzY19jdmN0X3NlY3Rpb25fY29kZWMsCisgICAgKHZvaWQgKigqKShzdHJ1
Y3QgYXRzY19zZWN0aW9uX3BzaXAgKikpYXRzY19ycnRfc2VjdGlvbl9jb2RlYywKKyAgICAodm9p
ZCAqKCopKHN0cnVjdCBhdHNjX3NlY3Rpb25fcHNpcCAqKSlhdHNjX2VpdF9zZWN0aW9uX2NvZGVj
LAorICAgICh2b2lkICooKikoc3RydWN0IGF0c2Nfc2VjdGlvbl9wc2lwICopKWF0c2NfZXR0X3Nl
Y3Rpb25fY29kZWMsCisgICAgKHZvaWQgKigqKShzdHJ1Y3QgYXRzY19zZWN0aW9uX3BzaXAgKikp
YXRzY19zdHRfc2VjdGlvbl9jb2RlYywKKyAgICBOVUxMLCBOVUxMCit9OworCisvKiBzaGFtZWxl
c3NseSBzdG9sZW4gZnJvbSBkdmJzbm9vcCwgYnV0IG1vZGlmaWVkICovCitzdGF0aWMgdWludDMy
X3QgZ2V0X2JpdHMoY29uc3QgdWludDhfdCAqYnVmLCBpbnQgc3RhcnRiaXQsIGludCBiaXRsZW4p
Cit7CisgICAgY29uc3QgdWludDhfdCAqYjsKKyAgICB1aW50MzJfdCBtYXNrLHRtcF9sb25nOwor
ICAgIGludCBiaXRIaWdoLGk7CisKKyAgICBiID0gJmJ1ZltzdGFydGJpdCAvIDhdOworICAgIHN0
YXJ0Yml0ICU9IDg7CisKKyAgICBiaXRIaWdoID0gODsKKyAgICB0bXBfbG9uZyA9IGJbMF07Cisg
ICAgZm9yIChpID0gMDsgaSA8ICgoYml0bGVuLTEpID4+IDMpOyBpKyspIHsKKyAgICAgICAgdG1w
X2xvbmcgPDw9IDg7CisgICAgICAgIHRtcF9sb25nICB8PSBiW2krMV07CisgICAgICAgIGJpdEhp
Z2ggICArPSA4OworICAgIH0KKworICAgIHN0YXJ0Yml0ID0gYml0SGlnaCAtIHN0YXJ0Yml0IC0g
Yml0bGVuOworICAgIHRtcF9sb25nID0gdG1wX2xvbmcgPj4gc3RhcnRiaXQ7CisgICAgbWFzayAg
ICAgPSAoMVVMTCA8PCBiaXRsZW4pIC0gMTsKKyAgICByZXR1cm4gdG1wX2xvbmcgJiBtYXNrOwor
fQorCitzdGF0aWMgdm9pZCB1c2FnZSh2b2lkKQoreworICAgIGZwcmludGYoc3RkZXJyLCAidXNh
Z2U6ICVzIFstYSA8bj5dIC1mIDxmcmVxdWVuY3k+IFstcCA8cGVyaW9kPl1bLW0gPG1vZHVsYXRp
b24+XSBbLWhdXG4iLCAKKyAgICAgICAgcHJvZ3JhbSk7Cit9CisKK3N0YXRpYyB2b2lkIGhlbHAo
dm9pZCkKK3sKKyAgICBmcHJpbnRmKHN0ZGVyciwKKyAgICAiXG5oZWxwOlxuIgorICAgICAgICAi
JXMgWy1hIDxuPl0gLWYgPGZyZXF1ZW5jeT4gWy1tIDxtb2R1bGF0aW9uPl0gWy10XSBbLWhdXG4i
CisgICAgICAgICIgIC1hOiBhZGFwdGVyIGluZGV4IHRvIHVzZSwgKGRlZmF1bHQgMClcbiIKKyAg
ICAgICAgIiAgLWY6IHR1bmluZyBmcmVxdWVuY3lcbiIKKyAgICAgICAgIiAgLXA6IHBlcmlvZCBp
biBob3VycywgKGRlZmF1bHQgMTIpXG4iCisgICAgICAgICIgIC1tOiBtb2R1bGF0aW9uIEFUU0Mg
dnNiXzh8dnNiXzE2IChkZWZhdWx0IHZzYl84KVxuIgorICAgICAgICAiICAtdDogZW5hYmxlIEVU
VCB0byByZWNlaXZlIHByb2dyYW0gZGV0YWlscywgaWYgYXZhaWxhYmxlXG4iCisgICAgICAgICIg
IC1oOiBkaXNwbGF5IHRoaXMgbWVzc2FnZVxuIiwgcHJvZ3JhbSk7Cit9CisKK3N0YXRpYyBpbnQg
Y2xvc2VfZnJvbnRlbmQoc3RydWN0IGR2YmZlX2hhbmRsZSAqZmUpCit7CisgICAgaWYoTlVMTCA9
PSBmZSkgeworICAgICAgICBmcHJpbnRmKHN0ZGVyciwgIiVzKCk6IE5VTEwgcG9pbnRlciBkZXRl
Y3RlZFxuIiwgX19GVU5DVElPTl9fKTsKKyAgICB9CisKKyAgICBkdmJmZV9jbG9zZShmZSk7CisK
KyAgICByZXR1cm4gMDsKK30KKworc3RhdGljIGludCBvcGVuX2Zyb250ZW5kKHN0cnVjdCBkdmJm
ZV9oYW5kbGUgKipmZSkKK3sKKyAgICBzdHJ1Y3QgZHZiZmVfaW5mbyBmZV9pbmZvOworCisgICAg
aWYoTlVMTCA9PSAoKmZlID0gZHZiZmVfb3BlbihhZGFwdGVyLCAwLCAwKSkpIHsKKyAgICAgICAg
ZnByaW50ZihzdGRlcnIsICIlcygpOiBlcnJvciBjYWxsaW5nIGR2YmZlX29wZW4oKVxuIiwgX19G
VU5DVElPTl9fKTsKKyAgICAgICAgcmV0dXJuIC0xOworICAgIH0KKyAgICBkdmJmZV9nZXRfaW5m
bygqZmUsIDAsICZmZV9pbmZvLCBEVkJGRV9JTkZPX1FVRVJZVFlQRV9JTU1FRElBVEUsIDApOwor
ICAgIGlmKERWQkZFX1RZUEVfQVRTQyAhPSBmZV9pbmZvLnR5cGUpIHsKKyAgICAgICAgZnByaW50
ZihzdGRlcnIsICIlcygpOiBvbmx5IEFUU0MgZnJvbnRlbmQgc3VwcG9ydGVkIGN1cnJlbnRseVxu
IiwgX19GVU5DVElPTl9fKTsKKyAgICAgICAgcmV0dXJuIC0xOworICAgIH0KKyAgICBmZV9pbmZv
LmZlcGFyYW1zLmZyZXF1ZW5jeSA9IGZyZXF1ZW5jeTsKKyAgICBmZV9pbmZvLmZlcGFyYW1zLmlu
dmVyc2lvbiA9IERWQkZFX0lOVkVSU0lPTl9BVVRPOworICAgIGZlX2luZm8uZmVwYXJhbXMudS5h
dHNjLm1vZHVsYXRpb24gPSBEVkJGRV9BVFNDX01PRF9WU0JfODsKKyAgICBmcHJpbnRmKHN0ZG91
dCwgInR1bmluZyB0byAlZCBIeiwgcGxlYXNlIHdhaXQuLi5cbiIsIGZyZXF1ZW5jeSk7CisgICAg
aWYoZHZiZmVfc2V0KCpmZSwgJmZlX2luZm8uZmVwYXJhbXMsIFRJTUVPVVQgKiAxMDAwKSkgewor
ICAgICAgICBmcHJpbnRmKHN0ZGVyciwgIiVzKCk6IGNhbm5vdCBsb2NrIHRvICVkIEh6IGluICVk
IHNlY29uZHNcbiIsIAorICAgICAgICAgICAgX19GVU5DVElPTl9fLCBmcmVxdWVuY3ksIFRJTUVP
VVQpOworICAgICAgICByZXR1cm4gLTE7CisgICAgfQorICAgIGZwcmludGYoc3Rkb3V0LCAidHVu
ZXIgbG9ja2VkLlxuIik7CisKKyAgICByZXR1cm4gMDsKK30KKworI2lmIDAKK3N0YXRpYyBpbnQg
cGFyc2VfcnJ0KGludCBkbXhmZCkKK3sKKyAgICBjb25zdCBlbnVtIGF0c2Nfc2VjdGlvbl90YWcg
dGFnID0gc3RhZ19hdHNjX3JhdGluZ19yZWdpb247CisgICAgc3RydWN0IGF0c2NfcnJ0X3NlY3Rp
b24gKnJydDsKKyAgICBzdHJ1Y3QgYXRzY190ZXh0ICpyZWdpb25fbmFtZTsKKyAgICBzdHJ1Y3Qg
YXRzY190ZXh0X3N0cmluZyAqYXRzY19zdHI7CisgICAgaW50IGksIGosIHJldDsKKworICAgIGkg
PSAwOworICAgIGZwcmludGYoc3Rkb3V0LCAid2FpdGluZyBmb3IgUlJUOiAiKTsKKyAgICBmZmx1
c2goc3Rkb3V0KTsKKyAgICB3aGlsZShpIDwgUlJUX1RJTUVPVVQpIHsKKyAgICAgICAgcmV0ID0g
YXRzY19zY2FuX3RhYmxlKGRteGZkLCBBVFNDX0JBU0VfUElELCB0YWcsICh2b2lkICoqKSZycnQp
OworICAgICAgICBpZigwID4gcmV0KSB7CisgICAgICAgICAgICBmcHJpbnRmKHN0ZGVyciwgIiVz
KCk6IGVycm9yIGNhbGxpbmcgYXRzY19zY2FuX3RhYmxlKClcbiIsIF9fRlVOQ1RJT05fXyk7Cisg
ICAgICAgICAgICByZXR1cm4gLTE7CisgICAgICAgIH0KKyAgICAgICAgaWYoMCA9PSByZXQpIHsK
KyAgICAgICAgICAgIGlmKFJSVF9USU1FT1VUID4gaSkgeworICAgICAgICAgICAgICAgIGZwcmlu
dGYoc3Rkb3V0LCAiLiIpOworICAgICAgICAgICAgICAgIGZmbHVzaChzdGRvdXQpOworICAgICAg
ICAgICAgfSBlbHNlIHsKKyAgICAgICAgICAgICAgICBmcHJpbnRmKHN0ZG91dCwgIlxubm8gUlJU
IGluICVkIHNlY29uZHNcbiIsIFJSVF9USU1FT1VUKTsKKyAgICAgICAgICAgICAgICByZXR1cm4g
MDsKKyAgICAgICAgICAgIH0KKyAgICAgICAgICAgIGkgKz0gVElNRU9VVDsKKyAgICAgICAgfSBl
bHNlIHsKKyAgICAgICAgICAgIGZwcmludGYoc3Rkb3V0LCAiXG4iKTsKKyAgICAgICAgICAgIGZm
bHVzaChzdGRvdXQpOworICAgICAgICAgICAgYnJlYWs7CisgICAgICAgIH0KKyAgICB9CisKKyAg
ICByZWdpb25fbmFtZSA9IGF0c2NfcnJ0X3NlY3Rpb25fcmF0aW5nX3JlZ2lvbl9uYW1lX3RleHQo
cnJ0KTsKKyAgICBhdHNjX3RleHRfc3RyaW5nc19mb3JfZWFjaChyZWdpb25fbmFtZSwgYXRzY19z
dHIsIGkpIHsKKyAgICAgICAgc3RydWN0IGF0c2NfdGV4dF9zdHJpbmdfc2VnbWVudCAqc2VnOwor
ICAgICAgICBhdHNjX3RleHRfc3RyaW5nX3NlZ21lbnRzX2Zvcl9lYWNoKGF0c2Nfc3RyLCBzZWcs
IGopIHsKKyAgICAgICAgICAgIGNvbnN0IGNoYXIgKmM7CisgICAgICAgICAgICBpbnQgazsKKyAg
ICAgICAgICAgIGlmKHNlZy0+bW9kZSA8IDB4M0UpIHsKKyAgICAgICAgICAgICAgICBmcHJpbnRm
KHN0ZGVyciwgIiVzKCk6IHRleHQgbW9kZSBvZiAweCUwMlggbm90IHN1cHBvcnRlZCB5ZXRcbiIs
IAorICAgICAgICAgICAgICAgICAgICBfX0ZVTkNUSU9OX18sIHNlZy0+bW9kZSk7CisgICAgICAg
ICAgICAgICAgcmV0dXJuIC0xOworICAgICAgICAgICAgfQorICAgICAgICAgICAgYyA9IChjb25z
dCBjaGFyICopYXRzY190ZXh0X3N0cmluZ19zZWdtZW50X2J5dGVzKHNlZyk7CisgICAgICAgICAg
ICBmb3IoayA9IDA7IGsgPCBzZWctPm51bWJlcl9ieXRlczsgaysrKSB7CisgICAgICAgICAgICAg
ICAgZnByaW50ZihzdGRvdXQsICIlYyIsIGNba10pOworICAgICAgICAgICAgfQorICAgICAgICB9
CisgICAgfQorCisgICAgcmV0dXJuIDA7Cit9CisjZW5kaWYKKworc3RhdGljIGludCBwYXJzZV9z
dHQoaW50IGRteGZkKQoreworICAgIGNvbnN0IGVudW0gYXRzY19zZWN0aW9uX3RhZyB0YWcgPSBz
dGFnX2F0c2Nfc3lzdGVtX3RpbWU7CisgICAgY29uc3Qgc3RydWN0IGF0c2Nfc3R0X3NlY3Rpb24g
KnN0dDsKKyAgICB0aW1lX3QgcnhfdGltZTsKKyAgICB0aW1lX3Qgc3lzX3RpbWU7CisgICAgaW50
IHJldDsKKworICAgIHJldCA9IGF0c2Nfc2Nhbl90YWJsZShkbXhmZCwgQVRTQ19CQVNFX1BJRCwg
dGFnLCAodm9pZCAqKikmc3R0KTsKKyAgICBpZigwID4gcmV0KSB7CisgICAgICAgIGZwcmludGYo
c3RkZXJyLCAiJXMoKTogZXJyb3IgY2FsbGluZyBhdHNjX3NjYW5fdGFibGUoKVxuIiwgX19GVU5D
VElPTl9fKTsKKyAgICAgICAgcmV0dXJuIC0xOworICAgIH0KKyAgICBpZigwID09IHJldCkgewor
ICAgICAgICBmcHJpbnRmKHN0ZG91dCwgIm5vIFNUVCBpbiAlZCBzZWNvbmRzXG4iLCBUSU1FT1VU
KTsKKyAgICAgICAgcmV0dXJuIDA7CisgICAgfQorCisgICAgcnhfdGltZSA9IGF0c2N0aW1lX3Rv
X3VuaXh0aW1lKHN0dC0+c3lzdGVtX3RpbWUpOworICAgIHRpbWUoJnN5c190aW1lKTsKKyAgICBm
cHJpbnRmKHN0ZG91dCwgInN5c3RlbSB0aW1lOiAlcyIsIGN0aW1lKCZzeXNfdGltZSkpOworICAg
IGZwcmludGYoc3Rkb3V0LCAiVFMgU1RUIHRpbWU6ICVzIiwgY3RpbWUoJnJ4X3RpbWUpKTsKKwor
ICAgIHJldHVybiAwOworfQorCitzdGF0aWMgaW50IHBhcnNlX3R2Y3QoaW50IGRteGZkKSAKK3sK
KyAgICBpbnQgbnVtX3NlY3Rpb25zOworICAgIHVpbnQzMl90IHNlY3Rpb25fcGF0dGVybjsKKyAg
ICBjb25zdCBlbnVtIGF0c2Nfc2VjdGlvbl90YWcgdGFnID0gc3RhZ19hdHNjX3RlcnJlc3RyaWFs
X3ZpcnR1YWxfY2hhbm5lbDsKKyAgICBzdHJ1Y3QgYXRzY190dmN0X3NlY3Rpb24gKnR2Y3Q7Cisg
ICAgc3RydWN0IGF0c2NfdHZjdF9jaGFubmVsICpjaDsKKyAgICBzdHJ1Y3QgYXRzY19jaGFubmVs
X2luZm8gKmN1cnJfaW5mbzsKKyAgICBpbnQgaSwgaywgcmV0OworCisgICAgc2VjdGlvbl9wYXR0
ZXJuID0gMDsKKyAgICBudW1fc2VjdGlvbnMgPSAtMTsKKworICAgIGRvIHsKKyAgICAgICAgcmV0
ID0gYXRzY19zY2FuX3RhYmxlKGRteGZkLCBBVFNDX0JBU0VfUElELCB0YWcsICh2b2lkICoqKSZ0
dmN0KTsKKyAgICAgICAgaWYoMCA+IHJldCkgeworICAgICAgICAgICAgZnByaW50ZihzdGRlcnIs
ICIlcygpOiBlcnJvciBjYWxsaW5nIGF0c2Nfc2Nhbl90YWJsZSgpXG4iLCBfX0ZVTkNUSU9OX18p
OworICAgICAgICAgICAgcmV0dXJuIC0xOworICAgICAgICB9CisgICAgICAgIGlmKDAgPT0gcmV0
KSB7CisgICAgICAgICAgICBmcHJpbnRmKHN0ZG91dCwgIm5vIFRWQ1QgaW4gJWQgc2Vjb25kc1xu
IiwgVElNRU9VVCk7CisgICAgICAgICAgICByZXR1cm4gMDsKKyAgICAgICAgfQorCisgICAgICAg
IGlmKC0xID09IG51bV9zZWN0aW9ucykgeworICAgICAgICAgICAgbnVtX3NlY3Rpb25zID0gMSAr
IHR2Y3QtPmhlYWQuZXh0X2hlYWQubGFzdF9zZWN0aW9uX251bWJlcjsKKyAgICAgICAgICAgIGlm
KDMyIDwgbnVtX3NlY3Rpb25zKSB7CisgICAgICAgICAgICAgICAgZnByaW50ZihzdGRlcnIsICIl
cygpOiBubyBzdXBwb3J0IHlldCBmb3IgdGFibGVzIGhhdmluZyBtb3JlIHRoYW4gIiAKKyAgICAg
ICAgICAgICAgICAgICAgIjMyIHNlY3Rpb25zXG4iLCBfX0ZVTkNUSU9OX18pOworICAgICAgICAg
ICAgICAgIHJldHVybiAtMTsKKyAgICAgICAgICAgIH0KKyAgICAgICAgfSBlbHNlIHsKKyAgICAg
ICAgICAgIGlmKG51bV9zZWN0aW9ucyAhPSAxICsgdHZjdC0+aGVhZC5leHRfaGVhZC5sYXN0X3Nl
Y3Rpb25fbnVtYmVyKSB7CisgICAgICAgICAgICAgICAgZnByaW50ZihzdGRlcnIsICIlcygpOiBs
YXN0IHNlY3Rpb24gbnVtYmVyIGRvZXMgbm90IG1hdGNoXG4iLCAKKyAgICAgICAgICAgICAgICAg
ICAgX19GVU5DVElPTl9fKTsKKyAgICAgICAgICAgICAgICByZXR1cm4gLTE7CisgICAgICAgICAg
ICB9CisgICAgICAgIH0KKyAgICAgICAgaWYoc2VjdGlvbl9wYXR0ZXJuICYgKDEgPDwgdHZjdC0+
aGVhZC5leHRfaGVhZC5zZWN0aW9uX251bWJlcikpIHsKKyAgICAgICAgICAgIGNvbnRpbnVlOwor
ICAgICAgICB9CisgICAgICAgIHNlY3Rpb25fcGF0dGVybiB8PSAxIDw8IHR2Y3QtPmhlYWQuZXh0
X2hlYWQuc2VjdGlvbl9udW1iZXI7CisKKyAgICAgICAgaWYoTUFYX05VTV9DSEFOTkVMUyA8IGd1
aWRlLm51bV9jaGFubmVscyArIHR2Y3QtPm51bV9jaGFubmVsc19pbl9zZWN0aW9uKSB7CisgICAg
ICAgICAgICBmcHJpbnRmKHN0ZGVyciwgIiVzKCk6IG5vIHN1cHBvcnQgZm9yIG1vcmUgdGhhbiAl
ZCB2aXJ0dWFsIGNoYW5uZWxzICIgCisgICAgICAgICAgICAgICAgImluIGEgcHloc2ljYWwgY2hh
bm5lbFxuIiwgX19GVU5DVElPTl9fLCBNQVhfTlVNX0NIQU5ORUxTKTsKKyAgICAgICAgICAgIHJl
dHVybiAtMTsKKyAgICAgICAgfQorICAgICAgICBjdXJyX2luZm8gPSAmZ3VpZGUuY2hbZ3VpZGUu
bnVtX2NoYW5uZWxzXTsKKyAgICAgICAgZ3VpZGUubnVtX2NoYW5uZWxzICs9IHR2Y3QtPm51bV9j
aGFubmVsc19pbl9zZWN0aW9uOworCisgICAgICAgIGF0c2NfdHZjdF9zZWN0aW9uX2NoYW5uZWxz
X2Zvcl9lYWNoKHR2Y3QsIGNoLCBpKSB7CisgICAgICAgICAgICAvKiBpbml0aWFsaXplIHRoZSBj
dXJyX2luZm8gc3RydWN0dXJlICovCisgICAgICAgICAgICAvKiBlYWNoIEVJVCBjb3ZlcnMgMyBo
b3VycyAqLworICAgICAgICAgICAgY3Vycl9pbmZvLT5udW1fZWl0cyA9IChwZXJpb2QgLyAzKSAr
ICEhKHBlcmlvZCAlIDMpOyAKKyAgICAgICAgICAgIHdoaWxlIChjdXJyX2luZm8tPm51bV9laXRz
ICYmIAorICAgICAgICAgICAgICAgICgweEZGRkYgPT0gZ3VpZGUuZWl0X3BpZFtjdXJyX2luZm8t
Pm51bV9laXRzIC0gMV0pKSB7CisgICAgICAgICAgICAgICAgY3Vycl9pbmZvLT5udW1fZWl0cyAt
PSAxOworICAgICAgICAgICAgfQorICAgICAgICAgICAgaWYoY3Vycl9pbmZvLT5laXQpIHsKKyAg
ICAgICAgICAgICAgICBmcHJpbnRmKHN0ZGVyciwgIiVzKCk6IG5vbi1OVUxMIHBvaW50ZXIgZGV0
ZWN0ZWQgZHVyaW5nIGluaXRpYWxpemF0aW9uIiwgCisgICAgICAgICAgICAgICAgICAgIF9fRlVO
Q1RJT05fXyk7CisgICAgICAgICAgICAgICAgcmV0dXJuIC0xOworICAgICAgICAgICAgfQorICAg
ICAgICAgICAgaWYoTlVMTCA9PSAoY3Vycl9pbmZvLT5laXQgPSBjYWxsb2MoY3Vycl9pbmZvLT5u
dW1fZWl0cywgCisgICAgICAgICAgICAgICAgc2l6ZW9mKHN0cnVjdCBhdHNjX2VpdF9pbmZvKSkp
KSB7CisgICAgICAgICAgICAgICAgZnByaW50ZihzdGRlcnIsICIlcygpOiBlcnJvciBjYWxsaW5n
IGNhbGxvYygpXG4iLCBfX0ZVTkNUSU9OX18pOworICAgICAgICAgICAgICAgIHJldHVybiAtMTsK
KyAgICAgICAgICAgIH0KKyAgICAgICAgICAgIGlmKE5VTEwgPT0gKGN1cnJfaW5mby0+dGl0bGVf
YnVmLnN0cmluZyA9IGNhbGxvYyhUSVRMRV9CVUZGRVJfTEVOLCAKKyAgICAgICAgICAgICAgICBz
aXplb2YoY2hhcikpKSkgeworICAgICAgICAgICAgICAgIGZwcmludGYoc3RkZXJyLCAiJXMoKTog
ZXJyb3IgY2FsbGluZyBjYWxsb2MoKVxuIiwgX19GVU5DVElPTl9fKTsKKyAgICAgICAgICAgICAg
ICByZXR1cm4gLTE7CisgICAgICAgICAgICB9CisgICAgICAgICAgICBjdXJyX2luZm8tPnRpdGxl
X2J1Zi5idWZfbGVuID0gVElUTEVfQlVGRkVSX0xFTjsKKyAgICAgICAgICAgIGN1cnJfaW5mby0+
dGl0bGVfYnVmLmJ1Zl9wb3MgPSAwOworCisgICAgICAgICAgICBpZihOVUxMID09IChjdXJyX2lu
Zm8tPm1zZ19idWYuc3RyaW5nID0gY2FsbG9jKE1FU1NBR0VfQlVGRkVSX0xFTiwgCisgICAgICAg
ICAgICAgICAgc2l6ZW9mKGNoYXIpKSkpIHsKKyAgICAgICAgICAgICAgICBmcHJpbnRmKHN0ZGVy
ciwgIiVzKCk6IGVycm9yIGNhbGxpbmcgY2FsbG9jKClcbiIsIF9fRlVOQ1RJT05fXyk7CisgICAg
ICAgICAgICAgICAgcmV0dXJuIC0xOworICAgICAgICAgICAgfQorICAgICAgICAgICAgY3Vycl9p
bmZvLT5tc2dfYnVmLmJ1Zl9sZW4gPSBNRVNTQUdFX0JVRkZFUl9MRU47CisgICAgICAgICAgICBj
dXJyX2luZm8tPm1zZ19idWYuYnVmX3BvcyA9IDA7CisKKyAgICAgICAgICAgIGZvcihrID0gMDsg
ayA8IDc7IGsrKykgeworICAgICAgICAgICAgICAgIGN1cnJfaW5mby0+c2hvcnRfbmFtZVtrXSA9
IGdldF9iaXRzKChjb25zdCB1aW50OF90ICopY2gtPnNob3J0X25hbWUsIAorICAgICAgICAgICAg
ICAgICAgICBrICogMTYsIDE2KTsKKyAgICAgICAgICAgIH0KKyAgICAgICAgICAgIGN1cnJfaW5m
by0+c2VydmljZV90eXBlID0gY2gtPnNlcnZpY2VfdHlwZTsKKyAgICAgICAgICAgIGN1cnJfaW5m
by0+bWFqb3JfbnVtID0gY2gtPm1ham9yX2NoYW5uZWxfbnVtYmVyOworICAgICAgICAgICAgY3Vy
cl9pbmZvLT5taW5vcl9udW0gPSBjaC0+bWlub3JfY2hhbm5lbF9udW1iZXI7CisgICAgICAgICAg
ICBjdXJyX2luZm8tPnRzaWQgPSBjaC0+Y2hhbm5lbF9UU0lEOworICAgICAgICAgICAgY3Vycl9p
bmZvLT5wcm9nX251bSA9IGNoLT5wcm9ncmFtX251bWJlcjsKKyAgICAgICAgICAgIGN1cnJfaW5m
by0+c3JjX2lkID0gY2gtPnNvdXJjZV9pZDsKKyAgICAgICAgICAgIGN1cnJfaW5mbysrOworICAg
ICAgICB9CisgICAgfSB3aGlsZShzZWN0aW9uX3BhdHRlcm4gIT0gKHVpbnQzMl90KSgoMSA8PCBu
dW1fc2VjdGlvbnMpIC0gMSkpOworCisgICAgcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBpbnQgcGFy
c2VfZXR0KGludCBkbXhmZCwgaW50IGluZGV4LCB1aW50MTZfdCBwaWQpIAoreworICAgIGNvbnN0
IGVudW0gYXRzY19zZWN0aW9uX3RhZyB0YWcgPSBzdGFnX2F0c2NfZXh0ZW5kZWRfdGV4dDsKKyAg
ICBzdHJ1Y3QgYXRzY19ldHRfc2VjdGlvbiAqZXR0OworICAgIHN0cnVjdCBhdHNjX2NoYW5uZWxf
aW5mbyAqY2hhbm5lbDsKKyAgICBzdHJ1Y3QgYXRzY19ldmVudF9pbmZvICpldmVudDsKKyAgICBz
dHJ1Y3QgYXRzY190ZXh0ICp0ZXh0OworICAgIHN0cnVjdCBhdHNjX3RleHRfc3RyaW5nICpzdHI7
CisgICAgdWludDE2X3Qgc291cmNlX2lkLCBldmVudF9pZDsKKyAgICBpbnQgaSwgaiwgaywgcmV0
OworCisgICAgcmV0ID0gYXRzY19zY2FuX3RhYmxlKGRteGZkLCBwaWQsIHRhZywgKHZvaWQgKiop
JmV0dCk7CisgICAgZnByaW50ZihzdGRvdXQsICIuIik7CisgICAgZmZsdXNoKHN0ZG91dCk7Cisg
ICAgaWYoMCA+IHJldCkgeworICAgICAgICBmcHJpbnRmKHN0ZGVyciwgIiVzKCk6IGVycm9yIGNh
bGxpbmcgYXRzY19zY2FuX3RhYmxlKClcbiIsIF9fRlVOQ1RJT05fXyk7CisgICAgICAgIHJldHVy
biAtMTsKKyAgICB9CisgICAgaWYoMCA9PSByZXQpIHsKKyAgICAgICAgZnByaW50ZihzdGRvdXQs
ICJubyBFSVQgJWQgaW4gJWQgc2Vjb25kc1xuIiwgaW5kZXgsIFRJTUVPVVQpOworICAgICAgICBy
ZXR1cm4gMDsKKyAgICB9CisKKyAgICBzb3VyY2VfaWQgPSBldHQtPkVUTV9zb3VyY2VfaWQ7Cisg
ICAgZXZlbnRfaWQgPSBldHQtPkVUTV9zdWJfaWQ7CisgICAgY2hhbm5lbCA9IE5VTEw7CisgICAg
Zm9yKGkgPSAwOyBpIDwgZ3VpZGUubnVtX2NoYW5uZWxzOyBpKyspIHsKKyAgICAgICAgaWYoc291
cmNlX2lkID09IGd1aWRlLmNoW2ldLnNyY19pZCkgeworICAgICAgICAgICAgY2hhbm5lbCA9ICZn
dWlkZS5jaFtpXTsKKyAgICAgICAgICAgIGJyZWFrOworICAgICAgICB9CisgICAgfQorICAgIGlm
KE5VTEwgPT0gY2hhbm5lbCkgeworICAgICAgICByZXR1cm4gMDsKKyAgICB9CisKKyAgICBldmVu
dCA9IE5VTEw7CisgICAgZm9yKGkgPSAwOyBpIDwgY2hhbm5lbC0+bnVtX2VpdHM7IGkrKykgewor
ICAgICAgICBzdHJ1Y3QgYXRzY19laXRfaW5mbyAqZWl0ID0gJmNoYW5uZWwtPmVpdFtpXTsKKwor
ICAgICAgICBmb3IoaiA9IDA7IGogPCBlaXQtPm51bV9laXRfc2VjdGlvbnM7IGorKykgeworICAg
ICAgICAgICAgc3RydWN0IGF0c2NfZWl0X3NlY3Rpb25faW5mbyAqc2VjdGlvbiA9ICZlaXQtPnNl
Y3Rpb25bal07CisKKyAgICAgICAgICAgIGZvcihrID0gMDsgayA8IHNlY3Rpb24tPm51bV9ldmVu
dHM7IGsrKykgeworICAgICAgICAgICAgICAgIGlmKHNlY3Rpb24tPmV2ZW50c1trXSAmJiBzZWN0
aW9uLT5ldmVudHNba10tPmlkID09IGV2ZW50X2lkKSB7CisgICAgICAgICAgICAgICAgICAgIGV2
ZW50ID0gc2VjdGlvbi0+ZXZlbnRzW2tdOworICAgICAgICAgICAgICAgICAgICBicmVhazsKKyAg
ICAgICAgICAgICAgICB9CisgICAgICAgICAgICB9CisgICAgICAgICAgICBpZihldmVudCkgewor
ICAgICAgICAgICAgICAgIGJyZWFrOworICAgICAgICAgICAgfQorICAgICAgICB9CisgICAgICAg
IGlmKGV2ZW50KSB7CisgICAgICAgICAgICBicmVhazsKKyAgICAgICAgfQorICAgIH0KKyAgICBp
ZihOVUxMID09IGV2ZW50KSB7CisgICAgICAgIHJldHVybiAwOworICAgIH0KKworICAgIHRleHQg
PSBhdHNjX2V0dF9zZWN0aW9uX2V4dGVuZGVkX3RleHRfbWVzc2FnZShldHQpOworICAgIGF0c2Nf
dGV4dF9zdHJpbmdzX2Zvcl9lYWNoKHRleHQsIHN0ciwgaSkgeworICAgICAgICBzdHJ1Y3QgYXRz
Y190ZXh0X3N0cmluZ19zZWdtZW50ICpzZWc7CisKKyAgICAgICAgYXRzY190ZXh0X3N0cmluZ19z
ZWdtZW50c19mb3JfZWFjaChzdHIsIHNlZywgaikgeworICAgICAgICAgICAgZXZlbnQtPm1zZ19w
b3MgPSBjaGFubmVsLT5tc2dfYnVmLmJ1Zl9wb3M7CisgICAgICAgICAgICBpZigwID4gYXRzY190
ZXh0X3NlZ21lbnRfZGVjb2RlKHNlZywgCisgICAgICAgICAgICAgICAgKHVpbnQ4X3QgKiopJmNo
YW5uZWwtPm1zZ19idWYuc3RyaW5nLCAKKyAgICAgICAgICAgICAgICAoc2l6ZV90ICopJmNoYW5u
ZWwtPm1zZ19idWYuYnVmX2xlbiwgCisgICAgICAgICAgICAgICAgKHNpemVfdCAqKSZjaGFubmVs
LT5tc2dfYnVmLmJ1Zl9wb3MpKSB7CisgICAgICAgICAgICAgICAgZnByaW50ZihzdGRlcnIsICIl
cygpOiBlcnJvciBjYWxsaW5nIGF0c2NfdGV4dF9zZWdtZW50X2RlY29kZSgpXG4iLCAKKyAgICAg
ICAgICAgICAgICAgICAgX19GVU5DVElPTl9fKTsKKyAgICAgICAgICAgICAgICByZXR1cm4gLTE7
CisgICAgICAgICAgICB9CisgICAgICAgICAgICBldmVudC0+bXNnX2xlbiA9IDEgKyBjaGFubmVs
LT5tc2dfYnVmLmJ1Zl9wb3MgLSBldmVudC0+bXNnX3BvczsKKyAgICAgICAgfQorICAgIH0KKyAg
ICByZXR1cm4gMDsKK30KKworc3RhdGljIGludCBwYXJzZV9laXQoaW50IGRteGZkLCBpbnQgaW5k
ZXgsIHVpbnQxNl90IHBpZCkgCit7CisgICAgaW50IG51bV9zZWN0aW9uczsKKyAgICB1aW50OF90
IHNlY3Rpb25fbnVtOworICAgIHVpbnQ4X3QgY3Vycl9jaGFubmVsX2luZGV4OworICAgIHVpbnQz
Ml90IHNlY3Rpb25fcGF0dGVybjsKKyAgICBjb25zdCBlbnVtIGF0c2Nfc2VjdGlvbl90YWcgdGFn
ID0gc3RhZ19hdHNjX2V2ZW50X2luZm9ybWF0aW9uOworICAgIHN0cnVjdCBhdHNjX2VpdF9zZWN0
aW9uICplaXQ7CisgICAgc3RydWN0IGF0c2NfZWl0X2V2ZW50ICplOworICAgIHN0cnVjdCBhdHNj
X2NoYW5uZWxfaW5mbyAqY3Vycl9pbmZvOworICAgIHN0cnVjdCBhdHNjX2VpdF9pbmZvICplaXRf
aW5mbzsKKyAgICBzdHJ1Y3QgYXRzY19laXRfc2VjdGlvbl9pbmZvICpzZWN0aW9uOworICAgIHVp
bnQxNl90IHNvdXJjZV9pZDsKKyAgICB0aW1lX3Qgc3RhcnRfdGltZSwgZW5kX3RpbWU7CisgICAg
dWludDMyX3QgZWl0X2luc3RhbmNlX3BhdHRlcm4gPSAwOworICAgIGludCBpLCBqLCBrLCByZXQ7
CisKKyAgICB3aGlsZShlaXRfaW5zdGFuY2VfcGF0dGVybiAhPSAodWludDMyX3QpKCgxIDw8IGd1
aWRlLm51bV9jaGFubmVscykgLSAxKSkgeworICAgICAgICBzb3VyY2VfaWQgPSAweEZGRkY7Cisg
ICAgICAgIHNlY3Rpb25fcGF0dGVybiA9IDA7CisgICAgICAgIG51bV9zZWN0aW9ucyA9IC0xOwor
CisgICAgICAgIGRvIHsKKyAgICAgICAgICAgIHJldCA9IGF0c2Nfc2Nhbl90YWJsZShkbXhmZCwg
cGlkLCB0YWcsICh2b2lkICoqKSZlaXQpOworICAgICAgICAgICAgZnByaW50ZihzdGRvdXQsICIu
Iik7CisgICAgICAgICAgICBmZmx1c2goc3Rkb3V0KTsKKyAgICAgICAgICAgIGlmKDAgPiByZXQp
IHsKKyAgICAgICAgICAgICAgICBmcHJpbnRmKHN0ZGVyciwgIiVzKCk6IGVycm9yIGNhbGxpbmcg
YXRzY19zY2FuX3RhYmxlKClcbiIsIF9fRlVOQ1RJT05fXyk7CisgICAgICAgICAgICAgICAgcmV0
dXJuIC0xOworICAgICAgICAgICAgfQorICAgICAgICAgICAgaWYoMCA9PSByZXQpIHsKKyAgICAg
ICAgICAgICAgICBmcHJpbnRmKHN0ZG91dCwgIm5vIEVJVCAlZCBpbiAlZCBzZWNvbmRzXG4iLCBp
bmRleCwgVElNRU9VVCk7CisgICAgICAgICAgICAgICAgcmV0dXJuIDA7CisgICAgICAgICAgICB9
CisKKyAgICAgICAgICAgIGlmKDB4RkZGRiA9PSBzb3VyY2VfaWQpIHsKKyAgICAgICAgICAgICAg
ICBzb3VyY2VfaWQgPSBhdHNjX2VpdF9zZWN0aW9uX3NvdXJjZV9pZChlaXQpOworICAgICAgICAg
ICAgICAgIGZvcihrID0gMDsgayA8IGd1aWRlLm51bV9jaGFubmVsczsgaysrKSB7CisgICAgICAg
ICAgICAgICAgICAgIGlmKHNvdXJjZV9pZCA9PSBndWlkZS5jaFtrXS5zcmNfaWQpIHsKKyAgICAg
ICAgICAgICAgICAgICAgICAgIGN1cnJfaW5mbyA9ICZndWlkZS5jaFtrXTsKKyAgICAgICAgICAg
ICAgICAgICAgICAgIGN1cnJfY2hhbm5lbF9pbmRleCA9IGs7CisgICAgICAgICAgICAgICAgICAg
ICAgICBpZigwID09IGluZGV4KSB7CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3Vycl9p
bmZvLT5sYXN0X2V2ZW50ID0gTlVMTDsKKyAgICAgICAgICAgICAgICAgICAgICAgIH0KKyAgICAg
ICAgICAgICAgICAgICAgICAgIGJyZWFrOworICAgICAgICAgICAgICAgICAgICB9CisgICAgICAg
ICAgICAgICAgfQorICAgICAgICAgICAgICAgIGlmKGsgPT0gZ3VpZGUubnVtX2NoYW5uZWxzKSB7
CisgICAgICAgICAgICAgICAgICAgIGZwcmludGYoc3RkZXJyLCAiJXMoKTogY2Fubm90IGZpbmQg
c291cmNlX2lkIDB4JTA0WCBpbiB0aGUgRUlUXG4iLCAKKyAgICAgICAgICAgICAgICAgICAgICAg
IF9fRlVOQ1RJT05fXywgc291cmNlX2lkKTsKKyAgICAgICAgICAgICAgICAgICAgcmV0dXJuIC0x
OworICAgICAgICAgICAgICAgIH0KKyAgICAgICAgICAgIH0gZWxzZSB7CisgICAgICAgICAgICAg
ICAgaWYoc291cmNlX2lkICE9IGF0c2NfZWl0X3NlY3Rpb25fc291cmNlX2lkKGVpdCkpIHsKKyAg
ICAgICAgICAgICAgICAgICAgY29udGludWU7CisgICAgICAgICAgICAgICAgfQorICAgICAgICAg
ICAgfQorICAgICAgICAgICAgaWYoZWl0X2luc3RhbmNlX3BhdHRlcm4gJiAoMSA8PCBjdXJyX2No
YW5uZWxfaW5kZXgpKSB7CisgICAgICAgICAgICAgICAgLyogd2UgaGF2ZSByZWNlaXZlZCB0aGlz
IGluc3RhbmNlLCBzbyBxdWl0IHF1aWNrICovCisgICAgICAgICAgICAgICAgYnJlYWs7CisgICAg
ICAgICAgICB9CisKKyAgICAgICAgICAgIGlmKC0xID09IG51bV9zZWN0aW9ucykgeworICAgICAg
ICAgICAgICAgIG51bV9zZWN0aW9ucyA9IDEgKyBlaXQtPmhlYWQuZXh0X2hlYWQubGFzdF9zZWN0
aW9uX251bWJlcjsKKyAgICAgICAgICAgICAgICBpZigzMiA8IG51bV9zZWN0aW9ucykgeworICAg
ICAgICAgICAgICAgICAgICBmcHJpbnRmKHN0ZGVyciwgIiVzKCk6IG5vIHN1cHBvcnQgeWV0IGZv
ciB0YWJsZXMgaGF2aW5nIG1vcmUgdGhhbiAiIAorICAgICAgICAgICAgICAgICAgICAgICAgIjMy
IHNlY3Rpb25zXG4iLCBfX0ZVTkNUSU9OX18pOworICAgICAgICAgICAgICAgICAgICByZXR1cm4g
LTE7CisgICAgICAgICAgICAgICAgfQorICAgICAgICAgICAgfSBlbHNlIHsKKyAgICAgICAgICAg
ICAgICBpZihudW1fc2VjdGlvbnMgIT0gMSArIGVpdC0+aGVhZC5leHRfaGVhZC5sYXN0X3NlY3Rp
b25fbnVtYmVyKSB7CisgICAgICAgICAgICAgICAgICAgIGZwcmludGYoc3RkZXJyLCAiJXMoKTog
bGFzdCBzZWN0aW9uIG51bWJlciBkb2VzIG5vdCBtYXRjaFxuIiwgCisgICAgICAgICAgICAgICAg
ICAgICAgICBfX0ZVTkNUSU9OX18pOworICAgICAgICAgICAgICAgICAgICByZXR1cm4gLTE7Cisg
ICAgICAgICAgICAgICAgfQorICAgICAgICAgICAgfQorICAgICAgICAgICAgaWYoc2VjdGlvbl9w
YXR0ZXJuICYgKDEgPDwgZWl0LT5oZWFkLmV4dF9oZWFkLnNlY3Rpb25fbnVtYmVyKSkgeworICAg
ICAgICAgICAgICAgIGNvbnRpbnVlOworICAgICAgICAgICAgfQorICAgICAgICAgICAgc2VjdGlv
bl9wYXR0ZXJuIHw9IDEgPDwgZWl0LT5oZWFkLmV4dF9oZWFkLnNlY3Rpb25fbnVtYmVyOworCisg
ICAgICAgICAgICBlaXRfaW5mbyA9ICZjdXJyX2luZm8tPmVpdFtpbmRleF07CisgICAgICAgICAg
ICBpZihOVUxMID09IChlaXRfaW5mby0+c2VjdGlvbiA9IHJlYWxsb2MoZWl0X2luZm8tPnNlY3Rp
b24sIAorICAgICAgICAgICAgICAgIChlaXRfaW5mby0+bnVtX2VpdF9zZWN0aW9ucyArIDEpICog
c2l6ZW9mKHN0cnVjdCBhdHNjX2VpdF9zZWN0aW9uX2luZm8pKSkpIHsKKyAgICAgICAgICAgICAg
ICBmcHJpbnRmKHN0ZGVyciwgIiVzKCk6IGVycm9yIGNhbGxpbmcgcmVhbGxvYygpXG4iLCBfX0ZV
TkNUSU9OX18pOworICAgICAgICAgICAgICAgIHJldHVybiAtMTsKKyAgICAgICAgICAgIH0KKyAg
ICAgICAgICAgIHNlY3Rpb25fbnVtID0gZWl0LT5oZWFkLmV4dF9oZWFkLnNlY3Rpb25fbnVtYmVy
OworICAgICAgICAgICAgaWYoMCA9PSBlaXRfaW5mby0+bnVtX2VpdF9zZWN0aW9ucykgeworICAg
ICAgICAgICAgICAgIGVpdF9pbmZvLT5udW1fZWl0X3NlY3Rpb25zID0gMTsKKyAgICAgICAgICAg
ICAgICBzZWN0aW9uID0gZWl0X2luZm8tPnNlY3Rpb247CisgICAgICAgICAgICB9IGVsc2Ugewor
ICAgICAgICAgICAgICAgIC8qIGhhdmUgdG8gc29ydCBpdCBpbnRvIHNlY3Rpb24gb3JkZXIgKHRl
bXBvcmFsIG9yZGVyKSAqLworICAgICAgICAgICAgICAgIGZvcihpID0gMDsgaSA8IGVpdF9pbmZv
LT5udW1fZWl0X3NlY3Rpb25zOyBpKyspIHsKKyAgICAgICAgICAgICAgICAgICAgaWYoc2VjdGlv
bl9udW0gPCBlaXRfaW5mby0+c2VjdGlvbltpXS5zZWN0aW9uX251bSkgeworICAgICAgICAgICAg
ICAgICAgICAgICAgYnJlYWs7CisgICAgICAgICAgICAgICAgICAgIH0KKyAgICAgICAgICAgICAg
ICB9CisgICAgICAgICAgICAgICAgbWVtbW92ZSgmZWl0X2luZm8tPnNlY3Rpb25baSArIDFdLCAm
ZWl0X2luZm8tPnNlY3Rpb25baV0sIAorICAgICAgICAgICAgICAgICAgICAoZWl0X2luZm8tPm51
bV9laXRfc2VjdGlvbnMgLSBpKSAqIHNpemVvZihzdHJ1Y3QgYXRzY19laXRfc2VjdGlvbl9pbmZv
KSk7CisgICAgICAgICAgICAgICAgc2VjdGlvbiA9ICZlaXRfaW5mby0+c2VjdGlvbltpIC0gMV07
CisgICAgICAgICAgICAgICAgc2VjdGlvbiA9ICZlaXRfaW5mby0+c2VjdGlvbltpXTsKKyAgICAg
ICAgICAgICAgICBlaXRfaW5mby0+bnVtX2VpdF9zZWN0aW9ucyArPSAxOworICAgICAgICAgICAg
fQorCisgICAgICAgICAgICBzZWN0aW9uLT5zZWN0aW9uX251bSA9IHNlY3Rpb25fbnVtOworICAg
ICAgICAgICAgc2VjdGlvbi0+bnVtX2V2ZW50cyA9IGVpdC0+bnVtX2V2ZW50c19pbl9zZWN0aW9u
OworICAgICAgICAgICAgaWYoTlVMTCA9PSAoc2VjdGlvbi0+ZXZlbnRzID0gY2FsbG9jKHNlY3Rp
b24tPm51bV9ldmVudHMsIAorICAgICAgICAgICAgICAgIHNpemVvZihzdHJ1Y3QgYXRzY19ldmVu
dF9pbmZvICopKSkpIHsKKyAgICAgICAgICAgICAgICBmcHJpbnRmKHN0ZGVyciwgIiVzKCk6IGVy
cm9yIGNhbGxpbmcgY2FsbG9jKClcbiIsIF9fRlVOQ1RJT05fXyk7CisgICAgICAgICAgICAgICAg
cmV0dXJuIC0xOworICAgICAgICAgICAgfQorCisgICAgICAgICAgICBhdHNjX2VpdF9zZWN0aW9u
X2V2ZW50c19mb3JfZWFjaChlaXQsIGUsIGkpIHsKKyAgICAgICAgICAgICAgICBzdHJ1Y3QgYXRz
Y190ZXh0ICp0aXRsZTsKKyAgICAgICAgICAgICAgICBzdHJ1Y3QgYXRzY190ZXh0X3N0cmluZyAq
c3RyOworICAgICAgICAgICAgICAgIHN0cnVjdCBhdHNjX2V2ZW50X2luZm8gKmVfaW5mbyA9ICZj
dXJyX2luZm8tPmVbY3Vycl9pbmZvLT5ldmVudF9pbmZvX2luZGV4XTsKKworICAgICAgICAgICAg
ICAgIGlmKDAgPT0gaSAmJiBjdXJyX2luZm8tPmxhc3RfZXZlbnQpIHsKKyAgICAgICAgICAgICAg
ICAgICAgaWYoZS0+ZXZlbnRfaWQgPT0gY3Vycl9pbmZvLT5sYXN0X2V2ZW50LT5pZCkgeworICAg
ICAgICAgICAgICAgICAgICAgICAgc2VjdGlvbi0+ZXZlbnRzW2ldID0gTlVMTDsKKyAgICAgICAg
ICAgICAgICAgICAgICAgIC8qIHNraXAgaWYgaXQncyB0aGUgc2FtZSBldmVudCBzcGFubmluZyBv
dmVyIHNlY3Rpb25zICovCisgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKKyAgICAg
ICAgICAgICAgICAgICAgfQorICAgICAgICAgICAgICAgIH0KKyAgICAgICAgICAgICAgICBjdXJy
X2luZm8tPmV2ZW50X2luZm9faW5kZXggKz0gMTsKKyAgICAgICAgICAgICAgICBzZWN0aW9uLT5l
dmVudHNbaV0gPSBlX2luZm87CisgICAgICAgICAgICAgICAgZV9pbmZvLT5pZCA9IGUtPmV2ZW50
X2lkOworICAgICAgICAgICAgICAgIHN0YXJ0X3RpbWUgPSBhdHNjdGltZV90b191bml4dGltZShl
LT5zdGFydF90aW1lKTsKKyAgICAgICAgICAgICAgICBlbmRfdGltZSA9IHN0YXJ0X3RpbWUgKyBl
LT5sZW5ndGhfaW5fc2Vjb25kczsKKyAgICAgICAgICAgICAgICBsb2NhbHRpbWVfcigmc3RhcnRf
dGltZSwgJmVfaW5mby0+c3RhcnQpOworICAgICAgICAgICAgICAgIGxvY2FsdGltZV9yKCZlbmRf
dGltZSwgJmVfaW5mby0+ZW5kKTsKKworICAgICAgICAgICAgICAgIHRpdGxlID0gYXRzY19laXRf
ZXZlbnRfbmFtZV90aXRsZV90ZXh0KGUpOworICAgICAgICAgICAgICAgIGF0c2NfdGV4dF9zdHJp
bmdzX2Zvcl9lYWNoKHRpdGxlLCBzdHIsIGopIHsKKyAgICAgICAgICAgICAgICAgICAgc3RydWN0
IGF0c2NfdGV4dF9zdHJpbmdfc2VnbWVudCAqc2VnOworCisgICAgICAgICAgICAgICAgICAgIGF0
c2NfdGV4dF9zdHJpbmdfc2VnbWVudHNfZm9yX2VhY2goc3RyLCBzZWcsIGspIHsKKyAgICAgICAg
ICAgICAgICAgICAgICAgIGVfaW5mby0+dGl0bGVfcG9zID0gY3Vycl9pbmZvLT50aXRsZV9idWYu
YnVmX3BvczsKKyAgICAgICAgICAgICAgICAgICAgICAgIGlmKDAgPiBhdHNjX3RleHRfc2VnbWVu
dF9kZWNvZGUoc2VnLCAKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAodWludDhfdCAqKikm
Y3Vycl9pbmZvLT50aXRsZV9idWYuc3RyaW5nLCAKKyAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAoc2l6ZV90ICopJmN1cnJfaW5mby0+dGl0bGVfYnVmLmJ1Zl9sZW4sIAorICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIChzaXplX3QgKikmY3Vycl9pbmZvLT50aXRsZV9idWYuYnVmX3Bvcykp
IHsKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICBmcHJpbnRmKHN0ZGVyciwgIiVzKCk6IGVy
cm9yIGNhbGxpbmcgYXRzY190ZXh0X3NlZ21lbnRfZGVjb2RlKClcbiIsIAorICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICBfX0ZVTkNUSU9OX18pOworICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIHJldHVybiAtMTsKKyAgICAgICAgICAgICAgICAgICAgICAgIH0KKyAgICAgICAgICAg
ICAgICAgICAgICAgIGVfaW5mby0+dGl0bGVfbGVuID0gMSArIGN1cnJfaW5mby0+dGl0bGVfYnVm
LmJ1Zl9wb3MgLSAKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICBlX2luZm8tPnRpdGxlX3Bv
czsgCisgICAgICAgICAgICAgICAgICAgIH0KKyAgICAgICAgICAgICAgICB9CisgICAgICAgICAg
ICB9CisgICAgICAgIH0gd2hpbGUoc2VjdGlvbl9wYXR0ZXJuICE9ICh1aW50MzJfdCkoKDEgPDwg
bnVtX3NlY3Rpb25zKSAtIDEpKTsKKyAgICAgICAgZWl0X2luc3RhbmNlX3BhdHRlcm4gfD0gMSA8
PCBjdXJyX2NoYW5uZWxfaW5kZXg7CisgICAgfQorCisgICAgZm9yKGkgPSAwOyBpIDwgZ3VpZGUu
bnVtX2NoYW5uZWxzOyBpKyspIHsKKyAgICAgICAgc3RydWN0IGF0c2NfY2hhbm5lbF9pbmZvICpj
aGFubmVsID0gJmd1aWRlLmNoW2ldOworICAgICAgICBzdHJ1Y3QgYXRzY19laXRfaW5mbyAqZWkg
PSAmY2hhbm5lbC0+ZWl0W2luZGV4XTsKKyAgICAgICAgc3RydWN0IGF0c2NfZWl0X3NlY3Rpb25f
aW5mbyAqczsKKworICAgICAgICBpZigwID09IGVpLT5udW1fZWl0X3NlY3Rpb25zKSB7CisgICAg
ICAgICAgICBjaGFubmVsLT5sYXN0X2V2ZW50ID0gTlVMTDsKKyAgICAgICAgICAgIGNvbnRpbnVl
OworICAgICAgICB9CisgICAgICAgIHMgPSAmZWktPnNlY3Rpb25bZWktPm51bV9laXRfc2VjdGlv
bnMgLSAxXTsKKyAgICAgICAgLyogQlVHOiBpdCdzIGluY29ycmVjdCB3aGVuIGxhc3Qgc2VjdGlv
biBoYXMgbm8gZXZlbnQgKi8KKyAgICAgICAgaWYoMCA9PSBzLT5udW1fZXZlbnRzKSB7CisgICAg
ICAgICAgICBjaGFubmVsLT5sYXN0X2V2ZW50ID0gTlVMTDsKKyAgICAgICAgICAgIGNvbnRpbnVl
OworICAgICAgICB9CisgICAgICAgIGNoYW5uZWwtPmxhc3RfZXZlbnQgPSBzLT5ldmVudHNbcy0+
bnVtX2V2ZW50cyAtIDFdOworICAgIH0KKworICAgIHJldHVybiAwOworfQorCitzdGF0aWMgaW50
IHBhcnNlX21ndChpbnQgZG14ZmQpCit7CisgICAgY29uc3QgZW51bSBhdHNjX3NlY3Rpb25fdGFn
IHRhZyA9IHN0YWdfYXRzY19tYXN0ZXJfZ3VpZGU7CisgICAgc3RydWN0IGF0c2NfbWd0X3NlY3Rp
b24gKm1ndDsKKyAgICBzdHJ1Y3QgYXRzY19tZ3RfdGFibGUgKnQ7CisgICAgaW50IGksIGosIHJl
dDsKKworICAgIHJldCA9IGF0c2Nfc2Nhbl90YWJsZShkbXhmZCwgQVRTQ19CQVNFX1BJRCwgdGFn
LCAodm9pZCAqKikmbWd0KTsKKyAgICBpZigwID4gcmV0KSB7CisgICAgICAgIGZwcmludGYoc3Rk
ZXJyLCAiJXMoKTogZXJyb3IgY2FsbGluZyBhdHNjX3NjYW5fdGFibGUoKVxuIiwgX19GVU5DVElP
Tl9fKTsKKyAgICAgICAgcmV0dXJuIC0xOworICAgIH0KKyAgICBpZigwID09IHJldCkgeworICAg
ICAgICBmcHJpbnRmKHN0ZG91dCwgIm5vIE1HVCBpbiAlZCBzZWNvbmRzXG4iLCBUSU1FT1VUKTsK
KyAgICAgICAgcmV0dXJuIDA7CisgICAgfQorCisgICAgZnByaW50ZihzdGRvdXQsICJNR1QgdGFi
bGU6XG4iKTsKKyAgICBhdHNjX21ndF9zZWN0aW9uX3RhYmxlc19mb3JfZWFjaChtZ3QsIHQsIGkp
IHsKKyAgICAgICAgc3RydWN0IG1ndF90YWJsZV9uYW1lIHRhYmxlOworCisgICAgICAgIGZvcihq
ID0gMDsgaiA8IChpbnQpKHNpemVvZihtZ3RfdGFiX25hbWVfYXJyYXkpIC8gCisgICAgICAgICAg
ICBzaXplb2Yoc3RydWN0IG1ndF90YWJsZV9uYW1lKSk7IGorKykgeworICAgICAgICAgICAgaWYo
dC0+dGFibGVfdHlwZSA+IG1ndF90YWJfbmFtZV9hcnJheVtqXS5yYW5nZSkgeworICAgICAgICAg
ICAgICAgIGNvbnRpbnVlOworICAgICAgICAgICAgfQorICAgICAgICAgICAgdGFibGUgPSBtZ3Rf
dGFiX25hbWVfYXJyYXlbal07CisgICAgICAgICAgICBpZigwID09IGogfHwgbWd0X3RhYl9uYW1l
X2FycmF5W2ogLSAxXS5yYW5nZSArIDEgPT0gCisgICAgICAgICAgICAgICAgbWd0X3RhYl9uYW1l
X2FycmF5W2pdLnJhbmdlKSB7CisgICAgICAgICAgICAgICAgaiA9IC0xOworICAgICAgICAgICAg
fSBlbHNlIHsKKyAgICAgICAgICAgICAgICBqID0gdC0+dGFibGVfdHlwZSAtIG1ndF90YWJfbmFt
ZV9hcnJheVtqIC0gMV0ucmFuZ2UgLSAxOworICAgICAgICAgICAgICAgIGlmKDB4MDE3RiA9PSB0
YWJsZS5yYW5nZSkgeworICAgICAgICAgICAgICAgICAgICBndWlkZS5laXRfcGlkW2pdID0gdC0+
dGFibGVfdHlwZV9QSUQ7CisgICAgICAgICAgICAgICAgfSBlbHNlIGlmICgweDAyN0YgPT0gdGFi
bGUucmFuZ2UpIHsKKyAgICAgICAgICAgICAgICAgICAgZ3VpZGUuZXR0X3BpZFtqXSA9IHQtPnRh
YmxlX3R5cGVfUElEOworICAgICAgICAgICAgICAgIH0KKyAgICAgICAgICAgIH0KKyAgICAgICAg
ICAgIGJyZWFrOworICAgICAgICB9CisKKyAgICAgICAgZnByaW50ZihzdGRvdXQsICIgICUyZDog
dHlwZSA9IDB4JTA0WCwgUElEID0gMHglMDRYLCAlcyIsIGksIAorICAgICAgICAgICAgdC0+dGFi
bGVfdHlwZSwgdC0+dGFibGVfdHlwZV9QSUQsIHRhYmxlLnN0cmluZyk7CisgICAgICAgIGlmKC0x
ICE9IGopIHsKKyAgICAgICAgICAgIGZwcmludGYoc3Rkb3V0LCAiICVkIiwgaik7CisgICAgICAg
IH0KKyAgICAgICAgZnByaW50ZihzdGRvdXQsICJcbiIpOworICAgIH0KKyAKKyAgICByZXR1cm4g
MDsKK30KKworc3RhdGljIGludCBjbGVhbnVwX2d1aWRlKHZvaWQpIAoreworICAgIGludCBpLCBq
LCBrOworCisgICAgZm9yKGkgPSAwOyBpIDwgZ3VpZGUubnVtX2NoYW5uZWxzOyBpKyspIHsKKyAg
ICAgICAgc3RydWN0IGF0c2NfY2hhbm5lbF9pbmZvICpjaGFubmVsID0gJmd1aWRlLmNoW2ldOwor
CisgICAgICAgIGlmKGNoYW5uZWwtPnRpdGxlX2J1Zi5zdHJpbmcpIHsKKyAgICAgICAgICAgIGZy
ZWUoY2hhbm5lbC0+dGl0bGVfYnVmLnN0cmluZyk7CisgICAgICAgIH0KKyAgICAgICAgaWYoY2hh
bm5lbC0+bXNnX2J1Zi5zdHJpbmcpIHsKKyAgICAgICAgICAgIGZyZWUoY2hhbm5lbC0+bXNnX2J1
Zi5zdHJpbmcpOworICAgICAgICB9CisgICAgICAgIGZvcihqID0gMDsgaiA8IGNoYW5uZWwtPm51
bV9laXRzOyBqKyspIHsKKyAgICAgICAgICAgIHN0cnVjdCBhdHNjX2VpdF9pbmZvICplaXQgPSAm
Y2hhbm5lbC0+ZWl0W2pdOworCisgICAgICAgICAgICBmb3IoayA9IDA7IGsgPCBlaXQtPm51bV9l
aXRfc2VjdGlvbnM7IGsrKykgeworICAgICAgICAgICAgICAgIHN0cnVjdCBhdHNjX2VpdF9zZWN0
aW9uX2luZm8gKnNlY3Rpb24gPSAmZWl0LT5zZWN0aW9uW2tdOworICAgICAgICAgICAgICAgIGlm
KHNlY3Rpb24tPm51bV9ldmVudHMpIHsKKyAgICAgICAgICAgICAgICAgICAgZnJlZShzZWN0aW9u
LT5ldmVudHMpOworICAgICAgICAgICAgICAgIH0KKyAgICAgICAgICAgIH0KKyAgICAgICAgICAg
IGlmKGspIHsKKyAgICAgICAgICAgICAgICBmcmVlKGVpdC0+c2VjdGlvbik7CisgICAgICAgICAg
ICB9CisgICAgICAgIH0KKyAgICAgICAgaWYoaikgeworICAgICAgICAgICAgZnJlZShjaGFubmVs
LT5laXQpOworICAgICAgICB9CisgICAgfQorCisgICAgcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBp
bnQgcHJpbnRfZ3VpZGUodm9pZCkgCit7CisgICAgaW50IGksIGosIGssIG07CisgICAgY2hhciBs
aW5lWzI1Nl07CisKKyAgICBmcHJpbnRmKHN0ZG91dCwgIiVzXG4iLCBzZXBhcmF0b3IpOworICAg
IGZvcihpID0gMDsgaSA8IGd1aWRlLm51bV9jaGFubmVsczsgaSsrKSB7CisgICAgICAgIHN0cnVj
dCBhdHNjX2NoYW5uZWxfaW5mbyAqY2hhbm5lbCA9ICZndWlkZS5jaFtpXTsKKworICAgICAgICBm
cHJpbnRmKHN0ZG91dCwgIiVkLiVkICAlc1xuIiwgY2hhbm5lbC0+bWFqb3JfbnVtLCBjaGFubmVs
LT5taW5vcl9udW0sIAorICAgICAgICAgICAgY2hhbm5lbC0+c2hvcnRfbmFtZSk7CisgICAgICAg
IGZvcihqID0gMDsgaiA8IGNoYW5uZWwtPm51bV9laXRzOyBqKyspIHsKKyAgICAgICAgICAgIHN0
cnVjdCBhdHNjX2VpdF9pbmZvICplaXQgPSAmY2hhbm5lbC0+ZWl0W2pdOworCisgICAgICAgICAg
ICBmb3IoayA9IDA7IGsgPCBlaXQtPm51bV9laXRfc2VjdGlvbnM7IGsrKykgeworICAgICAgICAg
ICAgICAgIHN0cnVjdCBhdHNjX2VpdF9zZWN0aW9uX2luZm8gKnNlY3Rpb24gPSAmZWl0LT5zZWN0
aW9uW2tdOworCisgICAgICAgICAgICAgICAgZm9yKG0gPSAwOyBtIDwgc2VjdGlvbi0+bnVtX2V2
ZW50czsgbSsrKSB7CisgICAgICAgICAgICAgICAgICAgIHN0cnVjdCBhdHNjX2V2ZW50X2luZm8g
KmV2ZW50ID0gc2VjdGlvbi0+ZXZlbnRzW21dOworCisgICAgICAgICAgICAgICAgICAgIGlmKE5V
TEwgPT0gZXZlbnQpIHsKKyAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOworICAgICAg
ICAgICAgICAgICAgICB9CisgICAgICAgICAgICAgICAgICAgIGZwcmludGYoc3Rkb3V0LCAifCUw
MmQ6JTAyZC0tJTAyZDolMDJkfCAiLCAKKyAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50LT5z
dGFydC50bV9ob3VyLCBldmVudC0+c3RhcnQudG1fbWluLCAKKyAgICAgICAgICAgICAgICAgICAg
ICAgIGV2ZW50LT5lbmQudG1faG91ciwgZXZlbnQtPmVuZC50bV9taW4pOworICAgICAgICAgICAg
ICAgICAgICBzbnByaW50ZihsaW5lLCBldmVudC0+dGl0bGVfbGVuLCAiJXMiLCAKKyAgICAgICAg
ICAgICAgICAgICAgICAgICZjaGFubmVsLT50aXRsZV9idWYuc3RyaW5nW2V2ZW50LT50aXRsZV9w
b3NdKTsKKyAgICAgICAgICAgICAgICAgICAgbGluZVtldmVudC0+dGl0bGVfbGVuXSA9ICdcMCc7
CisgICAgICAgICAgICAgICAgICAgIGZwcmludGYoc3Rkb3V0LCAiJXNcbiIsIGxpbmUpOworICAg
ICAgICAgICAgICAgICAgICBpZihldmVudC0+bXNnX2xlbikgeworICAgICAgICAgICAgICAgICAg
ICAgICAgaW50IGxlbiA9IGV2ZW50LT5tc2dfbGVuOworICAgICAgICAgICAgICAgICAgICAgICAg
aW50IHBvcyA9IGV2ZW50LT5tc2dfcG9zOworICAgICAgICAgICAgICAgICAgICAgICAgc2l6ZV90
IHBhcnQ7CisgICAgICAgICAgICAgICAgICAgICAgICBkbyB7CisgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgcGFydCA9IGxlbiA+IDI1NSA/IDI1NSA6IGxlbjsKKyAgICAgICAgICAgICAgICAg
ICAgICAgICAgICBzbnByaW50ZihsaW5lLCBwYXJ0LCAiJXMiLCAKKyAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgJmNoYW5uZWwtPm1zZ19idWYuc3RyaW5nW3Bvc10pOworICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIGxpbmVbcGFydF0gPSAnXDAnOworICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIGZwcmludGYoc3Rkb3V0LCAiJXMiLCBsaW5lKTsKKyAgICAgICAgICAgICAgICAg
ICAgICAgICAgICBsZW4gLT0gcGFydDsgcG9zICs9IHBhcnQ7CisgICAgICAgICAgICAgICAgICAg
ICAgICB9IHdoaWxlKDAgPCBsZW4pOworICAgICAgICAgICAgICAgICAgICAgICAgZnByaW50Zihz
dGRvdXQsICJcbiIpOworICAgICAgICAgICAgICAgICAgICB9CisgICAgICAgICAgICAgICAgfQor
ICAgICAgICAgICAgfQorICAgICAgICB9CisgICAgICAgIGZwcmludGYoc3Rkb3V0LCAiJXNcbiIs
IHNlcGFyYXRvcik7CisgICAgfQorCisgICAgcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBpbnQgb3Bl
bl9kZW11eChpbnQgKmRteGZkKQoreworICAgIGlmICgoKmRteGZkID0gZHZiZGVtdXhfb3Blbl9k
ZW11eChhZGFwdGVyLCAwLCAwKSkgPCAwKSB7CisgICAgICAgIGZwcmludGYoc3RkZXJyLCAiJXMo
KTogZXJyb3IgY2FsbGluZyBkdmJkZW11eF9vcGVuX2RlbXV4KClcbiIsIF9fRlVOQ1RJT05fXyk7
CisgICAgICAgIHJldHVybiAtMTsKKyAgICB9CisgICAgcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBp
bnQgY2xvc2VfZGVtdXgoaW50IGRteGZkKQoreworICAgIGlmIChkdmJkZW11eF9zdG9wKGRteGZk
KSkgeworICAgICAgICBmcHJpbnRmKHN0ZGVyciwgIiVzKCk6IGVycm9yIGNhbGxpbmcgZHZiZGVt
dXhfc3RvcCgpXG4iLCBfX0ZVTkNUSU9OX18pOworICAgICAgICByZXR1cm4gLTE7CisgICAgfQor
ICAgIHJldHVybiAwOworfQorCitzdGF0aWMgaW50IGF0c2Nfc2Nhbl90YWJsZShpbnQgZG14ZmQs
IHVpbnQxNl90IHBpZCwgZW51bSBhdHNjX3NlY3Rpb25fdGFnIHRhZywgCisgICAgdm9pZCAqKnRh
YmxlX3NlY3Rpb24pCit7CisgICAgdWludDhfdCBmaWx0ZXJbMThdOworICAgIHVpbnQ4X3QgbWFz
a1sxOF07CisgICAgdW5zaWduZWQgY2hhciBzaWJ1Zls0MDk2XTsKKyAgICBpbnQgc2l6ZTsKKyAg
ICBpbnQgcmV0OworICAgIHN0cnVjdCBwb2xsZmQgcG9sbGZkOworICAgIHN0cnVjdCBzZWN0aW9u
ICpzZWN0aW9uOworICAgIHN0cnVjdCBzZWN0aW9uX2V4dCAqc2VjdGlvbl9leHQ7CisgICAgc3Ry
dWN0IGF0c2Nfc2VjdGlvbl9wc2lwICpwc2lwOworCisgICAgLyogY3JlYXRlIGEgc2VjdGlvbiBm
aWx0ZXIgZm9yIHRoZSB0YWJsZSAqLworICAgIG1lbXNldChmaWx0ZXIsIDAsIHNpemVvZihmaWx0
ZXIpKTsKKyAgICBtZW1zZXQobWFzaywgMCwgc2l6ZW9mKG1hc2spKTsKKyAgICBmaWx0ZXJbMF0g
PSB0YWc7CisgICAgbWFza1swXSA9IDB4RkY7CisgICAgaWYoZHZiZGVtdXhfc2V0X3NlY3Rpb25f
ZmlsdGVyKGRteGZkLCBwaWQsIGZpbHRlciwgbWFzaywgMSwgMSkpIHsKKyAgICAgICAgZnByaW50
ZihzdGRlcnIsICIlcygpOiBlcnJvciBjYWxsaW5nIGF0c2Nfc2Nhbl90YWJsZSgpXG4iLCBfX0ZV
TkNUSU9OX18pOworICAgICAgICByZXR1cm4gLTE7CisgICAgfQorCisgICAgLyogcG9sbCBmb3Ig
ZGF0YSAqLworICAgIHBvbGxmZC5mZCA9IGRteGZkOworICAgIHBvbGxmZC5ldmVudHMgPSBQT0xM
SU4gfCBQT0xMRVJSIHxQT0xMUFJJOworICAgIGlmKChyZXQgPSBwb2xsKCZwb2xsZmQsIDEsIFRJ
TUVPVVQgKiAxMDAwKSkgPCAwKSB7CisgICAgICAgIGZwcmludGYoc3RkZXJyLCAiJXMoKTogZXJy
b3IgY2FsbGluZyBwb2xsKClcbiIsIF9fRlVOQ1RJT05fXyk7CisgICAgICAgIHJldHVybiAtMTsK
KyAgICB9CisKKyAgICBpZigwID09IHJldCkgeworICAgICAgICByZXR1cm4gMDsKKyAgICB9CisK
KyAgICAvKiByZWFkIGl0ICovCisgICAgaWYoKHNpemUgPSByZWFkKGRteGZkLCBzaWJ1Ziwgc2l6
ZW9mKHNpYnVmKSkpIDwgMCkgeworICAgICAgICBmcHJpbnRmKHN0ZGVyciwgIiVzKCk6IGVycm9y
IGNhbGxpbmcgcmVhZCgpXG4iLCBfX0ZVTkNUSU9OX18pOworICAgICAgICByZXR1cm4gLTE7Cisg
ICAgfQorCisgICAgLyogcGFyc2Ugc2VjdGlvbiAqLworICAgIHNlY3Rpb24gPSBzZWN0aW9uX2Nv
ZGVjKHNpYnVmLCBzaXplKTsKKyAgICBpZihOVUxMID09IHNlY3Rpb24pIHsKKyAgICAgICAgZnBy
aW50ZihzdGRlcnIsICIlcygpOiBlcnJvciBjYWxsaW5nIHNlY3Rpb25fY29kZWMoKVxuIiwgX19G
VU5DVElPTl9fKTsKKyAgICAgICAgcmV0dXJuIC0xOworICAgIH0KKworICAgIHNlY3Rpb25fZXh0
ID0gc2VjdGlvbl9leHRfZGVjb2RlKHNlY3Rpb24sIDApOworICAgIGlmKE5VTEwgPT0gc2VjdGlv
bl9leHQpIHsKKyAgICAgICAgZnByaW50ZihzdGRlcnIsICIlcygpOiBlcnJvciBjYWxsaW5nIHNl
Y3Rpb25fZXh0X2RlY29kZSgpXG4iLCBfX0ZVTkNUSU9OX18pOworICAgICAgICByZXR1cm4gLTE7
CisgICAgfQorCisgICAgcHNpcCA9IGF0c2Nfc2VjdGlvbl9wc2lwX2RlY29kZShzZWN0aW9uX2V4
dCk7CisgICAgaWYoTlVMTCA9PSBwc2lwKSB7CisgICAgICAgIGZwcmludGYoc3RkZXJyLCAiJXMo
KTogZXJyb3IgY2FsbGluZyBhdHNjX3NlY3Rpb25fcHNpcF9kZWNvZGUoKVxuIiwgX19GVU5DVElP
Tl9fKTsKKyAgICAgICAgcmV0dXJuIC0xOworICAgIH0KKworICAgICp0YWJsZV9zZWN0aW9uID0g
dGFibGVfY2FsbGJhY2tbdGFnICYgMHgwRl0ocHNpcCk7CisgICAgaWYoTlVMTCA9PSAqdGFibGVf
c2VjdGlvbikgeworICAgICAgICBmcHJpbnRmKHN0ZGVyciwgIiVzKCk6IGVycm9yIGRlY29kZSB0
YWJsZSBzZWN0aW9uXG4iLCBfX0ZVTkNUSU9OX18pOworICAgICAgICByZXR1cm4gLTE7CisgICAg
fQorCisgICAgcmV0dXJuIDE7Cit9CisKK2ludCBtYWluKGludCBhcmdjLCBjaGFyICphcmd2W10p
Cit7CisgICAgaW50IGksIGRteGZkOworICAgIHN0cnVjdCBkdmJmZV9oYW5kbGUgKmZlOworCisg
ICAgaWYoMSA9PSBhcmdjKSB7CisgICAgICAgIHVzYWdlKCk7CisgICAgfQorCisgICAgcHJvZ3Jh
bSA9IGFyZ3ZbMF07CisKKyAgICBmb3IoIDsgOyApIHsKKyAgICAgICAgY2hhciBjOworCisgICAg
ICAgIGlmKC0xID09IChjID0gZ2V0b3B0KGFyZ2MsIGFyZ3YsICJhOmY6cDptOnRoIikpKSB7Cisg
ICAgICAgICAgICBicmVhazsKKyAgICAgICAgfQorCisgICAgICAgIHN3aXRjaChjKSB7CisgICAg
ICAgIGNhc2UgJ2EnOgorICAgICAgICAgICAgYWRhcHRlciA9IHN0cnRvbGwob3B0YXJnLCBOVUxM
LCAwKTsKKyAgICAgICAgICAgIGJyZWFrOworCisgICAgICAgIGNhc2UgJ2YnOgorICAgICAgICAg
ICAgZnJlcXVlbmN5ID0gc3RydG9sKG9wdGFyZywgTlVMTCwgMCk7CisgICAgICAgICAgICBicmVh
azsKKworICAgICAgICBjYXNlICdwJzoKKyAgICAgICAgICAgIHBlcmlvZCA9IHN0cnRvbChvcHRh
cmcsIE5VTEwsIDApOworICAgICAgICAgICAgLyogZWFjaCB0YWJsZSBjb3ZlcnMgMyBob3VycyAq
LworICAgICAgICAgICAgaWYoKDMgKiBNQVhfTlVNX0VWRU5UX1RBQkxFUykgPCBwZXJpb2QpIHsK
KyAgICAgICAgICAgICAgICBwZXJpb2QgPSAzICogTUFYX05VTV9FVkVOVF9UQUJMRVM7CisgICAg
ICAgICAgICB9CisgICAgICAgICAgICBicmVhazsKKworICAgICAgICBjYXNlICdtJzoKKyAgICAg
ICAgICAgIG1vZHVsYXRpb24gPSBvcHRhcmc7CisgICAgICAgICAgICBicmVhazsKKworICAgICAg
ICBjYXNlICd0JzoKKyAgICAgICAgICAgIGVuYWJsZV9ldHQgPSAxOworICAgICAgICAgICAgYnJl
YWs7CisKKyAgICAgICAgY2FzZSAnaCc6CisgICAgICAgICAgICBoZWxwKCk7CisgICAgICAgICAg
ICBleGl0KDApOworCisgICAgICAgIGRlZmF1bHQ6CisgICAgICAgICAgICB1c2FnZSgpOworICAg
ICAgICAgICAgZXhpdCgtMSk7CisgICAgICAgIH0KKyAgICB9CisKKyAgICBtZW1zZXQoc2VwYXJh
dG9yLCAnLScsIHNpemVvZihzZXBhcmF0b3IpKTsKKyAgICBzZXBhcmF0b3JbNzldID0gJ1wwJzsK
KyAgICBtZW1zZXQoJmd1aWRlLCAwLCBzaXplb2Yoc3RydWN0IGF0c2NfdmlydHVhbF9jaGFubmVs
c19pbmZvKSk7CisgICAgbWVtc2V0KGd1aWRlLmVpdF9waWQsIDB4RkYsIE1BWF9OVU1fRVZFTlRf
VEFCTEVTICogc2l6ZW9mKHVpbnQxNl90KSk7CisgICAgbWVtc2V0KGd1aWRlLmV0dF9waWQsIDB4
RkYsIE1BWF9OVU1fRVZFTlRfVEFCTEVTICogc2l6ZW9mKHVpbnQxNl90KSk7CisKKyAgICBpZihv
cGVuX2Zyb250ZW5kKCZmZSkpIHsKKyAgICAgICAgZnByaW50ZihzdGRlcnIsICIlcygpOiBlcnJv
ciBjYWxsaW5nIG9wZW5fZnJvbnRlbmQoKVxuIiwgX19GVU5DVElPTl9fKTsKKyAgICAgICAgcmV0
dXJuIC0xOworICAgIH0KKworICAgIGlmKG9wZW5fZGVtdXgoJmRteGZkKSkgeworICAgICAgICBm
cHJpbnRmKHN0ZGVyciwgIiVzKCk6IGVycm9yIGNhbGxpbmcgb3Blbl9kZW11eCgpXG4iLCBfX0ZV
TkNUSU9OX18pOworICAgICAgICByZXR1cm4gLTE7CisgICAgfQorCisgICAgaWYocGFyc2Vfc3R0
KGRteGZkKSkgeworICAgICAgICBmcHJpbnRmKHN0ZGVyciwgIiVzKCk6IGVycm9yIGNhbGxpbmcg
cGFyc2Vfc3R0KClcbiIsIF9fRlVOQ1RJT05fXyk7CisgICAgICAgIHJldHVybiAtMTsKKyAgICB9
CisKKyAgICBpZihwYXJzZV9tZ3QoZG14ZmQpKSB7CisgICAgICAgIGZwcmludGYoc3RkZXJyLCAi
JXMoKTogZXJyb3IgY2FsbGluZyBwYXJzZV9tZ3QoKVxuIiwgX19GVU5DVElPTl9fKTsKKyAgICAg
ICAgcmV0dXJuIC0xOworICAgIH0KKworICAgIGlmKHBhcnNlX3R2Y3QoZG14ZmQpKSB7CisgICAg
ICAgIGZwcmludGYoc3RkZXJyLCAiJXMoKTogZXJyb3IgY2FsbGluZyBwYXJzZV90dmN0KClcbiIs
IF9fRlVOQ1RJT05fXyk7CisgICAgICAgIHJldHVybiAtMTsKKyAgICB9CisKKyAgICBmcHJpbnRm
KHN0ZG91dCwgInJlY2VpdmluZyBFSVQgIik7CisgICAgZm9yKGkgPSAwOyBpIDwgZ3VpZGUuY2hb
MF0ubnVtX2VpdHM7IGkrKykgeworICAgICAgICBpZihwYXJzZV9laXQoZG14ZmQsIGksIGd1aWRl
LmVpdF9waWRbaV0pKSB7CisgICAgICAgICAgICBmcHJpbnRmKHN0ZGVyciwgIiVzKCk6IGVycm9y
IGNhbGxpbmcgcGFyc2VfZWl0KClcbiIsIF9fRlVOQ1RJT05fXyk7CisgICAgICAgICAgICByZXR1
cm4gLTE7CisgICAgICAgIH0KKyAgICB9CisgICAgZnByaW50ZihzdGRvdXQsICJcbiIpOworCisg
ICAgaWYoZW5hYmxlX2V0dCkgeworICAgICAgICBmcHJpbnRmKHN0ZG91dCwgInJlY2VpdmluZyBF
VFQgIik7CisgICAgICAgIGZvcihpID0gMDsgaSA8IGd1aWRlLmNoWzBdLm51bV9laXRzOyBpKysp
IHsKKyAgICAgICAgICAgIGlmKDB4RkZGRiAhPSBndWlkZS5ldHRfcGlkW2ldKSB7CisgICAgICAg
ICAgICAgICAgaWYocGFyc2VfZXR0KGRteGZkLCBpLCBndWlkZS5ldHRfcGlkW2ldKSkgeworICAg
ICAgICAgICAgICAgICAgICBmcHJpbnRmKHN0ZGVyciwgIiVzKCk6IGVycm9yIGNhbGxpbmcgcGFy
c2VfZWl0KClcbiIsIF9fRlVOQ1RJT05fXyk7CisgICAgICAgICAgICAgICAgICAgIHJldHVybiAt
MTsKKyAgICAgICAgICAgICAgICB9CisgICAgICAgICAgICB9CisgICAgICAgIH0KKyAgICAgICAg
ZnByaW50ZihzdGRvdXQsICJcbiIpOworICAgIH0KKworICAgIGlmKHByaW50X2d1aWRlKCkpIHsK
KyAgICAgICAgZnByaW50ZihzdGRlcnIsICIlcygpOiBlcnJvciBjYWxsaW5nIHByaW50X2d1aWRl
KClcbiIsIF9fRlVOQ1RJT05fXyk7CisgICAgICAgIHJldHVybiAtMTsKKyAgICB9CisKKyAgICBp
ZihjbGVhbnVwX2d1aWRlKCkpIHsKKyAgICAgICAgZnByaW50ZihzdGRlcnIsICIlcygpOiBlcnJv
ciBjYWxsaW5nIGNsZWFudXBfZ3VpZGUoKVxuIiwgX19GVU5DVElPTl9fKTsKKyAgICAgICAgcmV0
dXJuIC0xOworICAgIH0KKworI2lmIDAKKyAgICBpID0gMDsKKyAgICB3aGlsZSgwICE9IGNoX2lu
Zm9baV0uc291cmNlX2lkKSB7CisgICAgICAgIGNoX2luZm9baV0uc3RyaW5nW2NoX2luZm9baV0u
YnVmZmVyX3Bvc10gPSAnXDAnOworICAgICAgICBmcHJpbnRmKHN0ZG91dCwgIiVzIiwgY2hfaW5m
b1tpXS5zdHJpbmcpOworICAgICAgICBmcmVlKGNoX2luZm9baSsrXS5zdHJpbmcpOworICAgIH0K
KyAgICBmcHJpbnRmKHN0ZG91dCwgIiVzXG4iLCBzZXBhcmF0b3IpOworI2VuZGlmCisKKyNpZiAw
CisgICAgaWYocGFyc2VfcnJ0KGRteGZkKSkgeworICAgICAgICBmcHJpbnRmKHN0ZGVyciwgIiVz
KCk6IGVycm9yIGNhbGxpbmcgcGFyc2VfcnJ0KClcbiIsIF9fRlVOQ1RJT05fXyk7CisgICAgICAg
IHJldHVybiAtMTsKKyAgICB9CisjZW5kaWYKKworICAgIGlmKGNsb3NlX2RlbXV4KGRteGZkKSkg
eworICAgICAgICBmcHJpbnRmKHN0ZGVyciwgIiVzKCk6IGVycm9yIGNhbGxpbmcgY2xvc2VfZGVt
dXgoKVxuIiwgX19GVU5DVElPTl9fKTsKKyAgICAgICAgcmV0dXJuIC0xOworICAgIH0KKworICAg
IGlmKGNsb3NlX2Zyb250ZW5kKGZlKSkgeworICAgICAgICBmcHJpbnRmKHN0ZGVyciwgIiVzKCk6
IGVycm9yIGNhbGxpbmcgY2xvc2VfZGVtdXgoKVxuIiwgX19GVU5DVElPTl9fKTsKKyAgICAgICAg
cmV0dXJuIC0xOworICAgIH0KKworICAgIHJldHVybiAwOworfQorCmRpZmYgLXIgOWI1YzczMTQ5
ODA4IC1yIDM4NjA5Y2IwZDljNSB1dGlsL3NjYW4vTWFrZWZpbGUKLS0tIGEvdXRpbC9zY2FuL01h
a2VmaWxlCVdlZCBKdW4gMTAgMjA6MjM6MTUgMjAwOSArMDIwMAorKysgYi91dGlsL3NjYW4vTWFr
ZWZpbGUJTW9uIEp1biAxNSAyMDozMjowOCAyMDA5IC0wNTAwCkBAIC0xNCw3ICsxNCw3IEBACiAK
IHJlbW92aW5nID0gYXRzY19wc2lwX3NlY3Rpb24uYyBhdHNjX3BzaXBfc2VjdGlvbi5oCiAKLUNQ
UEZMQUdTICs9IC1EREFUQURJUj1cIiQocHJlZml4KS9zaGFyZVwiCitDUFBGTEFHUyArPSAtRF9f
S0VSTkVMX1NUUklDVF9OQU1FUyAtRERBVEFESVI9XCIkKHByZWZpeCkvc2hhcmVcIgogCiAuUEhP
Tlk6IGFsbAogCmRpZmYgLXIgOWI1YzczMTQ5ODA4IC1yIDM4NjA5Y2IwZDljNSB1dGlsL3NjYW4v
YXRzY19wc2lwX3NlY3Rpb24ucGwKLS0tIGEvdXRpbC9zY2FuL2F0c2NfcHNpcF9zZWN0aW9uLnBs
CVdlZCBKdW4gMTAgMjA6MjM6MTUgMjAwOSArMDIwMAorKysgYi91dGlsL3NjYW4vYXRzY19wc2lw
X3NlY3Rpb24ucGwJTW9uIEp1biAxNSAyMDozMjowOCAyMDA5IC0wNTAwCkBAIC02NSwxMCArNjUs
MTEgQEAKIAkJCQloaWRkZW4gPT4gMSwKIAkJCQlyZXNlcnZlZDEgPT4gMiwKIAkJCQloaWRlX2d1
aWRlID0+IDEsCi0JCQkJcmVzZXJ2ZWQyID0+IDMsCisJCQkJcmVzZXJ2ZWQyID0+IDEsCisJCQkJ
cmVzZXJ2ZWQzID0+IDIsCiAJCQkJc2VydmljZV90eXBlID0+IDYsCiAJCQkJc291cmNlX2lkID0+
IDE2LAotCQkJCXJlc2VydmVkMyA9PiA2LAorCQkJCXJlc2VydmVkNCA9PiA2LAogCQkJCWRlc2Ny
aXB0b3JzX2xlbmd0aCA9PiAxMCwKIAkJCV0sCiAJCX0sCg==
--0016362835a65fc86e046c9382e4--
