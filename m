Return-path: <linux-media-owner@vger.kernel.org>
Received: from mail.tut.by ([195.137.160.40]:45194 "EHLO speedy.tutby.com"
	rhost-flags-OK-OK-OK-OK) by vger.kernel.org with ESMTP
	id S1752193AbZBSFSu (ORCPT <rfc822;linux-media@vger.kernel.org>);
	Thu, 19 Feb 2009 00:18:50 -0500
Received: from [93.125.74.3] (account liplianin@tut.by HELO [172.30.2.32])
  by speedy.tutby.com (CommuniGate Pro SMTP 5.2.12)
  with ESMTPA id 10813036 for linux-media@vger.kernel.org; Thu, 19 Feb 2009 07:18:43 +0200
From: "Igor M. Liplianin" <liplianin@tut.by>
To: linux-media@vger.kernel.org
Subject: dm1105: not demuxing from interrupt context
Date: Thu, 19 Feb 2009 07:18:47 +0200
MIME-Version: 1.0
Content-Type: text/plain;
  charset="iso-8859-1"
Content-Transfer-Encoding: base64
Content-Disposition: inline
Message-Id: <200902190718.47890.liplianin@tut.by>
Sender: linux-media-owner@vger.kernel.org
List-ID: <linux-media.vger.kernel.org>

SSByZWFkIGluIG1haWxpbmcgbGlzdCBhYm91dCBkZXNpZ24gZXJyb3IgaW4gZG0xMTA1LgpTbyBJ
IGFtIGRlc2lnbmVyLgpETUEgYnVmZmVyIGluIHRoZSBkcml2ZXIgaXRzZWxmIG9yZ2FuaXplZCBs
aWtlIHJpbmdidWZmZXIKYW5kIG5vdCBkaWZmaWN1bHQgdG8gYmluZCBpdCB0byB0YXNrbGV0IG9y
IHdvcmsgcXVldWUuCkkgY2hvb3NlIHdvcmsgcXVldWUsIGJlY2F1c2UgaXQgaXMgbGlrZSB0cmVu
ZCA6KQpUaGUgY29kZSB0ZXN0ZWQgYnkgbWUgb24gcXVpdGUgZmFzdCBjb21wdXRlciBhbmQgaXQg
d29ya3MgYXMgdXN1YWwuCkkgdGhpbmssIG9uIHNsb3cgY29tcHV0ZXIgZGlmZmVyZW5jZSBtdXN0
IGJlIG5vdGljZWFibGUuClRoZSBwYXRjaCBpcyBwcmVsaW1pbmFyeS4KQW55b25lIGNhbiBjcml0
aWNpemUuCgpkaWZmIC1yIDM1OWQ5NWUxZDU0MSAtciBmMjJkYThkNmE4M2MgbGludXgvZHJpdmVy
cy9tZWRpYS9kdmIvZG0xMTA1L2RtMTEwNS5jCi0tLSBhL2xpbnV4L2RyaXZlcnMvbWVkaWEvZHZi
L2RtMTEwNS9kbTExMDUuY6CgoFdlZCBGZWIgMTggMDk6NDk6MzcgMjAwOSAtMDMwMAorKysgYi9s
aW51eC9kcml2ZXJzL21lZGlhL2R2Yi9kbTExMDUvZG0xMTA1LmOgoKBUaHUgRmViIDE5IDA0OjM4
OjMyIDIwMDkgKzAyMDAKQEAgLTIyMCwxMCArMjIwLDE0IEBACqCgoKCgoKCgLyogaTJjICovCqCg
oKCgoKCgc3RydWN0IGkyY19hZGFwdGVyIGkyY19hZGFwOwqgCiugoKCgoKCgLyogaXJxICovCiug
oKCgoKCgc3RydWN0IHdvcmtfc3RydWN0IHdvcms7CisKoKCgoKCgoKAvKiBkbWEgKi8KoKCgoKCg
oKBkbWFfYWRkcl90IGRtYV9hZGRyOwqgoKCgoKCgoHVuc2lnbmVkIGNoYXIgKnRzX2J1ZjsKoKCg
oKCgoKB1MzIgd3JwOworoKCgoKCgoHUzMiBuZXh0d3JwOwqgoKCgoKCgoHUzMiBidWZmZXJfc2l6
ZTsKoKCgoKCgoKB1bnNpZ25lZCBpbnSgoKCgUGFja2V0RXJyb3JDb3VudDsKoKCgoKCgoKB1bnNp
Z25lZCBpbnQgZG1hcnN0OwpAQCAtNDE4LDYgKzQyMiw5IEBACqCgoKCgoKCgdTggZGF0YTsKoKCg
oKCgoKB1MTYga2V5Y29kZTsKoAoroKCgoKCgoGlmIChpcl9kZWJ1ZykKK6CgoKCgoKCgoKCgoKCg
oHByaW50ayhLRVJOX0lORk8gIiVzOiByZWNlaXZlZCBieXRlIDB4JTA0eFxuIiwgX19mdW5jX18s
IGlyY29tKTsKKwqgoKCgoKCgoGRhdGEgPSAoaXJjb20gPj4gOCkgJiAweDdmOwqgCqCgoKCgoKCg
aW5wdXRfZXZlbnQoaXItPmlucHV0X2RldiwgRVZfTVNDLCBNU0NfUkFXLCAoMHgwMDAwZjggPDwg
MTYpIHwgZGF0YSk7CkBAIC00MzQsNiArNDQxLDUwIEBACqAKoH0KoAorLyogd29yayBoYW5kbGVy
ICovCisjaWYgTElOVVhfVkVSU0lPTl9DT0RFIDwgS0VSTkVMX1ZFUlNJT04oMiwgNiwgMjApCitz
dGF0aWMgdm9pZCBkbTExMDVfZG14X2J1ZmZlcih2b2lkICpfZG0xMTA1ZHZiKQorI2Vsc2UKK3N0
YXRpYyB2b2lkIGRtMTEwNV9kbXhfYnVmZmVyKHN0cnVjdCB3b3JrX3N0cnVjdCAqd29yaykKKyNl
bmRpZgoreworI2lmIExJTlVYX1ZFUlNJT05fQ09ERSA8IEtFUk5FTF9WRVJTSU9OKDIsIDYsIDIw
KQoroKCgoKCgoHN0cnVjdCBkbTExMDVkdmIgKmRtMTEwNWR2YiA9IF9kbTExMDVkdmI7CisjZWxz
ZQoroKCgoKCgoHN0cnVjdCBkbTExMDVkdmIgKmRtMTEwNWR2YiA9CiugoKCgoKCgoKCgoKCgoKCg
oKCgoKCgoKCgoKCgoKCgY29udGFpbmVyX29mKHdvcmssIHN0cnVjdCBkbTExMDVkdmIsIHdvcmsp
OworI2VuZGlmCiugoKCgoKCgdW5zaWduZWQgaW50IG5icGFja2V0czsKK6CgoKCgoKB1MzIgb2xk
d3JwID0gZG0xMTA1ZHZiLT53cnA7CiugoKCgoKCgdTMyIG5leHR3cnAgPSBkbTExMDVkdmItPm5l
eHR3cnA7CisKK6CgoKCgoKBpZiAoISgoZG0xMTA1ZHZiLT50c19idWZbb2xkd3JwXSA9PSAweDQ3
KSAmJgoroKCgoKCgoKCgoKCgoKCgoKCgoKCgoKAoZG0xMTA1ZHZiLT50c19idWZbb2xkd3JwICsg
MTg4XSA9PSAweDQ3KSAmJgoroKCgoKCgoKCgoKCgoKCgoKCgoKCgoKAoZG0xMTA1ZHZiLT50c19i
dWZbb2xkd3JwICsgMTg4ICogMl0gPT0gMHg0NykpKSB7CiugoKCgoKCgoKCgoKCgoKBkbTExMDVk
dmItPlBhY2tldEVycm9yQ291bnQrKzsKK6CgoKCgoKCgoKCgoKCgoC8qIGJhZCBwYWNrZXQgZm91
bmQgKi8KK6CgoKCgoKCgoKCgoKCgoGlmICgoZG0xMTA1ZHZiLT5QYWNrZXRFcnJvckNvdW50ID49
IDIpICYmCiugoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgKGRtMTEwNWR2Yi0+ZG1hcnN0
ID09IDApKSB7CiugoKCgoKCgoKCgoKCgoKCgoKCgoKCgoG91dGIoMSwgZG1faW9fbWVtKERNMTEw
NV9SU1QpKTsKK6CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgZG0xMTA1ZHZiLT53cnAgPSAwOworoKCg
oKCgoKCgoKCgoKCgoKCgoKCgoKBkbTExMDVkdmItPlBhY2tldEVycm9yQ291bnQgPSAwOworoKCg
oKCgoKCgoKCgoKCgoKCgoKCgoKBkbTExMDVkdmItPmRtYXJzdCA9IDA7CiugoKCgoKCgoKCgoKCg
oKCgoKCgoKCgoHJldHVybjsKK6CgoKCgoKCgoKCgoKCgoH0KK6CgoKCgoKB9CisKK6CgoKCgoKBp
ZiAobmV4dHdycCA8IG9sZHdycCkgeworoKCgoKCgoKCgoKCgoKCgbWVtY3B5KGRtMTEwNWR2Yi0+
dHNfYnVmICsgZG0xMTA1ZHZiLT5idWZmZXJfc2l6ZSwKK6CgoKCgoKCgoKCgoKCgoKCgoKCgoKCg
oKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgZG0xMTA1ZHZiLT50c19idWYsIG5leHR3cnApOworoKCg
oKCgoKCgoKCgoKCgbmJwYWNrZXRzID0gKChkbTExMDVkdmItPmJ1ZmZlcl9zaXplIC0gb2xkd3Jw
KSArIG5leHR3cnApIC8gMTg4OworoKCgoKCgoH0gZWxzZQoroKCgoKCgoKCgoKCgoKCgbmJwYWNr
ZXRzID0gKG5leHR3cnAgLSBvbGR3cnApIC8gMTg4OworCiugoKCgoKCgZG0xMTA1ZHZiLT53cnAg
PSBuZXh0d3JwOworoKCgoKCgoGR2Yl9kbXhfc3dmaWx0ZXJfcGFja2V0cygmZG0xMTA1ZHZiLT5k
ZW11eCwKK6CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoCZkbTExMDVkdmIt
PnRzX2J1ZltvbGR3cnBdLCBuYnBhY2tldHMpOworfQorCqAjaWYgTElOVVhfVkVSU0lPTl9DT0RF
IDwgS0VSTkVMX1ZFUlNJT04oMiwgNiwgMTkpCqBzdGF0aWMgaXJxcmV0dXJuX3QgZG0xMTA1ZHZi
X2lycShpbnQgaXJxLCB2b2lkICpkZXZfaWQsIHN0cnVjdCBwdF9yZWdzICpyZWdzKQqgI2Vsc2UK
QEAgLTQ0MSwxMSArNDkyLDYgQEAKoCNlbmRpZgqgewqgoKCgoKCgoHN0cnVjdCBkbTExMDVkdmIg
KmRtMTEwNWR2YiA9IGRldl9pZDsKLaCgoKCgoKB1bnNpZ25lZCBpbnQgcGllY2U7Ci2goKCgoKCg
dW5zaWduZWQgaW50IG5icGFja2V0czsKLaCgoKCgoKB1MzIgY29tbWFuZDsKLaCgoKCgoKB1MzIg
bmV4dHdycDsKLaCgoKCgoKB1MzIgb2xkd3JwOwqgCqCgoKCgoKCgLyogUmVhZC1Xcml0ZSBJTlNU
UyBBY2sncyBJbnRlcnJ1cHQgZm9yIERNMTEwNSBjaGlwIDE2LjAzLjIwMDggKi8KoKCgoKCgoKB1
bnNpZ25lZCBpbnQgaW50c3RzID0gaW5iKGRtX2lvX21lbShETTExMDVfSU5UU1RTKSk7CkBAIC00
NTQsNDggKzUwMCwxNyBAQAqgoKCgoKCgoHN3aXRjaCAoaW50c3RzKSB7CqCgoKCgoKCgY2FzZSBJ
TlRTVFNfVFNJUlE6CqCgoKCgoKCgY2FzZSAoSU5UU1RTX1RTSVJRIHwgSU5UU1RTX0lSKToKLaCg
oKCgoKCgoKCgoKCgoG5leHR3cnAgPSBpbmwoZG1faW9fbWVtKERNMTEwNV9XUlApKSAtCi2goKCg
oKCgoKCgoKCgoKCgoKCgoKCgoGlubChkbV9pb19tZW0oRE0xMTA1X1NUQURSKSkgOwotoKCgoKCg
oKCgoKCgoKCgb2xkd3JwID0gZG0xMTA1ZHZiLT53cnA7Ci2goKCgoKCgoKCgoKCgoKBzcGluX2xv
Y2soJmRtMTEwNWR2Yi0+bG9jayk7Ci2goKCgoKCgoKCgoKCgoKBpZiAoISgoZG0xMTA1ZHZiLT50
c19idWZbb2xkd3JwXSA9PSAweDQ3KSAmJgotoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCg
oChkbTExMDVkdmItPnRzX2J1ZltvbGR3cnAgKyAxODhdID09IDB4NDcpICYmCi2goKCgoKCgoKCg
oKCgoKCgoKCgoKCgoKCgoKCgoKCgKGRtMTEwNWR2Yi0+dHNfYnVmW29sZHdycCArIDE4OCAqIDJd
ID09IDB4NDcpKSkgewotoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKBkbTExMDVkdmItPlBhY2tldEVy
cm9yQ291bnQrKzsKLaCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgLyogYmFkIHBhY2tldCBmb3VuZCAq
LwotoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKBpZiAoKGRtMTEwNWR2Yi0+UGFja2V0RXJyb3JDb3Vu
dCA+PSAyKSAmJgotoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgKGRtMTEw
NWR2Yi0+ZG1hcnN0ID09IDApKSB7Ci2goKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgb3V0
YigxLCBkbV9pb19tZW0oRE0xMTA1X1JTVCkpOwotoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCg
oKCgoGRtMTEwNWR2Yi0+d3JwID0gMDsKLaCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKBk
bTExMDVkdmItPlBhY2tldEVycm9yQ291bnQgPSAwOwotoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCg
oKCgoKCgoGRtMTEwNWR2Yi0+ZG1hcnN0ID0gMDsKLaCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCg
oKCgoKBzcGluX3VubG9jaygmZG0xMTA1ZHZiLT5sb2NrKTsKLaCgoKCgoKCgoKCgoKCgoKCgoKCg
oKCgoKCgoKCgoKByZXR1cm4gSVJRX0hBTkRMRUQ7Ci2goKCgoKCgoKCgoKCgoKCgoKCgoKCgoH0K
LaCgoKCgoKCgoKCgoKCgoH0KLaCgoKCgoKCgoKCgoKCgoGlmIChuZXh0d3JwIDwgb2xkd3JwKSB7
Ci2goKCgoKCgoKCgoKCgoKCgoKCgoKCgoHBpZWNlID0gZG0xMTA1ZHZiLT5idWZmZXJfc2l6ZSAt
IG9sZHdycDsKLaCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgbWVtY3B5KGRtMTEwNWR2Yi0+dHNfYnVm
ICsgZG0xMTA1ZHZiLT5idWZmZXJfc2l6ZSwgZG0xMTA1ZHZiLT50c19idWYsIApuZXh0d3JwKTsK
LaCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgbmJwYWNrZXRzID0gKHBpZWNlICsgbmV4dHdycCkvMTg4
OwotoKCgoKCgoKCgoKCgoKCgfSBlbHNloKB7Ci2goKCgoKCgoKCgoKCgoKCgoKCgoKCgoG5icGFj
a2V0cyA9IChuZXh0d3JwIC0gb2xkd3JwKS8xODg7Ci2goKCgoKCgoKCgoKCgoKB9Ci2goKCgoKCg
oKCgoKCgoKBkdmJfZG14X3N3ZmlsdGVyX3BhY2tldHMoJmRtMTEwNWR2Yi0+ZGVtdXgsICZkbTEx
MDVkdmItPnRzX2J1ZltvbGR3cnBdLCAKbmJwYWNrZXRzKTsKLaCgoKCgoKCgoKCgoKCgoGRtMTEw
NWR2Yi0+d3JwID0gbmV4dHdycDsKLaCgoKCgoKCgoKCgoKCgoHNwaW5fdW5sb2NrKCZkbTExMDVk
dmItPmxvY2spOworoKCgoKCgoKCgoKCgoKCgZG0xMTA1ZHZiLT5uZXh0d3JwID0gaW5sKGRtX2lv
X21lbShETTExMDVfV1JQKSkgLQoroKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCg
oKCgaW5sKGRtX2lvX21lbShETTExMDVfU1RBRFIpKTsKK6CgoKCgoKCgoKCgoKCgoHNjaGVkdWxl
X3dvcmsoJmRtMTEwNWR2Yi0+d29yayk7CqCgoKCgoKCgoKCgoKCgoKBicmVhazsKoKCgoKCgoKBj
YXNlIElOVFNUU19JUjoKLaCgoKCgoKCgoKCgoKCgoGNvbW1hbmQgPSBpbmwoZG1faW9fbWVtKERN
MTEwNV9JUkNPREUpKTsKLaCgoKCgoKCgoKCgoKCgoGlmIChpcl9kZWJ1ZykKLaCgoKCgoKCgoKCg
oKCgoKCgoKCgoKCgcHJpbnRrKCJkbTExMDU6IHJlY2VpdmVkIGJ5dGUgMHglMDR4XG4iLCBjb21t
YW5kKTsKLQotoKCgoKCgoKCgoKCgoKCgZG0xMTA1ZHZiLT5pci5pcl9jb21tYW5kID0gY29tbWFu
ZDsKK6CgoKCgoKCgoKCgoKCgoGRtMTEwNWR2Yi0+aXIuaXJfY29tbWFuZCA9IGlubChkbV9pb19t
ZW0oRE0xMTA1X0lSQ09ERSkpOwqgoKCgoKCgoKCgoKCgoKCgdGFza2xldF9zY2hlZHVsZSgmZG0x
MTA1ZHZiLT5pci5pcl90YXNrbGV0KTsKoKCgoKCgoKCgoKCgoKCgoGJyZWFrOwqgoKCgoKCgoH0K
KwqgoKCgoKCgoHJldHVybiBJUlFfSEFORExFRDsKLQotCqB9CqAKoC8qIHJlZ2lzdGVyIHdpdGgg
aW5wdXQgbGF5ZXIgKi8KQEAgLTcxNyw3ICs3MzIsNyBAQAqgCqCgoKCgoKCgZG0xMTA1ZHZiID0g
a3phbGxvYyhzaXplb2Yoc3RydWN0IGRtMTEwNWR2YiksIEdGUF9LRVJORUwpOwqgoKCgoKCgoGlm
ICghZG0xMTA1ZHZiKQotoKCgoKCgoKCgoKCgoKCgZ290byBvdXQ7CiugoKCgoKCgoKCgoKCgoKBy
ZXR1cm4gLUVOT01FTTsKoAqgoKCgoKCgoGRtMTEwNWR2Yi0+cGRldiA9IHBkZXY7CqCgoKCgoKCg
ZG0xMTA1ZHZiLT5idWZmZXJfc2l6ZSA9IDUgKiBETTExMDVfRE1BX0JZVEVTOwpAQCAtNzQ3LDEz
ICs3NjIsOSBAQAqgoKCgoKCgoHNwaW5fbG9ja19pbml0KCZkbTExMDVkdmItPmxvY2spOwqgoKCg
oKCgoHBjaV9zZXRfZHJ2ZGF0YShwZGV2LCBkbTExMDVkdmIpOwqgCi2goKCgoKCgcmV0ID0gcmVx
dWVzdF9pcnEocGRldi0+aXJxLCBkbTExMDVkdmJfaXJxLCBJUlFGX1NIQVJFRCwgRFJJVkVSX05B
TUUsIGRtMTEwNWR2Yik7CiugoKCgoKCgcmV0ID0gZG0xMTA1ZHZiX2h3X2luaXQoZG0xMTA1ZHZi
KTsKoKCgoKCgoKBpZiAocmV0IDwgMCkKoKCgoKCgoKCgoKCgoKCgoGdvdG8gZXJyX3BjaV9pb3Vu
bWFwOwotCi2goKCgoKCgcmV0ID0gZG0xMTA1ZHZiX2h3X2luaXQoZG0xMTA1ZHZiKTsKLaCgoKCg
oKBpZiAocmV0IDwgMCkKLaCgoKCgoKCgoKCgoKCgoGdvdG8gZXJyX2ZyZWVfaXJxOwqgCqCgoKCg
oKCgLyogaTJjICovCqCgoKCgoKCgaTJjX3NldF9hZGFwZGF0YSgmZG0xMTA1ZHZiLT5pMmNfYWRh
cCwgZG0xMTA1ZHZiKTsKQEAgLTgyMCw4ICs4MzEsMTkgQEAKoAqgoKCgoKCgoGR2Yl9uZXRfaW5p
dChkdmJfYWRhcHRlciwgJmRtMTEwNWR2Yi0+ZHZibmV0LCBkbXgpOwqgoKCgoKCgoGRtMTEwNV9p
cl9pbml0KGRtMTEwNWR2Yik7Ci1vdXQ6Ci2goKCgoKCgcmV0dXJuIHJldDsKKworI2lmIExJTlVY
X1ZFUlNJT05fQ09ERSA8IEtFUk5FTF9WRVJTSU9OKDIsIDYsIDIwKQoroKCgoKCgoElOSVRfV09S
SygmZG0xMTA1ZHZiLT53b3JrLCBkbTExMDVfZG14X2J1ZmZlciwgZG0xMTA1ZHZiKTsKKyNlbHNl
CiugoKCgoKCgSU5JVF9XT1JLKCZkbTExMDVkdmItPndvcmssIGRtMTEwNV9kbXhfYnVmZmVyKTsK
KyNlbmRpZgorCiugoKCgoKCgcmV0ID0gcmVxdWVzdF9pcnEocGRldi0+aXJxLCBkbTExMDVkdmJf
aXJxLCBJUlFGX1NIQVJFRCwKK6CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCg
oKCgoKCgoKCgRFJJVkVSX05BTUUsIGRtMTEwNWR2Yik7CiugoKCgoKCgaWYgKHJldCA8IDApCiug
oKCgoKCgoKCgoKCgoKBnb3RvIGVycl9mcmVlX2lycTsKKworoKCgoKCgoHJldHVybiAwOwqgCqBl
cnJfZGlzY29ubmVjdF9mcm9udGVuZDoKoKCgoKCgoKBkbXgtPmRpc2Nvbm5lY3RfZnJvbnRlbmQo
ZG14KTsKQEAgLTg1MCw3ICs4NzIsNyBAQAqgZXJyX2tmcmVlOgqgoKCgoKCgoHBjaV9zZXRfZHJ2
ZGF0YShwZGV2LCBOVUxMKTsKoKCgoKCgoKBrZnJlZShkbTExMDVkdmIpOwotoKCgoKCgoGdvdG8g
b3V0OworoKCgoKCgoHJldHVybiByZXQ7CqB9CqAKoHN0YXRpYyB2b2lkIF9fZGV2ZXhpdCBkbTEx
MDVfcmVtb3ZlKHN0cnVjdCBwY2lfZGV2ICpwZGV2KQo=
