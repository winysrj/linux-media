Return-path: <linux-media-owner@vger.kernel.org>
Received: from mx2.suse.de ([195.135.220.15]:55322 "EHLO mx2.suse.de"
	rhost-flags-OK-OK-OK-OK) by vger.kernel.org with ESMTP
	id S1752705AbcCNKdc (ORCPT <rfc822;linux-media@vger.kernel.org>);
	Mon, 14 Mar 2016 06:33:32 -0400
Date: Mon, 14 Mar 2016 11:33:25 +0100
Message-ID: <s5hmvq14adm.wl-tiwai@suse.de>
From: Takashi Iwai <tiwai@suse.de>
To: "Mauro Carvalho Chehab" <mchehab@osg.samsung.com>
Cc: "Sakari Ailus" <sakari.ailus@iki.fi>,
	<alsa-devel@alsa-project.org>, <hans.verkuil@cisco.com>,
	<lixiubo@cmss.chinamobile.com>, <devel@driverdev.osuosl.org>,
	<amitoj1606@gmail.com>, <chehabrafael@gmail.com>,
	<hamohammed.sa@gmail.com>, <navyasri.tech@gmail.com>,
	<prabhakar.csengg@gmail.com>, <g.liakhovetski@gmx.de>,
	<der.herr@hofr.at>, <laurent.pinchart@ideasonboard.com>,
	<crope@iki.fi>, <tommi.franttila@intel.com>, <kgene@kernel.org>,
	<gregkh@linuxfoundation.org>, <Julia.Lawall@lip6.fr>,
	<linux-arm-kernel@lists.infradead.org>, <dan.carpenter@oracle.com>,
	<javier@osg.samsung.com>, "Shuah Khan" <shuahkh@osg.samsung.com>,
	<perex@perex.cz>, <a.hajda@samsung.com>, <k.kozlowski@samsung.com>,
	<kyungmin.park@samsung.com>, <s.nawrocki@samsung.com>,
	<linux-kernel@vger.kernel.org>, <linux-media@vger.kernel.org>,
	<linux-renesas-soc@vger.kernel.org>,
	<linux-samsung-soc@vger.kernel.org>, <hyun.kwon@xilinx.com>,
	<soren.brinkmann@xilinx.com>
Subject: Re: [PATCH] media: add GFP flag to media_*() that could get called in atomic context
In-Reply-To: <20160314071358.27c87dab@recife.lan>
References: <1457833689-4926-1-git-send-email-shuahkh@osg.samsung.com>
	<20160314072236.GO11084@valkosipuli.retiisi.org.uk>
	<20160314071358.27c87dab@recife.lan>
MIME-Version: 1.0 (generated by SEMI 1.14.6 - "Maruoka")
Content-Type: text/plain; charset=US-ASCII
Sender: linux-media-owner@vger.kernel.org
List-ID: <linux-media.vger.kernel.org>

On Mon, 14 Mar 2016 11:13:58 +0100,
Mauro Carvalho Chehab wrote:
> 
> Em Mon, 14 Mar 2016 09:22:37 +0200
> Sakari Ailus <sakari.ailus@iki.fi> escreveu:
> 
> > Hi Shuah,
> > 
> > On Sat, Mar 12, 2016 at 06:48:09PM -0700, Shuah Khan wrote:
> > > Add GFP flags to media_create_pad_link(), media_create_intf_link(),
> > > media_devnode_create(), and media_add_link() that could get called
> > > in atomic context to allow callers to pass in the right flags for
> > > memory allocation.
> > > 
> > > tree-wide driver changes for media_*() GFP flags change:
> > > Change drivers to add gfpflags to interffaces, media_create_pad_link(),
> > > media_create_intf_link() and media_devnode_create().
> > > 
> > > Signed-off-by: Shuah Khan <shuahkh@osg.samsung.com>
> > > Suggested-by: Mauro Carvalho Chehab <mchehab@osg.samsung.com>  
> > 
> > What's the use case for calling the above functions in an atomic context?
> > 
> 
> ALSA code seems to do a lot of stuff at atomic context. That's what
> happens on my test machine when au0828 gets probed before
> snd-usb-audio:
> 	http://pastebin.com/LEX5LD5K
> 
> It seems that ALSA USB probe routine (usb_audio_probe) happens in
> atomic context.

No, usb_audio_probe() doesn't take a lock.  But
media_device_register_entity() seems taking a spinlock, instead.


Takashi
