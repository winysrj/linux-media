Return-path: <mchehab@pedra>
Received: from mail-ew0-f46.google.com ([209.85.215.46]:36407 "EHLO
	mail-ew0-f46.google.com" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
	with ESMTP id S1753053Ab1A3UCZ convert rfc822-to-8bit (ORCPT
	<rfc822;linux-media@vger.kernel.org>);
	Sun, 30 Jan 2011 15:02:25 -0500
MIME-Version: 1.0
In-Reply-To: <201101302033.01964.PeterHuewe@gmx.de>
References: <1295988851-23561-1-git-send-email-peterhuewe@gmx.de>
	<201101252354.31217.PeterHuewe@gmx.de>
	<4D3FE986.9030603@infradead.org>
	<201101302033.01964.PeterHuewe@gmx.de>
Date: Sun, 30 Jan 2011 15:02:23 -0500
Message-ID: <AANLkTin7HaZ5GNnPmM066K+OJwEzCUpw4-oGtAhXSgRt@mail.gmail.com>
Subject: Re: [PATCH v2] video/saa7164: Fix sparse warning: Using plain integer
 as NULL pointer
From: Devin Heitmueller <dheitmueller@kernellabs.com>
To: Peter Huewe <PeterHuewe@gmx.de>
Cc: Mauro Carvalho Chehab <mchehab@infradead.org>,
	Julia Lawall <julia@diku.dk>, linux-media@vger.kernel.org,
	linux-kernel@vger.kernel.org, kernel-janitors@vger.kernel.org,
	Steven Toth <stoth@kernellabs.com>, Tejun Heo <tj@kernel.org>,
	Dan Carpenter <error27@gmail.com>
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: 8BIT
List-ID: <linux-media.vger.kernel.org>
Sender: <mchehab@pedra>

On Sun, Jan 30, 2011 at 2:33 PM, Peter Huewe <PeterHuewe@gmx.de> wrote:
> From: Peter Huewe <peterhuewe@gmx.de>
>
> This patch fixes the warning "Using plain integer as NULL pointer",
> generated by sparse, by replacing
>        if(var == 0)
> with
>        if (!var)
> after an allocation
> and all other offending 0s with NULL.
>
> KernelVersion: linus' tree-1f0324c
>
> Signed-off-by: Peter Huewe <peterhuewe@gmx.de>
> ---
> v2: I changed the patch according to Julia's hints.
> i.e. using if(!buf) instead of if(buf==NULL) after the kmalloc family,
> and other allocations.

Ok, so now we've gone from "eliminating a couple of sparse warnings"
to "going through the rest of the code and jamming in some alternate
coding style when there was nothing wrong with it in the first place."

Don't get me wrong, I appreciate the role of the kernel janitors in
general, but this patch is crap.  It's changes like this that just
lower the signal/noise ratio on *real* work going on, and increasing
the likelihood that some well intentioned janitor screwed up one of
the conversions.

After all, it's not like the author of this patch actually tried the
resulting code.  He only has to mess up one of those two line changes
and we go from "driver that works perfectly well" to "driver that is
100% broken".

There are much better uses of the maintainer's time than going through
patches like this to make sure the submitter didn't screw up the a
conversion that provides no real value.

A change like this:

-       if (buf == NULL) {
+       if (!buf) {

is a worthless change, and there is is a higher chance that one of
them gets screwed up in the patch than what we had to start with.

Devin

-- 
Devin J. Heitmueller - Kernel Labs
http://www.kernellabs.com
