Return-path: <linux-media-owner@vger.kernel.org>
Received: from mail-wg0-f43.google.com ([74.125.82.43]:34818 "EHLO
	mail-wg0-f43.google.com" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
	with ESMTP id S1753093Ab3EFI7I (ORCPT
	<rfc822;linux-media@vger.kernel.org>); Mon, 6 May 2013 04:59:08 -0400
Received: by mail-wg0-f43.google.com with SMTP id c11so3314608wgh.22
        for <linux-media@vger.kernel.org>; Mon, 06 May 2013 01:59:07 -0700 (PDT)
MIME-Version: 1.0
Date: Mon, 6 May 2013 10:59:07 +0200
Message-ID: <CAGGh5h00H10F7GWgjyhN_5Zn8JNMXRptt4FF+u=NHDdTXFD2MA@mail.gmail.com>
Subject: omap3-isp : panic using previewer from V4L input
From: jean-philippe francois <jp.francois@cynove.com>
To: linux-media <linux-media@vger.kernel.org>
Cc: Laurent Pinchart <laurent.pinchart@ideasonboard.com>
Content-Type: multipart/mixed; boundary=e89a8f3ba457cfbc3604dc08e90c
Sender: linux-media-owner@vger.kernel.org
List-ID: <linux-media.vger.kernel.org>

--e89a8f3ba457cfbc3604dc08e90c
Content-Type: text/plain; charset=UTF-8

Hi,

I am trying to use the previewer to debayer pictures coming from the
filesystem instead of the capture hardware. The media-ctl links are as
follows :

preview V4L input -> preview pad 0 (sink), preview pad 1(src)
->preview V4L output.

Input output format is set via media-ctl for the preview element, and
via the V4L2 api for the V4L2 file descriptors. I am using USERPTR
buffer allocated via memalign, and the application goes like this :

REQBUFS 1 buf on on input
REQBUFS 1 buf on output
alloc buffers
QBUF on input
QBUF on output
STREAMON on output
STREAMON on input
DQBUF on output.

The board either panics or hangs (though HUNG_TASK_DETECTION and
SOFT_LOCKUP_DETECTION is set)

Please find attached the panic log, and the application code.

--e89a8f3ba457cfbc3604dc08e90c
Content-Type: application/octet-stream; name="session.log"
Content-Disposition: attachment; filename="session.log"
Content-Transfer-Encoding: base64
X-Attachment-Id: f_hgdf26yn0

bWVkIyBtZWRpYS1jdGwgG1tKLXIKIyBwcmUHIyBwcmVwYXJlLhtbSmRlYiMgcHJlcGFyZS5kZWJh
eWVyIBtbSgojIGNkIC90bXAKIyBvbSMgb21hcGRlYmF5ZXIgG1tKcmEjIG9tYXBkZWJheWVyIHJh
dzk1Yy5yYXcgG1tKCmlucHV0IGlzIDM2NjQgeCAyNzUyCmJ5dGVzcGVybGluZSBpcyA3MzYwCnNp
emVpbWFnZSBpcyAyMDI1NDcyMApvdXRwdXQgaXMgMzY1MCB4IDI3NDQKYnl0ZXNwZXJsaW5lIGlz
IDczMjgKc2l6ZWltYWdlIGlzIDIwMTA4MDMyCk9wZW5pbmcgcmF3OTVjLnJhdyBmb3IgZGViYXll
cmluZwp1c3JwdHIgPSAweGI1YTQzMDIwIAp2NGwyYnVmLmxlbmd0aCA9IDIwMjU0NzIwCmlucHV0
IGJ1ZmZlciBxdWV1ZWQKb3V0cHV0IGJ1ZmZlciBxdVsgICA1MC4xMDg4MjVdIG9tYXAzaXNwIG9t
YXAzaXNwOiBjYW4ndCBmaW5kIHNvdXJjZSwgZmFpbGluZyBub3cKZXVlZApbICAgNTAuMTE2NDg1
XSBvbWFwM2lzcCBvbWFwM2lzcDogY2FuJ3QgZmluZCBzb3VyY2UsIGZhaWxpbmcgbm93ClsgICA1
MC4xMjcyMjddIC0tLS0tLS0tLS0tLVsgY3V0IGhlcmUgXS0tLS0tLS0tLS0tLQpbICAgNTAuMTMy
MDgwXSBLZXJuZWwgQlVHIGF0IGMwMTliYjFjIFt2ZXJib3NlIGRlYnVnIGluZm8gdW5hdmFpbGFi
bGVdClsgICA1MC4xMzg3MDJdIEludGVybmFsIGVycm9yOiBPb3BzIC0gQlVHOiAwIFsjMV0gUFJF
RU1QVCBBUk0KWyAgIDUwLjE0NDQ3MF0gTW9kdWxlcyBsaW5rZWQgaW46IG9tYXAzX2lzcCBvdjEw
NjMwKE8pClsgICA1MC4xNDk2MjddIENQVTogMCAgICBUYWludGVkOiBHICAgICAgICAgICBPICAo
My45LjAgIzMpClsgICA1MC4xNTUyNzNdIFBDIGlzIGF0IG9tYXAzX2wzX2FwcF9pcnErMHgzYy8w
eGJjClsgICA1MC4xNjAwMzRdIExSIGlzIGF0IGhhbmRsZV9pcnFfZXZlbnRfcGVyY3B1KzB4Mjgv
MHgxMGMKWyAgIDUwLjE2NTU1N10gcGMgOiBbPGMwMTliYjFjPl0gICAgbHIgOiBbPGMwMDZiMzU0
Pl0gICAgcHNyOiAyMDAwMDE5MwpbICAgNTAuMTY1NTU3XSBzcCA6IGMwNTA3ZTU4ICBpcCA6IDAw
MDYwMDAwICBmcCA6IDAwMDAwMDAwClsgICA1MC4xNzc2NzNdIHIxMDogY2Y4MDRkYzAgIHI5IDog
ZmZmZjllNjUgIHI4IDogMDAyMDAwMDAKWyAgIDUwLjE4MzE2Nl0gcjcgOiAwMDAwMDAwMCAgcjYg
OiAwMDAwMTAwMCAgcjUgOiAwMDAwMDAwMCAgcjQgOiBjZjg3ZjNjMApbICAgNTAuMTkwMDYzXSBy
MyA6IDAwMDAwMDAwICByMiA6IDAwMDAxMDAwICByMSA6IGNmOGZmYzgwICByMCA6IDAwMDAxMDAw
ClsgICA1MC4xOTY5MjldIEZsYWdzOiBuekN2ICBJUlFzIG9mZiAgRklRcyBvbiAgTW9kZSBTVkNf
MzIgIElTQSBBUk0gIFNlZ21lbnQga2VybmVsClsgICA1MC4yMDQ3NDJdIENvbnRyb2w6IDEwYzUz
ODdkICBUYWJsZTogOGZhODAwMTkgIERBQzogMDAwMDAwMTUKWyAgIDUwLjIxMDc4NF0gUHJvY2Vz
cyBzd2FwcGVyIChwaWQ6IDAsIHN0YWNrIGxpbWl0ID0gMHhjMDUwNjIzMCkKWyAgIDUwLjIxNjk0
OV0gU3RhY2s6ICgweGMwNTA3ZTU4IHRvIDB4YzA1MDgwMDApClsgICA1MC4yMjE1MjddIDdlNDA6
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDAw
MDAwMDAyIGNmODdmM2MwClsgICA1MC4yMzAxNjNdIDdlNjA6IDAwMDAwMDFhIDAwMDAwMDAwIDAw
MDAwMDAwIGMwMDZiMzU0IGNmODA0ZGMwIGNmODdmM2MwIGNmODA0ZGMwIGMwNTA2MDAwClsgICA1
MC4yMzg4MDBdIDdlODA6IGNmODdmM2MwIGMwNTA3ZjBjIDAwMjAwMDAwIGZmZmY5ZTY1IGMwNTRk
NjQwIGMwMDZiNDkwIGNmODA0ZGMwIGMwNTA3ZjgwClsgICA1MC4yNDc0MzZdIDdlYTA6IGZmZmZm
ZmZmIGMwMDZkYTY4IDAwMDAwMDFhIGMwMDZhYzQ0IDAwMDAwMDFhIGMwMDBlYmM4IDAwMDAwMDBh
IGMwNTA3ZWQ4ClsgICA1MC4yNTYwNzJdIDdlYzA6IDAwMDAwMDFhIGMwMDA4NTk0IGMwNTRkNjAw
IGMwMDM0MDBjIDYwMDAwMTEzIGMwMDBkZjAwIDAwMDAwMDAxIGMwNTRkNjAwClsgICA1MC4yNjQ3
MDldIDdlZTA6IDAwMDAwMTAxIGMwNTA2MDAwIDAwMDAwMDAyIDAwMDAwMDAwIGZmZmZmZmZmIGMw
NTA3ZmI0IDAwMjAwMDAwIGZmZmY5ZTY1ClsgICA1MC4yNzMzMTVdIDdmMDA6IGMwNTRkNjQwIDAw
MDAwMDAwIGMwNTI2ZjI4IGMwNTA3ZjIwIGMwNTRkNjAwIGMwMDM0MDBjIDYwMDAwMTEzIGZmZmZm
ZmZmClsgICA1MC4yODE5NTFdIDdmMjA6IGNmODA1YzQwIGMwNTA2MDAwIGMwNTExYzk4IGMwNTA3
ZmI0IDgwMDA0MDU5IDAwMDAwMDM1IDAwMDAwMDAwIGZmZmZmZmZmClsgICA1MC4yOTA1ODhdIDdm
NDA6IGMwNTA3ZmI0IDgwMDA0MDU5IDQxM2ZjMDgyIDAwMDAwMDAwIDAwMDAwMDAwIGMwMDM0NDBj
IDAwMDAwMDM1IGMwMDBlYmNjClsgICA1MC4yOTkyMjRdIDdmNjA6IDAwMDAwMDI1IGMwNTA3Zjgw
IDAwMDAwMDM1IGMwMDA4NTk0IGMwNTA2MDA4IGMwMDBlZDc4IDIwMDAwMDEzIGMwMDBkZjAwClsg
ICA1MC4zMDc4NjFdIDdmODA6IGMwNTQ3NTQ4IGMwNTBmYjUwIDAwMDAwMDAxIGMwNTA2MDAwIGMw
NTBlMGQ4IDAwMDAwMDAwIGMwNGZiOTU0IGMwNTEwODQ0ClsgICA1MC4zMTY0OTddIDdmYTA6IDgw
MDA0MDU5IDQxM2ZjMDgyIDAwMDAwMDAwIDAwMDAwMDAwIDAwMDAwMDAwIGMwNTA3ZmM4IGMwNTA2
MDA4IGMwMDBlZDc4ClsgICA1MC4zMjUxMDNdIDdmYzA6IDIwMDAwMDEzIGZmZmZmZmZmIGMwMzZj
OTU4IGMwNGRhN2E4IGZmZmZmZmZmIGZmZmZmZmZmIGMwNGRhMzQ0IDAwMDAwMDAwClsgICA1MC4z
MzM3NDBdIDdmZTA6IGMwNGZiOTU4IDI3MWFlNDFjIDAwMDAwMDAwIDEwYzUzYzdkIGMwNTBlMDI4
IDgwMDA4MDcwIDAwMDAwMDAwIDAwMDAwMDAwClsgICA1MC4zNDI0MDddIFs8YzAxOWJiMWM+XSAo
b21hcDNfbDNfYXBwX2lycSsweDNjLzB4YmMpIGZyb20gWzxjMDA2YjM1ND5dIChoYW5kbGVfaXJx
X2V2ZW50X3BlcmNwdSsweDI4LzB4MTBjKQpbICAgNTAuMzUyNzgzXSBbPGMwMDZiMzU0Pl0gKGhh
bmRsZV9pcnFfZXZlbnRfcGVyY3B1KzB4MjgvMHgxMGMpIGZyb20gWzxjMDA2YjQ5MD5dIChoYW5k
bGVfaXJxX2V2ZW50KzB4NTgvMHg3NCkKWyAgIDUwLjM2MzE1OV0gWzxjMDA2YjQ5MD5dIChoYW5k
bGVfaXJxX2V2ZW50KzB4NTgvMHg3NCkgZnJvbSBbPGMwMDZkYTY4Pl0gKGhhbmRsZV9sZXZlbF9p
cnErMHhkOC8weDExMCkKWyAgIDUwLjM3Mjg5NF0gWzxjMDA2ZGE2OD5dIChoYW5kbGVfbGV2ZWxf
aXJxKzB4ZDgvMHgxMTApIGZyb20gWzxjMDA2YWM0ND5dIChnZW5lcmljX2hhbmRsZV9pcnErMHgy
MC8weDMwKQpbICAgNTAuMzgyODEyXSBbPGMwMDZhYzQ0Pl0gKGdlbmVyaWNfaGFuZGxlX2lycSsw
eDIwLzB4MzApIGZyb20gWzxjMDAwZWJjOD5dIChoYW5kbGVfSVJRKzB4NjAvMHg4NCkKWyAgIDUw
LjM5MjA4OV0gWzxjMDAwZWJjOD5dIChoYW5kbGVfSVJRKzB4NjAvMHg4NCkgZnJvbSBbPGMwMDA4
NTk0Pl0gKG9tYXAzX2ludGNfaGFuZGxlX2lycSsweDU4LzB4NmMpClsgICA1MC40MDE2NDFdIFs8
YzAwMDg1OTQ+XSAob21hcDNfaW50Y19oYW5kbGVfaXJxKzB4NTgvMHg2YykgZnJvbSBbPGMwMDBk
ZjAwPl0gKF9faXJxX3N2YysweDQwLzB4NzApClsgICA1MC40MTExMDJdIEV4Y2VwdGlvbiBzdGFj
aygweGMwNTA3ZWQ4IHRvIDB4YzA1MDdmMjApClsgICA1MC40MTY0MTJdIDdlYzA6ICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDAwMDAwMDAxIGMw
NTRkNjAwClsgICA1MC40MjUwNDhdIDdlZTA6IDAwMDAwMTAxIGMwNTA2MDAwIDAwMDAwMDAyIDAw
MDAwMDAwIGZmZmZmZmZmIGMwNTA3ZmI0IDAwMjAwMDAwIGZmZmY5ZTY1ClsgICA1MC40MzM2ODVd
IDdmMDA6IGMwNTRkNjQwIDAwMDAwMDAwIGMwNTI2ZjI4IGMwNTA3ZjIwIGMwNTRkNjAwIGMwMDM0
MDBjIDYwMDAwMTEzIGZmZmZmZmZmClsgICA1MC40NDIzMjFdIFs8YzAwMGRmMDA+XSAoX19pcnFf
c3ZjKzB4NDAvMHg3MCkgZnJvbSBbPGMwMDM0MDBjPl0gKF9fZG9fc29mdGlycSsweDYwLzB4MTg0
KQpbICAgNTAuNDUxMDQ5XSBbPGMwMDM0MDBjPl0gKF9fZG9fc29mdGlycSsweDYwLzB4MTg0KSBm
cm9tIFs8YzAwMzQ0MGM+XSAoaXJxX2V4aXQrMHg3MC8weGM0KQpbICAgNTAuNDU5Njg2XSBbPGMw
MDM0NDBjPl0gKGlycV9leGl0KzB4NzAvMHhjNCkgZnJvbSBbPGMwMDBlYmNjPl0gKGhhbmRsZV9J
UlErMHg2NC8weDg0KQpbICAgNTAuNDY4MDQ4XSBbPGMwMDBlYmNjPl0gKGhhbmRsZV9JUlErMHg2
NC8weDg0KSBmcm9tIFs8YzAwMDg1OTQ+XSAob21hcDNfaW50Y19oYW5kbGVfaXJxKzB4NTgvMHg2
YykKWyAgIDUwLjQ3NzYwMF0gWzxjMDAwODU5ND5dIChvbWFwM19pbnRjX2hhbmRsZV9pcnErMHg1
OC8weDZjKSBmcm9tIFs8YzAwMGRmMDA+XSAoX19pcnFfc3ZjKzB4NDAvMHg3MCkKWyAgIDUwLjQ4
NzAzMF0gRXhjZXB0aW9uIHN0YWNrKDB4YzA1MDdmODAgdG8gMHhjMDUwN2ZjOCkKWyAgIDUwLjQ5
MjM3MF0gN2Y4MDogYzA1NDc1NDggYzA1MGZiNTAgMDAwMDAwMDEgYzA1MDYwMDAgYzA1MGUwZDgg
MDAwMDAwMDAgYzA0ZmI5NTQgYzA1MTA4NDQKWyAgIDUwLjUwMTAwN10gN2ZhMDogODAwMDQwNTkg
NDEzZmMwODIgMDAwMDAwMDAgMDAwMDAwMDAgMDAwMDAwMDAgYzA1MDdmYzggYzA1MDYwMDggYzAw
MGVkNzgKWyAgIDUwLjUwOTY0M10gN2ZjMDogMjAwMDAwMTMgZmZmZmZmZmYKWyAgIDUwLjUxMzMw
NV0gWzxjMDAwZGYwMD5dIChfX2lycV9zdmMrMHg0MC8weDcwKSBmcm9tIFs8YzAwMGVkNzg+XSAo
Y3B1X2lkbGUrMHg2MC8weDkwKQpbICAgNTAuNTIxNTc1XSBbPGMwMDBlZDc4Pl0gKGNwdV9pZGxl
KzB4NjAvMHg5MCkgZnJvbSBbPGMwNGRhN2E4Pl0gKHN0YXJ0X2tlcm5lbCsweDIzNC8weDI4NCkK
WyAgIDUwLjUzMDMwM10gQ29kZTogZTAwMjIwMDYgZTAwMzMwMDcgZTE5MjAwMDMgMGEwMDAwMDIg
KGU3ZjAwMWYyKSAKWyAgIDUwLjUzNjc0M10gLS0tWyBlbmQgdHJhY2UgNThkNzgxYTZjMTE2NjUz
NSBdLS0tClsgICA1MC41NDE1OTVdIEtlcm5lbCBwYW5pYyAtIG5vdCBzeW5jaW5nOiBGYXRhbCBl
eGNlcHRpb24gaW4gaW50ZXJydXB0Cg==
--e89a8f3ba457cfbc3604dc08e90c
Content-Type: text/x-csrc; charset=US-ASCII; name="omapdebayer.c"
Content-Disposition: attachment; filename="omapdebayer.c"
Content-Transfer-Encoding: base64
X-Attachment-Id: f_hgdf2l291

I2luY2x1ZGUgPHN0ZGlvLmg+CiNpbmNsdWRlIDxzdGRsaWIuaD4KI2luY2x1ZGUgPHN0cmluZy5o
PgojaW5jbHVkZSA8ZXJybm8uaD4KI2luY2x1ZGUgPHN5cy90eXBlcy5oPgojaW5jbHVkZSA8c3lz
L3N0YXQuaD4KI2luY2x1ZGUgPGZjbnRsLmg+CiNpbmNsdWRlIDx1bmlzdGQuaD4KI2luY2x1ZGUg
PHN5cy9pb2N0bC5oPgojaW5jbHVkZSA8bGludXgvdmlkZW9kZXYyLmg+CiNpbmNsdWRlIDxtYWxs
b2MuaD4KI2luY2x1ZGUgInZpZGVvYnVmLmgiCgojZGVmaW5lIFdJRFRIIDM2NjQKI2RlZmluZSBI
RUlHSFQgMjc1MgoKY29uc3QgY2hhciAqIHY0bDJfaW5wdXQgPSAiL2Rldi92aWRlbzMiOwpjb25z
dCBjaGFyICogdjRsMl9vdXRwdXQgPSAiL2Rldi92aWRlbzQiOwoKdmJ1Zl9kZXNjIGlidWY7CnZi
dWZfZGVzYyBvYnVmOwoKI2RlZmluZSBYSU9DVEwoZmQsIG5hbWUsIGRhdGEpIGRvIHsJCQkJXAoJ
CWludCByYzsJCQkJCQkJCQlcCgkJcmMgPSBpb2N0bChmZCwgbmFtZSwgZGF0YSk7CQkJCVwKCQlp
ZihyYyA8IDApIHsJCQkJCQkJXAoJCQlwZXJyb3IoI25hbWUpOwkJCQkJCVwKCQkJZXhpdChFWElU
X0ZBSUxVUkUpOwkJCQkJXAoJCX0JCQkJCQkJCQkJXAoJfSB3aGlsZSgwKQoKc3RhdGljIGxvbmcg
ZmlsZXNpemUoRklMRSAqIHN0cmVhbSkgCnsKCWxvbmcgb2ZmczsKCWZzZWVrKHN0cmVhbSwgMCwg
U0VFS19FTkQpOwoJb2ZmcyA9IGZ0ZWxsKHN0cmVhbSk7CglyZXdpbmQoc3RyZWFtKTsKCXJldHVy
biBvZmZzOwp9CgppbnQgbWFpbihpbnQgYXJnYywgY2hhciAqKmFyZ3YpCnsKCWludCBpZmQsIG9m
ZDsKCUZJTEUgKiBpc3RyZWFtLCAgKiBvc3RyZWFtOwoJc3RydWN0IHY0bDJfZm9ybWF0IGZtdDsK
CXN0cnVjdCB2NGwyX3BpeF9mb3JtYXQgaXBmbXQ7CglzdHJ1Y3QgdjRsMl9waXhfZm9ybWF0IG9w
Zm10OwogICAgc3RydWN0IHY0bDJfcmVxdWVzdGJ1ZmZlcnMgIHJlcTsKCXN0cnVjdCB2NGwyX2J1
ZmZlciB2NGwyYnVmOwoJdW5zaWduZWQgY2hhciAqIGxpbmU7CgljaGFyICogZm5hbWU7Cglsb25n
IGZzaXplOwoJaW50IGw7CgoJLy8gb3BlbiB2aWRlbyBmZHMKCWlmZCA9IG9wZW4odjRsMl9pbnB1
dCwgT19SRFdSKTsKCWlmKGlmZCA8IDApIHsKCQlwZXJyb3IodjRsMl9pbnB1dCk7CgkJZXhpdChF
WElUX0ZBSUxVUkUpOwoJfQoKCW9mZCA9IG9wZW4odjRsMl9vdXRwdXQsIE9fUkRXUik7CglpZihv
ZmQgPCAwKSB7CgkJcGVycm9yKHY0bDJfb3V0cHV0KTsKCQlleGl0KEVYSVRfRkFJTFVSRSk7Cgl9
CgoJLy8gZ2V0IC8gc2V0IGlucHV0IHBpeGVsIGZvcm1hdCBhdCBTQkdHUjEwCglmbXQudHlwZSA9
IFY0TDJfQlVGX1RZUEVfVklERU9fT1VUUFVUOwoJaXBmbXQud2lkdGggPSBXSURUSDsKCWlwZm10
LmhlaWdodCA9IEhFSUdIVDsKCWZtdC5mbXQucGl4ID0gaXBmbXQ7CglYSU9DVEwoaWZkLCBWSURJ
T0NfVFJZX0ZNVCwgJmZtdCk7CglpcGZtdCA9IGZtdC5mbXQucGl4OwoKCXByaW50ZigiaW5wdXQg
aXMgJWQgeCAlZFxuIiwgaXBmbXQud2lkdGgsIGlwZm10LmhlaWdodCk7CglYSU9DVEwoaWZkLCBW
SURJT0NfU19GTVQsICZmbXQpOwoJcHJpbnRmKCJieXRlc3BlcmxpbmUgaXMgJWRcbiIsaXBmbXQu
Ynl0ZXNwZXJsaW5lKTsKCXByaW50Zigic2l6ZWltYWdlIGlzICVkXG4iLGlwZm10LnNpemVpbWFn
ZSk7CgkvLyBhbGxvY2F0ZSBpbnB1dCBidWZmZXIKCS8vIGFsbG9jYXRlIG91dHB1dCBidWZmZXIg
dmlhIG1hbGxvYwoJaWJ1Zi5sZW5ndGggPSBpcGZtdC5zaXplaW1hZ2U7CglpYnVmLnVzcnB0ciA9
IG1lbWFsaWduKDMyLCBpYnVmLmxlbmd0aCk7CglsaW5lID0gbWFsbG9jKGlwZm10LndpZHRoKTsK
CgkvLyByZXF1ZXN0IGJ1ZmZlciBpbiBkcml2ZXIKCXJlcS5jb3VudCA9IDE7CglyZXEudHlwZSA9
IFY0TDJfQlVGX1RZUEVfVklERU9fT1VUUFVUOwoJcmVxLm1lbW9yeSA9IFY0TDJfTUVNT1JZX1VT
RVJQVFI7CglYSU9DVEwoaWZkLCBWSURJT0NfUkVRQlVGUywgJnJlcSk7CgoKCgkvLyBnZXQgLyBz
ZXQgb3V0cHV0IHBpeGVsIGZvcm1hdAoJZm10LnR5cGUgPSBWNEwyX0JVRl9UWVBFX1ZJREVPX0NB
UFRVUkU7CglYSU9DVEwob2ZkLCBWSURJT0NfVFJZX0ZNVCwgJmZtdCk7CglvcGZtdCA9IGZtdC5m
bXQucGl4OwoJcHJpbnRmKCJvdXRwdXQgaXMgJWQgeCAlZFxuIiwgb3BmbXQud2lkdGgsIG9wZm10
LmhlaWdodCk7CglwcmludGYoImJ5dGVzcGVybGluZSBpcyAlZFxuIixvcGZtdC5ieXRlc3Blcmxp
bmUpOwoJcHJpbnRmKCJzaXplaW1hZ2UgaXMgJWRcbiIsb3BmbXQuc2l6ZWltYWdlKTsKCVhJT0NU
TChvZmQsIFZJRElPQ19TX0ZNVCwgJmZtdCk7CgoJLy8gYWxsb2NhdGUgb3V0cHV0IGJ1ZmZlciB2
aWEgbWFsbG9jCglvYnVmLmxlbmd0aCA9IGZtdC5mbXQucGl4LnNpemVpbWFnZTsKCW9idWYudXNy
cHRyID0gbWVtYWxpZ24oMzIsIG9idWYubGVuZ3RoKTsKCglyZXEuY291bnQgPSAxOwoJcmVxLnR5
cGUgPSBWNEwyX0JVRl9UWVBFX1ZJREVPX0NBUFRVUkU7CglyZXEubWVtb3J5ID0gVjRMMl9NRU1P
UllfVVNFUlBUUjsKCVhJT0NUTChvZmQsIFZJRElPQ19SRVFCVUZTLCAmcmVxKTsKCgoJLy8gb3Bl
biBpbnB1dCBmaWxlCglpZihhcmdjIDwgMikgewoJCXByaW50ZigicGxlYXNlIHByb3ZpZGUgYSBp
bnB1dCBmaWxlIHRvIGRlYmF5ZXIiKTsKCX0KCWZuYW1lID0gYXJndlsxXTsKCXByaW50ZigiT3Bl
bmluZyAlcyBmb3IgZGViYXllcmluZ1xuIiwgZm5hbWUpOwoJaXN0cmVhbSA9IGZvcGVuKGZuYW1l
LCAiciIpOwoJaWYoIWlzdHJlYW0pIHsKCQlwZXJyb3IoZm5hbWUpOwoJCWV4aXQoRVhJVF9GQUlM
VVJFKTsKCX0KCglmc2l6ZSA9IGZpbGVzaXplKGlzdHJlYW0pOwoJaWYoZnNpemUgIT0gaXBmbXQu
d2lkdGggKiBpcGZtdC5oZWlnaHQpIHsKCQlpZihmc2l6ZSA8IGlwZm10LndpZHRoICogaXBmbXQu
aGVpZ2h0KSB7CgkJCXByaW50ZigiRmlsZSBpcyB0b28gc2hvcnQgZm90IGN1cnJlbnQgaW5wdXQg
OiAlZCA8ICVkXG4iLCBmc2l6ZSwgaXBmbXQud2lkdGggKiBpcGZtdC5oZWlnaHQpOwoJCQlleGl0
KEVYSVRfRkFJTFVSRSk7CgkJfSBlbHNlIHsKCQkJcHJpbnRmKCJXYXJuaW5nIDogdG9vIG1hbnkg
ZGF0YSBpbiBpbnB1dCBmaWxlXG4iKTsKCQl9Cgl9CgoKCS8vIHJlYWQgOCBiaXQgcGl4ZWwgbGlu
ZQoJZm9yKGwgPSAgMDsgbCA8IGlwZm10LmhlaWdodDsgbCsrKSB7CgkJaW50IGlkeDsKCQlmcmVh
ZChsaW5lLCAxLCBpcGZtdC53aWR0aCwgaXN0cmVhbSk7CgkJLy8gdHJhbnNmb3JtIGFuZCBzdG9y
ZSA4IGJpdCBpbnB1dCBsaW5lIHRvIDEwIGJpdCBpbiBpbnB1dCBidWZmZXIKCQlmb3IoaWR4ID0g
MDsgaWR4IDwgaXBmbXQud2lkdGg7IGlkeCsrKSB7CgkJCXVuc2lnbmVkIHNob3J0ICogcGl4OwoJ
CQlwaXggPSAodW5zaWduZWQgc2hvcnQgKikmaWJ1Zi51c3JwdHJbbCAqIGlwZm10LmJ5dGVzcGVy
bGluZSArIGlkeCAqIDJdOwoJCQkqcGl4ID0gbGluZVtpZHhdICogNDsKCQl9Cgl9CgkKCgkvLyBx
dWV1ZSBpbnB1dCBidWYsIHF1ZXVlIG91dHB1dCBidWYKCXY0bDJidWYuaW5kZXggPSAwOwoJdjRs
MmJ1Zi50eXBlID0gVjRMMl9CVUZfVFlQRV9WSURFT19PVVRQVVQ7Cgl2NGwyYnVmLm1lbW9yeSA9
IFY0TDJfTUVNT1JZX1VTRVJQVFI7Cgl2NGwyYnVmLm0udXNlcnB0ciA9IGlidWYudXNycHRyOwoJ
djRsMmJ1Zi5sZW5ndGggPSBpYnVmLmxlbmd0aDsKCXByaW50ZigidXNycHRyID0gMHgleCBcbiIs
IHY0bDJidWYubS51c2VycHRyKTsKCXByaW50ZigidjRsMmJ1Zi5sZW5ndGggPSAlZFxuIixpYnVm
Lmxlbmd0aCk7CglYSU9DVEwoaWZkLCBWSURJT0NfUUJVRiwgJnY0bDJidWYpOwoJcHJpbnRmKCJp
bnB1dCBidWZmZXIgcXVldWVkXG4iKTsKCgl2NGwyYnVmLmluZGV4ID0gMDsKCXY0bDJidWYudHlw
ZSA9IFY0TDJfQlVGX1RZUEVfVklERU9fQ0FQVFVSRTsKCXY0bDJidWYubWVtb3J5ID0gVjRMMl9N
RU1PUllfVVNFUlBUUjsKCXY0bDJidWYubS51c2VycHRyID0gb2J1Zi51c3JwdHI7Cgl2NGwyYnVm
Lmxlbmd0aCA9IG9idWYubGVuZ3RoOwoJWElPQ1RMKG9mZCwgVklESU9DX1FCVUYsICZ2NGwyYnVm
KTsKCXByaW50Zigib3V0cHV0IGJ1ZmZlciBxdWV1ZWRcbiIpOwoKCS8vIHN0cmVhbW9uCglYSU9D
VEwob2ZkLCBWSURJT0NfU1RSRUFNT04sICZ2NGwyYnVmLnR5cGUpOwoJLy9wcmludGYoIm91dHB1
dCBzdHJlYW1vblxuIik7Cgl2NGwyYnVmLnR5cGUgPSBWNEwyX0JVRl9UWVBFX1ZJREVPX09VVFBV
VDsKCVhJT0NUTChpZmQsIFZJRElPQ19TVFJFQU1PTiwgJnY0bDJidWYudHlwZSk7CgkvL3ByaW50
ZigiaW5wdXQgc3RyZWFtb25cbiIpOwoJLy8gZGVxdWV1ZSBvdXRwdXQgYnVmZmVyCgl2NGwyYnVm
LnR5cGUgPSBWNEwyX0JVRl9UWVBFX1ZJREVPX0NBUFRVUkU7CglYSU9DVEwob2ZkLCBWSURJT0Nf
RFFCVUYsICZ2NGwyYnVmKTsKCgkvLyBzdG9yZSBidWZmZXIgZGF0YSBpbiBvdXRwdXQgZmlsZSAK
CW9zdHJlYW0gPSBmb3Blbigib3V0cHV0Lnl1diIsICJ3Iik7Cglmb3IobCA9IDA7IGwgPCBvcGZt
dC5oZWlnaHQ7IGwrKykgewoJCWZ3cml0ZSgmb2J1Zi51c3JwdHJbbCpvcGZtdC53aWR0aCoyXSwg
Miwgb3BmbXQud2lkdGgsIG9zdHJlYW0pOwoJfQoJZmNsb3NlKG9zdHJlYW0pOwoJcmV0dXJuIDA7
Cn0K
--e89a8f3ba457cfbc3604dc08e90c--
