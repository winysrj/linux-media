Return-path: <linux-media-owner@vger.kernel.org>
Received: from mail.renesas.com ([202.234.163.13]:50926 "EHLO
	mail03.idc.renesas.com" rhost-flags-OK-OK-OK-FAIL) by vger.kernel.org
	with ESMTP id S1751619AbZBSBBh (ORCPT
	<rfc822;linux-media@vger.kernel.org>);
	Wed, 18 Feb 2009 20:01:37 -0500
Date: Thu, 19 Feb 2009 10:01:15 +0900
From: morimoto.kuninori@renesas.com
Subject: Re: soc-camera : sh_mobile_ceu_camera race on free_buffer ?
In-reply-to: <Pine.LNX.4.64.0902181938311.6371@axis700.grange>
To: Guennadi Liakhovetski <g.liakhovetski@gmx.de>
Cc: Magnus Damm <magnus.damm@gmail.com>,
	Matthieu CASTET <matthieu.castet@parrot.com>,
	Linux Media Mailing List <linux-media@vger.kernel.org>
Message-id: <uy6w3jl44.wl%morimoto.kuninori@renesas.com>
MIME-version: 1.0 (generated by SEMI 1.14.6 - "Maruoka")
Content-type: text/plain; charset=US-ASCII
References: <497487F2.7070400@parrot.com>
 <aec7e5c30901192046j1a595day51da698181d034e5@mail.gmail.com>
 <497598ED.3050502@parrot.com>
 <aec7e5c30902130214k6a0fc8ck74b412f41fa63385@mail.gmail.com>
 <u7i3rgpeo.wl%morimoto.kuninori@renesas.com>
 <Pine.LNX.4.64.0902181938311.6371@axis700.grange>
Sender: linux-media-owner@vger.kernel.org
List-ID: <linux-media.vger.kernel.org>


Dear Guennadi

> > It works well on all cases.
> So I can add your "Tested-by:"?

Yes please.

> You can try to trigger the race with the capture.c example. Reduce the 
> "count" variable in mainloop() and run capture.c in a loop for a while... 
> Try without this patch and then with this patch. But I think this is a 
> correct fix, so, unless you say, it crashes without it and with it, I'll 
> apply it.

I tried with following command option

# capture_example -d /dev/videoX -f -c 1000

I used -f option, I think you already know the reason =).
I think -c 1000 is enough.

# Because tw9910 can not use YUYV,
# I fixed capture_example to use VUYU for tw9910.

sh_mobile_ceu_camera didn't crashe with
and without Magnus patch.

MigoR + ov772x + capture_example
MigoR + tw9910 + capture_example (VUYU fix)
AP325 + ov772x + capture_example

Best regards
--
Kuninori Morimoto
 
