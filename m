Return-path: <linux-media-owner@vger.kernel.org>
Received: from rv-out-0506.google.com ([209.85.198.234]:2893 "EHLO
	rv-out-0506.google.com" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
	with ESMTP id S1753839AbZCQQAM (ORCPT
	<rfc822;linux-media@vger.kernel.org>);
	Tue, 17 Mar 2009 12:00:12 -0400
Received: by rv-out-0506.google.com with SMTP id g37so62373rvb.1
        for <linux-media@vger.kernel.org>; Tue, 17 Mar 2009 09:00:10 -0700 (PDT)
MIME-Version: 1.0
Date: Wed, 18 Mar 2009 00:00:10 +0800
Message-ID: <15ed362e0903170900y6a71cb71oc65768367a8cfd14@mail.gmail.com>
Subject: [PATCH] Remove stream pipe draining code for CXUSB D680 DMB
From: David Wong <davidtlwong@gmail.com>
To: linux-media@vger.kernel.org
Content-Type: multipart/mixed; boundary=000e0cd14d665eaa5f046552a9df
Sender: linux-media-owner@vger.kernel.org
List-ID: <linux-media.vger.kernel.org>

--000e0cd14d665eaa5f046552a9df
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 7bit

CXUSB D680 DMB pipe draining code found to be problematic for new
kernels (eg. kernel 2.6.27 @ Ubuntu 8.10)

David T.L. Wong

--000e0cd14d665eaa5f046552a9df
Content-Type: text/x-patch; charset=US-ASCII; name="remove_cxusb_d680_pipe_drains.patch"
Content-Disposition: attachment;
	filename="remove_cxusb_d680_pipe_drains.patch"
Content-Transfer-Encoding: base64
X-Attachment-Id: f_fserslmv0

ZGlmZiAtciA2MjZjMTM2ZWMyMjEgbGludXgvZHJpdmVycy9tZWRpYS9kdmIvZHZiLXVzYi9jeHVz
Yi5jCi0tLSBhL2xpbnV4L2RyaXZlcnMvbWVkaWEvZHZiL2R2Yi11c2IvY3h1c2IuYwlGcmkgTWFy
IDEzIDE0OjM1OjE0IDIwMDkgLTA3MDAKKysrIGIvbGludXgvZHJpdmVycy9tZWRpYS9kdmIvZHZi
LXVzYi9jeHVzYi5jCVR1ZSBNYXIgMTcgMjM6MjA6MDAgMjAwOSArMDgwMApAQCAtMzIyLDU4ICsz
MjIsMTEgQEAKIAlyZXR1cm4gMDsKIH0KIAotc3RhdGljIHZvaWQgY3h1c2JfZDY4MF9kbWJfZHJh
aW5fbWVzc2FnZShzdHJ1Y3QgZHZiX3VzYl9kZXZpY2UgKmQpCi17Ci0JaW50ICAgICAgIGVwID0g
ZC0+cHJvcHMuZ2VuZXJpY19idWxrX2N0cmxfZW5kcG9pbnQ7Ci0JY29uc3QgaW50IHRpbWVvdXQg
PSAxMDA7Ci0JY29uc3QgaW50IGp1bmtfbGVuID0gMzI7Ci0JdTggICAgICAgICpqdW5rOwotCWlu
dCAgICAgICByZF9jb3VudDsKLQotCS8qIERpc2NhcmQgcmVtYWluaW5nIGRhdGEgaW4gdmlkZW8g
cGlwZSAqLwotCWp1bmsgPSBrbWFsbG9jKGp1bmtfbGVuLCBHRlBfS0VSTkVMKTsKLQlpZiAoIWp1
bmspCi0JCXJldHVybjsKLQl3aGlsZSAoMSkgewotCQlpZiAodXNiX2J1bGtfbXNnKGQtPnVkZXYs
Ci0JCQl1c2JfcmN2YnVsa3BpcGUoZC0+dWRldiwgZXApLAotCQkJanVuaywganVua19sZW4sICZy
ZF9jb3VudCwgdGltZW91dCkgPCAwKQotCQkJYnJlYWs7Ci0JCWlmICghcmRfY291bnQpCi0JCQli
cmVhazsKLQl9Ci0Ja2ZyZWUoanVuayk7Ci19Ci0KLXN0YXRpYyB2b2lkIGN4dXNiX2Q2ODBfZG1i
X2RyYWluX3ZpZGVvKHN0cnVjdCBkdmJfdXNiX2RldmljZSAqZCkKLXsKLQlzdHJ1Y3QgdXNiX2Rh
dGFfc3RyZWFtX3Byb3BlcnRpZXMgKnAgPSAmZC0+cHJvcHMuYWRhcHRlclswXS5zdHJlYW07Ci0J
Y29uc3QgaW50IHRpbWVvdXQgPSAxMDA7Ci0JY29uc3QgaW50IGp1bmtfbGVuID0gcC0+dS5idWxr
LmJ1ZmZlcnNpemU7Ci0JdTggICAgICAgICpqdW5rOwotCWludCAgICAgICByZF9jb3VudDsKLQot
CS8qIERpc2NhcmQgcmVtYWluaW5nIGRhdGEgaW4gdmlkZW8gcGlwZSAqLwotCWp1bmsgPSBrbWFs
bG9jKGp1bmtfbGVuLCBHRlBfS0VSTkVMKTsKLQlpZiAoIWp1bmspCi0JCXJldHVybjsKLQl3aGls
ZSAoMSkgewotCQlpZiAodXNiX2J1bGtfbXNnKGQtPnVkZXYsCi0JCQl1c2JfcmN2YnVsa3BpcGUo
ZC0+dWRldiwgcC0+ZW5kcG9pbnQpLAotCQkJanVuaywganVua19sZW4sICZyZF9jb3VudCwgdGlt
ZW91dCkgPCAwKQotCQkJYnJlYWs7Ci0JCWlmICghcmRfY291bnQpCi0JCQlicmVhazsKLQl9Ci0J
a2ZyZWUoanVuayk7Ci19Ci0KIHN0YXRpYyBpbnQgY3h1c2JfZDY4MF9kbWJfc3RyZWFtaW5nX2N0
cmwoCiAJCXN0cnVjdCBkdmJfdXNiX2FkYXB0ZXIgKmFkYXAsIGludCBvbm9mZikKIHsKIAlpZiAo
b25vZmYpIHsKIAkJdTggYnVmWzJdID0geyAweDAzLCAweDAwIH07Ci0JCWN4dXNiX2Q2ODBfZG1i
X2RyYWluX3ZpZGVvKGFkYXAtPmRldik7CiAJCXJldHVybiBjeHVzYl9jdHJsX21zZyhhZGFwLT5k
ZXYsIENNRF9TVFJFQU1JTkdfT04sCiAJCQlidWYsIHNpemVvZihidWYpLCBOVUxMLCAwKTsKIAl9
IGVsc2UgewpAQCAtMTExOCwxMyArMTA4MSw2IEBACiAJdXNiX2NsZWFyX2hhbHQoZC0+dWRldiwK
IAkJdXNiX3JjdmJ1bGtwaXBlKGQtPnVkZXYsIGQtPnByb3BzLmFkYXB0ZXJbMF0uc3RyZWFtLmVu
ZHBvaW50KSk7CiAKLQkvKiBEcmFpbiBVU0IgcGlwZXMgdG8gYXZvaWQgaGFuZyBhZnRlciByZWJv
b3QgKi8KLQlmb3IgKG4gPSAwOyAgbiA8IDU7ICBuKyspIHsKLQkJY3h1c2JfZDY4MF9kbWJfZHJh
aW5fbWVzc2FnZShkKTsKLQkJY3h1c2JfZDY4MF9kbWJfZHJhaW5fdmlkZW8oZCk7Ci0JCW1zbGVl
cCgyMDApOwotCX0KLQogCS8qIFJlc2V0IHRoZSB0dW5lciAqLwogCWlmIChjeHVzYl9kNjgwX2Rt
Yl9ncGlvX3R1bmVyKGQsIDB4MDcsIDApIDwgMCkgewogCQllcnIoImNsZWFyIHR1bmVyIGdwaW8g
ZmFpbGVkIik7Cg==
--000e0cd14d665eaa5f046552a9df--
