Return-path: <video4linux-list-bounces@redhat.com>
Received: from mx3.redhat.com (mx3.redhat.com [172.16.48.32])
	by int-mx1.corp.redhat.com (8.13.1/8.13.1) with ESMTP id mBG0hlXW029312
	for <video4linux-list@redhat.com>; Mon, 15 Dec 2008 19:43:48 -0500
Received: from mail02.idc.renesas.com (mail.renesas.com [202.234.163.13])
	by mx3.redhat.com (8.13.8/8.13.8) with ESMTP id mBG0hWKJ029229
	for <video4linux-list@redhat.com>; Mon, 15 Dec 2008 19:43:33 -0500
Date: Tue, 16 Dec 2008 09:43:20 +0900
From: morimoto.kuninori@renesas.com
In-reply-to: <aec7e5c30812150328t70117d7fp8eee31de4ac223ae@mail.gmail.com>
To: Magnus Damm <magnus.damm@gmail.com>
Message-id: <uskopgdav.wl%morimoto.kuninori@renesas.com>
MIME-version: 1.0 (generated by SEMI 1.14.6 - "Maruoka")
Content-type: text/plain; charset=US-ASCII
References: <u3agtx39i.wl%morimoto.kuninori@renesas.com>
	<aec7e5c30812150328t70117d7fp8eee31de4ac223ae@mail.gmail.com>
Cc: V4L-Linux <video4linux-list@redhat.com>,
	Guennadi Liakhovetski <g.liakhovetski@gmx.de>
Subject: Re: [PATCH re-send v2] Add interlace support to
	sh_mobile_ceu_camera.c
List-Unsubscribe: <https://www.redhat.com/mailman/listinfo/video4linux-list>,
	<mailto:video4linux-list-request@redhat.com?subject=unsubscribe>
List-Archive: <https://www.redhat.com/mailman/private/video4linux-list>
List-Post: <mailto:video4linux-list@redhat.com>
List-Help: <mailto:video4linux-list-request@redhat.com?subject=help>
List-Subscribe: <https://www.redhat.com/mailman/listinfo/video4linux-list>,
	<mailto:video4linux-list-request@redhat.com?subject=subscribe>
Sender: video4linux-list-bounces@redhat.com
Errors-To: video4linux-list-bounces@redhat.com
List-ID: <video4linux-list@redhat.com>


Hi Magnus

Thank you for your advice.

> Can you please use the names phys_addr_top and phys_addr_bottom
> instead? It may be strange to have phys_addr_t as variable name.

OK. I will fix these name.

> > -       phys_addr = videobuf_to_dma_contig(pcdev->active);
> > -       ceu_write(pcdev, CDAYR, phys_addr);
> > +       phys_addr_t = videobuf_to_dma_contig(pcdev->active);
> > +       ceu_write(pcdev, CDAYR, phys_addr_t);
> > +       if (pcdev->is_interlace) {
> > +               phys_addr_b = phys_addr_t + icd->width;
> > +               ceu_write(pcdev, CDBYR, phys_addr_b);
> > +       }
(snip)
> The "phys_addr_b" code above changes the variable which may give you a
> warning if your compiler is silly. If you change the code to
> "phys_addr_b = phys_addr_t + icd->width" then you should get the same
> result but will avoid the warning without the need for the dummy
> initialization code.

?
Do you mean like this ??

static void sh_mobile_ceu_capture( xxxx )
{
        dma_addr_t phys_addr_top;
        dma_addr_t phys_addr_bottom = phys_addr_top + icd->width;
        ....

I can not agree with you.
because phys_addr_top needs videobuf_to_dma_contig

=>> +       phys_addr_t = videobuf_to_dma_contig(pcdev->active);
  > +       ceu_write(pcdev, CDAYR, phys_addr_t);
  > +       if (pcdev->is_interlace) {
=>> +               phys_addr_b = phys_addr_t + icd->width;
  > +               ceu_write(pcdev, CDBYR, phys_addr_b);
  > +       }

Or is my understanding different ?

How about this ?

static void sh_mobile_ceu_capture( xxxx )
{
        dma_addr_t phys_addr_top;
=>      dma_addr_t phys_addr_bottom = icd->width;
        ....

        phys_addr_top = videobuf_to_dma_contig(pcdev->active);
        ceu_write(pcdev, CDAYR, phys_addr_top);
        if (pcdev->is_interlace) {
=>       	phys_addr_bottom += phys_addr_top;
                ceu_write(pcdev, CDBYR, phys_addr_bottom);
        }


> > +       pcdev->is_interlace = 0;
> > +       if (V4L2_FIELD_INTERLACED == f->fmt.pix.field) {
> > +               pcdev->is_interlace = 1;
> > +               f->fmt.pix.field = V4L2_FIELD_NONE;
> > +       }
> 
> Like Guennadi mentioned, this is a bit fishy. But you guys are working
> that out now, so that's all good.

I will fix this code like Guennadi said.


Best regards
--
Kuninori Morimoto

--
video4linux-list mailing list
Unsubscribe mailto:video4linux-list-request@redhat.com?subject=unsubscribe
https://www.redhat.com/mailman/listinfo/video4linux-list
