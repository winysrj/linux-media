Return-path: <linux-media-owner@vger.kernel.org>
Received: from mail-wy0-f174.google.com ([74.125.82.174]:52897 "EHLO
	mail-wy0-f174.google.com" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
	with ESMTP id S1755871Ab0EZWsG (ORCPT
	<rfc822;linux-media@vger.kernel.org>);
	Wed, 26 May 2010 18:48:06 -0400
Received: by wyb29 with SMTP id 29so3698608wyb.19
        for <linux-media@vger.kernel.org>; Wed, 26 May 2010 15:48:02 -0700 (PDT)
MIME-Version: 1.0
Date: Wed, 26 May 2010 23:48:02 +0100
Message-ID: <AANLkTikN5n3Pt7gdmwWdg97fKrlSuaOseUI6AxUnTQCr@mail.gmail.com>
Subject: [RFC] V4L2 Controls State Store/Restore File Format v.0.0.2 and test
	app
From: Paulo Assis <pj.assis@gmail.com>
To: Hans Verkuil <hverkuil@xs4all.nl>,
	martin_rubli <Martin_Rubli@logitech.com>,
	Hans de Goede <hdegoede@redhat.com>,
	Laurent Pinchart <laurent.pinchart@ideasonboard.com>
Cc: Linux Media Mailing List <linux-media@vger.kernel.org>
Content-Type: multipart/mixed; boundary=0016e64c39e60390b40487871174
Sender: linux-media-owner@vger.kernel.org
List-ID: <linux-media.vger.kernel.org>

--0016e64c39e60390b40487871174
Content-Type: text/plain; charset=ISO-8859-1

Ok so here is a new version for the controls state store/restore
functionality and a test app implementing the functionality.
I've removed the need for control order inside the file since this can
be done inside the application.
Simply  ordering by id is enough for most auto/absolute control pairs
to work since auto controls will almost in all cases have a lower id
than the absolute counterpart, the exception being
V4L2_CID_FOCUS_AUTO, in the included test app I don't take any special
attention for this case since it would increase complexity.
I also could not test string and 64 bit integer controls since i don't
have any hardware that supports them.

Best Regards,
Paulo

--0016e64c39e60390b40487871174
Content-Type: text/plain; charset=US-ASCII; name="RFC_control_save_restore_file_format.txt"
Content-Disposition: attachment;
	filename="RFC_control_save_restore_file_format.txt"
Content-Transfer-Encoding: base64
X-Attachment-Id: f_g9oqwtkn2

W1JGQ10gVjRMMiBDb250cm9scyBTdGF0ZSBTdG9yZS9SZXN0b3JlIEZpbGUgRm9ybWF0CgpBVVRI
T1JTOiBQYXVsbyBBc3NpcyA8cGouYXNzaXNAZ21haWwuY29tPgoKVkVSU0lPTjogMC4wLjIKCkFC
U1RSQUNUCgpUaGlzIGRvY3VtZW50IHByb3Bvc2VzIGEgc3RhbmRhcmQgZm9yIHRoZSBmaWxlIGZv
cm1hdCB1c2VkIGJ5IHY0bDIgYXBwbGljYXRpb25zIHRvIHN0b3JlL3Jlc3RvcmUgdGhlIGNvbnRy
b2xzIHN0YXRlLgpUaGlzIHVuaWZpZWQgZmlsZSBmb3JtYXQgYWxsb3dzIHNoYXJpbmcgY29udHJv
bCBwcm9maWxlcyBiZXR3ZWVuIGFwcGxpY2F0aW9ucywgbWFraW5nIGl0IG11Y2ggZWFzaWVyIG9u
IGJvdGggZGV2ZWxvcGVycyBhbmQgdXNlcnMuCgpJTlRST0RVQ1RJT04KClY0bDIgY29udHJvbHMg
Y2FuIGJlIGRpdmlkZWQgYnkgY2xhc3NlcyBhbmQgdHlwZXMuCkNvbnRyb2xzIGluIGRpZmZlcmVu
dCBjbGFzc2VzIGFyZSBub3QgZGVwZW5kZW50IGJldHdlZW4gdGhlbXNlbHZlcywgb24gdGhlIG90
aGVyIGVuZCBpZiB0d28gY29udHJvbHMgYmVsb25nIHRvIHRoZSBzYW1lIGNsYXNzIHRoZXkgbWF5
IG9yIG1heSBub3QgYmUgZGVwZW5kZW50LgpBIGdvb2QgZXhhbXBsZSBhcmUgYXV0b21hdGljIGNv
bnRyb2xzIGFuZCB0aGVpciBhYnNvbHV0ZSBjb3VudGVycGFydHMsIGUuZy46IFY0TDJfQ0lEX0FV
VE9HQUlOIGFuZCBWNEwyX0NJRF9HQUlOLgpDb250cm9scyBtdXN0IGJlIHNldCBmb2xsb3dpbmcg
dGhlIGRlcGVuZGVuY3kgb3JkZXIsIGF1dG9tYXRpYyBjb250cm9scyBtdXN0IGJlIHNldCBmaXJz
dCBvciBlbHNlIHNldHRpbmcgdGhlIGFic29sdXRlIHZhbHVlIG1heSBmYWlsLCB3aGVuIHRoYXQg
d2FzIG5vdCB0aGUgaW50ZW5kZWQgYmVoYXZpb3IgKGF1dG8gZGlzYWJsZWQpLgpBZnRlciBhIHF1
aWNrIGFuYWx5c2VzIG9mIHRoZSB2NGwyIGNvbnRyb2xzLCB3ZSBhcmUgbGVmdCB0byBjb25jbHVk
ZSB0aGF0IGF1dG8gY29udHJvbHMgaGF2ZSBpbiBhbG1vc3QgYWxsIGNhc2VzIGEgbG93ZXIgSUQg
b3JkZXIgdGhhbiB0aGUgY29ycmVzcG9uZGluZyBhYnNvbHV0ZSBjb3VudGVycGFydHMsIHRoZSBl
eGNlcHRpb24gYmVpbmcgVjRMMl9DSURfRk9DVVNfQVVUTy4KU28gYnkgb3JkZXJpbmcgY29udHJv
bHMgYnkgaWQsIHdpdGggdGhlIGFib3ZlIGV4Y2VwdGlvbiwgc2hvdWxkIGJlIGVub3VnaCBmb3Ig
dGhpbmdzIHRvIHdvcmsgd2l0aG91dCBwcm9ibGVtcy4KT3JkZXJpbmcgYnkgaWQgd2lsbCBhbHNv
IGF1dG9tYXRpY2FsbHkgb3JkZXIgdGhlIGNvbnRyb2xzIGJ5IGNsYXNzIGFsbG93aW5nIHRoZSB1
c2FnZSBvZiB0aGUgZXh0ZW5zaW9uIGNvbnRyb2wgQVBJLiAKCkJ1dHRvbiBjb250cm9scyBhcmUg
c3RhdGVsZXNzIHNvIHRoZXkgY2FuJ3QgYmUgc3RvcmVkLgpSZWxhdGl2ZSBjb250cm9scyBhcmUg
YWxzbyBpbiBlZmZlY3Qgc3RhdGVsZXNzLCBzaW5jZSB0aGV5IHdpbGwgYWx3YXlzIGRlcGVuZCBv
biB0aGVpciBjdXJyZW50IHN0YXRlLgpJbiBmYWN0IG9ubHkgY29udHJvbHMgd2l0aCBSZWFkL1dy
aXRlIHBlcm1pc3Npb25zIGNhbiBiZSBzdG9yZWQgYW5kIHJlc3RvcmVkIHNvIG9ubHkgdGhlc2Ug
YmVsb25nIGluIHRoZSBzY29wZSBvZiB0aGlzIGRvY3VtZW50LgoKVGhlIHByb3Bvc2VkIGZpbGUg
Zm9ybWF0IHRha2VzIGFsbCBvZiB0aGlzIGludG8gYWNjb3VudCBhbmQgdHJpZXMgdG8gbWFrZSBp
bXBsZW1lbnRhdGlvbiBvZiBib3RoIHN0b3JlIGFuZCByZXN0b3JlIGZ1bmN0aW9uYWxpdHkgYXMg
ZWFzeSBhcyBwb3NzaWJsZS4KCkZJTEUgRk9STUFUCgpUaGUgcHJvcG9zZWQgZmlsZSBmb3JtYXQg
aXMgYSByZWd1bGFyIHRleHQgZmlsZSB3aXRoIGxpbmVzIHRlcm1pbmF0aW5nIHdpdGggdGhlIG5l
d2xpbmUgY2hhcmFjdGVyICdcbicuIApDb21tZW50cyBjYW4gYmUgaW5zZXJ0ZWQgYnkgYWRkaW5n
ICcjJyBhdCB0aGUgYmVnaW5uaW5nIG9mIHRoZSBsaW5lLCBhbmQgY2FuIHNhZmVseSBiZSBpZ25v
cmVkIHdoZW4gcGFyc2luZyB0aGUgZmlsZS4KCkZJTEUgRVhURU5TSU9OCgpBbHRob3VnaCBub3Qg
bXVjaCByZWxldmFudCwgdGhlIGZpbGUgZXh0ZW5zaW9uIG1ha2VzIGl0IGVhc3kgdG8gdmlzdWFs
bHkgaWRlbnRpZnkgdGhlIGZpbGUgdHlwZSBhbmQgIGFsc28gZm9yIGFwcGxpY2F0aW9ucyB0byBs
aXN0IHJlbGV2YW50IGZpbGVzLCBzbyB3ZSBwcm9wb3NlIHRoYXQgdjRsMiBjb250cm9sIHN0YXRl
IGZpbGVzIGJlIHRlcm1pbmF0ZWQgYnkgdGhlIHN1ZmZpeDogIi52NGwiCiAKRklMRSBIRUFERVIK
ClRoZSBmaWxlIG11c3QgYWx3YXlzIHN0YXJ0IHdpdGggYSBjb21tZW50ZWQgbGluZSBjb250YWlu
aW5nIHRoZSBmaWxlIHR5cGUgaWRlbnRpZmljYXRpb24gYW5kIHRoZSB2ZXJzaW9uIG9mIHRoaXMg
ZG9jdW1lbnQgb24gd2hpY2ggaXQgaXMgYmFzZWQ6CgojVjRMMi9DVFJMLzAuMC4yCiAKQWRkaXRp
b25hbGx5IGl0IG1heSBjb250YWluIGV4dHJhIGluZm9ybWF0aW9uIGxpa2UgdGhlIGFwcGxpY2F0
aW9uIG5hbWUgdGhhdCBnZW5lcmF0ZWQgdGhlIGZpbGUgYW5kIGZvciB1c2IgZGV2aWNlcyB0aGUg
dmlkIGFuZCBwaWQgb2YgdGhlIGRldmljZSB0byB3aG9tIHRoZSBjb250cm9scyByZWxhdGUgaW4g
aGV4YWRlY2ltYWwgbm90YXRpb246CgpBUFBfTkFNRXsiYXBwbGljYXRpb24gbmFtZSJ9ClZJRHsw
eDAwfQpQSUR7MHgwMH0KCkNPTlRST0xTIERBVEEKClRoZSBjb250cm9scyBkbyBub3QgcmVxdWly
ZSBhbnkgc3BlY2lhbCBvcmRlcmluZyBpbiB0aGUgZmlsZSBzaW5jZSB0aGlzIGNhbiBiZSBhY2hp
ZXZlZCBpbiB0aGUgYXBwbGljYXRpb24gaW1wbGVtZW50aW5nIHRoZSBmdW5jdGlvbmFsaXR5LgpJ
biBhbnkgY2FzZSBvcmRlcmluZyBieSBJRCBpcyBuYXR1cmFsIGFzIHRoaXMgaXMgdGhlIHVzdWFs
IHdheSBWSURJT0NfUVVFUllDVFJMIGlzIGRvbmUuCgpFYWNoIGNvbnRyb2wgbXVzdCBoYXZlIGlz
IGRhdGEgc2V0IGluIGEgc2luZ2xlIGxpbmUgbmFkIGl0IHdpbGwgZGVwZW5kIG9uIHRoZSBjb250
cm9sIHR5cGU6CiAKMS0gVjRMMl9DVFJMX1RZUEVfU1RSSU5HOgpJRHsweDAwMDAwMDAwfTtDSEt7
bWluOm1heDpzdGVwOjB9PVNUUnsic3RyaW5nX3ZhbHVlIn0KCjItIFY0TDJfQ1RSTF9UWVBFX0lO
VEVHRVI2NDoKSUR7MHgwMDAwMDAwMH07Q0hLezA6MDowOjB9PVZBTDY0e3ZhbHVlNjR9CgozLSBW
NEwyX0NUUkxfVFlQRV9JTlRFR0VSOyBWNEwyX0NUUkxfVFlQRV9CT09MRUFOOyBWNEwyX0NUUkxf
VFlQRV9NRU5VOgpJRHsweDAwMDB9O0NIS3ttaW46bWF4OnN0ZXA6ZGVmfTtFWFR7WzB8PjB9PVZB
THt2YWx1ZX0KClRoZSBJRCBrZXkgaXMgdGhlIGNvbnRyb2wgdjRsMiBpZCBpbiBoZXggbm90YXRp
b24uCgpUaGUgQ0hLIGtleSBpcyB1c2VkIHRvIG1hdGNoIHRoZSBjb250cm9sIHN0b3JlZCBpbiBm
aWxlIHRvIHRoZSBvbmUgd2UgYXJlIHRyeWluZyB0byBzZXQgb24gdGhlIGRldmljZS4KQ29udHJv
bHMgb24gZGlmZmVyZW50IGRldmljZXMgbWF5IGhhdmUgaWRlbnRpY2FsIElEJ3MgYnV0IGlzIHVu
bGlrZWx5IHRoYXQgdGhlIGNvcnJlc3BvbmRlbnQgdmFsdWVzIHJlbWFpbiB0aGUgc2FtZS4gQWxs
IHZhbHVlcyBhcmUgaW4gZGVjaW1hbCBub3RhdGlvbiBhbmQgY29ycmVzcG9uZCB0byB0aGUgY29u
dHJvbHMgcmVwb3J0ZWQgdmFsdWVzLgptaW4tIG1pbmltdW0KbWF4LSBtYXhpbXVtCnN0ZXA6IHN0
ZXAKZGVmOiBkZWZhdWx0CgpUaGVzZSBhcmUgc3BlY2lhbGx5IGltcG9ydGFudCBmb3IgaW50ZWdl
ciB0eXBlcyBidXQgYXJlIG5vdCByZWxldmFudCBmb3IgNjQgYml0IGNvbnRyb2xzLgpGb3Igc3Ry
aW5nIGNvbnRyb2xzIG1heCBjYW4gYmUgdXNlZCBmb3IgdGhlIHN0cmluZyBhbGxvY2F0aW9uICht
YXgrMSkuCiAKVGhlIFNUUiBrZXkgY29udGFpbnMgdGhlIHN0cmluZyBjb250cm9sIHZhbHVlLgoK
VGhlIFZBTDY0IGtleSBjb250YWlucyBhIDY0IGJpdCBzaWduZWQgaW50ZWdlciB2YWx1ZS4KClRo
ZSBWQUwga2V5IGNvbnRhaW5zIGEgMzIgYml0IHNpZ25lZCBpbnRlZ2VyIHZhbHVlLgoKVGhpcyBm
b3JtYXQgc2hvdWxkIGNvdmVyIGFsbCBjdXJyZW50IGNvbnRyb2wgdHlwZXMsIGFuZCBpcyBzdGls
bCBmbGV4aWJsZSBlbm91Z2ggdG8gYWxsb3cgbmV3IHR5cGVzIGluIHRoZSBmdXR1cmUuIAoKCgo=
--0016e64c39e60390b40487871174
Content-Type: text/x-csrc; charset=US-ASCII; name="v4l2-re-store-ctrls.c"
Content-Disposition: attachment; filename="v4l2-re-store-ctrls.c"
Content-Transfer-Encoding: base64
X-Attachment-Id: f_g9oqgib50

LyogU3RvcmUvUmVzdG9yZSBWNEwyIENvbnRyb2xzIEZpbGUgRm9ybWF0IGV4YW1wbGUKICogCiAq
ICAgUGF1bG8gQXNzaXMgPHBqLmFzc2lzQGdtYWlsLmNvbT4KICoKICogVGhpcyBwcm9ncmFtIGlz
IGZyZWUgc29mdHdhcmU7IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnkKICog
aXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhcyBw
dWJsaXNoZWQgYnkKICogdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbjsgZWl0aGVyIHZlcnNp
b24gMiBvZiB0aGUgTGljZW5zZSwgb3IKICogKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVy
c2lvbi4KICogCiAqIFRoaXMgcHJvZ3JhbSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0
IGl0IHdpbGwgYmUgdXNlZnVsLAogKiBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQg
ZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZgogKiBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVT
UyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlCiAqIEdOVSBHZW5lcmFsIFB1Ymxp
YyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuCiAqCiAqLwoKI2luY2x1ZGUgPHN0ZGxpYi5oPgoj
aW5jbHVkZSA8c3RkaW8uaD4KI2luY2x1ZGUgPHN5cy90eXBlcy5oPgojaW5jbHVkZSA8aW50dHlw
ZXMuaD4KI2luY2x1ZGUgPHVuaXN0ZC5oPgojaW5jbHVkZSA8ZmNudGwuaD4KI2luY2x1ZGUgPHN0
cmluZy5oPgojaW5jbHVkZSA8c3lzL2lvY3RsLmg+CiNpbmNsdWRlIDxsaW51eC92aWRlb2RldjIu
aD4KI2luY2x1ZGUgPGVycm5vLmg+CiNpbmNsdWRlIDxnZXRvcHQuaD4KCnN0YXRpYyBjaGFyIGRl
dmljZV9uYW1lWzIwXSA9ICIvZGV2L3ZpZGVvMCI7CnN0YXRpYyBjaGFyIGZpbGVuYW1lWzEwMF07
CnN0YXRpYyBpbnQgc3RvcmUgPSAwOwoKLyogCiAqIENvbnRyb2wgc3RydWN0dXJlIHdoZXJlIHdl
IG9sZCB0aGUgY29udHJvbCB2YWx1ZXMuCiAqLwp0eXBlZGVmIHN0cnVjdCBfQ29udHJvbAp7CiAg
ICBzdHJ1Y3QgdjRsMl9xdWVyeWN0cmwgY29udHJvbDsKICAgIGludDMyX3QgY2xhc3M7CiAgICBp
bnQzMl90IHZhbHVlOyAvL2Fsc28gdXNlZCBmb3Igc3RyaW5nIG1heCBzaXplCiAgICBpbnQ2NF90
IHZhbHVlNjQ7CiAgICBjaGFyICpzdHJpbmc7CiAgICBzdHJ1Y3QgX0NvbnRyb2wgKm5leHQ7Cn0g
Q29udHJvbDsKCi8qCiAqIHJldHVybnMgYSBDb250cm9sIHN0cnVjdHVyZSBOVUxMIHRlcm1pbmF0
ZWQgbGlua2VkIGxpc3QKICogd2l0aCBhbGwgb2YgdGhlIGRldmljZSBjb250cm9scyB3aXRoIFJl
YWQvV3JpdGUgcGVybWlzc2lvbnMuCiAqIFRoZXNlIGFyZSB0aGUgb25seSBvbmVzIHRoYXQgd2Ug
Y2FuIHN0b3JlL3Jlc3RvcmUuCiAqIEFsc28gc2V0cyBudW1fY3RybHMgd2l0aCB0aGUgY29udHJv
bHMgY291bnQuCiAqLwpDb250cm9sICpnZXRfY29udHJvbF9saXN0KGludCBoZGV2aWNlLCBpbnQg
Km51bV9jdHJscykKewogICAgaW50IHJldD0wOwogICAgQ29udHJvbCAqZmlyc3QgICA9IE5VTEw7
CiAgICBDb250cm9sICpjdXJyZW50ID0gTlVMTDsKICAgIENvbnRyb2wgKmNvbnRyb2wgPSBOVUxM
OwogICAgCiAgICBpbnQgbiA9IDA7CiAgICBzdHJ1Y3QgdjRsMl9xdWVyeWN0cmwgcXVlcnljdHJs
PXswfTsgCgogICAgcXVlcnljdHJsLmlkID0gMCB8IFY0TDJfQ1RSTF9GTEFHX05FWFRfQ1RSTDsK
ICAgIAogICAgaWYgKChyZXQ9aW9jdGwgKGhkZXZpY2UsIFZJRElPQ19RVUVSWUNUUkwsICZxdWVy
eWN0cmwpKSA9PSAwKQogICAgewogICAgICAgIC8vIFRoZSBkcml2ZXIgc3VwcG9ydHMgdGhlIFY0
TDJfQ1RSTF9GTEFHX05FWFRfQ1RSTCBmbGFnCiAgICAgICAgcXVlcnljdHJsLmlkID0gMDsKICAg
ICAgICBpbnQgY3VycmVudGN0cmw9IHF1ZXJ5Y3RybC5pZDsKICAgICAgICBxdWVyeWN0cmwuaWQg
fD0gVjRMMl9DVFJMX0ZMQUdfTkVYVF9DVFJMOwoKICAgICAgICB3aGlsZSgocmV0ID0gaW9jdGwo
aGRldmljZSwgVklESU9DX1FVRVJZQ1RSTCwgJnF1ZXJ5Y3RybCkpLCByZXQgPyBlcnJubyAhPSBF
SU5WQUwgOiAxKSAKICAgICAgICB7CiAgICAgICAgICAgIC8vIFByZXZlbnQgaW5maW5pdGUgbG9v
cCBmb3IgYnVnZ3kgTkVYVF9DVFJMIGltcGxlbWVudGF0aW9ucwogICAgICAgICAgICBpZihyZXQg
JiYgcXVlcnljdHJsLmlkIDw9IGN1cnJlbnRjdHJsKSAKICAgICAgICAgICAgewogICAgICAgICAg
ICAgICAgY3VycmVudGN0cmwrKzsKICAgICAgICAgICAgICAgIGdvdG8gbmV4dF9jb250cm9sOwog
ICAgICAgICAgICB9CiAgICAgICAgICAgIGN1cnJlbnRjdHJsID0gcXVlcnljdHJsLmlkOwogICAg
CiAgICAgICAgICAgIC8vIHNraXAgaWYgY29udHJvbCBpcyBkaXNhYmxlZCwgcmVhZCBvbmx5LCB3
cml0ZSBvbmx5IG9yIGZhaWxlZAogICAgICAgICAgICBpZiAocmV0IHx8IAogICAgICAgICAgICAg
ICAgKHF1ZXJ5Y3RybC5mbGFncyAmIFY0TDJfQ1RSTF9GTEFHX0RJU0FCTEVEKSAgfHwgCiAgICAg
ICAgICAgICAgICAocXVlcnljdHJsLmZsYWdzICYgVjRMMl9DVFJMX0ZMQUdfUkVBRF9PTkxZKSB8
fAogICAgICAgICAgICAgICAgKHF1ZXJ5Y3RybC5mbGFncyAmIFY0TDJfQ1RSTF9GTEFHX1dSSVRF
X09OTFkpKQogICAgICAgICAgICAgICAgZ290byBuZXh0X2NvbnRyb2w7CiAgICAKICAgICAgICAg
ICAgLy8gQWRkIHRoZSBjb250cm9sIHRvIHRoZSBsaW5rZWQgbGlzdAogICAgICAgICAgICBjb250
cm9sID0gY2FsbG9jICgxLCBzaXplb2YoQ29udHJvbCkpOwogICAgICAgICAgICBtZW1jcHkoJihj
b250cm9sLT5jb250cm9sKSwgJnF1ZXJ5Y3RybCwgc2l6ZW9mKHN0cnVjdCB2NGwyX3F1ZXJ5Y3Ry
bCkpOwogICAgICAgICAgICBjb250cm9sLT5jbGFzcyA9IChjb250cm9sLT5jb250cm9sLmlkICYg
MHhGRkZGMDAwMCk7CiAgICAgICAgICAgIC8vYWxsb2NhdGUgYSBzdHJpbmcgd2l0aCBtYXggc2l6
ZSBpZiBuZWVkZWQKICAgICAgICAgICAgaWYoY29udHJvbC0+Y29udHJvbC50eXBlID09IFY0TDJf
Q1RSTF9UWVBFX1NUUklORykKICAgICAgICAgICAgICAgIGNvbnRyb2wtPnN0cmluZyA9IGNhbGxv
Yyhjb250cm9sLT5jb250cm9sLm1heGltdW0gKyAxLCBzaXplb2YoY2hhcikpOwogICAgICAgICAg
ICBlbHNlCiAgICAgICAgICAgICAgICBjb250cm9sLT5zdHJpbmcgPSBOVUxMOwogICAgICAgICAg
ICAgICAgCiAgICAgICAgICAgIGlmKGZpcnN0ICE9IE5VTEwpCiAgICAgICAgICAgIHsKICAgICAg
ICAgICAgICAgIGN1cnJlbnQtPm5leHQgPSBjb250cm9sOwogICAgICAgICAgICAgICAgY3VycmVu
dCA9IGNvbnRyb2w7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZQogICAgICAgICAgICB7
CiAgICAgICAgICAgICAgICBmaXJzdCA9IGNvbnRyb2w7CiAgICAgICAgICAgICAgICBjdXJyZW50
ID0gZmlyc3Q7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIG4rKzsKICAg
IApuZXh0X2NvbnRyb2w6CiAgICAgICAgICAgIHF1ZXJ5Y3RybC5pZCB8PSBWNEwyX0NUUkxfRkxB
R19ORVhUX0NUUkw7CiAgICAgICAgfQogICAgfQogICAgZWxzZQogICAgewogICAgICAgIHByaW50
ZigiTkVYVF9DVFJMIGZsYWcgbm90IHN1cHBvcnRlZFxuIik7CiAgICAgICAgaW50IGN1cnJlbnRj
dHJsOwogICAgICAgIGZvcihjdXJyZW50Y3RybCA9IFY0TDJfQ0lEX0JBU0U7IGN1cnJlbnRjdHJs
IDwgVjRMMl9DSURfTEFTVFAxOyBjdXJyZW50Y3RybCsrKSAKICAgICAgICB7CiAgICAgICAgICAg
IHF1ZXJ5Y3RybC5pZCA9IGN1cnJlbnRjdHJsOwogICAgICAgICAgICByZXQgPSBpb2N0bChoZGV2
aWNlLCBWSURJT0NfUVVFUllDVFJMLCAmcXVlcnljdHJsKTsKICAgIAogICAgICAgICAgICBpZiAo
cmV0IHx8IAogICAgICAgICAgICAgICAgKHF1ZXJ5Y3RybC5mbGFncyAmIFY0TDJfQ1RSTF9GTEFH
X0RJU0FCTEVEKSAgfHwgCiAgICAgICAgICAgICAgICAocXVlcnljdHJsLmZsYWdzICYgVjRMMl9D
VFJMX0ZMQUdfUkVBRF9PTkxZKSB8fAogICAgICAgICAgICAgICAgKHF1ZXJ5Y3RybC5mbGFncyAm
IFY0TDJfQ1RSTF9GTEFHX1dSSVRFX09OTFkpKQogICAgICAgICAgICAgICAgY29udGludWU7CiAg
ICAgICAgICAgIC8vIEFkZCB0aGUgY29udHJvbCB0byB0aGUgbGlua2VkIGxpc3QKICAgICAgICAg
ICAgY29udHJvbCA9IGNhbGxvYyAoMSwgc2l6ZW9mKENvbnRyb2wpKTsKICAgICAgICAgICAgbWVt
Y3B5KCYoY29udHJvbC0+Y29udHJvbCksICZxdWVyeWN0cmwsIHNpemVvZihzdHJ1Y3QgdjRsMl9x
dWVyeWN0cmwpKTsKICAgICAgICAgICAgY29udHJvbC0+Y2xhc3MgPSAweDAwOTgwMDAwOwogICAg
ICAgICAgICAKICAgICAgICAgICAgaWYoZmlyc3QgIT0gTlVMTCkKICAgICAgICAgICAgewogICAg
ICAgICAgICAgICAgY3VycmVudC0+bmV4dCA9IGNvbnRyb2w7CiAgICAgICAgICAgICAgICBjdXJy
ZW50ID0gY29udHJvbDsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlCiAgICAgICAgICAg
IHsKICAgICAgICAgICAgICAgIGZpcnN0ID0gY29udHJvbDsKICAgICAgICAgICAgICAgIGN1cnJl
bnQgPSBmaXJzdDsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgbisrOwog
ICAgICAgIH0KICAgICAgICAKICAgICAgICBmb3IgKGN1cnJlbnRjdHJsID0gVjRMMl9DSURfUFJJ
VkFURV9CQVNFOztxdWVyeWN0cmwuaWQrKykgCiAgICAgICAgewogICAgICAgICAgICByZXQgPSBp
b2N0bChoZGV2aWNlLCBWSURJT0NfUVVFUllDVFJMLCAmcXVlcnljdHJsKTsKICAgICAgICAgICAg
aWYocmV0KQogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGVsc2UgaWYgKChxdWVy
eWN0cmwuZmxhZ3MgJiBWNEwyX0NUUkxfRkxBR19ESVNBQkxFRCkgIHx8IAogICAgICAgICAgICAg
ICAgICAgICAocXVlcnljdHJsLmZsYWdzICYgVjRMMl9DVFJMX0ZMQUdfUkVBRF9PTkxZKSB8fAog
ICAgICAgICAgICAgICAgICAgICAocXVlcnljdHJsLmZsYWdzICYgVjRMMl9DVFJMX0ZMQUdfV1JJ
VEVfT05MWSkpCiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgLy8gQWRkIHRo
ZSBjb250cm9sIHRvIHRoZSBsaW5rZWQgbGlzdAogICAgICAgICAgICBjb250cm9sID0gY2FsbG9j
ICgxLCBzaXplb2YoQ29udHJvbCkpOwogICAgICAgICAgICBtZW1jcHkoJihjb250cm9sLT5jb250
cm9sKSwgJnF1ZXJ5Y3RybCwgc2l6ZW9mKHN0cnVjdCB2NGwyX3F1ZXJ5Y3RybCkpOwogICAgICAg
ICAgICBjb250cm9sLT5jbGFzcyA9IDB4MDA5ODAwMDA7CiAgICAgICAgICAgIAogICAgICAgICAg
ICBpZihmaXJzdCAhPSBOVUxMKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBjdXJyZW50
LT5uZXh0ID0gY29udHJvbDsKICAgICAgICAgICAgICAgIGN1cnJlbnQgPSBjb250cm9sOwogICAg
ICAgICAgICB9CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgewogICAgICAgICAgICAgICAg
Zmlyc3QgPSBjb250cm9sOwogICAgICAgICAgICAgICAgY3VycmVudCA9IGZpcnN0OwogICAgICAg
ICAgICB9CgogICAgICAgICAgICBuKys7CiAgICAgICAgfQogICAgfQogICAgCiAgICAqbnVtX2N0
cmxzID0gbjsKICAgIHJldHVybiBmaXJzdDsKfQoKLyoKICogUmV0dXJucyB0aGUgQ29udHJvbCBz
dHJ1Y3R1cmUgY29ycmVzcG9uZGluZyB0byBjb250cm9sIGlkLAogKiBmcm9tIHRoZSBjb250cm9s
IGxpc3QuCiAqLwpzdGF0aWMgQ29udHJvbCAqZ2V0X2N0cmxfYnlfaWQoQ29udHJvbCAqY29udHJv
bF9saXN0LCBpbnQgaWQpCnsKICAgIENvbnRyb2wgKmN1cnJlbnQgPSBjb250cm9sX2xpc3Q7CiAg
ICBDb250cm9sICpuZXh0ID0gY3VycmVudC0+bmV4dDsKICAgIHdoaWxlIChuZXh0ICE9IE5VTEwp
CiAgICB7CiAgICAgICAgaWYoY3VycmVudC0+Y29udHJvbC5pZCA9PSBpZCkKICAgICAgICAgICAg
cmV0dXJuIChjdXJyZW50KTsKICAgICAgICAKICAgICAgICBjdXJyZW50ID0gbmV4dDsKICAgICAg
ICBuZXh0ID0gY3VycmVudC0+bmV4dDsKICAgIH0KICAgIGlmKGN1cnJlbnQtPmNvbnRyb2wuaWQg
PT0gaWQpCiAgICAgICAgcmV0dXJuIChjdXJyZW50KTsKICAgIGVsc2UvL25vIGlkIG1hdGNoCiAg
ICAgICAgcmV0dXJuKE5VTEwpOwp9CgovKgogKiBHb2VzIHRocm91Z2ggdGhlIGNvbnRyb2wgbGlz
dCBhbmQgZ2V0cyB0aGUgY29udHJvbHMgY3VycmVudCB2YWx1ZXMKICovCnN0YXRpYyB2b2lkIGdl
dF9jdHJsX3ZhbHVlcyAoaW50IGhkZXZpY2UsIENvbnRyb2wgKmNvbnRyb2xzLCBpbnQgbnVtX2Nv
bnRyb2xzKQp7CiAgICBpbnQgcmV0ID0gMDsKICAgIHN0cnVjdCB2NGwyX2V4dF9jb250cm9sIGNs
aXN0W251bV9jb250cm9sc107CiAgICBDb250cm9sICpjdXJyZW50ID0gY29udHJvbHM7CiAgICBD
b250cm9sICpuZXh0ID0gY3VycmVudC0+bmV4dDsKICAgIGludCBjb3VudCA9IDA7CiAgICBpbnQg
aSA9IDA7CiAgICBpbnQgZG9uZSA9IDA7CiAgICAKICAgIHdoaWxlKCFkb25lKQogICAgewogICAg
ICAgIGNsaXN0W2NvdW50XS5pZCA9IGN1cnJlbnQtPmNvbnRyb2wuaWQ7CiAgICAgICAgY2xpc3Rb
Y291bnRdLnNpemUgPSAwOwogICAgICAgIGlmKGN1cnJlbnQtPmNvbnRyb2wudHlwZSA9PSBWNEwy
X0NUUkxfVFlQRV9TVFJJTkcpCiAgICAgICAgewogICAgICAgICAgICBjbGlzdFtjb3VudF0uc2l6
ZSA9IGN1cnJlbnQtPmNvbnRyb2wubWF4aW11bSArIDE7CiAgICAgICAgICAgIGNsaXN0W2NvdW50
XS5zdHJpbmcgPSBjdXJyZW50LT5zdHJpbmc7IAogICAgICAgIH0KICAgICAgICBjb3VudCsrOwog
ICAgICAgIAogICAgICAgIGlmKChuZXh0ID09IE5VTEwpIHx8IChuZXh0LT5jbGFzcyAhPSBjdXJy
ZW50LT5jbGFzcykpCiAgICAgICAgewogICAgICAgICAgICBzdHJ1Y3QgdjRsMl9leHRfY29udHJv
bHMgY3RybHMgPSB7MH07CiAgICAgICAgICAgIGN0cmxzLmN0cmxfY2xhc3MgPSBjdXJyZW50LT5j
bGFzczsKICAgICAgICAgICAgY3RybHMuY291bnQgPSBjb3VudDsKICAgICAgICAgICAgY3RybHMu
Y29udHJvbHMgPSBjbGlzdDsKICAgICAgICAgICAgcmV0ID0gaW9jdGwoaGRldmljZSwgVklESU9D
X0dfRVhUX0NUUkxTLCAmY3RybHMpOwogICAgICAgICAgICBpZihyZXQpCiAgICAgICAgICAgIHsK
ICAgICAgICAgICAgICAgIHByaW50ZigiVklESU9DX0dfRVhUX0NUUkxTIGZhaWxlZFxuIik7CiAg
ICAgICAgICAgICAgICBzdHJ1Y3QgdjRsMl9jb250cm9sIGN0cmw7CiAgICAgICAgICAgICAgICAv
L2dldCB0aGUgY29udHJvbHMgb25lIGJ5IG9uZQogICAgICAgICAgICAgICAgaWYoIGN1cnJlbnQt
PmNsYXNzID09IFY0TDJfQ1RSTF9DTEFTU19VU0VSKQogICAgICAgICAgICAgICAgewogICAgICAg
ICAgICAgICAgICAgIHByaW50ZigiICAgdXNpbmcgVklESU9DX0dfQ1RSTCBmb3IgdXNlciBjbGFz
cyBjb250cm9sc1xuIik7CiAgICAgICAgICAgICAgICAgICAgZm9yKGk9MDsgaSA8IGNvdW50OyBp
KyspCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBjdHJsLmlk
ID0gY2xpc3RbaV0uaWQ7CiAgICAgICAgICAgICAgICAgICAgICAgIGN0cmwudmFsdWUgPSAwOwog
ICAgICAgICAgICAgICAgICAgICAgICByZXQgPSBpb2N0bChoZGV2aWNlLCBWSURJT0NfR19DVFJM
LCAmY3RybCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmKHJldCkKICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAgICAgICBjbGlzdFtpXS52
YWx1ZSA9IGN0cmwudmFsdWU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAg
fQogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAg
ICAgIHByaW50ZigiICAgdXNpbmcgVklESU9DX0dfRVhUX0NUUkxTIG9uIHNpbmdsZSBjb250cm9s
cyBmb3IgY2xhc3M6IDB4JTA4eFxuIiwgCiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnQt
PmNsYXNzKTsKICAgICAgICAgICAgICAgICAgICBmb3IoaT0wO2kgPCBjb3VudDsgaSsrKQogICAg
ICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgY3RybHMuY291bnQgPSAx
OwogICAgICAgICAgICAgICAgICAgICAgICBjdHJscy5jb250cm9scyA9ICZjbGlzdFtpXTsKICAg
ICAgICAgICAgICAgICAgICAgICAgcmV0ID0gaW9jdGwoaGRldmljZSwgVklESU9DX1NfRVhUX0NU
UkxTLCAmY3RybHMpOwogICAgICAgICAgICAgICAgICAgICAgICBpZihyZXQpCiAgICAgICAgICAg
ICAgICAgICAgICAgICAgICBwcmludGYoImNvbnRyb2wgaWQ6IDB4JTA4eCBmYWlsZWQgdG8gc2V0
IChlcnJvciAlaSlcbiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xpc3RbaV0u
aWQsIHJldCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAg
ICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICAvL2ZpbGwgaW4gdGhlIHZhbHVlcyBvbiB0
aGUgY29udHJvbCBsaXN0CiAgICAgICAgICAgIGZvcihpPTA7IGk8Y291bnQ7IGkrKykKICAgICAg
ICAgICAgewogICAgICAgICAgICAgICAgQ29udHJvbCAqY3RybCA9IGdldF9jdHJsX2J5X2lkKGNv
bnRyb2xzLCBjbGlzdFtpXS5pZCk7CiAgICAgICAgICAgICAgICBpZighY3RybCkKICAgICAgICAg
ICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBwcmludGYoImNvdWxkbid0IGdldCBjb250cm9s
IGZvciBpZDogJWlcbiIsIGNsaXN0W2ldLmlkKTsKICAgICAgICAgICAgICAgICAgICBjb250aW51
ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHN3aXRjaChjdHJsLT5jb250cm9s
LnR5cGUpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgY2FzZSBWNEwyX0NU
UkxfVFlQRV9TVFJJTkc6CiAgICAgICAgICAgICAgICAgICAgICAgIC8vc3RyaW5nIGdldHMgc2V0
IG9uIFZJRElPQ19HX0VYVF9DVFJMUwogICAgICAgICAgICAgICAgICAgICAgICAvL2FkZCB0aGUg
bWF4aW11bSBzaXplIHRvIHZhbHVlCiAgICAgICAgICAgICAgICAgICAgICAgIGN0cmwtPnZhbHVl
ID0gY2xpc3RbaV0uc2l6ZTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAg
ICAgICAgICAgICAgY2FzZSBWNEwyX0NUUkxfVFlQRV9JTlRFR0VSNjQ6CiAgICAgICAgICAgICAg
ICAgICAgICAgIGN0cmwtPnZhbHVlNjQgPSBjbGlzdFtpXS52YWx1ZTY0OwogICAgICAgICAgICAg
ICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAg
ICAgICAgICAgICAgICBjdHJsLT52YWx1ZSA9IGNsaXN0W2ldLnZhbHVlOwogICAgICAgICAgICAg
ICAgICAgICAgICAvL3ByaW50ZigiY29udHJvbCAlaSBbMHglMDh4XSA9ICVpXG4iLCAKICAgICAg
ICAgICAgICAgICAgICAgICAgLy8gICAgaSwgY2xpc3RbaV0uaWQsIGNsaXN0W2ldLnZhbHVlKTsK
ICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAg
ICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIGNvdW50ID0gMDsKICAgICAgICAgICAgCiAg
ICAgICAgICAgIGlmKG5leHQgPT0gTlVMTCkKICAgICAgICAgICAgICAgIGRvbmUgPSAxOwogICAg
ICAgIH0KICAgICAgICAKICAgICAgICBpZighZG9uZSkKICAgICAgICB7CiAgICAgICAgICAgIGN1
cnJlbnQgPSBuZXh0OwogICAgICAgICAgICBuZXh0ID0gY3VycmVudC0+bmV4dDsKICAgICAgICB9
CiAgICB9CiAgICAKfQoKLyoKICogR29lcyB0aHJvdWdoIHRoZSBjb250cm9sIGxpc3QgYW5kIHRy
aWVzIHRvIHNldCB0aGUgY29udHJvbHMgdmFsdWVzIAogKi8Kc3RhdGljIHZvaWQgc2V0X2N0cmxf
dmFsdWVzIChpbnQgaGRldmljZSwgQ29udHJvbCAqY29udHJvbHMsIGludCBudW1fY29udHJvbHMp
CnsKICAgIGludCByZXQgPSAwOwogICAgc3RydWN0IHY0bDJfZXh0X2NvbnRyb2wgY2xpc3RbbnVt
X2NvbnRyb2xzXTsKICAgIENvbnRyb2wgKmN1cnJlbnQgPSBjb250cm9sczsKICAgIENvbnRyb2wg
Km5leHQgPSBjdXJyZW50LT5uZXh0OwogICAgaW50IGNvdW50ID0gMDsKICAgIGludCBpID0gMDsK
ICAgIGludCBkb25lID0gMDsKICAgIAogICAgd2hpbGUoIWRvbmUpCiAgICB7CiAgICAgICAgY2xp
c3RbY291bnRdLmlkID0gY3VycmVudC0+Y29udHJvbC5pZDsKICAgICAgICBzd2l0Y2ggKGN1cnJl
bnQtPmNvbnRyb2wudHlwZSkKICAgICAgICB7CiAgICAgICAgICAgIGNhc2UgVjRMMl9DVFJMX1RZ
UEVfU1RSSU5HOgogICAgICAgICAgICAgICAgY2xpc3RbY291bnRdLnNpemUgPSBjdXJyZW50LT52
YWx1ZTsKICAgICAgICAgICAgICAgIGNsaXN0W2NvdW50XS5zdHJpbmcgPSBjdXJyZW50LT5zdHJp
bmc7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBWNEwyX0NUUkxfVFlQ
RV9JTlRFR0VSNjQ6CiAgICAgICAgICAgICAgICBjbGlzdFtjb3VudF0uc2l6ZSA9IDA7CiAgICAg
ICAgICAgICAgICBjbGlzdFtjb3VudF0udmFsdWU2NCA9IGN1cnJlbnQtPnZhbHVlNjQ7CiAgICAg
ICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIGNs
aXN0W2NvdW50XS5zaXplID0gMDsKICAgICAgICAgICAgICAgIGNsaXN0W2NvdW50XS52YWx1ZSA9
IGN1cnJlbnQtPnZhbHVlOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAg
IGNvdW50Kys7CiAgICAgICAgCiAgICAgICAgaWYoKG5leHQgPT0gTlVMTCkgfHwgKG5leHQtPmNs
YXNzICE9IGN1cnJlbnQtPmNsYXNzKSkKICAgICAgICB7CiAgICAgICAgICAgIHN0cnVjdCB2NGwy
X2V4dF9jb250cm9scyBjdHJscyA9IHswfTsKICAgICAgICAgICAgY3RybHMuY3RybF9jbGFzcyA9
IGN1cnJlbnQtPmNsYXNzOwogICAgICAgICAgICBjdHJscy5jb3VudCA9IGNvdW50OwogICAgICAg
ICAgICBjdHJscy5jb250cm9scyA9IGNsaXN0OwogICAgICAgICAgICByZXQgPSBpb2N0bChoZGV2
aWNlLCBWSURJT0NfU19FWFRfQ1RSTFMsICZjdHJscyk7CiAgICAgICAgICAgIGlmKHJldCkKICAg
ICAgICAgICAgewogICAgICAgICAgICAgICAgcHJpbnRmKCJWSURJT0NfU19FWFRfQ1RSTFMgZm9y
IG11bHRpcGxlIGNvbnRyb2xzIGZhaWxlZCAoZXJyb3IgJWkpXG4iLCByZXQpOwogICAgICAgICAg
ICAgICAgc3RydWN0IHY0bDJfY29udHJvbCBjdHJsOwogICAgICAgICAgICAgICAgLy9zZXQgdGhl
IGNvbnRyb2xzIG9uZSBieSBvbmUKICAgICAgICAgICAgICAgIGlmKCBjdXJyZW50LT5jbGFzcyA9
PSBWNEwyX0NUUkxfQ0xBU1NfVVNFUikKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAg
ICAgICBwcmludGYoIiAgIHVzaW5nIFZJRElPQ19TX0NUUkwgZm9yIHVzZXIgY2xhc3MgY29udHJv
bHNcbiIpOwogICAgICAgICAgICAgICAgICAgIGZvcihpPTA7aSA8IGNvdW50OyBpKyspCiAgICAg
ICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBjdHJsLmlkID0gY2xpc3Rb
aV0uaWQ7CiAgICAgICAgICAgICAgICAgICAgICAgIGN0cmwudmFsdWUgPSBjbGlzdFtpXS52YWx1
ZTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0ID0gaW9jdGwoaGRldmljZSwgVklESU9DX1Nf
Q1RSTCwgJmN0cmwpOwogICAgICAgICAgICAgICAgICAgICAgICBpZihyZXQpCiAgICAgICAgICAg
ICAgICAgICAgICAgICAgICBwcmludGYoImNvbnRyb2wgaWQ6IDB4JTA4eCBmYWlsZWQgdG8gc2V0
IChlcnJvciAlaSlcbiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xpc3RbaV0u
aWQsIHJldCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAg
ICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIHByaW50
ZigiICAgdXNpbmcgVklESU9DX1NfRVhUX0NUUkxTIG9uIHNpbmdsZSBjb250cm9scyBmb3IgY2xh
c3M6IDB4JTA4eFxuIiwgCiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnQtPmNsYXNzKTsK
ICAgICAgICAgICAgICAgICAgICBmb3IoaT0wO2kgPCBjb3VudDsgaSsrKQogICAgICAgICAgICAg
ICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgY3RybHMuY291bnQgPSAxOwogICAgICAg
ICAgICAgICAgICAgICAgICBjdHJscy5jb250cm9scyA9ICZjbGlzdFtpXTsKICAgICAgICAgICAg
ICAgICAgICAgICAgcmV0ID0gaW9jdGwoaGRldmljZSwgVklESU9DX1NfRVhUX0NUUkxTLCAmY3Ry
bHMpOwogICAgICAgICAgICAgICAgICAgICAgICBpZihyZXQpCiAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBwcmludGYoImNvbnRyb2wgaWQ6IDB4JTA4eCBmYWlsZWQgdG8gc2V0IChlcnJvciAl
aSlcbiIsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsaXN0W2ldLmlkLCByZXQp
OwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQog
ICAgICAgICAgICAKICAgICAgICAgICAgY291bnQgPSAwOwogICAgICAgICAgICAKICAgICAgICAg
ICAgaWYobmV4dCA9PSBOVUxMKQogICAgICAgICAgICAgICAgZG9uZSA9IDE7CiAgICAgICAgfQog
ICAgICAgCiAgICAgICAgaWYoIWRvbmUpCiAgICAgICAgewogICAgICAgICAgICBjdXJyZW50ID0g
bmV4dDsKICAgICAgICAgICAgbmV4dCA9IGN1cnJlbnQtPm5leHQ7ICAgCiAgICAgICAgfQogICAg
fQp9CgovKgogKiBmcmVlcyB0aGUgY29udHJvbCBsaXN0IGFsbG9jYXRpb25zCiAqLwpzdGF0aWMg
dm9pZCBmcmVlX2NvbnRyb2xfbGlzdCAoQ29udHJvbCAqY29udHJvbHMpCnsKICAgIENvbnRyb2wg
KmZpcnN0ID0gY29udHJvbHM7CiAgICBDb250cm9sICpuZXh0ID0gZmlyc3QtPm5leHQ7CiAgICB3
aGlsZSAobmV4dCAhPSBOVUxMKQogICAgewogICAgICAgIGlmKGZpcnN0LT5zdHJpbmcpIGZyZWUo
Zmlyc3QtPnN0cmluZyk7CiAgICAgICAgZnJlZShmaXJzdCk7CiAgICAgICAgZmlyc3QgPSBuZXh0
OwogICAgICAgIG5leHQgPSBmaXJzdC0+bmV4dDsKICAgIH0KICAgIC8vY2xlYW4gdGhlIGxhc3Qg
b25lCiAgICBpZihmaXJzdC0+c3RyaW5nKSBmcmVlKGZpcnN0LT5zdHJpbmcpOwogICAgaWYoZmly
c3QpIGZyZWUoZmlyc3QpOwogICAgY29udHJvbHMgPSBOVUxMOwp9CgovKgogKiBHZXRvcHQgb3B0
aW9uIHBhcnNlcgogKi8Kc3RhdGljIHZvaWQgcGFyc2Vfb3B0aW9ucyhpbnQgYXJnYywgY2hhciAq
YXJndltdKQp7CiAgICBpbnQgbmV4dF9vcHRpb24gPSAwOwogICAgaW50IG9wdGlvbl9pbmRleCA9
IDA7CiAgICBjb25zdCBjaGFyIHNob3J0X29wdGlvbnNbXT0gImhkOnM6cjoiOwogICAgc3RhdGlj
IHN0cnVjdCBvcHRpb24gbG9uZ19vcHRpb25zW10gPQogICAgewogICAgICAgIHsiaGVscCIsICAg
IG5vX2FyZ3VtZW50LCAgICAgICAwLCAnaCd9LAogICAgICAgIHsiZGV2aWNlIiwgIHJlcXVpcmVk
X2FyZ3VtZW50LCAwLCAnZCd9LAogICAgICAgIHsic3RvcmUiLCAgIHJlcXVpcmVkX2FyZ3VtZW50
LCAwLCAncyd9LAogICAgICAgIHsicmVzdG9yZSIsIHJlcXVpcmVkX2FyZ3VtZW50LCAwLCAncid9
LAogICAgICAgIHswLCAwLCAwLCAwfQogICAgfTsKICAgIAogICAgd2hpbGUgKG5leHRfb3B0aW9u
ICE9IC0xKSAKICAgIHsKICAgICAgICBuZXh0X29wdGlvbiA9IGdldG9wdF9sb25nIChhcmdjLCBh
cmd2LCBzaG9ydF9vcHRpb25zLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9uZ19v
cHRpb25zLCAmb3B0aW9uX2luZGV4KTsKICAgICAgICBzd2l0Y2ggKG5leHRfb3B0aW9uKQogICAg
ICAgIHsKICAgICAgICAgICAgY2FzZSAnaCc6ICAgLyogLWggb3IgLS1oZWxwICovCiAgICAgICAg
ICAgICAgICBwcmludGYoIlVTQUdFOiBcbiIpOwogICAgICAgICAgICAgICAgcHJpbnRmKCIlcyBv
cHRpb25zXG4iLCBhcmd2WzBdKTsKICAgICAgICAgICAgICAgIHByaW50ZigiT1BUSU9OUzogXG4i
KTsKICAgICAgICAgICAgICAgIHByaW50ZigiLWgsIC0taGVscCAgICAgICAgICAgICAgICA6IHBy
aW50cyB0aGlzIG1lc3NhZ2VcbiIpOwogICAgICAgICAgICAgICAgcHJpbnRmKCItZCwgLS1kZXZp
Y2UgIGRldmljZW5hbWUgIDogc2V0cyB0aGUgZGV2aWNlIFtkZWZhdWx0OiAvZGV2L3ZpZGVvMF1c
biIpOwogICAgICAgICAgICAgICAgcHJpbnRmKCItcywgLS1zdG9yZSAgIGZpbGVuYW1lICAgIDog
c3RvcmVzIHRoZSBjb250cm9scyBzdGF0ZSB0byBmaWxlbmFtZVxuIik7CiAgICAgICAgICAgICAg
ICBwcmludGYoIi1yLCAtLXJlc3RvcmUgZmlsZW5hbWUgICAgOiByZXN0b3JlcyB0aGUgY29udHJv
bHMgc3RhdGUgZnJvbSBmaWxlbmFtZVxuIik7CiAgICAgICAgICAgICAgICBleGl0KDApOwogICAg
ICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgJ2QnOgogICAgICAgICAgICAgICAg
c3RybmNweShkZXZpY2VfbmFtZSwgb3B0YXJnLCAyMCpzaXplb2YoY2hhcikpOyAKICAgICAgICAg
ICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICdzJzoKICAgICAgICAgICAgICAgIHN0b3Jl
ID0gMTsKICAgICAgICAgICAgY2FzZSAncic6CiAgICAgICAgICAgICAgICBzdHJuY3B5KGZpbGVu
YW1lLCBvcHRhcmcsIDEwMCpzaXplb2YoY2hhcikpOyAKICAgICAgICAgICAgICAgIGJyZWFrOwog
ICAgICAgICAgICBjYXNlICc/JzoKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBk
ZWZhdWx0OgogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgfQp9CgoKaW50IG1h
aW4oaW50IGFyZ2MsIGNoYXIgKmFyZ3ZbXSkKewogICAgaW50IGhkZXZpY2UgPSAwOwogICAgaW50
IG51bV9jdHJscyA9IDA7CiAgICBpbnQgaSA9IDA7CiAgICBpbnQgbWFqb3IgPSAwLCBtaW5vciA9
IDAsIHJldiA9IDA7CiAgICBDb250cm9sICpjb250cm9sX2xpc3QgPSBOVUxMOwogICAgQ29udHJv
bCAqY3VycmVudCA9IE5VTEw7CiAgICBDb250cm9sICpuZXh0ID0gTlVMTDsKICAgIEZJTEUgKmZw
ID0gTlVMTDsKICAgIAogICAgcGFyc2Vfb3B0aW9ucyhhcmdjLCBhcmd2KTsKICAgIAogICAgaWYg
KChoZGV2aWNlID0gb3BlbihkZXZpY2VfbmFtZSwgT19SRFdSIHwgT19OT05CTE9DSywgMCkpIDwg
MCkgCiAgICB7CiAgICAgICAgcHJpbnRmKCJFUlJPUiBvcGVuaW5nIFY0TCBpbnRlcmZhY2VcbiIp
OwogICAgICAgIHJldHVybiAoLTEpOwogICAgfQogICAgCiAgICBjb250cm9sX2xpc3QgPSBnZXRf
Y29udHJvbF9saXN0KGhkZXZpY2UsICZudW1fY3RybHMpOwogICAgcHJpbnRmICgibGlzdGVkICVp
IGNvbnRyb2xlc1xuIiwgbnVtX2N0cmxzKTsKICAgIAogICAgZ2V0X2N0cmxfdmFsdWVzKGhkZXZp
Y2UsIGNvbnRyb2xfbGlzdCwgbnVtX2N0cmxzKTsKICAgIAogICAgY3VycmVudCA9IGNvbnRyb2xf
bGlzdDsKICAgIG5leHQgPSBjdXJyZW50LT5uZXh0OwogICAgCiAgICBpZihzdG9yZSkKICAgIHsg
ICAKICAgICAgICBwcmludGYgKCJzdG9yaW5nIGNvbnRyb2xlcyB0byAlc1xuIiwgZmlsZW5hbWUp
OwogICAgICAgIC8vc2F2ZSB0byBmaWxlCiAgICAgICAgZnAgPSBmb3BlbihmaWxlbmFtZSwgInci
KTsKICAgICAgICBpZighZnApCiAgICAgICAgewogICAgICAgICAgICBwcmludGYoIkNvdWxkbid0
IG9wZW4gJXMgZm9yIHdyaXRlXG4iLCBmaWxlbmFtZSk7CiAgICAgICAgICAgIGdvdG8gZmluaXNo
OwogICAgICAgIH0KICAgICAgICAKICAgICAgICAvL3dyaXRlIGhlYWRlcgogICAgICAgIGZwcmlu
dGYoZnAsICIjVjRMMi9DVFJMLzAuMC4yXG4iKTsKICAgICAgICBmcHJpbnRmKGZwLCAiQVBQe1wi
djRsMi1yZS1zdG9yZS1jdHJscyBleGFtcGxlIGFwcFwifVxuIik7CiAgICAgICAgLy93cml0ZSBj
b250cm9sIGRhdGEKICAgICAgICBmcHJpbnRmKGZwLCAiIyBjb250cm9sIGRhdGFcbiIpOwogICAg
ICAgIGZvcihpPTA7IGk8bnVtX2N0cmxzOyBpKyspCiAgICAgICAgewogICAgICAgICAgICBmcHJp
bnRmKGZwLCAiIyVzXG4iLCBjdXJyZW50LT5jb250cm9sLm5hbWUpOwogICAgICAgICAgICBzd2l0
Y2goY3VycmVudC0+Y29udHJvbC50eXBlKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBj
YXNlIFY0TDJfQ1RSTF9UWVBFX1NUUklORyA6CiAgICAgICAgICAgICAgICAgICAgZnByaW50Zihm
cCwgIklEezB4JTA4eH07Q0hLeyVpOiVpOiVpOjB9PVNUUntcIiVzXCJ9XG4iLAogICAgICAgICAg
ICAgICAgICAgICAgICBjdXJyZW50LT5jb250cm9sLmlkLCAKICAgICAgICAgICAgICAgICAgICAg
ICAgY3VycmVudC0+Y29udHJvbC5taW5pbXVtLCAKICAgICAgICAgICAgICAgICAgICAgICAgY3Vy
cmVudC0+Y29udHJvbC5tYXhpbXVtLAogICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50LT5j
b250cm9sLnN0ZXAsCiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnQtPnN0cmluZyk7CiAg
ICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFY0TDJfQ1RSTF9U
WVBFX0lOVEVHRVI2NCA6CiAgICAgICAgICAgICAgICAgICAgZnByaW50ZihmcCwgIklEezB4JTA4
eH07Q0hLezA6MDowOjB9PVZBTDY0eyUiIFBSSWQ2NCAifVxuIiwKICAgICAgICAgICAgICAgICAg
ICAgICAgY3VycmVudC0+Y29udHJvbC5pZCwgCiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJl
bnQtPnZhbHVlNjQpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAg
ZGVmYXVsdCA6CiAgICAgICAgICAgICAgICAgICAgZnByaW50ZihmcCwgIklEezB4JTA4eH07Q0hL
eyVpOiVpOiVpOiVpfT1WQUx7JWl9XG4iLAogICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50
LT5jb250cm9sLmlkLCAKICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudC0+Y29udHJvbC5t
aW5pbXVtLCAKICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudC0+Y29udHJvbC5tYXhpbXVt
LAogICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50LT5jb250cm9sLnN0ZXAsCiAgICAgICAg
ICAgICAgICAgICAgICAgIGN1cnJlbnQtPmNvbnRyb2wuZGVmYXVsdF92YWx1ZSwKICAgICAgICAg
ICAgICAgICAgICAgICAgY3VycmVudC0+dmFsdWUpOwogICAgICAgICAgICAgICAgICAgIGJyZWFr
OwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBpZihuZXh0ID09IE5VTEwp
CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgZWxzZSAKICAgICAgICAgICAgewog
ICAgICAgICAgICAgICAgY3VycmVudCA9IG5leHQ7CiAgICAgICAgICAgICAgICBuZXh0ID0gY3Vy
cmVudC0+bmV4dDsKICAgICAgICAgICAgfSAgICAKICAgICAgICB9CiAgICB9CiAgICBlbHNlCiAg
ICB7CiAgICAgICAgcHJpbnRmICgicmVzdG9yaW5nIGNvbnRyb2xlcyBmcm9tICVzXG4iLCBmaWxl
bmFtZSk7CiAgICAgICAgLy9yZWFkIGZyb20gZmlsZQogICAgICAgIC8vc2F2ZSB0byBmaWxlCiAg
ICAgICAgZnAgPSBmb3BlbihmaWxlbmFtZSwgInIiKTsKICAgICAgICBpZighZnApCiAgICAgICAg
ewogICAgICAgICAgICBwcmludGYoIkNvdWxkbid0IG9wZW4gJXMgZm9yIHJlYWRcbiIsIGZpbGVu
YW1lKTsKICAgICAgICAgICAgZ290byBmaW5pc2g7CiAgICAgICAgfQogICAgICAgIAogICAgICAg
IGNoYXIgbGluZVsyMDBdOwogICAgICAgIGlmKGZnZXRzKGxpbmUsIHNpemVvZihsaW5lKSwgZnAp
ICE9IE5VTEwpCiAgICAgICAgaWYoc3NjYW5mKGxpbmUsIiNWNEwyL0NUUkwvJWkuJWkuJWkiLCAm
bWFqb3IsICZtaW5vciwgJnJldikgPT0gMykgewogICAgICAgICAgICAvL2NoZWNrIHN0YW5kYXJk
IHZlcnNpb24gaWYgbmVlZGVkCiAgICAgICAgfQogICAgICAgIGVsc2UKICAgICAgICB7CiAgICAg
ICAgICAgIHByaW50Zigibm8gdmFsaWQgaGVhZGVyIGZvdW5kXG4iKTsKICAgICAgICAgICAgZ290
byBmaW5pc2g7CiAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICB3aGlsZSAoZmdldHMobGlu
ZSwgc2l6ZW9mKGxpbmUpLCBmcCkgIT0gTlVMTCkgCiAgICAgICAgewogICAgICAgICAgICBpbnQg
aWQgPSAwOyAKICAgICAgICAgICAgaW50IG1pbiA9IDAsIG1heCA9IDAsIHN0ZXAgPSAwLCBkZWYg
PSAwOwogICAgICAgICAgICBpbnQzMl90IHZhbCA9IDA7CiAgICAgICAgICAgIGludDY0X3QgdmFs
NjQgPSAwOwogICAgICAgICAgICAKICAgICAgICAgICAgaWYgKChsaW5lWzBdIT0nIycpICYmIChs
aW5lWzBdIT0nXG4nKSkgCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGlmKHNzY2FuZihs
aW5lLCJJRHsweCUwOHh9O0NIS3slaTolaTolaTolaX09VkFMeyVpfSIsCiAgICAgICAgICAgICAg
ICAgICAgJmlkLCAmbWluLCAmbWF4LCAmc3RlcCwgJmRlZiwgJnZhbCkgPT0gNikKICAgICAgICAg
ICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBjdXJyZW50ID0gZ2V0X2N0cmxfYnlfaWQoY29u
dHJvbF9saXN0LCBpZCk7CiAgICAgICAgICAgICAgICAgICAgaWYoY3VycmVudCkKICAgICAgICAg
ICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vY2hlY2sgdmFsdWVzCiAgICAg
ICAgICAgICAgICAgICAgICAgIGlmKGN1cnJlbnQtPmNvbnRyb2wubWluaW11bSA9PSBtaW4gJiYK
ICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudC0+Y29udHJvbC5tYXhpbXVtID09IG1h
eCAmJgogICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50LT5jb250cm9sLnN0ZXAgPT0g
c3RlcCAmJgogICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50LT5jb250cm9sLmRlZmF1
bHRfdmFsdWUgPT0gZGVmKQogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAg
ICAgICAgICAgICAgICBjdXJyZW50LT52YWx1ZSA9IHZhbDsKICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIC8vcHJpbnRmKCJzZXR0aW5nICVzIHRvICVpXG4iLAogICAgICAgICAgICAgICAgICAg
ICAgICAgICAgLy8gICAgY3VycmVudC0+Y29udHJvbC5uYW1lLCB2YWwpOwogICAgICAgICAgICAg
ICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAg
ICAgICAgICAgICAgZWxzZSBpZihzc2NhbmYobGluZSwiSUR7MHglMDh4fTtDSEt7MDowOjA6MH09
VkFMNjR7JSIgUFJJZDY0ICJ9IiwKICAgICAgICAgICAgICAgICAgICAmaWQsICZ2YWw2NCkgPT0g
MikKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBjdXJyZW50ID0gZ2V0X2N0
cmxfYnlfaWQoY29udHJvbF9saXN0LCBpZCk7CiAgICAgICAgICAgICAgICAgICAgaWYoY3VycmVu
dCkKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnQt
PnZhbHVlNjQgPSB2YWw2NDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9
CiAgICAgICAgICAgICAgICBlbHNlIGlmKHNzY2FuZihsaW5lLCJJRHsweCUwOHh9O0NIS3slaTol
aTolaTowfT1TVFJ7XCIlKnNcIn0iLAogICAgICAgICAgICAgICAgICAgICZpZCwgJm1pbiwgJm1h
eCwgJnN0ZXApID09IDUpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgY3Vy
cmVudCA9IGdldF9jdHJsX2J5X2lkKGNvbnRyb2xfbGlzdCwgaWQpOwogICAgICAgICAgICAgICAg
ICAgIGlmKGN1cnJlbnQpCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAg
ICAgICAgLy9jaGVjayB2YWx1ZXMKICAgICAgICAgICAgICAgICAgICAgICAgaWYoY3VycmVudC0+
Y29udHJvbC5taW5pbXVtID09IG1pbiAmJgogICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJy
ZW50LT5jb250cm9sLm1heGltdW0gPT0gbWF4ICYmCiAgICAgICAgICAgICAgICAgICAgICAgICAg
IGN1cnJlbnQtPmNvbnRyb2wuc3RlcCA9PSBzdGVwKQogICAgICAgICAgICAgICAgICAgICAgICB7
CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGFyIHN0clttYXgrMV07CiAgICAgICAgICAg
ICAgICAgICAgICAgICAgICBzc2NhbmYobGluZSwgIklEezB4JSp4fTtDSEt7JSppOiUqaTolKmk6
MH09PVNUUntcIiVzXCJ9Iiwgc3RyKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKHN0
cmxlbihzdHIpID4gbWF4KSAvL0ZJWE1FOiBzaG91bGQgYWxzbyBjaGVjayAobWluaW11bSArTipz
dGVwKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIHByaW50Zigic3RyaW5nIGJpZ2dlciB0aGFuIG1heGltdW0gYnVmZmVyIHNpemUi
KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAvL3N0cmluZyBzaXplIGluY2x1ZGluZyB0ZXJtaW5hdGluZyBudWxsIGNo
YXJhY3RlcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnQtPnZhbHVlID0g
c3RybGVuKHN0cikgKyAxOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cmNweShj
dXJyZW50LT5zdHJpbmcsIHN0cik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAg
ICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg
ICB9ICAgICAgIAogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHNldF9j
dHJsX3ZhbHVlcyhoZGV2aWNlLCBjb250cm9sX2xpc3QsIG51bV9jdHJscyk7CiAgICB9CgpmaW5p
c2g6CiAgICBpZihmcCkKICAgIHsKICAgICAgICBmZmx1c2goZnApOwogICAgICAgIGZzeW5jKGZp
bGVubyhmcCkpOwogICAgICAgIGZjbG9zZShmcCk7CiAgICB9CiAgICBmcmVlX2NvbnRyb2xfbGlz
dChjb250cm9sX2xpc3QpOwogICAgY2xvc2UoaGRldmljZSk7Cn0KCg==
--0016e64c39e60390b40487871174--
