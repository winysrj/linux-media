Return-path: <mchehab@pedra>
Received: from mail-qw0-f46.google.com ([209.85.216.46]:48839 "EHLO
	mail-qw0-f46.google.com" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
	with ESMTP id S1752577Ab0JZXv4 (ORCPT
	<rfc822;linux-media@vger.kernel.org>);
	Tue, 26 Oct 2010 19:51:56 -0400
Received: by qwk3 with SMTP id 3so60835qwk.19
        for <linux-media@vger.kernel.org>; Tue, 26 Oct 2010 16:51:55 -0700 (PDT)
MIME-Version: 1.0
Date: Wed, 27 Oct 2010 01:51:55 +0200
Message-ID: <AANLkTikGT6m9Ji3bBrwUB-yJY9dT0j8eCP_RNAvh3deG@mail.gmail.com>
Subject: Re: [PATCH] Too slow libv4l MJPEG decoding with HD cameras
From: Mitar <mmitar@gmail.com>
To: linux-media@vger.kernel.org
Content-Type: multipart/mixed; boundary=0016362845f4372e3604938dcb6e
List-ID: <linux-media.vger.kernel.org>
Sender: <mchehab@pedra>

--0016362845f4372e3604938dcb6e
Content-Type: text/plain; charset=UTF-8

Hi!

On Sun, Oct 24, 2010 at 6:04 PM, Mitar <mmitar@gmail.com> wrote:
> Has anybody tried to improve MJPEG support in libv4l? With newer
> cameras this becomes important.

I have made a patch which makes libv4l uses ffmpeg's avcodec library
for MJPEG decoding. Performance improvements are unbelievable.

I have been testing with Logitech HD Pro Webcam C910 and
2.6.36-rc6-amd64 and Intel(R) Core(TM)2 Quad CPU Q9400 @ 2.66GHz.
Camera supports 2592x1944 at 10 FPS MJPEG stream.

With using original MJPEG code it takes my computer on average 129.614
ms to decode the frame what is 0.0257 us per pixel.

With using ffmpeg MJPEG decoding it takes my computer on average
43.616 ms to decode the frame what is 0.0087 us per pixel.

In comparison with libv4l YUYV decoding which is 27.407 ms to decode
the frame what is 0.0054 us per pixel this is really amazing. So it is
same time range with YUYV decoding! This opens a new question of how
fast would YUYV decoding be if we would use swscale library for that.
(Code for that is already in my patch, I just use it only for MJPEG
decoding to proper output format.)

This makes decoding possible in real-time at 20 FPS on my computer.
This is really great. (When I will have such camera.)


Mitar

--0016362845f4372e3604938dcb6e
Content-Type: application/octet-stream; name="v4l-utils-ffmpeg-mjpeg.patch"
Content-Disposition: attachment; filename="v4l-utils-ffmpeg-mjpeg.patch"
Content-Transfer-Encoding: base64
X-Attachment-Id: f_gfrfh7he0

ZGlmZiAtLWdpdCBhL01ha2UucnVsZXMgYi9NYWtlLnJ1bGVzCmluZGV4IDU3OTlkZTQuLmNiNjBm
NDUgMTAwNjQ0Ci0tLSBhL01ha2UucnVsZXMKKysrIGIvTWFrZS5ydWxlcwpAQCAtMiw3ICsyLDcg
QEAgVjRMX1VUSUxTX1ZFUlNJT049MC44LjItdGVzdAogCiAjIFRoZXNlIG9uZXMgY2FuIGJlIG92
ZXJyaWRlbiBmcm9tIHRoZSBjbWRsaW5lCiAKLUNGTEFHUyA6PSAtZyAtTzEKK0NGTEFHUyA6PSAt
TzMgLWZmYXN0LW1hdGggLWZyZW5hbWUtcmVnaXN0ZXJzIC1md2ViIC1tdHVuZT1uYXRpdmUKIENG
TEFHUyArPSAtV2FsbCAtV3BvaW50ZXItYXJpdGgKIENYWEZMQUdTIDo9ICQoQ0ZMQUdTKQogQ0ZM
QUdTICs9IC1Xc3RyaWN0LXByb3RvdHlwZXMgLVdtaXNzaW5nLXByb3RvdHlwZXMKZGlmZiAtLWdp
dCBhL2xpYi9saWJ2NGxjb252ZXJ0L01ha2VmaWxlIGIvbGliL2xpYnY0bGNvbnZlcnQvTWFrZWZp
bGUKaW5kZXggOTNlNWZlOC4uMGUxMjEzMCAxMDA2NDQKLS0tIGEvbGliL2xpYnY0bGNvbnZlcnQv
TWFrZWZpbGUKKysrIGIvbGliL2xpYnY0bGNvbnZlcnQvTWFrZWZpbGUKQEAgLTIxLDYgKzIxLDgg
QEAgSU5DTFVERVMgICAgICA9IC4uL2luY2x1ZGUvbGlidjRsY29udmVydC5oCiAKIG92ZXJyaWRl
IENQUEZMQUdTICs9IC1ETElCRElSPVwiJChMSUJESVIpXCIgLURMSUJTVUJESVI9XCIkKExJQlNV
QkRJUilcIgogCitvdmVycmlkZSBMREZMQUdTICs9IC1sYXZjb2RlYyAtbHN3c2NhbGUKKwogYWxs
OiAkKFRBUkdFVFMpCiAKIC1pbmNsdWRlICQoQ09OVkVSVF9PQkpTOi5vPS5kKQpkaWZmIC0tZ2l0
IGEvbGliL2xpYnY0bGNvbnZlcnQvbGlidjRsY29udmVydC1wcml2LmggYi9saWIvbGlidjRsY29u
dmVydC9saWJ2NGxjb252ZXJ0LXByaXYuaAppbmRleCA2MWE4YzM5Li42MDRjMDYxIDEwMDY0NAot
LS0gYS9saWIvbGlidjRsY29udmVydC9saWJ2NGxjb252ZXJ0LXByaXYuaAorKysgYi9saWIvbGli
djRsY29udmVydC9saWJ2NGxjb252ZXJ0LXByaXYuaApAQCAtMjYsNiArMjYsMTQgQEAKICNpbmNs
dWRlICJwcm9jZXNzaW5nL2xpYnY0bHByb2Nlc3NpbmcuaCIKICNpbmNsdWRlICJ0aW55anBlZy5o
IgogCisjaWZkZWYgSEFWRV9BVl9DT05GSUdfSAorI3VuZGVmIEhBVkVfQVZfQ09ORklHX0gKKyNl
bmRpZgorCisjaW5jbHVkZSA8bGliYXZjb2RlYy9hdmNvZGVjLmg+CisjaW5jbHVkZSA8bGlic3dz
Y2FsZS9zd3NjYWxlLmg+CisjaW5jbHVkZSA8bGliYXZ1dGlsL21hdGhlbWF0aWNzLmg+CisKICNk
ZWZpbmUgQVJSQVlfU0laRSh4KSAoKGludClzaXplb2YoeCkvKGludClzaXplb2YoKHgpWzBdKSkK
IAogI2RlZmluZSBWNExDT05WRVJUX0VSUk9SX01TR19TSVpFIDI1NgpAQCAtNDMsNiArNTEsMTQg
QEAKICNkZWZpbmUgVjRMQ09OVkVSVF9ORUVEU19DT05WRVJTSU9OICAgICAgMHgwMiAvKiBBcHBz
IGxpa2VseSB3b250IGtub3cgdGhpcyAqLwogI2RlZmluZSBWNExDT05WRVJUX0NPTVBSRVNTRURf
QU5EX05FRURTX0NPTlZFUlNJT04gMHgwMwogCitzdHJ1Y3QgdjRsY29udmVydF9mZm1wZWcgewor
CUFWQ29kZWNDb250ZXh0ICpjb250ZXh0OworCUFWQ29kZWMgKmNvZGVjOworCUFWRnJhbWUgKmZy
YW1lOworCUFWUGFja2V0IHBhY2tldDsKKwlzdHJ1Y3QgU3dzQ29udGV4dCAqc3dzX2NvbnRleHQ7
Cit9OworCiBzdHJ1Y3QgdjRsY29udmVydF9kYXRhIHsKIAlpbnQgZmQ7CiAJaW50IGZsYWdzOyAv
KiBiaXRmaWVsZCAqLwpAQCAtNTEsNiArNjcsNyBAQCBzdHJ1Y3QgdjRsY29udmVydF9kYXRhIHsK
IAl1bnNpZ25lZCBpbnQgbm9fZm9ybWF0czsKIAljaGFyIGVycm9yX21zZ1tWNExDT05WRVJUX0VS
Uk9SX01TR19TSVpFXTsKIAlzdHJ1Y3QgamRlY19wcml2YXRlICpqZGVjOworCXN0cnVjdCB2NGxj
b252ZXJ0X2ZmbXBlZyBmZm1wZWc7CiAJc3RydWN0IHY0bDJfZnJtc2l6ZWVudW0gZnJhbWVzaXpl
c1tWNExDT05WRVJUX01BWF9GUkFNRVNJWkVTXTsKIAl1bnNpZ25lZCBpbnQgbm9fZnJhbWVzaXpl
czsKIAlpbnQgY29udmVydDFfYnVmX3NpemU7CmRpZmYgLS1naXQgYS9saWIvbGlidjRsY29udmVy
dC9saWJ2NGxjb252ZXJ0LmMgYi9saWIvbGlidjRsY29udmVydC9saWJ2NGxjb252ZXJ0LmMKaW5k
ZXggZjA4OTk2YS4uNDRkOWFlNyAxMDA2NDQKLS0tIGEvbGliL2xpYnY0bGNvbnZlcnQvbGlidjRs
Y29udmVydC5jCisrKyBiL2xpYi9saWJ2NGxjb252ZXJ0L2xpYnY0bGNvbnZlcnQuYwpAQCAtMjYs
NiArMjYsMTQgQEAKICNpbmNsdWRlICJsaWJ2NGxjb252ZXJ0LXByaXYuaCIKICNpbmNsdWRlICJs
aWJ2NGxzeXNjYWxsLXByaXYuaCIKIAorI2lmZGVmIEhBVkVfQVZfQ09ORklHX0gKKyN1bmRlZiBI
QVZFX0FWX0NPTkZJR19ICisjZW5kaWYKKworI2luY2x1ZGUgPGxpYmF2Y29kZWMvYXZjb2RlYy5o
PgorI2luY2x1ZGUgPGxpYnN3c2NhbGUvc3dzY2FsZS5oPgorI2luY2x1ZGUgPGxpYmF2dXRpbC9t
YXRoZW1hdGljcy5oPgorCiAjZGVmaW5lIE1JTihhLCBiKSAoKChhKSA8IChiKSkgPyAoYSkgOiAo
YikpCiAKIC8qIE5vdGUgZm9yIHByb3BlciBmdW5jdGlvbmluZyBvZiB2NGxjb252ZXJ0X2VudW1f
Zm10IHRoZSBmaXJzdCBlbnRyaWVzIGluCkBAIC0xNjgsNiArMTc2LDE2IEBAIHZvaWQgdjRsY29u
dmVydF9kZXN0cm95KHN0cnVjdCB2NGxjb252ZXJ0X2RhdGEgKmRhdGEpCiAJCXRpbnlqcGVnX3Nl
dF9jb21wb25lbnRzKGRhdGEtPmpkZWMsIGNvbXBzLCAzKTsKIAkJdGlueWpwZWdfZnJlZShkYXRh
LT5qZGVjKTsKIAl9CisJaWYgKGRhdGEtPmZmbXBlZy5jb250ZXh0KSB7CisJCWF2Y29kZWNfY2xv
c2UoZGF0YS0+ZmZtcGVnLmNvbnRleHQpOworCQlhdl9mcmVlKGRhdGEtPmZmbXBlZy5jb250ZXh0
KTsKKwl9CisJaWYgKGRhdGEtPmZmbXBlZy5mcmFtZSkgeworCQlhdl9mcmVlKGRhdGEtPmZmbXBl
Zy5mcmFtZSk7CisJfQorCWlmIChkYXRhLT5mZm1wZWcuc3dzX2NvbnRleHQpIHsKKwkJc3dzX2Zy
ZWVDb250ZXh0KGRhdGEtPmZmbXBlZy5zd3NfY29udGV4dCk7CisJfQogCXY0bGNvbnZlcnRfaGVs
cGVyX2NsZWFudXAoZGF0YSk7CiAJZnJlZShkYXRhLT5jb252ZXJ0MV9idWYpOwogCWZyZWUoZGF0
YS0+Y29udmVydDJfYnVmKTsKQEAgLTU1Miw5ICs1NzAsNiBAQCBzdGF0aWMgaW50IHY0bGNvbnZl
cnRfY29udmVydF9waXhmbXQoc3RydWN0IHY0bGNvbnZlcnRfZGF0YSAqZGF0YSwKIAlzd2l0Y2gg
KHNyY19waXhfZm10KSB7CiAJY2FzZSBWNEwyX1BJWF9GTVRfUEpQRzoKIAkJanBlZ19mbGFncyB8
PSBUSU5ZSlBFR19GTEFHU19QSVhBUlRfSlBFRzsKLQkJLyogRmFsbCB0aHJvdWdoICovCi0JY2Fz
ZSBWNEwyX1BJWF9GTVRfTUpQRUc6Ci0JY2FzZSBWNEwyX1BJWF9GTVRfSlBFRzoKIAkJaWYgKCFk
YXRhLT5qZGVjKSB7CiAJCQlkYXRhLT5qZGVjID0gdGlueWpwZWdfaW5pdCgpOwogCQkJaWYgKCFk
YXRhLT5qZGVjKQpAQCAtNjM5LDYgKzY1NCwxMjMgQEAgc3RhdGljIGludCB2NGxjb252ZXJ0X2Nv
bnZlcnRfcGl4Zm10KHN0cnVjdCB2NGxjb252ZXJ0X2RhdGEgKmRhdGEsCiAJCQlyZXN1bHQgPSAt
MTsKIAkJfQogCQlicmVhazsKKwkJCisJY2FzZSBWNEwyX1BJWF9GTVRfTUpQRUc6CisJY2FzZSBW
NEwyX1BJWF9GTVRfSlBFRzoKKwkJaWYgKCFkYXRhLT5mZm1wZWcuZnJhbWUpIHsKKwkJCWlmICgh
KGRhdGEtPmZmbXBlZy5mcmFtZSA9IGF2Y29kZWNfYWxsb2NfZnJhbWUoKSkpIHsKKwkJCQl2NGxj
b252ZXJ0X29vbV9lcnJvcihkYXRhKTsKKwkJCX0KKwkJfQorCQlpZiAoIWRhdGEtPmZmbXBlZy5j
b250ZXh0KSB7CisJCQlpZiAoIShkYXRhLT5mZm1wZWcuY29udGV4dCA9IGF2Y29kZWNfYWxsb2Nf
Y29udGV4dCgpKSkgeworCQkJCXY0bGNvbnZlcnRfb29tX2Vycm9yKGRhdGEpOworCQkJfQorCQl9
CisJCWlmICghZGF0YS0+ZmZtcGVnLmNvZGVjKSB7CisJCQlhdmNvZGVjX2luaXQoKTsKKwkJCWF2
X2xvZ19zZXRfbGV2ZWwoQVZfTE9HX0VSUk9SKTsKKwkJCWF2Y29kZWNfcmVnaXN0ZXJfYWxsKCk7
CisJCQlpZiAoIShkYXRhLT5mZm1wZWcuY29kZWMgPSBhdmNvZGVjX2ZpbmRfZGVjb2RlcihDT0RF
Q19JRF9NSlBFRykpKSB7CisJCQkJVjRMQ09OVkVSVF9FUlIoIkNvZGVjIG5vdCBmb3VuZFxuIik7
CisJCQkJZXJybm8gPSBFSU5WQUw7CisJCQkJcmV0dXJuIC0xOworCQkJfQorCQkJCisJCQlkYXRh
LT5mZm1wZWcuY29udGV4dC0+Y29kZWRfd2lkdGggPSB3aWR0aDsKKwkJCWRhdGEtPmZmbXBlZy5j
b250ZXh0LT5jb2RlZF9oZWlnaHQgPSBoZWlnaHQ7CisJCQkKKwkJCWlmIChhdmNvZGVjX29wZW4o
ZGF0YS0+ZmZtcGVnLmNvbnRleHQsIGRhdGEtPmZmbXBlZy5jb2RlYykgPCAwKSB7CisJCQkJVjRM
Q09OVkVSVF9FUlIoIkNvdWxkIG5vdCBvcGVuIGNvZGVjXG4iKTsKKwkJCQllcnJubyA9IEVJTlZB
TDsKKwkJCQlyZXR1cm4gLTE7CisJCQl9CisJCQlhdl9pbml0X3BhY2tldCgmZGF0YS0+ZmZtcGVn
LnBhY2tldCk7CisJCX0KKwkJCisJCWRhdGEtPmZmbXBlZy5wYWNrZXQuc2l6ZSA9IHNyY19zaXpl
OworCQlkYXRhLT5mZm1wZWcucGFja2V0LmRhdGEgPSBzcmM7CisJCQorCQlpbnQgZ290X2ZyYW1l
OworCQlpZiAoYXZjb2RlY19kZWNvZGVfdmlkZW8yKGRhdGEtPmZmbXBlZy5jb250ZXh0LCBkYXRh
LT5mZm1wZWcuZnJhbWUsICZnb3RfZnJhbWUsICZkYXRhLT5mZm1wZWcucGFja2V0KSA8IDApIHsK
KwkJCVY0TENPTlZFUlRfRVJSKCJFcnJvciB3aGlsZSBkZWNvZGluZyBmcmFtZVxuIik7CisJCQll
cnJubyA9IEVQSVBFOworCQkJcmV0dXJuIC0xOworCQl9CisKKwkJaWYgKCFnb3RfZnJhbWUpIHsK
KwkJCVY0TENPTlZFUlRfRVJSKCJDb3VsZCBub3QgZGVjb2RlIGZyYW1lXG4iKTsKKwkJCWVycm5v
ID0gRVBJUEU7CisJCQlyZXR1cm4gLTE7CisJCX0KKworCQlpZiAoIWRhdGEtPmZmbXBlZy5zd3Nf
Y29udGV4dCkgeworCQkJc3dpdGNoIChkZXN0X3BpeF9mbXQpIHsKKwkJCQljYXNlIFY0TDJfUElY
X0ZNVF9SR0IyNDoKKwkJCQkJZGF0YS0+ZmZtcGVnLnN3c19jb250ZXh0ID0gc3dzX2dldENvbnRl
eHQoZGF0YS0+ZmZtcGVnLmNvbnRleHQtPndpZHRoLCBkYXRhLT5mZm1wZWcuY29udGV4dC0+aGVp
Z2h0LCBkYXRhLT5mZm1wZWcuY29udGV4dC0+cGl4X2ZtdCwgd2lkdGgsIGhlaWdodCwgUElYX0ZN
VF9SR0IyNCwgU1dTX1BPSU5ULCBOVUxMLCBOVUxMLCBOVUxMKTsKKwkJCQkJYnJlYWs7CisJCQkJ
Y2FzZSBWNEwyX1BJWF9GTVRfQkdSMjQ6CisJCQkJCWRhdGEtPmZmbXBlZy5zd3NfY29udGV4dCA9
IHN3c19nZXRDb250ZXh0KGRhdGEtPmZmbXBlZy5jb250ZXh0LT53aWR0aCwgZGF0YS0+ZmZtcGVn
LmNvbnRleHQtPmhlaWdodCwgZGF0YS0+ZmZtcGVnLmNvbnRleHQtPnBpeF9mbXQsIHdpZHRoLCBo
ZWlnaHQsIFBJWF9GTVRfQkdSMjQsIFNXU19QT0lOVCwgTlVMTCwgTlVMTCwgTlVMTCk7CisJCQkJ
CWJyZWFrOworCQkJCWNhc2UgVjRMMl9QSVhfRk1UX1lVVjQyMDoKKwkJCQkJZGF0YS0+ZmZtcGVn
LnN3c19jb250ZXh0ID0gc3dzX2dldENvbnRleHQoZGF0YS0+ZmZtcGVnLmNvbnRleHQtPndpZHRo
LCBkYXRhLT5mZm1wZWcuY29udGV4dC0+aGVpZ2h0LCBkYXRhLT5mZm1wZWcuY29udGV4dC0+cGl4
X2ZtdCwgd2lkdGgsIGhlaWdodCwgUElYX0ZNVF9ZVVY0MjBQLCBTV1NfUE9JTlQsIE5VTEwsIE5V
TEwsIE5VTEwpOworCQkJCQlicmVhazsKKwkJCQljYXNlIFY0TDJfUElYX0ZNVF9ZVlU0MjA6CisJ
CQkJCWRhdGEtPmZmbXBlZy5zd3NfY29udGV4dCA9IHN3c19nZXRDb250ZXh0KGRhdGEtPmZmbXBl
Zy5jb250ZXh0LT53aWR0aCwgZGF0YS0+ZmZtcGVnLmNvbnRleHQtPmhlaWdodCwgZGF0YS0+ZmZt
cGVnLmNvbnRleHQtPnBpeF9mbXQsIHdpZHRoLCBoZWlnaHQsIFBJWF9GTVRfWVVWNDIwUCwgU1dT
X1BPSU5ULCBOVUxMLCBOVUxMLCBOVUxMKTsKKwkJCQkJYnJlYWs7CisJCQl9CisJCQkKKwkJCWlm
ICghZGF0YS0+ZmZtcGVnLnN3c19jb250ZXh0KSB7CisJCQkJVjRMQ09OVkVSVF9FUlIoIkNvdWxk
IG5vdCBnZXQgbGlic3dzY2FsZSBjb250ZXh0XG4iKTsKKwkJCQllcnJubyA9IEVJTlZBTDsKKwkJ
CQlyZXR1cm4gLTE7CisJCQl9CisJCX0KKworCQlBVlBpY3R1cmUgb3V0cHV0OworCQlzd2l0Y2gg
KGRlc3RfcGl4X2ZtdCkgeworCQkJY2FzZSBWNEwyX1BJWF9GTVRfUkdCMjQ6CisJCQkJaWYgKGF2
cGljdHVyZV9maWxsKCZvdXRwdXQsIGRlc3QsIFBJWF9GTVRfUkdCMjQsIHdpZHRoLCBoZWlnaHQp
ID4gZGVzdF9zaXplKSB7CisJCQkJCVY0TENPTlZFUlRfRVJSKCJEZXN0aW5hdGlvbiBidWZmZXIg
dG9vIHNtYWxsXG4iKTsKKwkJCQkJZXJybm8gPSBFSU5WQUw7CisJCQkJCXJldHVybiAtMTsKKwkJ
CQl9CisJCQkJYnJlYWs7CisJCQljYXNlIFY0TDJfUElYX0ZNVF9CR1IyNDoKKwkJCQlpZiAoYXZw
aWN0dXJlX2ZpbGwoJm91dHB1dCwgZGVzdCwgUElYX0ZNVF9CR1IyNCwgd2lkdGgsIGhlaWdodCkg
PiBkZXN0X3NpemUpIHsKKwkJCQkJVjRMQ09OVkVSVF9FUlIoIkRlc3RpbmF0aW9uIGJ1ZmZlciB0
b28gc21hbGxcbiIpOworCQkJCQllcnJubyA9IEVJTlZBTDsKKwkJCQkJcmV0dXJuIC0xOworCQkJ
CX0KKwkJCQlicmVhazsKKwkJCWNhc2UgVjRMMl9QSVhfRk1UX1lVVjQyMDoKKwkJCQlpZiAoYXZw
aWN0dXJlX2ZpbGwoJm91dHB1dCwgZGVzdCwgUElYX0ZNVF9ZVVY0MjBQLCB3aWR0aCwgaGVpZ2h0
KSA+IGRlc3Rfc2l6ZSkgeworCQkJCQlWNExDT05WRVJUX0VSUigiRGVzdGluYXRpb24gYnVmZmVy
IHRvbyBzbWFsbFxuIik7CisJCQkJCWVycm5vID0gRUlOVkFMOworCQkJCQlyZXR1cm4gLTE7CisJ
CQkJfQorCQkJCWJyZWFrOworCQkJY2FzZSBWNEwyX1BJWF9GTVRfWVZVNDIwOgorCQkJCWlmIChh
dnBpY3R1cmVfZmlsbCgmb3V0cHV0LCBkZXN0LCBQSVhfRk1UX1lVVjQyMFAsIHdpZHRoLCBoZWln
aHQpID4gZGVzdF9zaXplKSB7CisJCQkJCVY0TENPTlZFUlRfRVJSKCJEZXN0aW5hdGlvbiBidWZm
ZXIgdG9vIHNtYWxsXG4iKTsKKwkJCQkJZXJybm8gPSBFSU5WQUw7CisJCQkJCXJldHVybiAtMTsK
KwkJCQl9CisJCQkJCisJCQkJLy8gVSBhbmQgViBwbGFuZXMgYXJlIHN3YXBwZWQKKwkJCQl1aW50
OF90ICp0ZW1wID0gb3V0cHV0LmRhdGFbMl07CisJCQkJb3V0cHV0LmRhdGFbMl0gPSBvdXRwdXQu
ZGF0YVsxXTsKKwkJCQlvdXRwdXQuZGF0YVsxXSA9IHRlbXA7CisJCQkJYnJlYWs7CisJCX0KKwkJ
CisJCWlmIChzd3Nfc2NhbGUoZGF0YS0+ZmZtcGVnLnN3c19jb250ZXh0LCAoY29uc3QgdWludDhf
dCAqKilkYXRhLT5mZm1wZWcuZnJhbWUtPmRhdGEsIGRhdGEtPmZmbXBlZy5mcmFtZS0+bGluZXNp
emUsIDAsIGRhdGEtPmZmbXBlZy5jb250ZXh0LT5oZWlnaHQsIG91dHB1dC5kYXRhLCBvdXRwdXQu
bGluZXNpemUpICE9IGhlaWdodCkgeworCQkJVjRMQ09OVkVSVF9FUlIoIkNvdWxkIG5vdCBjb252
ZXJ0IHdpdGggbGlic3dzY2FsZVxuIik7CisJCQllcnJubyA9IEVJTlZBTDsKKwkJCXJldHVybiAt
MTsJCQkJCisJCX0KKwkJCisJCWJyZWFrOwogCiAJCS8qIEN1c3RvbSBjYW0gc3BlY2lmaWMgWVVW
IGZvcm1hdHMgKi8KIAljYXNlIFY0TDJfUElYX0ZNVF9TUENBNTAxOgpkaWZmIC0tZ2l0IGEvbGli
L2xpYnY0bGNvbnZlcnQvdGlueWpwZWctaW50ZXJuYWwuaCBiL2xpYi9saWJ2NGxjb252ZXJ0L3Rp
bnlqcGVnLWludGVybmFsLmgKaW5kZXggNzAyYTJhMi4uZmU1NTIyOCAxMDA2NDQKLS0tIGEvbGli
L2xpYnY0bGNvbnZlcnQvdGlueWpwZWctaW50ZXJuYWwuaAorKysgYi9saWIvbGlidjRsY29udmVy
dC90aW55anBlZy1pbnRlcm5hbC5oCkBAIC00Nyw3ICs0Nyw3IEBAIHN0cnVjdCBqZGVjX3ByaXZh
dGU7CiAKICNkZWZpbmUgSFVGRk1BTl9UQUJMRVMJICAgNAogI2RlZmluZSBDT01QT05FTlRTCSAg
IDMKLSNkZWZpbmUgSlBFR19NQVhfV0lEVEgJICAgMjA0OAorI2RlZmluZSBKUEVHX01BWF9XSURU
SAkgICA0MDk2CiAjZGVmaW5lIEpQRUdfTUFYX0hFSUdIVAkgICAyMDQ4CiAKIHN0cnVjdCBodWZm
bWFuX3RhYmxlIHsK
--0016362845f4372e3604938dcb6e--
