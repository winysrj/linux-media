Return-path: <linux-media-owner@vger.kernel.org>
Received: from vl18780.dinaserver.com ([82.98.188.50]:43918 "EHLO
        vl18780.dinaserver.com" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S1751131AbeCNMF2 (ORCPT
        <rfc822;linux-media@vger.kernel.org>);
        Wed, 14 Mar 2018 08:05:28 -0400
Subject: Re: [DE] Re: coda: i.MX6 decoding performance issues for
 multi-streaming
To: Philipp Zabel <p.zabel@pengutronix.de>,
        linux-media <linux-media@vger.kernel.org>
References: <c18549be-d55e-54d2-1524-1c51d05807ec@by.com.es>
 <1520940054.3965.10.camel@pengutronix.de>
From: Javier Martin <javiermartin@by.com.es>
Message-ID: <dfd0fe98-4e5e-bc28-c325-6c52f1964a03@by.com.es>
Date: Wed, 14 Mar 2018 13:05:10 +0100
MIME-Version: 1.0
In-Reply-To: <1520940054.3965.10.camel@pengutronix.de>
Content-Type: text/plain; charset=utf-8; format=flowed
Content-Language: en-US
Content-Transfer-Encoding: 7bit
Sender: linux-media-owner@vger.kernel.org
List-ID: <linux-media.vger.kernel.org>

Sorry everyone about my previous e-mail with all the HTML garbage. Here 
is the plain text answer instead.

Hi Philipp,

thanks for your answer.

On 13/03/18 12:20, Philipp Zabel wrote:
 > Hi Javier,
 >
 > On Mon, 2018-03-12 at 17:54 +0100, Javier Martin wrote:
 >> Hi,
 >> we have an i.MX6 Solo based board running the latest mainline kernel
 >> (4.15.3).
 >>
 >> As part of our development we were measuring the decoding 
performance of
 >> the i.MX6 coda chip.
 >>
 >> For that purpose we are feeding the decoder with 640x368 @ 30fps H.264
 >> streams that have been generated by another i.MX6 coda encoder
 >> configured with fixed qp = 25 and gopsize = 16.
 >>
 >> For 1-2 streams it works smoothly. However, when adding the 3rd stream
 >> the first decoder instance starts to output these kind of errors:
 >>
 >> DEC_PIC_SUCCESS = 2097153  -> 0x200001
 >> DEC_PIC_SUCCESS = 2621441  -> 0x280001
 > I think these might be (recoverable?) error flags, but so far I have
 > never seen them myself.
 > I've had reports of those occurring occasionally with certain streams
 > (not encoded by coda, regardless of the number of running decoder
 > instances) though.
 >
 > What is the coda firmware version you are using?

I'm currently using 3.1.1 both for encoding and decoding. I think I got 
it from the latest BSP provided by NXP. Now that you mention it the 
driver is printing these messages at probe time which I had ignored so far:

coda 2040000.vpu: Firmware code revision: 46056
coda 2040000.vpu: Initialized CODA960.
coda 2040000.vpu: Unsupported firmware version: 3.1.1
coda 2040000.vpu: codec registered as /dev/video[3-4]

Do you think I should use an older version instead?

Also, do you think it would be worth trying different parameters in the 
encoder to see how the decoder responds in those cases?


Regards,
Javier.
