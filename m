Return-path: <linux-media-owner@vger.kernel.org>
Received: from mail3-relais-sop.national.inria.fr ([192.134.164.104]:43808
        "EHLO mail3-relais-sop.national.inria.fr" rhost-flags-OK-OK-OK-OK)
        by vger.kernel.org with ESMTP id S936050AbeEYO3x (ORCPT
        <rfc822;linux-media@vger.kernel.org>);
        Fri, 25 May 2018 10:29:53 -0400
Date: Fri, 25 May 2018 16:29:50 +0200 (CEST)
From: Julia Lawall <julia.lawall@lip6.fr>
To: Gerd Hoffmann <kraxel@redhat.com>
cc: kbuild-all@01.org, linux-media@vger.kernel.org,
        Sumit Semwal <sumit.semwal@linaro.org>,
        dri-devel@lists.freedesktop.org, linaro-mm-sig@lists.linaro.org,
        linux-kernel@vger.kernel.org
Subject: [PATCH] udmabuf: fix odd_ptr_err.cocci warnings
Message-ID: <alpine.DEB.2.20.1805251628190.3078@hadrien>
MIME-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Sender: linux-media-owner@vger.kernel.org
List-ID: <linux-media.vger.kernel.org>

From: kbuild test robot <fengguang.wu@intel.com>

drivers/dma-buf/udmabuf.c:167:6-12: inconsistent IS_ERR and PTR_ERR on line 168.

 PTR_ERR should access the value just tested by IS_ERR

Semantic patch information:
 There can be false positives in the patch case, where it is the call to
 IS_ERR that is wrong.

Generated by: scripts/coccinelle/tests/odd_ptr_err.cocci

Fixes: cc2d0e91bc15 ("udmabuf: driver update")
Signed-off-by: kbuild test robot <fengguang.wu@intel.com>
Signed-off-by: linux-kernel@vger.kernel.org
---

tree:   git://git.kraxel.org/linux udmabuf
head:   cc2d0e91bc15849baff695d175bfb8fba35f1465
commit: cc2d0e91bc15849baff695d175bfb8fba35f1465 [6/6] udmabuf: driver
update

 udmabuf.c |    2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

--- a/drivers/dma-buf/udmabuf.c
+++ b/drivers/dma-buf/udmabuf.c
@@ -165,7 +165,7 @@ static long udmabuf_ioctl_create(struct
 		page = shmem_read_mapping_page(
 			file_inode(ubuf->filp)->i_mapping, pgoff + pgidx);
 		if (IS_ERR(page)) {
-			ret = PTR_ERR(buf);
+			ret = PTR_ERR(page);
 			goto err_put_pages;
 		}
 		ubuf->pages[pgidx] = page;
