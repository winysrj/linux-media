Return-path: <linux-media-owner@vger.kernel.org>
Received: from mail-ey0-f174.google.com ([209.85.215.174]:44069 "EHLO
	mail-ey0-f174.google.com" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
	with ESMTP id S1751103Ab1KUVJQ (ORCPT
	<rfc822;linux-media@vger.kernel.org>);
	Mon, 21 Nov 2011 16:09:16 -0500
Received: by eye27 with SMTP id 27so5857825eye.19
        for <linux-media@vger.kernel.org>; Mon, 21 Nov 2011 13:09:15 -0800 (PST)
MIME-Version: 1.0
Date: Tue, 22 Nov 2011 02:39:14 +0530
Message-ID: <CAHFNz9KmxyBB4nRQZg1RdU+6wXHmaR9WHejuMqp6g9qrXykjQQ@mail.gmail.com>
Subject: PATCH 12/13: 0012-CXD2820r-Query-DVB-frontend-delivery-capabilities
From: Manu Abraham <abraham.manu@gmail.com>
To: Linux Media Mailing List <linux-media@vger.kernel.org>
Cc: Mauro Carvalho Chehab <mchehab@redhat.com>,
	Andreas Oberritter <obi@linuxtv.org>,
	Antti Palosaari <crope@iki.fi>
Content-Type: multipart/mixed; boundary=bcaec52c62335f2b7d04b245192d
Sender: linux-media-owner@vger.kernel.org
List-ID: <linux-media.vger.kernel.org>

--bcaec52c62335f2b7d04b245192d
Content-Type: text/plain; charset=ISO-8859-1



--bcaec52c62335f2b7d04b245192d
Content-Type: text/x-patch; charset=UTF-8;
	name="0012-CXD2820r-Query-DVB-frontend-delivery-capabilities.patch"
Content-Disposition: attachment;
	filename="0012-CXD2820r-Query-DVB-frontend-delivery-capabilities.patch"
Content-Transfer-Encoding: base64
X-Attachment-Id: file0

RnJvbSAwOTZiY2E2NjNkMDc2MjU1ODUyYjg4Y2U5YTg3YzBmMDdmYTE3ZGVjIE1vbiBTZXAgMTcg
MDA6MDA6MDAgMjAwMQpGcm9tOiBNYW51IEFicmFoYW0gPGFicmFoYW0ubWFudUBnbWFpbC5jb20+
CkRhdGU6IE1vbiwgMjEgTm92IDIwMTEgMTk6NTg6MDMgKzA1MzAKU3ViamVjdDogW1BBVENIIDEy
LzEzXSBDWEQyODIwcjogUXVlcnkgRFZCIGZyb250ZW5kIGRlbGl2ZXJ5IGNhcGFiaWxpdGllcwoK
T3ZlcnJpZGUgZGVmYXVsdCBkZWxpdmVyeSBzeXN0ZW0gaW5mb3JtYXRpb24gcHJvdmlkZWQgYnkg
RkVfR0VUX0lORk8sIHNvCnRoYXQgYXBwbGljYXRpb25zIGNhbiBlbnVtZXJhdGUgZGVsaXZlcnkg
c3lzdGVtcyBwcm92aWRlZCBieSB0aGUgZnJvbnRlbmQuCgpTaWduZWQtb2ZmLWJ5OiBNYW51IEFi
cmFoYW0gPGFicmFoYW0ubWFudUBnbWFpbC5jb20+Ci0tLQogZHJpdmVycy9tZWRpYS9kdmIvZnJv
bnRlbmRzL2N4ZDI4MjByX2MuYyAgICB8ICAgMTcgKy0KIGRyaXZlcnMvbWVkaWEvZHZiL2Zyb250
ZW5kcy9jeGQyODIwcl9jb3JlLmMgfCAgNjUxICsrKysrKysrKy0tLS0tLS0tLS0tLS0tLS0tLQog
ZHJpdmVycy9tZWRpYS9kdmIvZnJvbnRlbmRzL2N4ZDI4MjByX3ByaXYuaCB8ICAgIDUgKy0KIGRy
aXZlcnMvbWVkaWEvZHZiL2Zyb250ZW5kcy9jeGQyODIwcl90LmMgICAgfCAgIDE5ICstCiBkcml2
ZXJzL21lZGlhL2R2Yi9mcm9udGVuZHMvY3hkMjgyMHJfdDIuYyAgIHwgICAyMCArLQogNSBmaWxl
cyBjaGFuZ2VkLCAyNjUgaW5zZXJ0aW9ucygrKSwgNDQ3IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdp
dCBhL2RyaXZlcnMvbWVkaWEvZHZiL2Zyb250ZW5kcy9jeGQyODIwcl9jLmMgYi9kcml2ZXJzL21l
ZGlhL2R2Yi9mcm9udGVuZHMvY3hkMjgyMHJfYy5jCmluZGV4IGI4NWY1MDEuLmY2ZDBmZjcgMTAw
NjQ0Ci0tLSBhL2RyaXZlcnMvbWVkaWEvZHZiL2Zyb250ZW5kcy9jeGQyODIwcl9jLmMKKysrIGIv
ZHJpdmVycy9tZWRpYS9kdmIvZnJvbnRlbmRzL2N4ZDI4MjByX2MuYwpAQCAtMjIsMTAgKzIyLDEx
IEBACiAjaW5jbHVkZSAiY3hkMjgyMHJfcHJpdi5oIgogCiBpbnQgY3hkMjgyMHJfc2V0X2Zyb250
ZW5kX2Moc3RydWN0IGR2Yl9mcm9udGVuZCAqZmUsCi0Jc3RydWN0IGR2Yl9mcm9udGVuZF9wYXJh
bWV0ZXJzICpwYXJhbXMpCisJCQkgICAgc3RydWN0IGR2Yl9mcm9udGVuZF9wYXJhbWV0ZXJzICpw
YXJhbXMpCiB7CiAJc3RydWN0IGN4ZDI4MjByX3ByaXYgKnByaXYgPSBmZS0+ZGVtb2R1bGF0b3Jf
cHJpdjsKIAlzdHJ1Y3QgZHR2X2Zyb250ZW5kX3Byb3BlcnRpZXMgKmMgPSAmZmUtPmR0dl9wcm9w
ZXJ0eV9jYWNoZTsKKwlzdHJ1Y3QgdHVuZXJfc3RhdGUgdHN0YXRlOwogCWludCByZXQsIGk7CiAJ
dTggYnVmWzJdOwogCXUxNiBpZl9jdGw7CkBAIC01NSw4ICs1NiwxOCBAQCBpbnQgY3hkMjgyMHJf
c2V0X2Zyb250ZW5kX2Moc3RydWN0IGR2Yl9mcm9udGVuZCAqZmUsCiAJCWdvdG8gZXJyb3I7CiAK
IAkvKiBwcm9ncmFtIHR1bmVyICovCi0JaWYgKGZlLT5vcHMudHVuZXJfb3BzLnNldF9wYXJhbXMp
Ci0JCWZlLT5vcHMudHVuZXJfb3BzLnNldF9wYXJhbXMoZmUsIHBhcmFtcyk7CisJdHN0YXRlLmRl
bHN5cyA9IFNZU19EVkJDX0FOTkVYX0FDOworCXRzdGF0ZS5mcmVxdWVuY3kgPSBjLT5mcmVxdWVu
Y3k7CisKKwlpZiAoZmUtPm9wcy50dW5lcl9vcHMuc2V0X3N0YXRlKSB7CisJCWZlLT5vcHMudHVu
ZXJfb3BzLnNldF9zdGF0ZShmZSwKKwkJCQkJICAgIERWQkZFX1RVTkVSX0RFTFNZUyAgICB8CisJ
CQkJCSAgICBEVkJGRV9UVU5FUl9GUkVRVUVOQ1ksCisJCQkJCSAgICAmdHN0YXRlKTsKKwl9IGVs
c2UgeworCQlpZiAoZmUtPm9wcy50dW5lcl9vcHMuc2V0X3BhcmFtcykKKwkJCWZlLT5vcHMudHVu
ZXJfb3BzLnNldF9wYXJhbXMoZmUsIHBhcmFtcyk7CisJfQogCiAJaWYgKHByaXYtPmRlbGl2ZXJ5
X3N5c3RlbSAhPSAgU1lTX0RWQkNfQU5ORVhfQUMpIHsKIAkJZm9yIChpID0gMDsgaSA8IEFSUkFZ
X1NJWkUodGFiKTsgaSsrKSB7CmRpZmYgLS1naXQgYS9kcml2ZXJzL21lZGlhL2R2Yi9mcm9udGVu
ZHMvY3hkMjgyMHJfY29yZS5jIGIvZHJpdmVycy9tZWRpYS9kdmIvZnJvbnRlbmRzL2N4ZDI4MjBy
X2NvcmUuYwppbmRleCAwMzY0ODBmLi41YjAxMjBhIDEwMDY0NAotLS0gYS9kcml2ZXJzL21lZGlh
L2R2Yi9mcm9udGVuZHMvY3hkMjgyMHJfY29yZS5jCisrKyBiL2RyaXZlcnMvbWVkaWEvZHZiL2Zy
b250ZW5kcy9jeGQyODIwcl9jb3JlLmMKQEAgLTI0MCw0MyArMjQwLDYgQEAgZXJyb3I6CiAJcmV0
dXJuIHJldDsKIH0KIAotLyogbG9jayBGRSAqLwotc3RhdGljIGludCBjeGQyODIwcl9sb2NrKHN0
cnVjdCBjeGQyODIwcl9wcml2ICpwcml2LCBpbnQgYWN0aXZlX2ZlKQotewotCWludCByZXQgPSAw
OwotCWRiZygiJXM6IGFjdGl2ZV9mZT0lZCIsIF9fZnVuY19fLCBhY3RpdmVfZmUpOwotCi0JbXV0
ZXhfbG9jaygmcHJpdi0+ZmVfbG9jayk7Ci0KLQkvKiAtMT1OT05FLCAwPURWQi1UL1QyLCAxPURW
Qi1DICovCi0JaWYgKHByaXYtPmFjdGl2ZV9mZSA9PSBhY3RpdmVfZmUpCi0JCTsKLQllbHNlIGlm
IChwcml2LT5hY3RpdmVfZmUgPT0gLTEpCi0JCXByaXYtPmFjdGl2ZV9mZSA9IGFjdGl2ZV9mZTsK
LQllbHNlCi0JCXJldCA9IC1FQlVTWTsKLQotCW11dGV4X3VubG9jaygmcHJpdi0+ZmVfbG9jayk7
Ci0KLQlyZXR1cm4gcmV0OwotfQotCi0vKiB1bmxvY2sgRkUgKi8KLXN0YXRpYyB2b2lkIGN4ZDI4
MjByX3VubG9jayhzdHJ1Y3QgY3hkMjgyMHJfcHJpdiAqcHJpdiwgaW50IGFjdGl2ZV9mZSkKLXsK
LQlkYmcoIiVzOiBhY3RpdmVfZmU9JWQiLCBfX2Z1bmNfXywgYWN0aXZlX2ZlKTsKLQotCW11dGV4
X2xvY2soJnByaXYtPmZlX2xvY2spOwotCi0JLyogLTE9Tk9ORSwgMD1EVkItVC9UMiwgMT1EVkIt
QyAqLwotCWlmIChwcml2LT5hY3RpdmVfZmUgPT0gYWN0aXZlX2ZlKQotCQlwcml2LT5hY3RpdmVf
ZmUgPSAtMTsKLQotCW11dGV4X3VubG9jaygmcHJpdi0+ZmVfbG9jayk7Ci0KLQlyZXR1cm47Ci19
Ci0KIC8qIDY0IGJpdCBkaXYgd2l0aCByb3VuZCBjbG9zZXN0LCBsaWtlIERJVl9ST1VORF9DTE9T
RVNUIGJ1dCA2NCBiaXQgKi8KIHUzMiBjeGQyODIwcl9kaXZfdTY0X3JvdW5kX2Nsb3Nlc3QodTY0
IGRpdmlkZW5kLCB1MzIgZGl2aXNvcikKIHsKQEAgLTI4NCwzNzggKzI0NywyMzAgQEAgdTMyIGN4
ZDI4MjByX2Rpdl91NjRfcm91bmRfY2xvc2VzdCh1NjQgZGl2aWRlbmQsIHUzMiBkaXZpc29yKQog
fQogCiBzdGF0aWMgaW50IGN4ZDI4MjByX3NldF9mcm9udGVuZChzdHJ1Y3QgZHZiX2Zyb250ZW5k
ICpmZSwKLQlzdHJ1Y3QgZHZiX2Zyb250ZW5kX3BhcmFtZXRlcnMgKnApCisJCQkJIHN0cnVjdCBk
dmJfZnJvbnRlbmRfcGFyYW1ldGVycyAqcCkKIHsKLQlzdHJ1Y3QgY3hkMjgyMHJfcHJpdiAqcHJp
diA9IGZlLT5kZW1vZHVsYXRvcl9wcml2OwogCXN0cnVjdCBkdHZfZnJvbnRlbmRfcHJvcGVydGll
cyAqYyA9ICZmZS0+ZHR2X3Byb3BlcnR5X2NhY2hlOwogCWludCByZXQ7Ci0JZGJnKCIlczogZGVs
c3lzPSVkIiwgX19mdW5jX18sIGZlLT5kdHZfcHJvcGVydHlfY2FjaGUuZGVsaXZlcnlfc3lzdGVt
KTsKLQotCWlmIChmZS0+b3BzLmluZm8udHlwZSA9PSBGRV9PRkRNKSB7Ci0JCS8qIERWQi1UL1Qy
ICovCi0JCXJldCA9IGN4ZDI4MjByX2xvY2socHJpdiwgMCk7Ci0JCWlmIChyZXQpCi0JCQlyZXR1
cm4gcmV0OwotCi0JCXN3aXRjaCAocHJpdi0+ZGVsaXZlcnlfc3lzdGVtKSB7Ci0JCWNhc2UgU1lT
X1VOREVGSU5FRDoKLQkJCWlmIChjLT5kZWxpdmVyeV9zeXN0ZW0gPT0gU1lTX0RWQlQpIHsKLQkJ
CQkvKiBTTEVFUCA9PiBEVkItVCAqLwotCQkJCXJldCA9IGN4ZDI4MjByX3NldF9mcm9udGVuZF90
KGZlLCBwKTsKLQkJCX0gZWxzZSB7Ci0JCQkJLyogU0xFRVAgPT4gRFZCLVQyICovCi0JCQkJcmV0
ID0gY3hkMjgyMHJfc2V0X2Zyb250ZW5kX3QyKGZlLCBwKTsKLQkJCX0KLQkJCWJyZWFrOwotCQlj
YXNlIFNZU19EVkJUOgotCQkJaWYgKGMtPmRlbGl2ZXJ5X3N5c3RlbSA9PSBTWVNfRFZCVCkgewot
CQkJCS8qIERWQi1UID0+IERWQi1UICovCi0JCQkJcmV0ID0gY3hkMjgyMHJfc2V0X2Zyb250ZW5k
X3QoZmUsIHApOwotCQkJfSBlbHNlIGlmIChjLT5kZWxpdmVyeV9zeXN0ZW0gPT0gU1lTX0RWQlQy
KSB7Ci0JCQkJLyogRFZCLVQgPT4gRFZCLVQyICovCi0JCQkJcmV0ID0gY3hkMjgyMHJfc2xlZXBf
dChmZSk7Ci0JCQkJaWYgKHJldCkKLQkJCQkJYnJlYWs7Ci0JCQkJcmV0ID0gY3hkMjgyMHJfc2V0
X2Zyb250ZW5kX3QyKGZlLCBwKTsKLQkJCX0KLQkJCWJyZWFrOwotCQljYXNlIFNZU19EVkJUMjoK
LQkJCWlmIChjLT5kZWxpdmVyeV9zeXN0ZW0gPT0gU1lTX0RWQlQyKSB7Ci0JCQkJLyogRFZCLVQy
ID0+IERWQi1UMiAqLwotCQkJCXJldCA9IGN4ZDI4MjByX3NldF9mcm9udGVuZF90MihmZSwgcCk7
Ci0JCQl9IGVsc2UgaWYgKGMtPmRlbGl2ZXJ5X3N5c3RlbSA9PSBTWVNfRFZCVCkgewotCQkJCS8q
IERWQi1UMiA9PiBEVkItVCAqLwotCQkJCXJldCA9IGN4ZDI4MjByX3NsZWVwX3QyKGZlKTsKLQkJ
CQlpZiAocmV0KQotCQkJCQlicmVhazsKLQkJCQlyZXQgPSBjeGQyODIwcl9zZXRfZnJvbnRlbmRf
dChmZSwgcCk7Ci0JCQl9Ci0JCQlicmVhazsKLQkJZGVmYXVsdDoKLQkJCWRiZygiJXM6IGVycm9y
IHN0YXRlPSVkIiwgX19mdW5jX18sCi0JCQkJcHJpdi0+ZGVsaXZlcnlfc3lzdGVtKTsKLQkJCXJl
dCA9IC1FSU5WQUw7Ci0JCX0KLQl9IGVsc2UgewotCQkvKiBEVkItQyAqLwotCQlyZXQgPSBjeGQy
ODIwcl9sb2NrKHByaXYsIDEpOwotCQlpZiAocmV0KQotCQkJcmV0dXJuIHJldDsKIAorCWRiZygi
JXM6IGRlbHN5cz0lZCIsIF9fZnVuY19fLCBmZS0+ZHR2X3Byb3BlcnR5X2NhY2hlLmRlbGl2ZXJ5
X3N5c3RlbSk7CisJc3dpdGNoIChjLT5kZWxpdmVyeV9zeXN0ZW0pIHsKKwljYXNlIFNZU19EVkJU
OgorCQlyZXQgPSBjeGQyODIwcl9pbml0X3QoZmUpOworCQlpZiAocmV0IDwgMCkKKwkJCWdvdG8g
ZXJyOworCQlyZXQgPSBjeGQyODIwcl9zZXRfZnJvbnRlbmRfdChmZSwgcCk7CisJCWlmIChyZXQg
PCAwKQorCQkJZ290byBlcnI7CisJCWJyZWFrOworCWNhc2UgU1lTX0RWQlQyOgorCQlyZXQgPSBj
eGQyODIwcl9pbml0X3QoZmUpOworCQlpZiAocmV0IDwgMCkKKwkJCWdvdG8gZXJyOworCQlyZXQg
PSBjeGQyODIwcl9zZXRfZnJvbnRlbmRfdDIoZmUsIHApOworCQlpZiAocmV0IDwgMCkKKwkJCWdv
dG8gZXJyOworCQlicmVhazsKKwljYXNlIFNZU19EVkJDX0FOTkVYX0FDOgorCQlyZXQgPSBjeGQy
ODIwcl9pbml0X2MoZmUpOworCQlpZiAocmV0IDwgMCkKKwkJCWdvdG8gZXJyOwogCQlyZXQgPSBj
eGQyODIwcl9zZXRfZnJvbnRlbmRfYyhmZSwgcCk7CisJCWlmIChyZXQgPCAwKQorCQkJZ290byBl
cnI7CisJCWJyZWFrOworCWRlZmF1bHQ6CisJCWRiZygiJXM6IGVycm9yIHN0YXRlPSVkIiwgX19m
dW5jX18sIGZlLT5kdHZfcHJvcGVydHlfY2FjaGUuZGVsaXZlcnlfc3lzdGVtKTsKKwkJcmV0ID0g
LUVJTlZBTDsKKwkJYnJlYWs7CiAJfQotCitlcnI6CiAJcmV0dXJuIHJldDsKIH0KLQogc3RhdGlj
IGludCBjeGQyODIwcl9yZWFkX3N0YXR1cyhzdHJ1Y3QgZHZiX2Zyb250ZW5kICpmZSwgZmVfc3Rh
dHVzX3QgKnN0YXR1cykKIHsKLQlzdHJ1Y3QgY3hkMjgyMHJfcHJpdiAqcHJpdiA9IGZlLT5kZW1v
ZHVsYXRvcl9wcml2OwogCWludCByZXQ7Ci0JZGJnKCIlczogZGVsc3lzPSVkIiwgX19mdW5jX18s
IGZlLT5kdHZfcHJvcGVydHlfY2FjaGUuZGVsaXZlcnlfc3lzdGVtKTsKLQotCWlmIChmZS0+b3Bz
LmluZm8udHlwZSA9PSBGRV9PRkRNKSB7Ci0JCS8qIERWQi1UL1QyICovCi0JCXJldCA9IGN4ZDI4
MjByX2xvY2socHJpdiwgMCk7Ci0JCWlmIChyZXQpCi0JCQlyZXR1cm4gcmV0OwotCi0JCXN3aXRj
aCAoZmUtPmR0dl9wcm9wZXJ0eV9jYWNoZS5kZWxpdmVyeV9zeXN0ZW0pIHsKLQkJY2FzZSBTWVNf
RFZCVDoKLQkJCXJldCA9IGN4ZDI4MjByX3JlYWRfc3RhdHVzX3QoZmUsIHN0YXR1cyk7Ci0JCQli
cmVhazsKLQkJY2FzZSBTWVNfRFZCVDI6Ci0JCQlyZXQgPSBjeGQyODIwcl9yZWFkX3N0YXR1c190
MihmZSwgc3RhdHVzKTsKLQkJCWJyZWFrOwotCQlkZWZhdWx0OgotCQkJcmV0ID0gLUVJTlZBTDsK
LQkJfQotCX0gZWxzZSB7Ci0JCS8qIERWQi1DICovCi0JCXJldCA9IGN4ZDI4MjByX2xvY2socHJp
diwgMSk7Ci0JCWlmIChyZXQpCi0JCQlyZXR1cm4gcmV0OwogCisJZGJnKCIlczogZGVsc3lzPSVk
IiwgX19mdW5jX18sIGZlLT5kdHZfcHJvcGVydHlfY2FjaGUuZGVsaXZlcnlfc3lzdGVtKTsKKwlz
d2l0Y2ggKGZlLT5kdHZfcHJvcGVydHlfY2FjaGUuZGVsaXZlcnlfc3lzdGVtKSB7CisJY2FzZSBT
WVNfRFZCVDoKKwkJcmV0ID0gY3hkMjgyMHJfcmVhZF9zdGF0dXNfdChmZSwgc3RhdHVzKTsKKwkJ
YnJlYWs7CisJY2FzZSBTWVNfRFZCVDI6CisJCXJldCA9IGN4ZDI4MjByX3JlYWRfc3RhdHVzX3Qy
KGZlLCBzdGF0dXMpOworCQlicmVhazsKKwljYXNlIFNZU19EVkJDX0FOTkVYX0FDOgogCQlyZXQg
PSBjeGQyODIwcl9yZWFkX3N0YXR1c19jKGZlLCBzdGF0dXMpOworCQlicmVhazsKKwlkZWZhdWx0
OgorCQlyZXQgPSAtRUlOVkFMOworCQlicmVhazsKIAl9Ci0KIAlyZXR1cm4gcmV0OwogfQogCiBz
dGF0aWMgaW50IGN4ZDI4MjByX2dldF9mcm9udGVuZChzdHJ1Y3QgZHZiX2Zyb250ZW5kICpmZSwK
LQlzdHJ1Y3QgZHZiX2Zyb250ZW5kX3BhcmFtZXRlcnMgKnApCisJCQkJIHN0cnVjdCBkdmJfZnJv
bnRlbmRfcGFyYW1ldGVycyAqcCkKIHsKLQlzdHJ1Y3QgY3hkMjgyMHJfcHJpdiAqcHJpdiA9IGZl
LT5kZW1vZHVsYXRvcl9wcml2OwogCWludCByZXQ7Ci0JZGJnKCIlczogZGVsc3lzPSVkIiwgX19m
dW5jX18sIGZlLT5kdHZfcHJvcGVydHlfY2FjaGUuZGVsaXZlcnlfc3lzdGVtKTsKLQotCWlmIChm
ZS0+b3BzLmluZm8udHlwZSA9PSBGRV9PRkRNKSB7Ci0JCS8qIERWQi1UL1QyICovCi0JCXJldCA9
IGN4ZDI4MjByX2xvY2socHJpdiwgMCk7Ci0JCWlmIChyZXQpCi0JCQlyZXR1cm4gcmV0OwotCi0J
CXN3aXRjaCAoZmUtPmR0dl9wcm9wZXJ0eV9jYWNoZS5kZWxpdmVyeV9zeXN0ZW0pIHsKLQkJY2Fz
ZSBTWVNfRFZCVDoKLQkJCXJldCA9IGN4ZDI4MjByX2dldF9mcm9udGVuZF90KGZlLCBwKTsKLQkJ
CWJyZWFrOwotCQljYXNlIFNZU19EVkJUMjoKLQkJCXJldCA9IGN4ZDI4MjByX2dldF9mcm9udGVu
ZF90MihmZSwgcCk7Ci0JCQlicmVhazsKLQkJZGVmYXVsdDoKLQkJCXJldCA9IC1FSU5WQUw7Ci0J
CX0KLQl9IGVsc2UgewotCQkvKiBEVkItQyAqLwotCQlyZXQgPSBjeGQyODIwcl9sb2NrKHByaXYs
IDEpOwotCQlpZiAocmV0KQotCQkJcmV0dXJuIHJldDsKIAorCWRiZygiJXM6IGRlbHN5cz0lZCIs
IF9fZnVuY19fLCBmZS0+ZHR2X3Byb3BlcnR5X2NhY2hlLmRlbGl2ZXJ5X3N5c3RlbSk7CisJc3dp
dGNoIChmZS0+ZHR2X3Byb3BlcnR5X2NhY2hlLmRlbGl2ZXJ5X3N5c3RlbSkgeworCWNhc2UgU1lT
X0RWQlQ6CisJCXJldCA9IGN4ZDI4MjByX2dldF9mcm9udGVuZF90KGZlLCBwKTsKKwkJYnJlYWs7
CisJY2FzZSBTWVNfRFZCVDI6CisJCXJldCA9IGN4ZDI4MjByX2dldF9mcm9udGVuZF90MihmZSwg
cCk7CisJCWJyZWFrOworCWNhc2UgU1lTX0RWQkNfQU5ORVhfQUM6CiAJCXJldCA9IGN4ZDI4MjBy
X2dldF9mcm9udGVuZF9jKGZlLCBwKTsKKwkJYnJlYWs7CisJZGVmYXVsdDoKKwkJcmV0ID0gLUVJ
TlZBTDsKKwkJYnJlYWs7CiAJfQotCiAJcmV0dXJuIHJldDsKIH0KIAogc3RhdGljIGludCBjeGQy
ODIwcl9yZWFkX2JlcihzdHJ1Y3QgZHZiX2Zyb250ZW5kICpmZSwgdTMyICpiZXIpCiB7Ci0Jc3Ry
dWN0IGN4ZDI4MjByX3ByaXYgKnByaXYgPSBmZS0+ZGVtb2R1bGF0b3JfcHJpdjsKIAlpbnQgcmV0
OwotCWRiZygiJXM6IGRlbHN5cz0lZCIsIF9fZnVuY19fLCBmZS0+ZHR2X3Byb3BlcnR5X2NhY2hl
LmRlbGl2ZXJ5X3N5c3RlbSk7Ci0KLQlpZiAoZmUtPm9wcy5pbmZvLnR5cGUgPT0gRkVfT0ZETSkg
ewotCQkvKiBEVkItVC9UMiAqLwotCQlyZXQgPSBjeGQyODIwcl9sb2NrKHByaXYsIDApOwotCQlp
ZiAocmV0KQotCQkJcmV0dXJuIHJldDsKLQotCQlzd2l0Y2ggKGZlLT5kdHZfcHJvcGVydHlfY2Fj
aGUuZGVsaXZlcnlfc3lzdGVtKSB7Ci0JCWNhc2UgU1lTX0RWQlQ6Ci0JCQlyZXQgPSBjeGQyODIw
cl9yZWFkX2Jlcl90KGZlLCBiZXIpOwotCQkJYnJlYWs7Ci0JCWNhc2UgU1lTX0RWQlQyOgotCQkJ
cmV0ID0gY3hkMjgyMHJfcmVhZF9iZXJfdDIoZmUsIGJlcik7Ci0JCQlicmVhazsKLQkJZGVmYXVs
dDoKLQkJCXJldCA9IC1FSU5WQUw7Ci0JCX0KLQl9IGVsc2UgewotCQkvKiBEVkItQyAqLwotCQly
ZXQgPSBjeGQyODIwcl9sb2NrKHByaXYsIDEpOwotCQlpZiAocmV0KQotCQkJcmV0dXJuIHJldDsK
IAorCWRiZygiJXM6IGRlbHN5cz0lZCIsIF9fZnVuY19fLCBmZS0+ZHR2X3Byb3BlcnR5X2NhY2hl
LmRlbGl2ZXJ5X3N5c3RlbSk7CisJc3dpdGNoIChmZS0+ZHR2X3Byb3BlcnR5X2NhY2hlLmRlbGl2
ZXJ5X3N5c3RlbSkgeworCWNhc2UgU1lTX0RWQlQ6CisJCXJldCA9IGN4ZDI4MjByX3JlYWRfYmVy
X3QoZmUsIGJlcik7CisJCWJyZWFrOworCWNhc2UgU1lTX0RWQlQyOgorCQlyZXQgPSBjeGQyODIw
cl9yZWFkX2Jlcl90MihmZSwgYmVyKTsKKwkJYnJlYWs7CisJY2FzZSBTWVNfRFZCQ19BTk5FWF9B
QzoKIAkJcmV0ID0gY3hkMjgyMHJfcmVhZF9iZXJfYyhmZSwgYmVyKTsKKwkJYnJlYWs7CisJZGVm
YXVsdDoKKwkJcmV0ID0gLUVJTlZBTDsKKwkJYnJlYWs7CiAJfQotCiAJcmV0dXJuIHJldDsKIH0K
IAogc3RhdGljIGludCBjeGQyODIwcl9yZWFkX3NpZ25hbF9zdHJlbmd0aChzdHJ1Y3QgZHZiX2Zy
b250ZW5kICpmZSwgdTE2ICpzdHJlbmd0aCkKIHsKLQlzdHJ1Y3QgY3hkMjgyMHJfcHJpdiAqcHJp
diA9IGZlLT5kZW1vZHVsYXRvcl9wcml2OwogCWludCByZXQ7Ci0JZGJnKCIlczogZGVsc3lzPSVk
IiwgX19mdW5jX18sIGZlLT5kdHZfcHJvcGVydHlfY2FjaGUuZGVsaXZlcnlfc3lzdGVtKTsKLQot
CWlmIChmZS0+b3BzLmluZm8udHlwZSA9PSBGRV9PRkRNKSB7Ci0JCS8qIERWQi1UL1QyICovCi0J
CXJldCA9IGN4ZDI4MjByX2xvY2socHJpdiwgMCk7Ci0JCWlmIChyZXQpCi0JCQlyZXR1cm4gcmV0
OwotCi0JCXN3aXRjaCAoZmUtPmR0dl9wcm9wZXJ0eV9jYWNoZS5kZWxpdmVyeV9zeXN0ZW0pIHsK
LQkJY2FzZSBTWVNfRFZCVDoKLQkJCXJldCA9IGN4ZDI4MjByX3JlYWRfc2lnbmFsX3N0cmVuZ3Ro
X3QoZmUsIHN0cmVuZ3RoKTsKLQkJCWJyZWFrOwotCQljYXNlIFNZU19EVkJUMjoKLQkJCXJldCA9
IGN4ZDI4MjByX3JlYWRfc2lnbmFsX3N0cmVuZ3RoX3QyKGZlLCBzdHJlbmd0aCk7Ci0JCQlicmVh
azsKLQkJZGVmYXVsdDoKLQkJCXJldCA9IC1FSU5WQUw7Ci0JCX0KLQl9IGVsc2UgewotCQkvKiBE
VkItQyAqLwotCQlyZXQgPSBjeGQyODIwcl9sb2NrKHByaXYsIDEpOwotCQlpZiAocmV0KQotCQkJ
cmV0dXJuIHJldDsKIAorCWRiZygiJXM6IGRlbHN5cz0lZCIsIF9fZnVuY19fLCBmZS0+ZHR2X3By
b3BlcnR5X2NhY2hlLmRlbGl2ZXJ5X3N5c3RlbSk7CisJc3dpdGNoIChmZS0+ZHR2X3Byb3BlcnR5
X2NhY2hlLmRlbGl2ZXJ5X3N5c3RlbSkgeworCWNhc2UgU1lTX0RWQlQ6CisJCXJldCA9IGN4ZDI4
MjByX3JlYWRfc2lnbmFsX3N0cmVuZ3RoX3QoZmUsIHN0cmVuZ3RoKTsKKwkJYnJlYWs7CisJY2Fz
ZSBTWVNfRFZCVDI6CisJCXJldCA9IGN4ZDI4MjByX3JlYWRfc2lnbmFsX3N0cmVuZ3RoX3QyKGZl
LCBzdHJlbmd0aCk7CisJCWJyZWFrOworCWNhc2UgU1lTX0RWQkNfQU5ORVhfQUM6CiAJCXJldCA9
IGN4ZDI4MjByX3JlYWRfc2lnbmFsX3N0cmVuZ3RoX2MoZmUsIHN0cmVuZ3RoKTsKKwkJYnJlYWs7
CisJZGVmYXVsdDoKKwkJcmV0ID0gLUVJTlZBTDsKKwkJYnJlYWs7CiAJfQotCiAJcmV0dXJuIHJl
dDsKIH0KIAogc3RhdGljIGludCBjeGQyODIwcl9yZWFkX3NucihzdHJ1Y3QgZHZiX2Zyb250ZW5k
ICpmZSwgdTE2ICpzbnIpCiB7Ci0Jc3RydWN0IGN4ZDI4MjByX3ByaXYgKnByaXYgPSBmZS0+ZGVt
b2R1bGF0b3JfcHJpdjsKIAlpbnQgcmV0OwotCWRiZygiJXM6IGRlbHN5cz0lZCIsIF9fZnVuY19f
LCBmZS0+ZHR2X3Byb3BlcnR5X2NhY2hlLmRlbGl2ZXJ5X3N5c3RlbSk7Ci0KLQlpZiAoZmUtPm9w
cy5pbmZvLnR5cGUgPT0gRkVfT0ZETSkgewotCQkvKiBEVkItVC9UMiAqLwotCQlyZXQgPSBjeGQy
ODIwcl9sb2NrKHByaXYsIDApOwotCQlpZiAocmV0KQotCQkJcmV0dXJuIHJldDsKLQotCQlzd2l0
Y2ggKGZlLT5kdHZfcHJvcGVydHlfY2FjaGUuZGVsaXZlcnlfc3lzdGVtKSB7Ci0JCWNhc2UgU1lT
X0RWQlQ6Ci0JCQlyZXQgPSBjeGQyODIwcl9yZWFkX3Nucl90KGZlLCBzbnIpOwotCQkJYnJlYWs7
Ci0JCWNhc2UgU1lTX0RWQlQyOgotCQkJcmV0ID0gY3hkMjgyMHJfcmVhZF9zbnJfdDIoZmUsIHNu
cik7Ci0JCQlicmVhazsKLQkJZGVmYXVsdDoKLQkJCXJldCA9IC1FSU5WQUw7Ci0JCX0KLQl9IGVs
c2UgewotCQkvKiBEVkItQyAqLwotCQlyZXQgPSBjeGQyODIwcl9sb2NrKHByaXYsIDEpOwotCQlp
ZiAocmV0KQotCQkJcmV0dXJuIHJldDsKIAorCWRiZygiJXM6IGRlbHN5cz0lZCIsIF9fZnVuY19f
LCBmZS0+ZHR2X3Byb3BlcnR5X2NhY2hlLmRlbGl2ZXJ5X3N5c3RlbSk7CisJc3dpdGNoIChmZS0+
ZHR2X3Byb3BlcnR5X2NhY2hlLmRlbGl2ZXJ5X3N5c3RlbSkgeworCWNhc2UgU1lTX0RWQlQ6CisJ
CXJldCA9IGN4ZDI4MjByX3JlYWRfc25yX3QoZmUsIHNucik7CisJCWJyZWFrOworCWNhc2UgU1lT
X0RWQlQyOgorCQlyZXQgPSBjeGQyODIwcl9yZWFkX3Nucl90MihmZSwgc25yKTsKKwkJYnJlYWs7
CisJY2FzZSBTWVNfRFZCQ19BTk5FWF9BQzoKIAkJcmV0ID0gY3hkMjgyMHJfcmVhZF9zbnJfYyhm
ZSwgc25yKTsKKwkJYnJlYWs7CisJZGVmYXVsdDoKKwkJcmV0ID0gLUVJTlZBTDsKKwkJYnJlYWs7
CiAJfQotCiAJcmV0dXJuIHJldDsKIH0KIAogc3RhdGljIGludCBjeGQyODIwcl9yZWFkX3VjYmxv
Y2tzKHN0cnVjdCBkdmJfZnJvbnRlbmQgKmZlLCB1MzIgKnVjYmxvY2tzKQogewotCXN0cnVjdCBj
eGQyODIwcl9wcml2ICpwcml2ID0gZmUtPmRlbW9kdWxhdG9yX3ByaXY7CiAJaW50IHJldDsKLQlk
YmcoIiVzOiBkZWxzeXM9JWQiLCBfX2Z1bmNfXywgZmUtPmR0dl9wcm9wZXJ0eV9jYWNoZS5kZWxp
dmVyeV9zeXN0ZW0pOwotCi0JaWYgKGZlLT5vcHMuaW5mby50eXBlID09IEZFX09GRE0pIHsKLQkJ
LyogRFZCLVQvVDIgKi8KLQkJcmV0ID0gY3hkMjgyMHJfbG9jayhwcml2LCAwKTsKLQkJaWYgKHJl
dCkKLQkJCXJldHVybiByZXQ7Ci0KLQkJc3dpdGNoIChmZS0+ZHR2X3Byb3BlcnR5X2NhY2hlLmRl
bGl2ZXJ5X3N5c3RlbSkgewotCQljYXNlIFNZU19EVkJUOgotCQkJcmV0ID0gY3hkMjgyMHJfcmVh
ZF91Y2Jsb2Nrc190KGZlLCB1Y2Jsb2Nrcyk7Ci0JCQlicmVhazsKLQkJY2FzZSBTWVNfRFZCVDI6
Ci0JCQlyZXQgPSBjeGQyODIwcl9yZWFkX3VjYmxvY2tzX3QyKGZlLCB1Y2Jsb2Nrcyk7Ci0JCQli
cmVhazsKLQkJZGVmYXVsdDoKLQkJCXJldCA9IC1FSU5WQUw7Ci0JCX0KLQl9IGVsc2UgewotCQkv
KiBEVkItQyAqLwotCQlyZXQgPSBjeGQyODIwcl9sb2NrKHByaXYsIDEpOwotCQlpZiAocmV0KQot
CQkJcmV0dXJuIHJldDsKIAorCWRiZygiJXM6IGRlbHN5cz0lZCIsIF9fZnVuY19fLCBmZS0+ZHR2
X3Byb3BlcnR5X2NhY2hlLmRlbGl2ZXJ5X3N5c3RlbSk7CisJc3dpdGNoIChmZS0+ZHR2X3Byb3Bl
cnR5X2NhY2hlLmRlbGl2ZXJ5X3N5c3RlbSkgeworCWNhc2UgU1lTX0RWQlQ6CisJCXJldCA9IGN4
ZDI4MjByX3JlYWRfdWNibG9ja3NfdChmZSwgdWNibG9ja3MpOworCQlicmVhazsKKwljYXNlIFNZ
U19EVkJUMjoKKwkJcmV0ID0gY3hkMjgyMHJfcmVhZF91Y2Jsb2Nrc190MihmZSwgdWNibG9ja3Mp
OworCQlicmVhazsKKwljYXNlIFNZU19EVkJDX0FOTkVYX0FDOgogCQlyZXQgPSBjeGQyODIwcl9y
ZWFkX3VjYmxvY2tzX2MoZmUsIHVjYmxvY2tzKTsKKwkJYnJlYWs7CisJZGVmYXVsdDoKKwkJcmV0
ID0gLUVJTlZBTDsKKwkJYnJlYWs7CiAJfQotCiAJcmV0dXJuIHJldDsKIH0KIAogc3RhdGljIGlu
dCBjeGQyODIwcl9pbml0KHN0cnVjdCBkdmJfZnJvbnRlbmQgKmZlKQogewotCXN0cnVjdCBjeGQy
ODIwcl9wcml2ICpwcml2ID0gZmUtPmRlbW9kdWxhdG9yX3ByaXY7Ci0JaW50IHJldDsKLQlkYmco
IiVzOiBkZWxzeXM9JWQiLCBfX2Z1bmNfXywgZmUtPmR0dl9wcm9wZXJ0eV9jYWNoZS5kZWxpdmVy
eV9zeXN0ZW0pOwotCi0JcHJpdi0+ZGVsaXZlcnlfc3lzdGVtID0gU1lTX1VOREVGSU5FRDsKLQkv
KiBkZWxpdmVyeSBzeXN0ZW0gaXMgdW5rbm93biBhdCB0aGF0IChpbml0KSBwaGFzZSAqLwotCi0J
aWYgKGZlLT5vcHMuaW5mby50eXBlID09IEZFX09GRE0pIHsKLQkJLyogRFZCLVQvVDIgKi8KLQkJ
cmV0ID0gY3hkMjgyMHJfbG9jayhwcml2LCAwKTsKLQkJaWYgKHJldCkKLQkJCXJldHVybiByZXQ7
Ci0KLQkJcmV0ID0gY3hkMjgyMHJfaW5pdF90KGZlKTsKLQl9IGVsc2UgewotCQkvKiBEVkItQyAq
LwotCQlyZXQgPSBjeGQyODIwcl9sb2NrKHByaXYsIDEpOwotCQlpZiAocmV0KQotCQkJcmV0dXJu
IHJldDsKLQotCQlyZXQgPSBjeGQyODIwcl9pbml0X2MoZmUpOwotCX0KLQotCXJldHVybiByZXQ7
CisJcmV0dXJuIDA7CiB9CiAKIHN0YXRpYyBpbnQgY3hkMjgyMHJfc2xlZXAoc3RydWN0IGR2Yl9m
cm9udGVuZCAqZmUpCiB7Ci0Jc3RydWN0IGN4ZDI4MjByX3ByaXYgKnByaXYgPSBmZS0+ZGVtb2R1
bGF0b3JfcHJpdjsKIAlpbnQgcmV0OwotCWRiZygiJXM6IGRlbHN5cz0lZCIsIF9fZnVuY19fLCBm
ZS0+ZHR2X3Byb3BlcnR5X2NhY2hlLmRlbGl2ZXJ5X3N5c3RlbSk7Ci0KLQlpZiAoZmUtPm9wcy5p
bmZvLnR5cGUgPT0gRkVfT0ZETSkgewotCQkvKiBEVkItVC9UMiAqLwotCQlyZXQgPSBjeGQyODIw
cl9sb2NrKHByaXYsIDApOwotCQlpZiAocmV0KQotCQkJcmV0dXJuIHJldDsKLQotCQlzd2l0Y2gg
KGZlLT5kdHZfcHJvcGVydHlfY2FjaGUuZGVsaXZlcnlfc3lzdGVtKSB7Ci0JCWNhc2UgU1lTX0RW
QlQ6Ci0JCQlyZXQgPSBjeGQyODIwcl9zbGVlcF90KGZlKTsKLQkJCWJyZWFrOwotCQljYXNlIFNZ
U19EVkJUMjoKLQkJCXJldCA9IGN4ZDI4MjByX3NsZWVwX3QyKGZlKTsKLQkJCWJyZWFrOwotCQlk
ZWZhdWx0OgotCQkJcmV0ID0gLUVJTlZBTDsKLQkJfQotCi0JCWN4ZDI4MjByX3VubG9jayhwcml2
LCAwKTsKLQl9IGVsc2UgewotCQkvKiBEVkItQyAqLwotCQlyZXQgPSBjeGQyODIwcl9sb2NrKHBy
aXYsIDEpOwotCQlpZiAocmV0KQotCQkJcmV0dXJuIHJldDsKIAorCWRiZygiJXM6IGRlbHN5cz0l
ZCIsIF9fZnVuY19fLCBmZS0+ZHR2X3Byb3BlcnR5X2NhY2hlLmRlbGl2ZXJ5X3N5c3RlbSk7CisJ
c3dpdGNoIChmZS0+ZHR2X3Byb3BlcnR5X2NhY2hlLmRlbGl2ZXJ5X3N5c3RlbSkgeworCWNhc2Ug
U1lTX0RWQlQ6CisJCXJldCA9IGN4ZDI4MjByX3NsZWVwX3QoZmUpOworCQlicmVhazsKKwljYXNl
IFNZU19EVkJUMjoKKwkJcmV0ID0gY3hkMjgyMHJfc2xlZXBfdDIoZmUpOworCQlicmVhazsKKwlj
YXNlIFNZU19EVkJDX0FOTkVYX0FDOgogCQlyZXQgPSBjeGQyODIwcl9zbGVlcF9jKGZlKTsKLQot
CQljeGQyODIwcl91bmxvY2socHJpdiwgMSk7CisJCWJyZWFrOworCWRlZmF1bHQ6CisJCXJldCA9
IC1FSU5WQUw7CisJCWJyZWFrOwogCX0KLQogCXJldHVybiByZXQ7CiB9CiAKIHN0YXRpYyBpbnQg
Y3hkMjgyMHJfZ2V0X3R1bmVfc2V0dGluZ3Moc3RydWN0IGR2Yl9mcm9udGVuZCAqZmUsCi0Jc3Ry
dWN0IGR2Yl9mcm9udGVuZF90dW5lX3NldHRpbmdzICpzKQorCQkJCSAgICAgIHN0cnVjdCBkdmJf
ZnJvbnRlbmRfdHVuZV9zZXR0aW5ncyAqcykKIHsKLQlzdHJ1Y3QgY3hkMjgyMHJfcHJpdiAqcHJp
diA9IGZlLT5kZW1vZHVsYXRvcl9wcml2OwogCWludCByZXQ7Ci0JZGJnKCIlczogZGVsc3lzPSVk
IiwgX19mdW5jX18sIGZlLT5kdHZfcHJvcGVydHlfY2FjaGUuZGVsaXZlcnlfc3lzdGVtKTsKLQot
CWlmIChmZS0+b3BzLmluZm8udHlwZSA9PSBGRV9PRkRNKSB7Ci0JCS8qIERWQi1UL1QyICovCi0J
CXJldCA9IGN4ZDI4MjByX2xvY2socHJpdiwgMCk7Ci0JCWlmIChyZXQpCi0JCQlyZXR1cm4gcmV0
OwotCi0JCXN3aXRjaCAoZmUtPmR0dl9wcm9wZXJ0eV9jYWNoZS5kZWxpdmVyeV9zeXN0ZW0pIHsK
LQkJY2FzZSBTWVNfRFZCVDoKLQkJCXJldCA9IGN4ZDI4MjByX2dldF90dW5lX3NldHRpbmdzX3Qo
ZmUsIHMpOwotCQkJYnJlYWs7Ci0JCWNhc2UgU1lTX0RWQlQyOgotCQkJcmV0ID0gY3hkMjgyMHJf
Z2V0X3R1bmVfc2V0dGluZ3NfdDIoZmUsIHMpOwotCQkJYnJlYWs7Ci0JCWRlZmF1bHQ6Ci0JCQly
ZXQgPSAtRUlOVkFMOwotCQl9Ci0JfSBlbHNlIHsKLQkJLyogRFZCLUMgKi8KLQkJcmV0ID0gY3hk
MjgyMHJfbG9jayhwcml2LCAxKTsKLQkJaWYgKHJldCkKLQkJCXJldHVybiByZXQ7CiAKKwlkYmco
IiVzOiBkZWxzeXM9JWQiLCBfX2Z1bmNfXywgZmUtPmR0dl9wcm9wZXJ0eV9jYWNoZS5kZWxpdmVy
eV9zeXN0ZW0pOworCXN3aXRjaCAoZmUtPmR0dl9wcm9wZXJ0eV9jYWNoZS5kZWxpdmVyeV9zeXN0
ZW0pIHsKKwljYXNlIFNZU19EVkJUOgorCQlyZXQgPSBjeGQyODIwcl9nZXRfdHVuZV9zZXR0aW5n
c190KGZlLCBzKTsKKwkJYnJlYWs7CisJY2FzZSBTWVNfRFZCVDI6CisJCXJldCA9IGN4ZDI4MjBy
X2dldF90dW5lX3NldHRpbmdzX3QyKGZlLCBzKTsKKwkJYnJlYWs7CisJY2FzZSBTWVNfRFZCQ19B
Tk5FWF9BQzoKIAkJcmV0ID0gY3hkMjgyMHJfZ2V0X3R1bmVfc2V0dGluZ3NfYyhmZSwgcyk7CisJ
CWJyZWFrOworCWRlZmF1bHQ6CisJCXJldCA9IC1FSU5WQUw7CisJCWJyZWFrOwogCX0KLQogCXJl
dHVybiByZXQ7CiB9CiAKIHN0YXRpYyBlbnVtIGR2YmZlX3NlYXJjaCBjeGQyODIwcl9zZWFyY2go
c3RydWN0IGR2Yl9mcm9udGVuZCAqZmUsCi0Jc3RydWN0IGR2Yl9mcm9udGVuZF9wYXJhbWV0ZXJz
ICpwKQorCQkJCQkgc3RydWN0IGR2Yl9mcm9udGVuZF9wYXJhbWV0ZXJzICpwKQogewogCXN0cnVj
dCBjeGQyODIwcl9wcml2ICpwcml2ID0gZmUtPmRlbW9kdWxhdG9yX3ByaXY7CiAJc3RydWN0IGR0
dl9mcm9udGVuZF9wcm9wZXJ0aWVzICpjID0gJmZlLT5kdHZfcHJvcGVydHlfY2FjaGU7CkBAIC02
NjQsNyArNDc5LDcgQEAgc3RhdGljIGVudW0gZHZiZmVfc2VhcmNoIGN4ZDI4MjByX3NlYXJjaChz
dHJ1Y3QgZHZiX2Zyb250ZW5kICpmZSwKIAlkYmcoIiVzOiBkZWxzeXM9JWQiLCBfX2Z1bmNfXywg
ZmUtPmR0dl9wcm9wZXJ0eV9jYWNoZS5kZWxpdmVyeV9zeXN0ZW0pOwogCiAJLyogc3dpdGNoIGJl
dHdlZW4gRFZCLVQgYW5kIERWQi1UMiB3aGVuIHR1bmUgZmFpbHMgKi8KLQlpZiAocHJpdi0+bGFz
dF90dW5lX2ZhaWxlZCkgeworCWlmIChwcml2LT5sYXN0X3R1bmVfZmFpbGVkICYmIChwcml2LT5k
ZWxpdmVyeV9zeXN0ZW0gIT0gU1lTX0RWQkNfQU5ORVhfQUMpKSB7CiAJCWlmIChwcml2LT5kZWxp
dmVyeV9zeXN0ZW0gPT0gU1lTX0RWQlQpCiAJCQljLT5kZWxpdmVyeV9zeXN0ZW0gPSBTWVNfRFZC
VDI7CiAJCWVsc2UKQEAgLTcyNyw5ICs1NDIsNyBAQCBzdGF0aWMgdm9pZCBjeGQyODIwcl9yZWxl
YXNlKHN0cnVjdCBkdmJfZnJvbnRlbmQgKmZlKQogCXN0cnVjdCBjeGQyODIwcl9wcml2ICpwcml2
ID0gZmUtPmRlbW9kdWxhdG9yX3ByaXY7CiAJZGJnKCIlcyIsIF9fZnVuY19fKTsKIAotCWlmIChm
ZS0+b3BzLmluZm8udHlwZSA9PSBGRV9PRkRNKQotCQlrZnJlZShwcml2KTsKLQorCWtmcmVlKHBy
aXYpOwogCXJldHVybjsKIH0KIApAQCAtNzQyLDEyOCArNTU1LDk4IEBAIHN0YXRpYyBpbnQgY3hk
MjgyMHJfaTJjX2dhdGVfY3RybChzdHJ1Y3QgZHZiX2Zyb250ZW5kICpmZSwgaW50IGVuYWJsZSkK
IAlyZXR1cm4gY3hkMjgyMHJfd3JfcmVnX21hc2socHJpdiwgMHhkYiwgZW5hYmxlID8gMSA6IDAs
IDB4MSk7CiB9CiAKLXN0YXRpYyBjb25zdCBzdHJ1Y3QgZHZiX2Zyb250ZW5kX29wcyBjeGQyODIw
cl9vcHNbMl07Ci0KLXN0cnVjdCBkdmJfZnJvbnRlbmQgKmN4ZDI4MjByX2F0dGFjaChjb25zdCBz
dHJ1Y3QgY3hkMjgyMHJfY29uZmlnICpjZmcsCi0Jc3RydWN0IGkyY19hZGFwdGVyICppMmMsIHN0
cnVjdCBkdmJfZnJvbnRlbmQgKmZlKQorc3RhdGljIGludCBjeGQyODIwcl9nZXRfcHJvcGVydHko
c3RydWN0IGR2Yl9mcm9udGVuZCAqZmUsIHN0cnVjdCBkdHZfcHJvcGVydHkgKnApCiB7Ci0JaW50
IHJldDsKLQlzdHJ1Y3QgY3hkMjgyMHJfcHJpdiAqcHJpdiA9IE5VTEw7Ci0JdTggdG1wOworCWRi
ZygiJXMoKVxuIiwgX19mdW5jX18pOworCisJc3dpdGNoIChwLT5jbWQpIHsKKwljYXNlIERUVl9F
TlVNX0RFTFNZUzoKKwkJcC0+dS5idWZmZXIuZGF0YVswXSA9IFNZU19EVkJUOworCQlwLT51LmJ1
ZmZlci5kYXRhWzFdID0gU1lTX0RWQlQyOworCQlwLT51LmJ1ZmZlci5kYXRhWzJdID0gU1lTX0RW
QkNfQU5ORVhfQUM7CisJCXAtPnUuYnVmZmVyLmxlbiA9IDM7CisJCWJyZWFrOworCWRlZmF1bHQ6
CisJCWJyZWFrOworCX0KKwlyZXR1cm4gMDsKK30KIAotCWlmIChmZSA9PSBOVUxMKSB7Ci0JCS8q
IEZFMCAqLwotCQkvKiBhbGxvY2F0ZSBtZW1vcnkgZm9yIHRoZSBpbnRlcm5hbCBwcml2ICovCi0J
CXByaXYgPSBremFsbG9jKHNpemVvZihzdHJ1Y3QgY3hkMjgyMHJfcHJpdiksIEdGUF9LRVJORUwp
OwotCQlpZiAocHJpdiA9PSBOVUxMKQotCQkJZ290byBlcnJvcjsKK3N0YXRpYyBjb25zdCBzdHJ1
Y3QgZHZiX2Zyb250ZW5kX29wcyBjeGQyODIwcl9vcHMgPSB7CisJLyogZGVmYXVsdDogRFZCLVQv
VDIgKi8KKwkuaW5mbyA9IHsKKwkJLm5hbWUgPSAiU29ueSBDWEQyODIwUiAoRFZCLVQvVDIpIiwK
KwkJLnR5cGUgPSBGRV9PRkRNLAorCisJCS5jYXBzID0JRkVfQ0FOX0ZFQ18xXzIJCQl8CisJCQlG
RV9DQU5fRkVDXzJfMwkJCXwKKwkJCUZFX0NBTl9GRUNfM180CQkJfAorCQkJRkVfQ0FOX0ZFQ181
XzYJCQl8CisJCQlGRV9DQU5fRkVDXzdfOAkJCXwKKwkJCUZFX0NBTl9GRUNfQVVUTwkJCXwKKwkJ
CUZFX0NBTl9RUFNLCQkJfAorCQkJRkVfQ0FOX1FBTV8xNgkJCXwKKwkJCUZFX0NBTl9RQU1fNjQJ
CQl8CisJCQlGRV9DQU5fUUFNXzI1NgkJCXwKKwkJCUZFX0NBTl9RQU1fQVVUTwkJCXwKKwkJCUZF
X0NBTl9UUkFOU01JU1NJT05fTU9ERV9BVVRPCXwKKwkJCUZFX0NBTl9HVUFSRF9JTlRFUlZBTF9B
VVRPCXwKKwkJCUZFX0NBTl9ISUVSQVJDSFlfQVVUTwkJfAorCQkJRkVfQ0FOX01VVEVfVFMJCQl8
CisJCQlGRV9DQU5fMkdfTU9EVUxBVElPTgorCQl9LAogCi0JCS8qIHNldHVwIHRoZSBwcml2ICov
Ci0JCXByaXYtPmkyYyA9IGkyYzsKLQkJbWVtY3B5KCZwcml2LT5jZmcsIGNmZywgc2l6ZW9mKHN0
cnVjdCBjeGQyODIwcl9jb25maWcpKTsKLQkJbXV0ZXhfaW5pdCgmcHJpdi0+ZmVfbG9jayk7CisJ
LnJlbGVhc2UJCT0gY3hkMjgyMHJfcmVsZWFzZSwKKwkuaW5pdAkJCT0gY3hkMjgyMHJfaW5pdCwK
Kwkuc2xlZXAJCQk9IGN4ZDI4MjByX3NsZWVwLAogCi0JCXByaXYtPmFjdGl2ZV9mZSA9IC0xOyAv
KiBOT05FICovCisJLmdldF90dW5lX3NldHRpbmdzCT0gY3hkMjgyMHJfZ2V0X3R1bmVfc2V0dGlu
Z3MsCisJLmkyY19nYXRlX2N0cmwJCT0gY3hkMjgyMHJfaTJjX2dhdGVfY3RybCwKIAotCQkvKiBj
aGVjayBpZiB0aGUgZGVtb2QgaXMgdGhlcmUgKi8KLQkJcHJpdi0+YmFua1swXSA9IHByaXYtPmJh
bmtbMV0gPSAweGZmOwotCQlyZXQgPSBjeGQyODIwcl9yZF9yZWcocHJpdiwgMHgwMDBmZCwgJnRt
cCk7Ci0JCWRiZygiJXM6IGNoaXAgaWQ9JTAyeCIsIF9fZnVuY19fLCB0bXApOwotCQlpZiAocmV0
IHx8IHRtcCAhPSAweGUxKQotCQkJZ290byBlcnJvcjsKKwkuZ2V0X2Zyb250ZW5kCQk9IGN4ZDI4
MjByX2dldF9mcm9udGVuZCwKIAotCQkvKiBjcmVhdGUgZnJvbnRlbmRzICovCi0JCW1lbWNweSgm
cHJpdi0+ZmVbMF0ub3BzLCAmY3hkMjgyMHJfb3BzWzBdLAotCQkJc2l6ZW9mKHN0cnVjdCBkdmJf
ZnJvbnRlbmRfb3BzKSk7Ci0JCW1lbWNweSgmcHJpdi0+ZmVbMV0ub3BzLCAmY3hkMjgyMHJfb3Bz
WzFdLAotCQkJc2l6ZW9mKHN0cnVjdCBkdmJfZnJvbnRlbmRfb3BzKSk7CisJLmdldF9mcm9udGVu
ZF9hbGdvCT0gY3hkMjgyMHJfZ2V0X2Zyb250ZW5kX2FsZ28sCisJLnNlYXJjaAkJCT0gY3hkMjgy
MHJfc2VhcmNoLAogCi0JCXByaXYtPmZlWzBdLmRlbW9kdWxhdG9yX3ByaXYgPSBwcml2OwotCQlw
cml2LT5mZVsxXS5kZW1vZHVsYXRvcl9wcml2ID0gcHJpdjsKKwkucmVhZF9zdGF0dXMJCT0gY3hk
MjgyMHJfcmVhZF9zdGF0dXMsCisJLnJlYWRfc25yCQk9IGN4ZDI4MjByX3JlYWRfc25yLAorCS5y
ZWFkX2JlcgkJPSBjeGQyODIwcl9yZWFkX2JlciwKKwkucmVhZF91Y2Jsb2NrcwkJPSBjeGQyODIw
cl9yZWFkX3VjYmxvY2tzLAorCS5yZWFkX3NpZ25hbF9zdHJlbmd0aAk9IGN4ZDI4MjByX3JlYWRf
c2lnbmFsX3N0cmVuZ3RoLAogCi0JCXJldHVybiAmcHJpdi0+ZmVbMF07CisJLmdldF9wcm9wZXJ0
eQkJPSBjeGQyODIwcl9nZXRfcHJvcGVydHksCit9OwogCi0JfSBlbHNlIHsKLQkJLyogRkUxOiBG
RTAgZ2l2ZW4gYXMgcG9pbnRlciwganVzdCByZXR1cm4gRkUxIHdlIGhhdmUKLQkJICogYWxyZWFk
eSBjcmVhdGVkICovCi0JCXByaXYgPSBmZS0+ZGVtb2R1bGF0b3JfcHJpdjsKLQkJcmV0dXJuICZw
cml2LT5mZVsxXTsKLQl9CitzdHJ1Y3QgZHZiX2Zyb250ZW5kICpjeGQyODIwcl9hdHRhY2goY29u
c3Qgc3RydWN0IGN4ZDI4MjByX2NvbmZpZyAqY2ZnLAorCQkJCSAgICAgc3RydWN0IGkyY19hZGFw
dGVyICppMmMsCisJCQkJICAgICBzdHJ1Y3QgZHZiX2Zyb250ZW5kICpmZSkKK3sKKwlzdHJ1Y3Qg
Y3hkMjgyMHJfcHJpdiAqcHJpdiA9IE5VTEw7CisJaW50IHJldDsKKwl1OCB0bXA7CisKKwlwcml2
ID0ga3phbGxvYyhzaXplb2YgKHN0cnVjdCBjeGQyODIwcl9wcml2KSwgR0ZQX0tFUk5FTCk7CisJ
aWYgKCFwcml2KQorCQlnb3RvIGVycm9yOwogCisJcHJpdi0+aTJjID0gaTJjOworCW1lbWNweSgm
cHJpdi0+Y2ZnLCBjZmcsIHNpemVvZiAoc3RydWN0IGN4ZDI4MjByX2NvbmZpZykpOworCisJcHJp
di0+YmFua1swXSA9IHByaXYtPmJhbmtbMV0gPSAweGZmOworCXJldCA9IGN4ZDI4MjByX3JkX3Jl
Zyhwcml2LCAweDAwMGZkLCAmdG1wKTsKKwlkYmcoIiVzOiBjaGlwIGlkPSUwMngiLCBfX2Z1bmNf
XywgdG1wKTsKKwlpZiAocmV0IHx8IHRtcCAhPSAweGUxKQorCQlnb3RvIGVycm9yOworCisJbWVt
Y3B5KCZwcml2LT5mZS5vcHMsICZjeGQyODIwcl9vcHMsIHNpemVvZiAoc3RydWN0IGR2Yl9mcm9u
dGVuZF9vcHMpKTsKKwlwcml2LT5mZS5kZW1vZHVsYXRvcl9wcml2ID0gcHJpdjsKKwlyZXR1cm4g
JnByaXYtPmZlOwogZXJyb3I6CiAJa2ZyZWUocHJpdik7CiAJcmV0dXJuIE5VTEw7CiB9CiBFWFBP
UlRfU1lNQk9MKGN4ZDI4MjByX2F0dGFjaCk7CiAKLXN0YXRpYyBjb25zdCBzdHJ1Y3QgZHZiX2Zy
b250ZW5kX29wcyBjeGQyODIwcl9vcHNbMl0gPSB7Ci0JewotCQkvKiBEVkItVC9UMiAqLwotCQku
aW5mbyA9IHsKLQkJCS5uYW1lID0gIlNvbnkgQ1hEMjgyMFIgKERWQi1UL1QyKSIsCi0JCQkudHlw
ZSA9IEZFX09GRE0sCi0JCQkuY2FwcyA9Ci0JCQkJRkVfQ0FOX0ZFQ18xXzIgfCBGRV9DQU5fRkVD
XzJfMyB8Ci0JCQkJRkVfQ0FOX0ZFQ18zXzQgfCBGRV9DQU5fRkVDXzVfNiB8Ci0JCQkJRkVfQ0FO
X0ZFQ183XzggfCBGRV9DQU5fRkVDX0FVVE8gfAotCQkJCUZFX0NBTl9RUFNLIHwgRkVfQ0FOX1FB
TV8xNiB8Ci0JCQkJRkVfQ0FOX1FBTV82NCB8IEZFX0NBTl9RQU1fMjU2IHwKLQkJCQlGRV9DQU5f
UUFNX0FVVE8gfAotCQkJCUZFX0NBTl9UUkFOU01JU1NJT05fTU9ERV9BVVRPIHwKLQkJCQlGRV9D
QU5fR1VBUkRfSU5URVJWQUxfQVVUTyB8Ci0JCQkJRkVfQ0FOX0hJRVJBUkNIWV9BVVRPIHwKLQkJ
CQlGRV9DQU5fTVVURV9UUyB8Ci0JCQkJRkVfQ0FOXzJHX01PRFVMQVRJT04KLQkJfSwKLQotCQku
cmVsZWFzZSA9IGN4ZDI4MjByX3JlbGVhc2UsCi0JCS5pbml0ID0gY3hkMjgyMHJfaW5pdCwKLQkJ
LnNsZWVwID0gY3hkMjgyMHJfc2xlZXAsCi0KLQkJLmdldF90dW5lX3NldHRpbmdzID0gY3hkMjgy
MHJfZ2V0X3R1bmVfc2V0dGluZ3MsCi0JCS5pMmNfZ2F0ZV9jdHJsID0gY3hkMjgyMHJfaTJjX2dh
dGVfY3RybCwKLQotCQkuZ2V0X2Zyb250ZW5kID0gY3hkMjgyMHJfZ2V0X2Zyb250ZW5kLAotCi0J
CS5nZXRfZnJvbnRlbmRfYWxnbyA9IGN4ZDI4MjByX2dldF9mcm9udGVuZF9hbGdvLAotCQkuc2Vh
cmNoID0gY3hkMjgyMHJfc2VhcmNoLAotCi0JCS5yZWFkX3N0YXR1cyA9IGN4ZDI4MjByX3JlYWRf
c3RhdHVzLAotCQkucmVhZF9zbnIgPSBjeGQyODIwcl9yZWFkX3NuciwKLQkJLnJlYWRfYmVyID0g
Y3hkMjgyMHJfcmVhZF9iZXIsCi0JCS5yZWFkX3VjYmxvY2tzID0gY3hkMjgyMHJfcmVhZF91Y2Js
b2NrcywKLQkJLnJlYWRfc2lnbmFsX3N0cmVuZ3RoID0gY3hkMjgyMHJfcmVhZF9zaWduYWxfc3Ry
ZW5ndGgsCi0JfSwKLQl7Ci0JCS8qIERWQi1DICovCi0JCS5pbmZvID0gewotCQkJLm5hbWUgPSAi
U29ueSBDWEQyODIwUiAoRFZCLUMpIiwKLQkJCS50eXBlID0gRkVfUUFNLAotCQkJLmNhcHMgPQot
CQkJCUZFX0NBTl9RQU1fMTYgfCBGRV9DQU5fUUFNXzMyIHwgRkVfQ0FOX1FBTV82NCB8Ci0JCQkJ
RkVfQ0FOX1FBTV8xMjggfCBGRV9DQU5fUUFNXzI1NiB8Ci0JCQkJRkVfQ0FOX0ZFQ19BVVRPCi0J
CX0sCi0KLQkJLnJlbGVhc2UgPSBjeGQyODIwcl9yZWxlYXNlLAotCQkuaW5pdCA9IGN4ZDI4MjBy
X2luaXQsCi0JCS5zbGVlcCA9IGN4ZDI4MjByX3NsZWVwLAotCi0JCS5nZXRfdHVuZV9zZXR0aW5n
cyA9IGN4ZDI4MjByX2dldF90dW5lX3NldHRpbmdzLAotCQkuaTJjX2dhdGVfY3RybCA9IGN4ZDI4
MjByX2kyY19nYXRlX2N0cmwsCi0KLQkJLnNldF9mcm9udGVuZCA9IGN4ZDI4MjByX3NldF9mcm9u
dGVuZCwKLQkJLmdldF9mcm9udGVuZCA9IGN4ZDI4MjByX2dldF9mcm9udGVuZCwKLQotCQkucmVh
ZF9zdGF0dXMgPSBjeGQyODIwcl9yZWFkX3N0YXR1cywKLQkJLnJlYWRfc25yID0gY3hkMjgyMHJf
cmVhZF9zbnIsCi0JCS5yZWFkX2JlciA9IGN4ZDI4MjByX3JlYWRfYmVyLAotCQkucmVhZF91Y2Js
b2NrcyA9IGN4ZDI4MjByX3JlYWRfdWNibG9ja3MsCi0JCS5yZWFkX3NpZ25hbF9zdHJlbmd0aCA9
IGN4ZDI4MjByX3JlYWRfc2lnbmFsX3N0cmVuZ3RoLAotCX0sCi19OwotCi0KIE1PRFVMRV9BVVRI
T1IoIkFudHRpIFBhbG9zYWFyaSA8Y3JvcGVAaWtpLmZpPiIpOwogTU9EVUxFX0RFU0NSSVBUSU9O
KCJTb255IENYRDI4MjBSIGRlbW9kdWxhdG9yIGRyaXZlciIpOwogTU9EVUxFX0xJQ0VOU0UoIkdQ
TCIpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9tZWRpYS9kdmIvZnJvbnRlbmRzL2N4ZDI4MjByX3By
aXYuaCBiL2RyaXZlcnMvbWVkaWEvZHZiL2Zyb250ZW5kcy9jeGQyODIwcl9wcml2LmgKaW5kZXgg
OTU1MzkxMy4uOTRkY2Y3ZiAxMDA2NDQKLS0tIGEvZHJpdmVycy9tZWRpYS9kdmIvZnJvbnRlbmRz
L2N4ZDI4MjByX3ByaXYuaAorKysgYi9kcml2ZXJzL21lZGlhL2R2Yi9mcm9udGVuZHMvY3hkMjgy
MHJfcHJpdi5oCkBAIC00OCwxMiArNDgsOSBAQCBzdHJ1Y3QgcmVnX3ZhbF9tYXNrIHsKIAogc3Ry
dWN0IGN4ZDI4MjByX3ByaXYgewogCXN0cnVjdCBpMmNfYWRhcHRlciAqaTJjOwotCXN0cnVjdCBk
dmJfZnJvbnRlbmQgZmVbMl07CisJc3RydWN0IGR2Yl9mcm9udGVuZCBmZTsKIAlzdHJ1Y3QgY3hk
MjgyMHJfY29uZmlnIGNmZzsKIAotCXN0cnVjdCBtdXRleCBmZV9sb2NrOyAvKsKgRkUgbG9jayAq
LwotCWludCBhY3RpdmVfZmU6MjsgLyogRkUgbG9jaywgLTE9Tk9ORSwgMD1EVkItVC9UMiwgMT1E
VkItQyAqLwotCiAJYm9vbCBiZXJfcnVubmluZzsKIAogCXU4IGJhbmtbMl07CmRpZmYgLS1naXQg
YS9kcml2ZXJzL21lZGlhL2R2Yi9mcm9udGVuZHMvY3hkMjgyMHJfdC5jIGIvZHJpdmVycy9tZWRp
YS9kdmIvZnJvbnRlbmRzL2N4ZDI4MjByX3QuYwppbmRleCBhMDRmOWM4Li5kNWZmYzE1IDEwMDY0
NAotLS0gYS9kcml2ZXJzL21lZGlhL2R2Yi9mcm9udGVuZHMvY3hkMjgyMHJfdC5jCisrKyBiL2Ry
aXZlcnMvbWVkaWEvZHZiL2Zyb250ZW5kcy9jeGQyODIwcl90LmMKQEAgLTIyLDEwICsyMiwxMSBA
QAogI2luY2x1ZGUgImN4ZDI4MjByX3ByaXYuaCIKIAogaW50IGN4ZDI4MjByX3NldF9mcm9udGVu
ZF90KHN0cnVjdCBkdmJfZnJvbnRlbmQgKmZlLAotCXN0cnVjdCBkdmJfZnJvbnRlbmRfcGFyYW1l
dGVycyAqcCkKKwkJCSAgICBzdHJ1Y3QgZHZiX2Zyb250ZW5kX3BhcmFtZXRlcnMgKnApCiB7CiAJ
c3RydWN0IGN4ZDI4MjByX3ByaXYgKnByaXYgPSBmZS0+ZGVtb2R1bGF0b3JfcHJpdjsKIAlzdHJ1
Y3QgZHR2X2Zyb250ZW5kX3Byb3BlcnRpZXMgKmMgPSAmZmUtPmR0dl9wcm9wZXJ0eV9jYWNoZTsK
KwlzdHJ1Y3QgdHVuZXJfc3RhdGUgdHN0YXRlOwogCWludCByZXQsIGk7CiAJdTMyIGlmX2toeiwg
aWZfY3RsOwogCXU2NCBudW07CkBAIC02Myw4ICs2NCwyMCBAQCBpbnQgY3hkMjgyMHJfc2V0X2Zy
b250ZW5kX3Qoc3RydWN0IGR2Yl9mcm9udGVuZCAqZmUsCiAJCWdvdG8gZXJyb3I7CiAKIAkvKiBw
cm9ncmFtIHR1bmVyICovCi0JaWYgKGZlLT5vcHMudHVuZXJfb3BzLnNldF9wYXJhbXMpCi0JCWZl
LT5vcHMudHVuZXJfb3BzLnNldF9wYXJhbXMoZmUsIHApOworCXRzdGF0ZS5kZWxzeXMgPSBTWVNf
RFZCVDsKKwl0c3RhdGUuZnJlcXVlbmN5ID0gYy0+ZnJlcXVlbmN5OworCXRzdGF0ZS5iYW5kd2lk
dGggPSBjLT5iYW5kd2lkdGhfaHo7CisKKwlpZiAoZmUtPm9wcy50dW5lcl9vcHMuc2V0X3N0YXRl
KSB7CisJCWZlLT5vcHMudHVuZXJfb3BzLnNldF9zdGF0ZShmZSwKKwkJCQkJICAgIERWQkZFX1RV
TkVSX0RFTFNZUyAgICB8CisJCQkJCSAgICBEVkJGRV9UVU5FUl9GUkVRVUVOQ1kgfAorCQkJCQkg
ICAgRFZCRkVfVFVORVJfQkFORFdJRFRILAorCQkJCQkgICAgJnRzdGF0ZSk7CisJfSBlbHNlIHsK
KwkJaWYgKGZlLT5vcHMudHVuZXJfb3BzLnNldF9wYXJhbXMpCisJCQlmZS0+b3BzLnR1bmVyX29w
cy5zZXRfcGFyYW1zKGZlLCBwKTsKKwl9CiAKIAlpZiAocHJpdi0+ZGVsaXZlcnlfc3lzdGVtICE9
IFNZU19EVkJUKSB7CiAJCWZvciAoaSA9IDA7IGkgPCBBUlJBWV9TSVpFKHRhYik7IGkrKykgewpk
aWZmIC0tZ2l0IGEvZHJpdmVycy9tZWRpYS9kdmIvZnJvbnRlbmRzL2N4ZDI4MjByX3QyLmMgYi9k
cml2ZXJzL21lZGlhL2R2Yi9mcm9udGVuZHMvY3hkMjgyMHJfdDIuYwppbmRleCA2NTQ4NTg4Li5h
NmM5OTAzIDEwMDY0NAotLS0gYS9kcml2ZXJzL21lZGlhL2R2Yi9mcm9udGVuZHMvY3hkMjgyMHJf
dDIuYworKysgYi9kcml2ZXJzL21lZGlhL2R2Yi9mcm9udGVuZHMvY3hkMjgyMHJfdDIuYwpAQCAt
MjIsMTAgKzIyLDExIEBACiAjaW5jbHVkZSAiY3hkMjgyMHJfcHJpdi5oIgogCiBpbnQgY3hkMjgy
MHJfc2V0X2Zyb250ZW5kX3QyKHN0cnVjdCBkdmJfZnJvbnRlbmQgKmZlLAotCXN0cnVjdCBkdmJf
ZnJvbnRlbmRfcGFyYW1ldGVycyAqcGFyYW1zKQorCQkJICAgICBzdHJ1Y3QgZHZiX2Zyb250ZW5k
X3BhcmFtZXRlcnMgKnBhcmFtcykKIHsKIAlzdHJ1Y3QgY3hkMjgyMHJfcHJpdiAqcHJpdiA9IGZl
LT5kZW1vZHVsYXRvcl9wcml2OwogCXN0cnVjdCBkdHZfZnJvbnRlbmRfcHJvcGVydGllcyAqYyA9
ICZmZS0+ZHR2X3Byb3BlcnR5X2NhY2hlOworCXN0cnVjdCB0dW5lcl9zdGF0ZSB0c3RhdGU7CiAJ
aW50IHJldCwgaTsKIAl1MzIgaWZfa2h6LCBpZl9jdGw7CiAJdTY0IG51bTsKQEAgLTc3LDggKzc4
LDIxIEBAIGludCBjeGQyODIwcl9zZXRfZnJvbnRlbmRfdDIoc3RydWN0IGR2Yl9mcm9udGVuZCAq
ZmUsCiAJCWdvdG8gZXJyb3I7CiAKIAkvKiBwcm9ncmFtIHR1bmVyICovCi0JaWYgKGZlLT5vcHMu
dHVuZXJfb3BzLnNldF9wYXJhbXMpCi0JCWZlLT5vcHMudHVuZXJfb3BzLnNldF9wYXJhbXMoZmUs
IHBhcmFtcyk7CisKKwl0c3RhdGUuZGVsc3lzID0gU1lTX0RWQlQyOworCXRzdGF0ZS5mcmVxdWVu
Y3kgPSBjLT5mcmVxdWVuY3k7CisJdHN0YXRlLmJhbmR3aWR0aCA9IGMtPmJhbmR3aWR0aF9oejsK
KworCWlmIChmZS0+b3BzLnR1bmVyX29wcy5zZXRfc3RhdGUpIHsKKwkJZmUtPm9wcy50dW5lcl9v
cHMuc2V0X3N0YXRlKGZlLAorCQkJCQkgICAgRFZCRkVfVFVORVJfREVMU1lTICAgIHwKKwkJCQkJ
ICAgIERWQkZFX1RVTkVSX0ZSRVFVRU5DWSB8CisJCQkJCSAgICBEVkJGRV9UVU5FUl9CQU5EV0lE
VEgsCisJCQkJCSAgICAmdHN0YXRlKTsKKwl9IGVsc2UgeworCQlpZiAoZmUtPm9wcy50dW5lcl9v
cHMuc2V0X3BhcmFtcykKKwkJCWZlLT5vcHMudHVuZXJfb3BzLnNldF9wYXJhbXMoZmUsIHBhcmFt
cyk7CisJfQogCiAJaWYgKHByaXYtPmRlbGl2ZXJ5X3N5c3RlbSAhPSBTWVNfRFZCVDIpIHsKIAkJ
Zm9yIChpID0gMDsgaSA8IEFSUkFZX1NJWkUodGFiKTsgaSsrKSB7Ci0tIAoxLjcuMQoK
--bcaec52c62335f2b7d04b245192d--
