Return-path: <linux-media-owner@vger.kernel.org>
Received: from mail.renesas.com ([202.234.163.13]:53713 "EHLO
	mail01.idc.renesas.com" rhost-flags-OK-OK-OK-FAIL) by vger.kernel.org
	with ESMTP id S1751718AbZA0FJM (ORCPT
	<rfc822;linux-media@vger.kernel.org>);
	Tue, 27 Jan 2009 00:09:12 -0500
Date: Tue, 27 Jan 2009 14:09:03 +0900
From: morimoto.kuninori@renesas.com
Subject: Re: [PATCH] ov772x: add support S_CROP operation.
In-reply-to: <Pine.LNX.4.64.0901260854010.4236@axis700.grange>
To: Guennadi Liakhovetski <g.liakhovetski@gmx.de>
Cc: Linux Media <linux-media@vger.kernel.org>
Message-id: <uk58hcp3k.wl%morimoto.kuninori@renesas.com>
MIME-version: 1.0 (generated by SEMI 1.14.6 - "Maruoka")
Content-type: multipart/mixed; boundary="Multipart_Tue_Jan_27_14:09:03_2009-1"
References: <uskna4qh8.wl%morimoto.kuninori@renesas.com>
 <Pine.LNX.4.64.0901250245440.4969@axis700.grange>
 <uzlheep1l.wl%morimoto.kuninori@renesas.com>
 <Pine.LNX.4.64.0901260854010.4236@axis700.grange>
Sender: linux-media-owner@vger.kernel.org
List-ID: <linux-media.vger.kernel.org>

--Multipart_Tue_Jan_27_14:09:03_2009-1
Content-Type: text/plain; charset=US-ASCII


Dear Guennadi

> > what is the best way to us ???
> > or do I miss understanding ???
> 
> Fix behaviour if no S_FMT is done.

I attached stupid 4 patches.
I would like to hear your opinion.
please check it.

I wonder is there any soc_camera that works without 
calling S_FMT though set_bus_param is not called ?

If soc_camera works without calling S_FMT, 
s_crop should call try_fmt_vid_cap
and set_bus_param like s_fmt_vid_cap I think.

And I think "current_fmt" is better than 0 to set_fmt
if user wants only geometry changes on s_crop.
it mean keep format.

These patches works well on my local environment.
ov772x and tw9910 work even if without -f option on capture_example.

If you can agree with this idea,
I will send these as formal patch.


--Multipart_Tue_Jan_27_14:09:03_2009-1
Content-Type: application/octet-stream; type=patch
Content-Disposition: attachment; filename="0001-tw9910-field-NONE-also-permits.patch"
Content-Transfer-Encoding: base64

RnJvbSA1NjQyOWYwZjAxYjQ1OTAxZjUzNzZkN2FkZmYzMWJmODk4Nzg3MTk5IE1vbiBTZXAgMTcg
MDA6MDA6MDAgMjAwMQpGcm9tOiBLdW5pbm9yaSBNb3JpbW90byA8bW9yaW1vdG8ua3VuaW5vcmlA
cmVuZXNhcy5jb20+CkRhdGU6IFR1ZSwgMjcgSmFuIDIwMDkgMTE6MjQ6MDYgKzA5MDAKU3ViamVj
dDogW1BBVENIXSB0dzk5MTA6IGZpZWxkIE5PTkUgYWxzbyBwZXJtaXRzLgoKClNpZ25lZC1vZmYt
Ynk6IEt1bmlub3JpIE1vcmltb3RvIDxtb3JpbW90by5rdW5pbm9yaUByZW5lc2FzLmNvbT4KLS0t
CiBkcml2ZXJzL21lZGlhL3ZpZGVvL3R3OTkxMC5jIHwgICAgMyArKy0KIDEgZmlsZXMgY2hhbmdl
ZCwgMiBpbnNlcnRpb25zKCspLCAxIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMv
bWVkaWEvdmlkZW8vdHc5OTEwLmMgYi9kcml2ZXJzL21lZGlhL3ZpZGVvL3R3OTkxMC5jCmluZGV4
IDE3ZDgyMDUuLjFhOWM2ZmQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvbWVkaWEvdmlkZW8vdHc5OTEw
LmMKKysrIGIvZHJpdmVycy9tZWRpYS92aWRlby90dzk5MTAuYwpAQCAtNzM5LDcgKzczOSw4IEBA
IHN0YXRpYyBpbnQgdHc5OTEwX3RyeV9mbXQoc3RydWN0IHNvY19jYW1lcmFfZGV2aWNlICppY2Qs
CiAJc3RydWN0IHY0bDJfcGl4X2Zvcm1hdCAqcGl4ID0gJmYtPmZtdC5waXg7CiAJY29uc3Qgc3Ry
dWN0IHR3OTkxMF9zY2FsZV9jdHJsICpzY2FsZTsKIAotCWlmIChWNEwyX0ZJRUxEX0FOWSA9PSBw
aXgtPmZpZWxkKSB7CisJaWYgKFY0TDJfRklFTERfQU5ZICA9PSBwaXgtPmZpZWxkIHx8CisJICAg
IFY0TDJfRklFTERfTk9ORSA9PSBwaXgtPmZpZWxkKSB7CiAJCXBpeC0+ZmllbGQgPSBWNEwyX0ZJ
RUxEX0lOVEVSTEFDRUQ7CiAJfSBlbHNlIGlmIChWNEwyX0ZJRUxEX0lOVEVSTEFDRUQgIT0gcGl4
LT5maWVsZCkgewogCQlkZXZfZXJyKCZpY2QtPmRldiwgIkZpZWxkIHR5cGUgaW52YWxpZC5cbiIp
OwotLSAKMS41LjYuMwoK

--Multipart_Tue_Jan_27_14:09:03_2009-1
Content-Type: application/octet-stream; type=patch
Content-Disposition: attachment; filename="0002-sh_mobile_ceu-revert-b6c6173ee8af9e8723b76e12bd92e4.patch"
Content-Transfer-Encoding: base64

RnJvbSAyY2Q4Njk3ZGNkZmVlMjMxMzgxZjZjYzVkOGIwMGZmMDExZWJkYTAzIE1vbiBTZXAgMTcg
MDA6MDA6MDAgMjAwMQpGcm9tOiBLdW5pbm9yaSBNb3JpbW90byA8bW9yaW1vdG8ua3VuaW5vcmlA
cmVuZXNhcy5jb20+CkRhdGU6IFR1ZSwgMjcgSmFuIDIwMDkgMTE6Mjg6MTYgKzA5MDAKU3ViamVj
dDogW1BBVENIXSBzaF9tb2JpbGVfY2V1OiByZXZlcnQgYjZjNjE3M2VlOGFmOWU4NzIzYjc2ZTEy
YmQ5MmU0ODRkYzM5MzUzZgoKClNpZ25lZC1vZmYtYnk6IEt1bmlub3JpIE1vcmltb3RvIDxtb3Jp
bW90by5rdW5pbm9yaUByZW5lc2FzLmNvbT4KLS0tCiBkcml2ZXJzL21lZGlhL3ZpZGVvL3NoX21v
YmlsZV9jZXVfY2FtZXJhLmMgfCAgICAyICstCiAxIGZpbGVzIGNoYW5nZWQsIDEgaW5zZXJ0aW9u
cygrKSwgMSBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL21lZGlhL3ZpZGVvL3No
X21vYmlsZV9jZXVfY2FtZXJhLmMgYi9kcml2ZXJzL21lZGlhL3ZpZGVvL3NoX21vYmlsZV9jZXVf
Y2FtZXJhLmMKaW5kZXggNGNiZDM2Mi4uZjhiMGMwMCAxMDA2NDQKLS0tIGEvZHJpdmVycy9tZWRp
YS92aWRlby9zaF9tb2JpbGVfY2V1X2NhbWVyYS5jCisrKyBiL2RyaXZlcnMvbWVkaWEvdmlkZW8v
c2hfbW9iaWxlX2NldV9jYW1lcmEuYwpAQCAtNzQyLDcgKzc0Miw3IEBAIHN0YXRpYyB2b2lkIHNo
X21vYmlsZV9jZXVfaW5pdF92aWRlb2J1ZihzdHJ1Y3QgdmlkZW9idWZfcXVldWUgKnEsCiAJCQkJ
ICAgICAgICZzaF9tb2JpbGVfY2V1X3ZpZGVvYnVmX29wcywKIAkJCQkgICAgICAgJmljaS0+ZGV2
LCAmcGNkZXYtPmxvY2ssCiAJCQkJICAgICAgIFY0TDJfQlVGX1RZUEVfVklERU9fQ0FQVFVSRSwK
LQkJCQkgICAgICAgVjRMMl9GSUVMRF9BTlksCisJCQkJICAgICAgIFY0TDJfRklFTERfTk9ORSwK
IAkJCQkgICAgICAgc2l6ZW9mKHN0cnVjdCBzaF9tb2JpbGVfY2V1X2J1ZmZlciksCiAJCQkJICAg
ICAgIGljZCk7CiB9Ci0tIAoxLjUuNi4zCgo=

--Multipart_Tue_Jan_27_14:09:03_2009-1
Content-Type: application/octet-stream; type=patch
Content-Disposition: attachment; filename="0003-soc_camera-use-currect-format-on-s_crop.patch"
Content-Transfer-Encoding: base64

RnJvbSA1ZDkyMzFkNmRlYTEyMzhhOTc5ZTFiNmRjYmY1NmI5NDRiNGYyZDBhIE1vbiBTZXAgMTcg
MDA6MDA6MDAgMjAwMQpGcm9tOiBLdW5pbm9yaSBNb3JpbW90byA8bW9yaW1vdG8ua3VuaW5vcmlA
cmVuZXNhcy5jb20+CkRhdGU6IFR1ZSwgMjcgSmFuIDIwMDkgMTE6MzA6MDEgKzA5MDAKU3ViamVj
dDogW1BBVENIXSBzb2NfY2FtZXJhOiB1c2UgY3VycmVjdCBmb3JtYXQgb24gc19jcm9wCgoKU2ln
bmVkLW9mZi1ieTogS3VuaW5vcmkgTW9yaW1vdG8gPG1vcmltb3RvLmt1bmlub3JpQHJlbmVzYXMu
Y29tPgotLS0KIGRyaXZlcnMvbWVkaWEvdmlkZW8vc29jX2NhbWVyYS5jIHwgICAgMyArKy0KIDEg
ZmlsZXMgY2hhbmdlZCwgMiBpbnNlcnRpb25zKCspLCAxIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdp
dCBhL2RyaXZlcnMvbWVkaWEvdmlkZW8vc29jX2NhbWVyYS5jIGIvZHJpdmVycy9tZWRpYS92aWRl
by9zb2NfY2FtZXJhLmMKaW5kZXggZmNiMDVmMC4uODI5ZmFiZSAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9tZWRpYS92aWRlby9zb2NfY2FtZXJhLmMKKysrIGIvZHJpdmVycy9tZWRpYS92aWRlby9zb2Nf
Y2FtZXJhLmMKQEAgLTY3Nyw2ICs2NzcsNyBAQCBzdGF0aWMgaW50IHNvY19jYW1lcmFfc19jcm9w
KHN0cnVjdCBmaWxlICpmaWxlLCB2b2lkICpmaCwKIAlzdHJ1Y3Qgc29jX2NhbWVyYV9maWxlICpp
Y2YgPSBmaWxlLT5wcml2YXRlX2RhdGE7CiAJc3RydWN0IHNvY19jYW1lcmFfZGV2aWNlICppY2Qg
PSBpY2YtPmljZDsKIAlzdHJ1Y3Qgc29jX2NhbWVyYV9ob3N0ICppY2kgPSB0b19zb2NfY2FtZXJh
X2hvc3QoaWNkLT5kZXYucGFyZW50KTsKKwlfX3UzMiBwaXhmbXQgPSBpY2QtPmN1cnJlbnRfZm10
LT5mb3VyY2M7CiAJaW50IHJldDsKIAogCWlmIChhLT50eXBlICE9IFY0TDJfQlVGX1RZUEVfVklE
RU9fQ0FQVFVSRSkKQEAgLTY4NSw3ICs2ODYsNyBAQCBzdGF0aWMgaW50IHNvY19jYW1lcmFfc19j
cm9wKHN0cnVjdCBmaWxlICpmaWxlLCB2b2lkICpmaCwKIAkvKiBDcm9wcGluZyBpcyBhbGxvd2Vk
IGR1cmluZyBhIHJ1bm5pbmcgY2FwdHVyZSwgZ3VhcmQgY29uc2lzdGVuY3kgKi8KIAltdXRleF9s
b2NrKCZpY2YtPnZiX3ZpZHEudmJfbG9jayk7CiAKLQlyZXQgPSBpY2ktPm9wcy0+c2V0X2ZtdChp
Y2QsIDAsICZhLT5jKTsKKwlyZXQgPSBpY2ktPm9wcy0+c2V0X2ZtdChpY2QsIHBpeGZtdCwgJmEt
PmMpOwogCWlmICghcmV0KSB7CiAJCWljZC0+d2lkdGgJPSBhLT5jLndpZHRoOwogCQlpY2QtPmhl
aWdodAk9IGEtPmMuaGVpZ2h0OwotLSAKMS41LjYuMwoK

--Multipart_Tue_Jan_27_14:09:03_2009-1
Content-Type: application/octet-stream; type=patch
Content-Disposition: attachment; filename="0004-soc_camera-s_crop-behaves-like-s_fmt_vid_cap.patch"
Content-Transfer-Encoding: base64

RnJvbSBjMTBjM2JkZTI3M2QwM2UwNzM3NTg5MDYyOWQwMzEzMmIwOGZlMDQ1IE1vbiBTZXAgMTcg
MDA6MDA6MDAgMjAwMQpGcm9tOiBLdW5pbm9yaSBNb3JpbW90byA8bW9yaW1vdG8ua3VuaW5vcmlA
cmVuZXNhcy5jb20+CkRhdGU6IFR1ZSwgMjcgSmFuIDIwMDkgMTE6MzM6NDIgKzA5MDAKU3ViamVj
dDogW1BBVENIXSBzb2NfY2FtZXJhOiBzX2Nyb3AgYmVoYXZlcyBsaWtlIHNfZm10X3ZpZF9jYXAu
Cgpzb2NfY2FtZXJhIHNob3VsZCBiZSBhYmxlIHRvIHJ1biB3aXRob3V0IFNfRk1ULgpUaGVyZWZv
cmUsIHNfY3JvcCBmdW5jdGlvbiBzaG91bGQgY2FsbCB0cnlfZm10X3ZpZF9jYXAKYW5kIHNldF9i
dXNfcGFyYW0gbGlrZSBzX2ZtdF92aWRfY2FwLgoKU2lnbmVkLW9mZi1ieTogS3VuaW5vcmkgTW9y
aW1vdG8gPG1vcmltb3RvLmt1bmlub3JpQHJlbmVzYXMuY29tPgotLS0KIGRyaXZlcnMvbWVkaWEv
dmlkZW8vc29jX2NhbWVyYS5jIHwgICAzMyArKysrKysrKysrKysrKysrKysrKysrKysrKystLS0t
LS0KIDEgZmlsZXMgY2hhbmdlZCwgMjcgaW5zZXJ0aW9ucygrKSwgNiBkZWxldGlvbnMoLSkKCmRp
ZmYgLS1naXQgYS9kcml2ZXJzL21lZGlhL3ZpZGVvL3NvY19jYW1lcmEuYyBiL2RyaXZlcnMvbWVk
aWEvdmlkZW8vc29jX2NhbWVyYS5jCmluZGV4IDgyOWZhYmUuLmM1ZmJiMTEgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvbWVkaWEvdmlkZW8vc29jX2NhbWVyYS5jCisrKyBiL2RyaXZlcnMvbWVkaWEvdmlk
ZW8vc29jX2NhbWVyYS5jCkBAIC02NzcsMjMgKzY3Nyw0NCBAQCBzdGF0aWMgaW50IHNvY19jYW1l
cmFfc19jcm9wKHN0cnVjdCBmaWxlICpmaWxlLCB2b2lkICpmaCwKIAlzdHJ1Y3Qgc29jX2NhbWVy
YV9maWxlICppY2YgPSBmaWxlLT5wcml2YXRlX2RhdGE7CiAJc3RydWN0IHNvY19jYW1lcmFfZGV2
aWNlICppY2QgPSBpY2YtPmljZDsKIAlzdHJ1Y3Qgc29jX2NhbWVyYV9ob3N0ICppY2kgPSB0b19z
b2NfY2FtZXJhX2hvc3QoaWNkLT5kZXYucGFyZW50KTsKKwlzdHJ1Y3QgdjRsMl9mb3JtYXQgZjsK
IAlfX3UzMiBwaXhmbXQgPSBpY2QtPmN1cnJlbnRfZm10LT5mb3VyY2M7CiAJaW50IHJldDsKIAog
CWlmIChhLT50eXBlICE9IFY0TDJfQlVGX1RZUEVfVklERU9fQ0FQVFVSRSkKIAkJcmV0dXJuIC1F
SU5WQUw7CiAKKwlmLnR5cGUgPSBhLT50eXBlOworCWYuZm10LnBpeC5waXhlbGZvcm1hdCA9IHBp
eGZtdDsKKwlmLmZtdC5waXguZmllbGQgICAgICAgPSBpY2YtPnZiX3ZpZHEuZmllbGQ7CisJZi5m
bXQucGl4LndpZHRoICAgICAgID0gYS0+Yy53aWR0aDsKKwlmLmZtdC5waXguaGVpZ2h0ICAgICAg
PSBhLT5jLmhlaWdodDsKKwlyZXQgPSBzb2NfY2FtZXJhX3RyeV9mbXRfdmlkX2NhcChmaWxlLCBm
aCwgJmYpOworCWlmIChyZXQgPCAwKQorCQlyZXR1cm4gcmV0OworCiAJLyogQ3JvcHBpbmcgaXMg
YWxsb3dlZCBkdXJpbmcgYSBydW5uaW5nIGNhcHR1cmUsIGd1YXJkIGNvbnNpc3RlbmN5ICovCiAJ
bXV0ZXhfbG9jaygmaWNmLT52Yl92aWRxLnZiX2xvY2spOwogCi0JcmV0ID0gaWNpLT5vcHMtPnNl
dF9mbXQoaWNkLCBwaXhmbXQsICZhLT5jKTsKLQlpZiAoIXJldCkgewotCQlpY2QtPndpZHRoCT0g
YS0+Yy53aWR0aDsKLQkJaWNkLT5oZWlnaHQJPSBhLT5jLmhlaWdodDsKLQkJaWNkLT54X2N1cnJl
bnQJPSBhLT5jLmxlZnQ7Ci0JCWljZC0+eV9jdXJyZW50CT0gYS0+Yy50b3A7CisJaWYgKHZpZGVv
YnVmX3F1ZXVlX2lzX2J1c3koJmljZi0+dmJfdmlkcSkpIHsKKwkJZGV2X2VycigmaWNkLT5kZXYs
ICJTX0NST1AgZGVuaWVkOiBxdWV1ZSBidXN5XG4iKTsKKwkJcmV0ID0gLUVCVVNZOworCQlnb3Rv
IHVubG9jazsKIAl9CiAKKwlyZXQgPSBpY2ktPm9wcy0+c2V0X2ZtdChpY2QsIHBpeGZtdCwgJmEt
PmMpOworCWlmIChyZXQgPCAwKQorCQlnb3RvIHVubG9jazsKKworCWljZC0+d2lkdGgJPSBhLT5j
LndpZHRoOworCWljZC0+aGVpZ2h0CT0gYS0+Yy5oZWlnaHQ7CisJaWNkLT54X2N1cnJlbnQJPSBh
LT5jLmxlZnQ7CisJaWNkLT55X2N1cnJlbnQJPSBhLT5jLnRvcDsKKworCS8qIHNldCBwaHlzaWNh
bCBidXMgcGFyYW1ldGVycyAqLworCXJldCA9IGljaS0+b3BzLT5zZXRfYnVzX3BhcmFtKGljZCwg
cGl4Zm10KTsKKwordW5sb2NrOgogCW11dGV4X3VubG9jaygmaWNmLT52Yl92aWRxLnZiX2xvY2sp
OwogCiAJcmV0dXJuIHJldDsKLS0gCjEuNS42LjMKCg==

--Multipart_Tue_Jan_27_14:09:03_2009-1
Content-Type: text/plain; charset=US-ASCII


Best regards
--
Kuninori Morimoto
 

--Multipart_Tue_Jan_27_14:09:03_2009-1--
