Return-path: <linux-media-owner@vger.kernel.org>
Received: from mail-qy0-f174.google.com ([209.85.221.174]:62874 "EHLO
	mail-qy0-f174.google.com" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
	with ESMTP id S1752773AbZJ2NlL (ORCPT
	<rfc822;linux-media@vger.kernel.org>);
	Thu, 29 Oct 2009 09:41:11 -0400
Received: by qyk4 with SMTP id 4so1099638qyk.33
        for <linux-media@vger.kernel.org>; Thu, 29 Oct 2009 06:41:15 -0700 (PDT)
MIME-Version: 1.0
Date: Thu, 29 Oct 2009 14:41:15 +0100
Message-ID: <156a113e0910290641n348a8500v7f1a3df3ddd395d9@mail.gmail.com>
Subject: Patch for "Leadtek Winfast TV USB II Deluxe" (with IR)
From: Magnus Alm <magnus.alm@gmail.com>
To: linux-media@vger.kernel.org
Content-Type: multipart/mixed; boundary=001636417d5fb3ef7f0477131086
Sender: linux-media-owner@vger.kernel.org
List-ID: <linux-media.vger.kernel.org>

--001636417d5fb3ef7f0477131086
Content-Type: text/plain; charset=ISO-8859-1

Hi!

I managed to get the remote working now in both in Ubuntu 9.04 (kernel
2.6.28-16) and Ubuntu 9.10 (kernel 2.6.31-14).

There is one difference tho, in the 2.6.28-16 kernel the remote
doesn't do anything without configuring lirc.
In 2.6.31-14 I can for example adjust volume in X and use the numeric
keys to change channels in tvtime without lirc.
Don't know why, it just works like that.

I've added 3 different examples for a patch as attachment, since the
remote can be enabled different ways.
(They also changes the basic config for my board.)

ex1.patch only works for kernel 2.6.31.

ex2.patch works for both 2.6.31 and 2.6.28 but can in the future cause
problems for boards that would like to use adress 0x1f (0x3e) for IR.
(Because of the "case 0x1f" for my board.)

ex3.patch is a combination of ex1 and ex2. where it is depending on if
kernel version is higher or lower than 2.6.30.

Dunno which one that would be most suitable.

Another thing is that my board finds an IR device at 0x18 (0x30), but
ir-polling doesn't work at that address, so if any board in the future
needs that added
0x1f needs to stand before 0x18.
This is for the funtion in em28xx-cards if kernel higher than 2.6.30:

	const unsigned short addr_list[] = {
		 0x1f, 0x30, 0x47, I2C_CLIENT_END			
	};

or in  ir-kbd-i2c for kernel lower than 2.6.30:

static const int probe_em28XX[] = { 0x1f, 0x30, 0x47, -1 };


I guess you also might have objections in how I'm naming stuff like
"get_key_lwtu2d", maybe it's a bit obscure...


/Magnus Alm

--001636417d5fb3ef7f0477131086
Content-Type: text/x-patch; charset=US-ASCII; name="ex1.patch"
Content-Disposition: attachment; filename="ex1.patch"
Content-Transfer-Encoding: base64
X-Attachment-Id: f_g1dj9hvl0

LS0tIG9yZy92NGwtZHZiL2xpbnV4L2luY2x1ZGUvbWVkaWEvaXItY29tbW9uLmgJMjAwOS0xMC0y
OSAxMzowMzo0Mi41MTUwNjE2ODAgKzAxMDAKKysrIGV4MS92NGwtZHZiL2xpbnV4L2luY2x1ZGUv
bWVkaWEvaXItY29tbW9uLmgJMjAwOS0xMC0yNiAxMjowMDowMC4wMDAwMDAwMDAgKzAxMDAKQEAg
LTE3OSw0ICsxNzksNSBAQAogZXh0ZXJuIHN0cnVjdCBpcl9zY2FuY29kZV90YWJsZSBpcl9jb2Rl
c190ZXJyYXRlY19jaW5lcmd5X3hzX3RhYmxlOwogZXh0ZXJuIHN0cnVjdCBpcl9zY2FuY29kZV90
YWJsZSBpcl9jb2Rlc192aWRlb21hdGVfczM1MF90YWJsZTsKIGV4dGVybiBzdHJ1Y3QgaXJfc2Nh
bmNvZGVfdGFibGUgaXJfY29kZXNfZ2FkbWVpX3JtMDA4el90YWJsZTsKK2V4dGVybiBzdHJ1Y3Qg
aXJfc2NhbmNvZGVfdGFibGUgaXJfY29kZXNfbHd0dTJkX3RhYmxlOwogI2VuZGlmCi0tLSBvcmcv
djRsLWR2Yi9saW51eC9kcml2ZXJzL21lZGlhL2NvbW1vbi9pci1rZXltYXBzLmMJMjAwOS0xMC0y
OSAxMzowMzo0MS41MjUwNjIzOTYgKzAxMDAKKysrIGV4MS92NGwtZHZiL2xpbnV4L2RyaXZlcnMv
bWVkaWEvY29tbW9uL2lyLWtleW1hcHMuYwkyMDA5LTEwLTI3IDE2OjUxOjA4LjI2NzU2NjAwMCAr
MDEwMApAQCAtMzMwMiwzICszMzAyLDQyIEBACiAJLnNpemUgPSBBUlJBWV9TSVpFKGlyX2NvZGVz
X2dhZG1laV9ybTAwOHopLAogfTsKIEVYUE9SVF9TWU1CT0xfR1BMKGlyX2NvZGVzX2dhZG1laV9y
bTAwOHpfdGFibGUpOworCitzdGF0aWMgc3RydWN0IGlyX3NjYW5jb2RlIGlyX2NvZGVzX2x3dHUy
ZFtdID0geworCXsgMHg3MCwgS0VZX1BPV0VSMn0sCQkvKiBQT1dFUiBPRkYqLworCXsgMHg3Miwg
S0VZX01PREV9LCAJCS8qIFRWL0ZNICovCisJeyAweDIxLCBLRVlfQ0hBTk5FTH0sCQkvKiBDSEFO
TkVMIFNVUkYgKi8KKwl7IDB4NzMsIEtFWV9aT09NfSwJCS8qIEZVTExTRUNSRUVOICovCisJeyAw
eDM5LCBLRVlfQ0xPU0V9LAkJLyogTUlOSU1JWkUgKi8KKwl7IDB4NjYsIEtFWV9JTkZPfSwJCS8q
IERJU1BMQVkgKi8KKwl7IDB4NjEsIEtFWV9QUkVWSU9VU30sCQkvKiBSRUNBTEwgKi8KKwl7IDB4
NjQsIEtFWV9NVVRFfSwJCS8qIE1VVEUgKi8KKwkKKwl7IDB4NzUsIEtFWV8xfSwKKwl7IDB4NzYs
IEtFWV8yfSwKKwl7IDB4NzcsIEtFWV8zfSwKKwl7IDB4NzksIEtFWV80fSwKKwl7IDB4N2EsIEtF
WV81fSwKKwl7IDB4N2IsIEtFWV82fSwKKwl7IDB4N2QsIEtFWV83fSwKKwl7IDB4N2UsIEtFWV84
fSwKKwl7IDB4N2YsIEtFWV85fSwKKwl7IDB4NjIsIEtFWV8wfSwKKwl7IDB4MzEsIEtFWV9ET1R9
LAkJLyogJy4nICovCisJeyAweDYzLCBLRVlfRU5URVJ9LAkJLyogRU5URVIgKi8KKworCXsgMHgz
NSwgS0VZX1RJTUV9LAkJLyogVElNRVNISUZUICovCisJeyAweDM4LCBLRVlfQ0FNRVJBfSwJCS8q
IFNOQVBTSE9UICovCisJeyAweDM3LCBLRVlfUkVDT1JEfSwJCS8qIFJFQ09SRCAqLworCXsgMHgz
YSwgS0VZX1RWMn0sCQkvKiBQSVAgKi8KKworCXsgMHg3NCwgS0VZX1ZPTFVNRVVQfSwJCS8qIFZP
TFVNRVVQICovCisJeyAweDc4LCBLRVlfVk9MVU1FRE9XTn0sCS8qIFZPTFVNRURPV04gKi8KKwl7
IDB4N2MsIEtFWV9DSEFOTkVMVVB9LAkJLyogQ0hBTk5FTFVQICovCisJeyAweDYwLCBLRVlfQ0hB
Tk5FTERPV059LAkvKiBDSEFOTkVMRE9XTiAqLworfTsKK3N0cnVjdCBpcl9zY2FuY29kZV90YWJs
ZSBpcl9jb2Rlc19sd3R1MmRfdGFibGUgPSB7CisJLnNjYW4gPSBpcl9jb2Rlc19sd3R1MmQsCisJ
LnNpemUgPSBBUlJBWV9TSVpFKGlyX2NvZGVzX2x3dHUyZCksCit9OworRVhQT1JUX1NZTUJPTF9H
UEwoaXJfY29kZXNfbHd0dTJkX3RhYmxlKTsKLS0tIG9yZy92NGwtZHZiL2xpbnV4L2RyaXZlcnMv
bWVkaWEvdmlkZW8vaXIta2JkLWkyYy5jCTIwMDktMTAtMjkgMTM6MDM6NDIuMTU1MDYyNDcyICsw
MTAwCisrKyBleDEvdjRsLWR2Yi9saW51eC9kcml2ZXJzL21lZGlhL3ZpZGVvL2lyLWtiZC1pMmMu
YwkyMDA5LTEwLTI5IDEzOjI4OjAyLjcwNTA2MzI1MyArMDEwMApAQCAtNDE2LDYgKzQxNiw3IEBA
CiAJCWlyX2NvZGVzICAgID0gJmlyX2NvZGVzX3B2OTUxX3RhYmxlOwogCQlicmVhazsKIAljYXNl
IDB4MTg6CisJY2FzZSAweDFmOgogCWNhc2UgMHgxYToKIAkJbmFtZSAgICAgICAgPSAiSGF1cHBh
dWdlIjsKIAkJaXItPmdldF9rZXkgPSBnZXRfa2V5X2hhdXA7Ci0tLSBvcmcvdjRsLWR2Yi9saW51
eC9kcml2ZXJzL21lZGlhL3ZpZGVvL2VtMjh4eC9lbTI4eHgtY2FyZHMuYwkyMDA5LTEwLTI5IDEz
OjAzOjQyLjA0NTA2MTMxMSArMDEwMAorKysgZXgxL3Y0bC1kdmIvbGludXgvZHJpdmVycy9tZWRp
YS92aWRlby9lbTI4eHgvZW0yOHh4LWNhcmRzLmMJMjAwOS0xMC0yOSAxMzo0ODo0My4yODU1MTk1
ODggKzAxMDAKQEAgLTQ2NiwyMiArNDY2LDMxIEBACiAJCS5uYW1lICAgICAgICAgPSAiTGVhZHRl
ayBXaW5mYXN0IFVTQiBJSSBEZWx1eGUiLAogCQkudmFsaWQgICAgICAgID0gRU0yOFhYX0JPQVJE
X05PVF9WQUxJREFURUQsCiAJCS50dW5lcl90eXBlICAgPSBUVU5FUl9QSElMSVBTX0ZNMTIxNk1F
X01LMywKLQkJLnRkYTk4ODdfY29uZiA9IFREQTk4ODdfUFJFU0VOVCwKKwkJLmhhc19pcl9pMmMg
ICA9IDEsCisJCS50dmF1ZGlvX2FkZHIgPSAweDU4LAkJCQkJCisJCS50ZGE5ODg3X2NvbmYgPSBU
REE5ODg3X1BSRVNFTlQgfAorCQkJCVREQTk4ODdfUE9SVDJfQUNUSVZFIHwKKwkJCQlUREE5ODg3
X1FTUywKIAkJLmRlY29kZXIgICAgICA9IEVNMjhYWF9TQUE3MTFYLAotCQkuaW5wdXQgICAgICAg
ID0geyB7CisJCS5hZGVjb2RlciAgICAgPSBFTTI4WFhfVFZBVURJTywKKyAgICAgIAkJLmlucHV0
ICAgICAgICA9IHsgewogCQkJLnR5cGUgICAgID0gRU0yOFhYX1ZNVVhfVEVMRVZJU0lPTiwKLQkJ
CS52bXV4ICAgICA9IFNBQTcxMTVfQ09NUE9TSVRFMiwKLQkJCS5hbXV4ICAgICA9IEVNMjhYWF9B
TVVYX1ZJREVPLAotCQl9LCB7CisJCQkudm11eCAgICAgPSBTQUE3MTE1X0NPTVBPU0lURTQsCisJ
CQkuYW11eCAgICAgPSBFTTI4WFhfQU1VWF9BVVgsCisgICAgICAJCX0sIHsKIAkJCS50eXBlICAg
ICA9IEVNMjhYWF9WTVVYX0NPTVBPU0lURTEsCi0JCQkudm11eCAgICAgPSBTQUE3MTE1X0NPTVBP
U0lURTAsCisJCQkudm11eCAgICAgPSBTQUE3MTE1X0NPTVBPU0lURTUsCiAJCQkuYW11eCAgICAg
PSBFTTI4WFhfQU1VWF9MSU5FX0lOLAotCQl9LCB7CisgICAgICAJCX0sIHsKIAkJCS50eXBlICAg
ICA9IEVNMjhYWF9WTVVYX1NWSURFTywKLQkJCS52bXV4ICAgICA9IFNBQTcxMTVfQ09NUE9TSVRF
MCwKKwkJCS52bXV4ICAgICA9IFNBQTcxMTVfU1ZJREVPMywKIAkJCS5hbXV4ICAgICA9IEVNMjhY
WF9BTVVYX0xJTkVfSU4sCi0JCX0gfSwKLQl9LAorICAgICAgCQl9IH0sCisJCQkucmFkaW8JICA9
IHsKKwkJCS50eXBlICAgICA9IEVNMjhYWF9SQURJTywKKwkJCS5hbXV4ICAgICA9IEVNMjhYWF9B
TVVYX0FVWCwKKyAgICAgICAgICAgICAgICAgICAgICB9CisgICAgICAgIH0sCiAJW0VNMjgyMF9C
T0FSRF9WSURFT0xPR1lfMjBLMTRYVVNCXSA9IHsKIAkJLm5hbWUgICAgICAgICA9ICJWaWRlb2xv
Z3kgMjBLMTRYVVNCIFVTQjIuMCIsCiAJCS52YWxpZCAgICAgICAgPSBFTTI4WFhfQk9BUkRfTk9U
X1ZBTElEQVRFRCwKQEAgLTIzMTAsOSArMjMxOSw5IEBACiAJfQogI2Vsc2UKIAljb25zdCB1bnNp
Z25lZCBzaG9ydCBhZGRyX2xpc3RbXSA9IHsKLQkJIDB4MzAsIDB4NDcsIEkyQ19DTElFTlRfRU5E
Ci0JfTsKLQorCQkgMHgxZiwgMHgzMCwgMHg0NywgSTJDX0NMSUVOVF9FTkQJCQkKKwl9OwkJCQkJ
CQkKKyAgICAgICAgCiAJaWYgKGRpc2FibGVfaXIpCiAJCXJldHVybjsKIApAQCAtMjM2MCw2ICsy
MzY5LDE4IEBACiAJCWRldi0+aW5pdF9kYXRhLm5hbWUgPSAiaTJjIElSIChFTTI4NDAgSGF1cHBh
dWdlKSI7CiAjZW5kaWYKIAkJYnJlYWs7CisJY2FzZSBFTTI4MjBfQk9BUkRfTEVBRFRFS19XSU5G
QVNUX1VTQklJX0RFTFVYRToKKyNpZiBMSU5VWF9WRVJTSU9OX0NPREUgPCBLRVJORUxfVkVSU0lP
TigyLCA2LCAzMCkKKwkJaXItPmlyX2NvZGVzID0gJmlyX2NvZGVzX2x3dHUyZF90YWJsZTsJCQkK
KwkJaXItPmdldF9rZXkgPSBlbTI4eHhfZ2V0X2tleV9sd3R1MmQ7CQkJCisJCXNucHJpbnRmKGly
LT5uYW1lLCBzaXplb2YoaXItPm5hbWUpLAkJCQorCQkJICJpMmMgSVIgKEVNMjgyMCBXaW5mYXN0
IHR2dTJkKSIpOworI2Vsc2UKKwkJZGV2LT5pbml0X2RhdGEuaXJfY29kZXMgPSAmaXJfY29kZXNf
bHd0dTJkX3RhYmxlOwkJCisJCWRldi0+aW5pdF9kYXRhLmdldF9rZXkgPSBlbTI4eHhfZ2V0X2tl
eV9sd3R1MmQ7CQkKKyAgICAgICAgICAgICAgIAlkZXYtPmluaXRfZGF0YS5uYW1lID0gImkyYyBJ
UiAoRU0yODIwIFdpbmZhc3QgdHZ1MmQpIjsKKyNlbmRpZgorCQlicmVhazsKIAl9CiAjaWYgTElO
VVhfVkVSU0lPTl9DT0RFID49IEtFUk5FTF9WRVJTSU9OKDIsIDYsIDMwKQogCi0tLSBvcmcvdjRs
LWR2Yi9saW51eC9kcml2ZXJzL21lZGlhL3ZpZGVvL2VtMjh4eC9lbTI4eHgtaW5wdXQuYwkyMDA5
LTEwLTI5IDEzOjAzOjQyLjA1NTA2NDgyMCArMDEwMAorKysgZXgxL3Y0bC1kdmIvbGludXgvZHJp
dmVycy9tZWRpYS92aWRlby9lbTI4eHgvZW0yOHh4LWlucHV0LmMJMjAwOS0xMC0yOSAxNDowNTo1
NC4yNTU4MjcyNTggKzAxMDAKQEAgLTE3OSw2ICsxNzksNTEgQEAKIAogCXJldHVybiAxOwogfQor
aW50IGVtMjh4eF9nZXRfa2V5X2x3dHUyZChzdHJ1Y3QgSVJfaTJjICppciwgdTMyICppcl9rZXks
IHUzMiAqaXJfcmF3KQoreworCXVuc2lnbmVkIGNoYXIgc3ViYWRkciwga2V5ZGV0ZWN0LCBrZXk7
CisJCisjaWYgTElOVVhfVkVSU0lPTl9DT0RFIDwgS0VSTkVMX1ZFUlNJT04oMiwgNiwgMzApCisJ
c3RydWN0IGkyY19tc2cgbXNnW10gPSB7IHsgLmFkZHIgPSBpci0+Yy5hZGRyLCAuZmxhZ3MgPSAw
LCAuYnVmID0gJnN1YmFkZHIsIC5sZW4gPSAxfSwKKyNlbHNlCisJc3RydWN0IGkyY19tc2cgbXNn
W10gPSB7IHsgLmFkZHIgPSBpci0+Yy0+YWRkciwgLmZsYWdzID0gMCwgLmJ1ZiA9ICZzdWJhZGRy
LCAubGVuID0gMX0sCisjZW5kaWYKKworI2lmIExJTlVYX1ZFUlNJT05fQ09ERSA8IEtFUk5FTF9W
RVJTSU9OKDIsIDYsIDMwKQorCQkJCSB7IC5hZGRyID0gaXItPmMuYWRkciwgLmZsYWdzID0gSTJD
X01fUkQsIC5idWYgPSAma2V5ZGV0ZWN0LCAubGVuID0gMX0gfTsKKyNlbHNlCisJCQkJIHsgLmFk
ZHIgPSBpci0+Yy0+YWRkciwgLmZsYWdzID0gSTJDX01fUkQsIC5idWYgPSAma2V5ZGV0ZWN0LCAu
bGVuID0gMX0gfTsKKyNlbmRpZgorCQkJCSAgCisJc3ViYWRkciA9IDB4MTA7CisjaWYgTElOVVhf
VkVSU0lPTl9DT0RFIDwgS0VSTkVMX1ZFUlNJT04oMiwgNiwgMzApCisJaWYgKDIgIT0gaTJjX3Ry
YW5zZmVyKGlyLT5jLmFkYXB0ZXIsIG1zZywgMikpIHsKKyNlbHNlCisJaWYgKDIgIT0gaTJjX3Ry
YW5zZmVyKGlyLT5jLT5hZGFwdGVyLCBtc2csIDIpKSB7CisjZW5kaWYKKwkJaTJjZHByaW50aygi
cmVhZCBlcnJvclxuIik7CisJCXJldHVybiAtRUlPOworCX0KKwlpZiAoa2V5ZGV0ZWN0ID09IDB4
MDApCisJCXJldHVybiAwOworCisJc3ViYWRkciA9IDB4MDA7CisJbXNnWzFdLmJ1ZiA9ICZrZXk7
CisjaWYgTElOVVhfVkVSU0lPTl9DT0RFIDwgS0VSTkVMX1ZFUlNJT04oMiwgNiwgMzApCisJaWYg
KDIgIT0gaTJjX3RyYW5zZmVyKGlyLT5jLmFkYXB0ZXIsIG1zZywgMikpIHsKKyNlbHNlCisJaWYg
KDIgIT0gaTJjX3RyYW5zZmVyKGlyLT5jLT5hZGFwdGVyLCBtc2csIDIpKSB7CisjZW5kaWYKKwkJ
aTJjZHByaW50aygicmVhZCBlcnJvclxuIik7CisJCXJldHVybiAtRUlPOworCX0KKwlpZiAoa2V5
ID09IDB4MDApCisJCXJldHVybiAwOworCQorCSppcl9rZXkgPSBrZXk7CisJKmlyX3JhdyA9IGtl
eTsKKwlyZXR1cm4gMTsKK30KIAogLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioKICBQb2xsIGJhc2VkIGdldCBrZXljb2RlIGZ1bmN0aW9u
cwotLS0gb3JnL3Y0bC1kdmIvbGludXgvZHJpdmVycy9tZWRpYS92aWRlby9lbTI4eHgvZW0yOHh4
LmgJMjAwOS0xMC0yOSAxMzowMzo0Mi4wNjUwNjEzNDUgKzAxMDAKKysrIGV4MS92NGwtZHZiL2xp
bnV4L2RyaXZlcnMvbWVkaWEvdmlkZW8vZW0yOHh4L2VtMjh4eC5oCTIwMDktMTAtMjcgMTY6NTE6
MDguMjM3NTY1MDAwICswMTAwCkBAIC03MDgsNiArNzA4LDggQEAKIGludCBlbTI4eHhfZ2V0X2tl
eV9lbV9oYXVwKHN0cnVjdCBJUl9pMmMgKmlyLCB1MzIgKmlyX2tleSwgdTMyICppcl9yYXcpOwog
aW50IGVtMjh4eF9nZXRfa2V5X3Bpbm5hY2xlX3VzYl9ncmV5KHN0cnVjdCBJUl9pMmMgKmlyLCB1
MzIgKmlyX2tleSwKIAkJCQkgICAgIHUzMiAqaXJfcmF3KTsKK2ludCBlbTI4eHhfZ2V0X2tleV9s
d3R1MmQoc3RydWN0IElSX2kyYyAqaXIsIHUzMiAqaXJfa2V5LCB1MzIgKmlyX3Jhdyk7CiB2b2lk
IGVtMjh4eF9yZWdpc3Rlcl9zbmFwc2hvdF9idXR0b24oc3RydWN0IGVtMjh4eCAqZGV2KTsKIHZv
aWQgZW0yOHh4X2RlcmVnaXN0ZXJfc25hcHNob3RfYnV0dG9uKHN0cnVjdCBlbTI4eHggKmRldik7
CiAK
--001636417d5fb3ef7f0477131086
Content-Type: text/x-patch; charset=US-ASCII; name="ex2.patch"
Content-Disposition: attachment; filename="ex2.patch"
Content-Transfer-Encoding: base64
X-Attachment-Id: f_g1dj9sgt1

LS0tIG9yZy92NGwtZHZiL2xpbnV4L2luY2x1ZGUvbWVkaWEvaXItY29tbW9uLmgJMjAwOS0xMC0y
OSAxMzowMzo0Mi41MTUwNjE2ODAgKzAxMDAKKysrIGV4Mi92NGwtZHZiL2xpbnV4L2luY2x1ZGUv
bWVkaWEvaXItY29tbW9uLmgJMjAwOS0xMC0yNiAxMjowMDowMC4wMDAwMDAwMDAgKzAxMDAKQEAg
LTE3OSw0ICsxNzksNSBAQAogZXh0ZXJuIHN0cnVjdCBpcl9zY2FuY29kZV90YWJsZSBpcl9jb2Rl
c190ZXJyYXRlY19jaW5lcmd5X3hzX3RhYmxlOwogZXh0ZXJuIHN0cnVjdCBpcl9zY2FuY29kZV90
YWJsZSBpcl9jb2Rlc192aWRlb21hdGVfczM1MF90YWJsZTsKIGV4dGVybiBzdHJ1Y3QgaXJfc2Nh
bmNvZGVfdGFibGUgaXJfY29kZXNfZ2FkbWVpX3JtMDA4el90YWJsZTsKK2V4dGVybiBzdHJ1Y3Qg
aXJfc2NhbmNvZGVfdGFibGUgaXJfY29kZXNfbHd0dTJkX3RhYmxlOwogI2VuZGlmCi0tLSBvcmcv
djRsLWR2Yi9saW51eC9kcml2ZXJzL21lZGlhL2NvbW1vbi9pci1rZXltYXBzLmMJMjAwOS0xMC0y
OSAxMzowMzo0MS41MjUwNjIzOTYgKzAxMDAKKysrIGV4Mi92NGwtZHZiL2xpbnV4L2RyaXZlcnMv
bWVkaWEvY29tbW9uL2lyLWtleW1hcHMuYwkyMDA5LTEwLTI3IDE2OjUxOjA4LjI2NzU2NjAwMCAr
MDEwMApAQCAtMzMwMiwzICszMzAyLDQyIEBACiAJLnNpemUgPSBBUlJBWV9TSVpFKGlyX2NvZGVz
X2dhZG1laV9ybTAwOHopLAogfTsKIEVYUE9SVF9TWU1CT0xfR1BMKGlyX2NvZGVzX2dhZG1laV9y
bTAwOHpfdGFibGUpOworCitzdGF0aWMgc3RydWN0IGlyX3NjYW5jb2RlIGlyX2NvZGVzX2x3dHUy
ZFtdID0geworCXsgMHg3MCwgS0VZX1BPV0VSMn0sCQkvKiBQT1dFUiBPRkYqLworCXsgMHg3Miwg
S0VZX01PREV9LCAJCS8qIFRWL0ZNICovCisJeyAweDIxLCBLRVlfQ0hBTk5FTH0sCQkvKiBDSEFO
TkVMIFNVUkYgKi8KKwl7IDB4NzMsIEtFWV9aT09NfSwJCS8qIEZVTExTRUNSRUVOICovCisJeyAw
eDM5LCBLRVlfQ0xPU0V9LAkJLyogTUlOSU1JWkUgKi8KKwl7IDB4NjYsIEtFWV9JTkZPfSwJCS8q
IERJU1BMQVkgKi8KKwl7IDB4NjEsIEtFWV9QUkVWSU9VU30sCQkvKiBSRUNBTEwgKi8KKwl7IDB4
NjQsIEtFWV9NVVRFfSwJCS8qIE1VVEUgKi8KKwkKKwl7IDB4NzUsIEtFWV8xfSwKKwl7IDB4NzYs
IEtFWV8yfSwKKwl7IDB4NzcsIEtFWV8zfSwKKwl7IDB4NzksIEtFWV80fSwKKwl7IDB4N2EsIEtF
WV81fSwKKwl7IDB4N2IsIEtFWV82fSwKKwl7IDB4N2QsIEtFWV83fSwKKwl7IDB4N2UsIEtFWV84
fSwKKwl7IDB4N2YsIEtFWV85fSwKKwl7IDB4NjIsIEtFWV8wfSwKKwl7IDB4MzEsIEtFWV9ET1R9
LAkJLyogJy4nICovCisJeyAweDYzLCBLRVlfRU5URVJ9LAkJLyogRU5URVIgKi8KKworCXsgMHgz
NSwgS0VZX1RJTUV9LAkJLyogVElNRVNISUZUICovCisJeyAweDM4LCBLRVlfQ0FNRVJBfSwJCS8q
IFNOQVBTSE9UICovCisJeyAweDM3LCBLRVlfUkVDT1JEfSwJCS8qIFJFQ09SRCAqLworCXsgMHgz
YSwgS0VZX1RWMn0sCQkvKiBQSVAgKi8KKworCXsgMHg3NCwgS0VZX1ZPTFVNRVVQfSwJCS8qIFZP
TFVNRVVQICovCisJeyAweDc4LCBLRVlfVk9MVU1FRE9XTn0sCS8qIFZPTFVNRURPV04gKi8KKwl7
IDB4N2MsIEtFWV9DSEFOTkVMVVB9LAkJLyogQ0hBTk5FTFVQICovCisJeyAweDYwLCBLRVlfQ0hB
Tk5FTERPV059LAkvKiBDSEFOTkVMRE9XTiAqLworfTsKK3N0cnVjdCBpcl9zY2FuY29kZV90YWJs
ZSBpcl9jb2Rlc19sd3R1MmRfdGFibGUgPSB7CisJLnNjYW4gPSBpcl9jb2Rlc19sd3R1MmQsCisJ
LnNpemUgPSBBUlJBWV9TSVpFKGlyX2NvZGVzX2x3dHUyZCksCit9OworRVhQT1JUX1NZTUJPTF9H
UEwoaXJfY29kZXNfbHd0dTJkX3RhYmxlKTsKLS0tIG9yZy92NGwtZHZiL2xpbnV4L2RyaXZlcnMv
bWVkaWEvdmlkZW8vaXIta2JkLWkyYy5jCTIwMDktMTAtMjkgMTM6MDM6NDIuMTU1MDYyNDcyICsw
MTAwCisrKyBleDIvdjRsLWR2Yi9saW51eC9kcml2ZXJzL21lZGlhL3ZpZGVvL2lyLWtiZC1pMmMu
YwkyMDA5LTEwLTI5IDE0OjA1OjA5LjA5NTM4MTEyOCArMDEwMApAQCAtMjk1LDYgKzI5NSw1MiBA
QAogCXJldHVybiAxOwogfQogCitzdGF0aWMgaW50IGdldF9rZXlfbHd0dTJkKHN0cnVjdCBJUl9p
MmMgKmlyLCB1MzIgKmlyX2tleSwgdTMyICppcl9yYXcpCit7CisJdW5zaWduZWQgY2hhciBzdWJh
ZGRyLCBrZXlkZXRlY3QsIGtleTsKKwkKKyNpZiBMSU5VWF9WRVJTSU9OX0NPREUgPCBLRVJORUxf
VkVSU0lPTigyLCA2LCAzMCkKKwlzdHJ1Y3QgaTJjX21zZyBtc2dbXSA9IHsgeyAuYWRkciA9IGly
LT5jLmFkZHIsIC5mbGFncyA9IDAsIAorI2Vsc2UKKwlzdHJ1Y3QgaTJjX21zZyBtc2dbXSA9IHsg
eyAuYWRkciA9IGlyLT5jLT5hZGRyLCAuZmxhZ3MgPSAwLCAKKyNlbmRpZgorCQkJCSAgIC5idWYg
PSAmc3ViYWRkciwgLmxlbiA9IDF9LAorCisjaWYgTElOVVhfVkVSU0lPTl9DT0RFIDwgS0VSTkVM
X1ZFUlNJT04oMiwgNiwgMzApCisJCQkJIHsgLmFkZHIgPSBpci0+Yy5hZGRyLCAuZmxhZ3MgPSBJ
MkNfTV9SRCwgCisjZWxzZQorCQkJCSB7IC5hZGRyID0gaXItPmMtPmFkZHIsIC5mbGFncyA9IEky
Q19NX1JELCAKKyNlbmRpZgorCQkJCSAgIC5idWYgPSAma2V5ZGV0ZWN0LCAubGVuID0gMX0gfTsK
KwlzdWJhZGRyID0gMHgxMDsKKyNpZiBMSU5VWF9WRVJTSU9OX0NPREUgPCBLRVJORUxfVkVSU0lP
TigyLCA2LCAzMCkKKwlpZiAoMiAhPSBpMmNfdHJhbnNmZXIoaXItPmMuYWRhcHRlciwgbXNnLCAy
KSkgeworI2Vsc2UKKwlpZiAoMiAhPSBpMmNfdHJhbnNmZXIoaXItPmMtPmFkYXB0ZXIsIG1zZywg
MikpIHsKKyNlbmRpZgorCQlkcHJpbnRrKDEsICJyZWFkIGVycm9yXG4iKTsKKwkJcmV0dXJuIC1F
SU87CisJfQorCWlmIChrZXlkZXRlY3QgPT0gMHgwMCkKKwkJcmV0dXJuIDA7CisKKwlzdWJhZGRy
ID0gMHgwMDsKKwltc2dbMV0uYnVmID0gJmtleTsKKyNpZiBMSU5VWF9WRVJTSU9OX0NPREUgPCBL
RVJORUxfVkVSU0lPTigyLCA2LCAzMCkKKwlpZiAoMiAhPSBpMmNfdHJhbnNmZXIoaXItPmMuYWRh
cHRlciwgbXNnLCAyKSkgeworI2Vsc2UKKwlpZiAoMiAhPSBpMmNfdHJhbnNmZXIoaXItPmMtPmFk
YXB0ZXIsIG1zZywgMikpIHsKKyNlbmRpZgorCQlkcHJpbnRrKDEsICJyZWFkIGVycm9yXG4iKTsK
KwkJcmV0dXJuIC1FSU87CisJfQorCWlmIChrZXkgPT0gMHgwMCkKKwkJcmV0dXJuIDA7CisJCisJ
KmlyX2tleSA9IGtleTsKKwkqaXJfcmF3ID0ga2V5OworCXJldHVybiAxOworfQogLyogLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0gKi8KIAogc3RhdGljIHZvaWQgaXJfa2V5X3BvbGwoc3RydWN0IElSX2kyYyAqaXIp
CkBAIC00MTYsNiArNDYyLDEyIEBACiAJCWlyX2NvZGVzICAgID0gJmlyX2NvZGVzX3B2OTUxX3Rh
YmxlOwogCQlicmVhazsKIAljYXNlIDB4MTg6CisJY2FzZSAweDFmOgorCQluYW1lICAgICAgICA9
ICJMZWFkdGVrIFdpbmZhc3QgVFYgVVNCIElJIERlbHV4ZSByZW1vdGUiOworCQlpci0+Z2V0X2tl
eSA9IGdldF9rZXlfbHd0dTJkOworCQlpcl90eXBlICAgICA9IElSX1RZUEVfT1RIRVI7CisJCWly
X2NvZGVzICAgID0gJmlyX2NvZGVzX2x3dHUyZF90YWJsZTsKKwkJYnJlYWs7CiAJY2FzZSAweDFh
OgogCQluYW1lICAgICAgICA9ICJIYXVwcGF1Z2UiOwogCQlpci0+Z2V0X2tleSA9IGdldF9rZXlf
aGF1cDsKQEAgLTYzMyw3ICs2ODUsNyBAQAogCiAJc3RhdGljIGNvbnN0IGludCBwcm9iZV9idHR2
W10gPSB7IDB4MWEsIDB4MTgsIDB4NGIsIDB4NjQsIDB4MzAsIC0xfTsKIAlzdGF0aWMgY29uc3Qg
aW50IHByb2JlX3NhYTcxMzRbXSA9IHsgMHg3YSwgMHg0NywgMHg3MSwgMHgyZCwgLTEgfTsKLQlz
dGF0aWMgY29uc3QgaW50IHByb2JlX2VtMjhYWFtdID0geyAweDMwLCAweDQ3LCAtMSB9OworCXN0
YXRpYyBjb25zdCBpbnQgcHJvYmVfZW0yOFhYW10gPSB7IDB4MWYsIDB4MzAsIDB4NDcsIC0xIH07
CiAJc3RhdGljIGNvbnN0IGludCBwcm9iZV9jeDg4W10gPSB7IDB4MTgsIDB4NmIsIDB4NzEsIC0x
IH07CiAJc3RhdGljIGNvbnN0IGludCBwcm9iZV9jeDIzODg1W10gPSB7IDB4NmIsIC0xIH07CiAJ
Y29uc3QgaW50ICpwcm9iZTsKLS0tIG9yZy92NGwtZHZiL2xpbnV4L2RyaXZlcnMvbWVkaWEvdmlk
ZW8vZW0yOHh4L2VtMjh4eC1jYXJkcy5jCTIwMDktMTAtMjkgMTM6MDM6NDIuMDQ1MDYxMzExICsw
MTAwCisrKyBleDIvdjRsLWR2Yi9saW51eC9kcml2ZXJzL21lZGlhL3ZpZGVvL2VtMjh4eC9lbTI4
eHgtY2FyZHMuYwkyMDA5LTEwLTI5IDEzOjQzOjM2LjY4NTA2MTI2NCArMDEwMApAQCAtNDY2LDIy
ICs0NjYsMzEgQEAKIAkJLm5hbWUgICAgICAgICA9ICJMZWFkdGVrIFdpbmZhc3QgVVNCIElJIERl
bHV4ZSIsCiAJCS52YWxpZCAgICAgICAgPSBFTTI4WFhfQk9BUkRfTk9UX1ZBTElEQVRFRCwKIAkJ
LnR1bmVyX3R5cGUgICA9IFRVTkVSX1BISUxJUFNfRk0xMjE2TUVfTUszLAotCQkudGRhOTg4N19j
b25mID0gVERBOTg4N19QUkVTRU5ULAorCQkuaGFzX2lyX2kyYyAgID0gMSwKKwkJLnR2YXVkaW9f
YWRkciA9IDB4NTgsCisJCS50ZGE5ODg3X2NvbmYgPSBUREE5ODg3X1BSRVNFTlQgfAorCQkJCVRE
QTk4ODdfUE9SVDJfQUNUSVZFIHwKKwkJCQlUREE5ODg3X1FTUywKIAkJLmRlY29kZXIgICAgICA9
IEVNMjhYWF9TQUE3MTFYLAorCQkuYWRlY29kZXIgICAgID0gRU0yOFhYX1RWQVVESU8sCiAJCS5p
bnB1dCAgICAgICAgPSB7IHsKIAkJCS50eXBlICAgICA9IEVNMjhYWF9WTVVYX1RFTEVWSVNJT04s
Ci0JCQkudm11eCAgICAgPSBTQUE3MTE1X0NPTVBPU0lURTIsCi0JCQkuYW11eCAgICAgPSBFTTI4
WFhfQU1VWF9WSURFTywKLQkJfSwgeworCQkJLnZtdXggICAgID0gU0FBNzExNV9DT01QT1NJVEU0
LAorCQkJLmFtdXggICAgID0gRU0yOFhYX0FNVVhfQVVYLAorICAgICAgCQl9LCB7CiAJCQkudHlw
ZSAgICAgPSBFTTI4WFhfVk1VWF9DT01QT1NJVEUxLAotCQkJLnZtdXggICAgID0gU0FBNzExNV9D
T01QT1NJVEUwLAorCQkJLnZtdXggICAgID0gU0FBNzExNV9DT01QT1NJVEU1LAogCQkJLmFtdXgg
ICAgID0gRU0yOFhYX0FNVVhfTElORV9JTiwKLQkJfSwgeworICAgICAgCQl9LCB7CiAJCQkudHlw
ZSAgICAgPSBFTTI4WFhfVk1VWF9TVklERU8sCi0JCQkudm11eCAgICAgPSBTQUE3MTE1X0NPTVBP
U0lURTAsCisJCQkudm11eCAgICAgPSBTQUE3MTE1X1NWSURFTzMsCiAJCQkuYW11eCAgICAgPSBF
TTI4WFhfQU1VWF9MSU5FX0lOLAotCQl9IH0sCi0JfSwKKyAgICAgIAkJfSB9LAorCQkJLnJhZGlv
CSAgPSB7CisJCQkudHlwZSAgICAgPSBFTTI4WFhfUkFESU8sCisJCQkuYW11eCAgICAgPSBFTTI4
WFhfQU1VWF9BVVgsCisgICAgICAgICAgICAgICAgICAgICAgfQorICAgICAgICB9LAogCVtFTTI4
MjBfQk9BUkRfVklERU9MT0dZXzIwSzE0WFVTQl0gPSB7CiAJCS5uYW1lICAgICAgICAgPSAiVmlk
ZW9sb2d5IDIwSzE0WFVTQiBVU0IyLjAiLAogCQkudmFsaWQgICAgICAgID0gRU0yOFhYX0JPQVJE
X05PVF9WQUxJREFURUQsCkBAIC0yMzEwLDkgKzIzMTksOSBAQAogCX0KICNlbHNlCiAJY29uc3Qg
dW5zaWduZWQgc2hvcnQgYWRkcl9saXN0W10gPSB7Ci0JCSAweDMwLCAweDQ3LCBJMkNfQ0xJRU5U
X0VORAotCX07Ci0KKwkJIDB4MWYsIDB4MzAsIDB4NDcsIEkyQ19DTElFTlRfRU5ECQkJCisJfTsJ
CQkJCQkJCisgICAgICAgIAogCWlmIChkaXNhYmxlX2lyKQogCQlyZXR1cm47CiAK
--001636417d5fb3ef7f0477131086
Content-Type: text/x-patch; charset=US-ASCII; name="ex3.patch"
Content-Disposition: attachment; filename="ex3.patch"
Content-Transfer-Encoding: base64
X-Attachment-Id: f_g1dj9x252

LS0tIG9yZy92NGwtZHZiL2xpbnV4L2luY2x1ZGUvbWVkaWEvaXItY29tbW9uLmgJMjAwOS0xMC0y
OSAxMzowMzo0Mi41MTUwNjE2ODAgKzAxMDAKKysrIGV4My92NGwtZHZiL2xpbnV4L2luY2x1ZGUv
bWVkaWEvaXItY29tbW9uLmgJMjAwOS0xMC0yNiAxMjowMDowMC4wMDAwMDAwMDAgKzAxMDAKQEAg
LTE3OSw0ICsxNzksNSBAQAogZXh0ZXJuIHN0cnVjdCBpcl9zY2FuY29kZV90YWJsZSBpcl9jb2Rl
c190ZXJyYXRlY19jaW5lcmd5X3hzX3RhYmxlOwogZXh0ZXJuIHN0cnVjdCBpcl9zY2FuY29kZV90
YWJsZSBpcl9jb2Rlc192aWRlb21hdGVfczM1MF90YWJsZTsKIGV4dGVybiBzdHJ1Y3QgaXJfc2Nh
bmNvZGVfdGFibGUgaXJfY29kZXNfZ2FkbWVpX3JtMDA4el90YWJsZTsKK2V4dGVybiBzdHJ1Y3Qg
aXJfc2NhbmNvZGVfdGFibGUgaXJfY29kZXNfbHd0dTJkX3RhYmxlOwogI2VuZGlmCi0tLSBvcmcv
djRsLWR2Yi9saW51eC9kcml2ZXJzL21lZGlhL2NvbW1vbi9pci1rZXltYXBzLmMJMjAwOS0xMC0y
OSAxMzowMzo0MS41MjUwNjIzOTYgKzAxMDAKKysrIGV4My92NGwtZHZiL2xpbnV4L2RyaXZlcnMv
bWVkaWEvY29tbW9uL2lyLWtleW1hcHMuYwkyMDA5LTEwLTI3IDE2OjUxOjA4LjI2NzU2NjAwMCAr
MDEwMApAQCAtMzMwMiwzICszMzAyLDQyIEBACiAJLnNpemUgPSBBUlJBWV9TSVpFKGlyX2NvZGVz
X2dhZG1laV9ybTAwOHopLAogfTsKIEVYUE9SVF9TWU1CT0xfR1BMKGlyX2NvZGVzX2dhZG1laV9y
bTAwOHpfdGFibGUpOworCitzdGF0aWMgc3RydWN0IGlyX3NjYW5jb2RlIGlyX2NvZGVzX2x3dHUy
ZFtdID0geworCXsgMHg3MCwgS0VZX1BPV0VSMn0sCQkvKiBQT1dFUiBPRkYqLworCXsgMHg3Miwg
S0VZX01PREV9LCAJCS8qIFRWL0ZNICovCisJeyAweDIxLCBLRVlfQ0hBTk5FTH0sCQkvKiBDSEFO
TkVMIFNVUkYgKi8KKwl7IDB4NzMsIEtFWV9aT09NfSwJCS8qIEZVTExTRUNSRUVOICovCisJeyAw
eDM5LCBLRVlfQ0xPU0V9LAkJLyogTUlOSU1JWkUgKi8KKwl7IDB4NjYsIEtFWV9JTkZPfSwJCS8q
IERJU1BMQVkgKi8KKwl7IDB4NjEsIEtFWV9QUkVWSU9VU30sCQkvKiBSRUNBTEwgKi8KKwl7IDB4
NjQsIEtFWV9NVVRFfSwJCS8qIE1VVEUgKi8KKwkKKwl7IDB4NzUsIEtFWV8xfSwKKwl7IDB4NzYs
IEtFWV8yfSwKKwl7IDB4NzcsIEtFWV8zfSwKKwl7IDB4NzksIEtFWV80fSwKKwl7IDB4N2EsIEtF
WV81fSwKKwl7IDB4N2IsIEtFWV82fSwKKwl7IDB4N2QsIEtFWV83fSwKKwl7IDB4N2UsIEtFWV84
fSwKKwl7IDB4N2YsIEtFWV85fSwKKwl7IDB4NjIsIEtFWV8wfSwKKwl7IDB4MzEsIEtFWV9ET1R9
LAkJLyogJy4nICovCisJeyAweDYzLCBLRVlfRU5URVJ9LAkJLyogRU5URVIgKi8KKworCXsgMHgz
NSwgS0VZX1RJTUV9LAkJLyogVElNRVNISUZUICovCisJeyAweDM4LCBLRVlfQ0FNRVJBfSwJCS8q
IFNOQVBTSE9UICovCisJeyAweDM3LCBLRVlfUkVDT1JEfSwJCS8qIFJFQ09SRCAqLworCXsgMHgz
YSwgS0VZX1RWMn0sCQkvKiBQSVAgKi8KKworCXsgMHg3NCwgS0VZX1ZPTFVNRVVQfSwJCS8qIFZP
TFVNRVVQICovCisJeyAweDc4LCBLRVlfVk9MVU1FRE9XTn0sCS8qIFZPTFVNRURPV04gKi8KKwl7
IDB4N2MsIEtFWV9DSEFOTkVMVVB9LAkJLyogQ0hBTk5FTFVQICovCisJeyAweDYwLCBLRVlfQ0hB
Tk5FTERPV059LAkvKiBDSEFOTkVMRE9XTiAqLworfTsKK3N0cnVjdCBpcl9zY2FuY29kZV90YWJs
ZSBpcl9jb2Rlc19sd3R1MmRfdGFibGUgPSB7CisJLnNjYW4gPSBpcl9jb2Rlc19sd3R1MmQsCisJ
LnNpemUgPSBBUlJBWV9TSVpFKGlyX2NvZGVzX2x3dHUyZCksCit9OworRVhQT1JUX1NZTUJPTF9H
UEwoaXJfY29kZXNfbHd0dTJkX3RhYmxlKTsKLS0tIG9yZy92NGwtZHZiL2xpbnV4L2RyaXZlcnMv
bWVkaWEvdmlkZW8vaXIta2JkLWkyYy5jCTIwMDktMTAtMjkgMTM6MDM6NDIuMTU1MDYyNDcyICsw
MTAwCisrKyBleDMvdjRsLWR2Yi9saW51eC9kcml2ZXJzL21lZGlhL3ZpZGVvL2lyLWtiZC1pMmMu
YwkyMDA5LTEwLTI5IDE0OjA0OjQzLjM5NTEzNjM0NyArMDEwMApAQCAtMjk1LDYgKzI5NSwzNyBA
QAogCXJldHVybiAxOwogfQogCisjaWYgTElOVVhfVkVSU0lPTl9DT0RFIDwgS0VSTkVMX1ZFUlNJ
T04oMiwgNiwgMzApCitzdGF0aWMgaW50IGdldF9rZXlfbHd0dTJkKHN0cnVjdCBJUl9pMmMgKmly
LCB1MzIgKmlyX2tleSwgdTMyICppcl9yYXcpCit7CisJdW5zaWduZWQgY2hhciBzdWJhZGRyLCBr
ZXlkZXRlY3QsIGtleTsKKwkKKwlzdHJ1Y3QgaTJjX21zZyBtc2dbXSA9IHsgeyAuYWRkciA9IGly
LT5jLmFkZHIsIC5mbGFncyA9IDAsIAorCQkJCSAgIC5idWYgPSAmc3ViYWRkciwgLmxlbiA9IDF9
LAorCQkJCSB7IC5hZGRyID0gaXItPmMuYWRkciwgLmZsYWdzID0gSTJDX01fUkQsIAorCQkJCSAg
IC5idWYgPSAma2V5ZGV0ZWN0LCAubGVuID0gMX0gfTsKKwlzdWJhZGRyID0gMHgxMDsKKwlpZiAo
MiAhPSBpMmNfdHJhbnNmZXIoaXItPmMuYWRhcHRlciwgbXNnLCAyKSkgeworCQlkcHJpbnRrKDEs
ICJyZWFkIGVycm9yXG4iKTsKKwkJcmV0dXJuIC1FSU87CisJfQorCWlmIChrZXlkZXRlY3QgPT0g
MHgwMCkKKwkJcmV0dXJuIDA7CisKKwlzdWJhZGRyID0gMHgwMDsKKwltc2dbMV0uYnVmID0gJmtl
eTsKKwlpZiAoMiAhPSBpMmNfdHJhbnNmZXIoaXItPmMuYWRhcHRlciwgbXNnLCAyKSkgeworCQlk
cHJpbnRrKDEsICJyZWFkIGVycm9yXG4iKTsKKwkJcmV0dXJuIC1FSU87CisJfQorCWlmIChrZXkg
PT0gMHgwMCkKKwkJcmV0dXJuIDA7CisJCisJKmlyX2tleSA9IGtleTsKKwkqaXJfcmF3ID0ga2V5
OworCXJldHVybiAxOworfQorI2VuZGlmCiAvKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqLwogCiBzdGF0aWMg
dm9pZCBpcl9rZXlfcG9sbChzdHJ1Y3QgSVJfaTJjICppcikKQEAgLTQxNiw2ICs0NDcsMTQgQEAK
IAkJaXJfY29kZXMgICAgPSAmaXJfY29kZXNfcHY5NTFfdGFibGU7CiAJCWJyZWFrOwogCWNhc2Ug
MHgxODoKKwljYXNlIDB4MWY6CisjaWYgTElOVVhfVkVSU0lPTl9DT0RFIDwgS0VSTkVMX1ZFUlNJ
T04oMiwgNiwgMzApCisJCW5hbWUgICAgICAgID0gIkxlYWR0ZWsgV2luZmFzdCBUViBVU0IgSUkg
RGVsdXhlIHJlbW90ZSI7CisJCWlyLT5nZXRfa2V5ID0gZ2V0X2tleV9sd3R1MmQ7CisJCWlyX3R5
cGUgICAgID0gSVJfVFlQRV9PVEhFUjsKKwkJaXJfY29kZXMgICAgPSAmaXJfY29kZXNfbHd0dTJk
X3RhYmxlOworCQlicmVhazsKKyNlbmRpZgogCWNhc2UgMHgxYToKIAkJbmFtZSAgICAgICAgPSAi
SGF1cHBhdWdlIjsKIAkJaXItPmdldF9rZXkgPSBnZXRfa2V5X2hhdXA7CkBAIC02MzMsNyArNjcy
LDcgQEAKIAogCXN0YXRpYyBjb25zdCBpbnQgcHJvYmVfYnR0dltdID0geyAweDFhLCAweDE4LCAw
eDRiLCAweDY0LCAweDMwLCAtMX07CiAJc3RhdGljIGNvbnN0IGludCBwcm9iZV9zYWE3MTM0W10g
PSB7IDB4N2EsIDB4NDcsIDB4NzEsIDB4MmQsIC0xIH07Ci0Jc3RhdGljIGNvbnN0IGludCBwcm9i
ZV9lbTI4WFhbXSA9IHsgMHgzMCwgMHg0NywgLTEgfTsKKwlzdGF0aWMgY29uc3QgaW50IHByb2Jl
X2VtMjhYWFtdID0geyAweDFmLCAweDMwLCAweDQ3LCAtMSB9OwogCXN0YXRpYyBjb25zdCBpbnQg
cHJvYmVfY3g4OFtdID0geyAweDE4LCAweDZiLCAweDcxLCAtMSB9OwogCXN0YXRpYyBjb25zdCBp
bnQgcHJvYmVfY3gyMzg4NVtdID0geyAweDZiLCAtMSB9OwogCWNvbnN0IGludCAqcHJvYmU7Ci0t
LSBvcmcvdjRsLWR2Yi9saW51eC9kcml2ZXJzL21lZGlhL3ZpZGVvL2VtMjh4eC9lbTI4eHgtY2Fy
ZHMuYwkyMDA5LTEwLTI5IDEzOjAzOjQyLjA0NTA2MTMxMSArMDEwMAorKysgZXgzL3Y0bC1kdmIv
bGludXgvZHJpdmVycy9tZWRpYS92aWRlby9lbTI4eHgvZW0yOHh4LWNhcmRzLmMJMjAwOS0xMC0y
OSAxNDowNDozOC45MzUwNjQ2MTggKzAxMDAKQEAgLTQ2NiwyMiArNDY2LDMxIEBACiAJCS5uYW1l
ICAgICAgICAgPSAiTGVhZHRlayBXaW5mYXN0IFVTQiBJSSBEZWx1eGUiLAogCQkudmFsaWQgICAg
ICAgID0gRU0yOFhYX0JPQVJEX05PVF9WQUxJREFURUQsCiAJCS50dW5lcl90eXBlICAgPSBUVU5F
Ul9QSElMSVBTX0ZNMTIxNk1FX01LMywKLQkJLnRkYTk4ODdfY29uZiA9IFREQTk4ODdfUFJFU0VO
VCwKKwkJLmhhc19pcl9pMmMgICA9IDEsCisJCS50dmF1ZGlvX2FkZHIgPSAweDU4LAorCQkudGRh
OTg4N19jb25mID0gVERBOTg4N19QUkVTRU5UIHwKKwkJCQlUREE5ODg3X1BPUlQyX0FDVElWRSB8
CisJCQkJVERBOTg4N19RU1MsCiAJCS5kZWNvZGVyICAgICAgPSBFTTI4WFhfU0FBNzExWCwKKwkJ
LmFkZWNvZGVyICAgICA9IEVNMjhYWF9UVkFVRElPLAogCQkuaW5wdXQgICAgICAgID0geyB7CiAJ
CQkudHlwZSAgICAgPSBFTTI4WFhfVk1VWF9URUxFVklTSU9OLAotCQkJLnZtdXggICAgID0gU0FB
NzExNV9DT01QT1NJVEUyLAotCQkJLmFtdXggICAgID0gRU0yOFhYX0FNVVhfVklERU8sCi0JCX0s
IHsKKwkJCS52bXV4ICAgICA9IFNBQTcxMTVfQ09NUE9TSVRFNCwKKwkJCS5hbXV4ICAgICA9IEVN
MjhYWF9BTVVYX0FVWCwKKyAgICAgIAkJfSwgewogCQkJLnR5cGUgICAgID0gRU0yOFhYX1ZNVVhf
Q09NUE9TSVRFMSwKLQkJCS52bXV4ICAgICA9IFNBQTcxMTVfQ09NUE9TSVRFMCwKKwkJCS52bXV4
ICAgICA9IFNBQTcxMTVfQ09NUE9TSVRFNSwKIAkJCS5hbXV4ICAgICA9IEVNMjhYWF9BTVVYX0xJ
TkVfSU4sCi0JCX0sIHsKKyAgICAgIAkJfSwgewogCQkJLnR5cGUgICAgID0gRU0yOFhYX1ZNVVhf
U1ZJREVPLAotCQkJLnZtdXggICAgID0gU0FBNzExNV9DT01QT1NJVEUwLAorCQkJLnZtdXggICAg
ID0gU0FBNzExNV9TVklERU8zLAogCQkJLmFtdXggICAgID0gRU0yOFhYX0FNVVhfTElORV9JTiwK
LQkJfSB9LAotCX0sCisgICAgICAJCX0gfSwKKwkJCS5yYWRpbwkgID0geworCQkJLnR5cGUgICAg
ID0gRU0yOFhYX1JBRElPLAorCQkJLmFtdXggICAgID0gRU0yOFhYX0FNVVhfQVVYLAorICAgICAg
ICAgICAgICAgICAgICAgIH0KKyAgICAgICAgfSwKIAlbRU0yODIwX0JPQVJEX1ZJREVPTE9HWV8y
MEsxNFhVU0JdID0gewogCQkubmFtZSAgICAgICAgID0gIlZpZGVvbG9neSAyMEsxNFhVU0IgVVNC
Mi4wIiwKIAkJLnZhbGlkICAgICAgICA9IEVNMjhYWF9CT0FSRF9OT1RfVkFMSURBVEVELApAQCAt
MjMxMCw5ICsyMzE5LDkgQEAKIAl9CiAjZWxzZQogCWNvbnN0IHVuc2lnbmVkIHNob3J0IGFkZHJf
bGlzdFtdID0gewotCQkgMHgzMCwgMHg0NywgSTJDX0NMSUVOVF9FTkQKLQl9OwotCisJCSAweDFm
LCAweDMwLCAweDQ3LCBJMkNfQ0xJRU5UX0VORAkJCQorCX07CQkJCQkJCQorICAgICAgICAKIAlp
ZiAoZGlzYWJsZV9pcikKIAkJcmV0dXJuOwogCkBAIC0yMzYwLDYgKzIzNjksMTMgQEAKIAkJZGV2
LT5pbml0X2RhdGEubmFtZSA9ICJpMmMgSVIgKEVNMjg0MCBIYXVwcGF1Z2UpIjsKICNlbmRpZgog
CQlicmVhazsKKyNpZiBMSU5VWF9WRVJTSU9OX0NPREUgPj0gS0VSTkVMX1ZFUlNJT04oMiwgNiwg
MzApCisJY2FzZSBFTTI4MjBfQk9BUkRfTEVBRFRFS19XSU5GQVNUX1VTQklJX0RFTFVYRToKKwkJ
ZGV2LT5pbml0X2RhdGEuaXJfY29kZXMgPSAmaXJfY29kZXNfbHd0dTJkX3RhYmxlOworCQlkZXYt
PmluaXRfZGF0YS5nZXRfa2V5ID0gZW0yOHh4X2dldF9rZXlfbHd0dTJkOworICAgICAgICAgICAg
ICAgCWRldi0+aW5pdF9kYXRhLm5hbWUgPSAiaTJjIElSIChFTTI4MjAgV2luZmFzdCB0dnUyZCki
OworCQlicmVhazsKKyNlbmRpZgogCX0KICNpZiBMSU5VWF9WRVJTSU9OX0NPREUgPj0gS0VSTkVM
X1ZFUlNJT04oMiwgNiwgMzApCiAKLS0tIG9yZy92NGwtZHZiL2xpbnV4L2RyaXZlcnMvbWVkaWEv
dmlkZW8vZW0yOHh4L2VtMjh4eC1pbnB1dC5jCTIwMDktMTAtMjkgMTM6MDM6NDIuMDU1MDY0ODIw
ICswMTAwCisrKyBleDMvdjRsLWR2Yi9saW51eC9kcml2ZXJzL21lZGlhL3ZpZGVvL2VtMjh4eC9l
bTI4eHgtaW5wdXQuYwkyMDA5LTEwLTI5IDE0OjA0OjQxLjU0NTgzNzEwOCArMDEwMApAQCAtMTc5
LDcgKzE3OSwzNiBAQAogCiAJcmV0dXJuIDE7CiB9CisjaWYgTElOVVhfVkVSU0lPTl9DT0RFID49
IEtFUk5FTF9WRVJTSU9OKDIsIDYsIDMwKQoraW50IGVtMjh4eF9nZXRfa2V5X2x3dHUyZChzdHJ1
Y3QgSVJfaTJjICppciwgdTMyICppcl9rZXksIHUzMiAqaXJfcmF3KQoreworCXVuc2lnbmVkIGNo
YXIgc3ViYWRkciwga2V5ZGV0ZWN0LCBrZXk7CisKKwlzdHJ1Y3QgaTJjX21zZyBtc2dbXSA9IHsg
eyAuYWRkciA9IGlyLT5jLT5hZGRyLCAuZmxhZ3MgPSAwLCAuYnVmID0gJnN1YmFkZHIsIC5sZW4g
PSAxfSwKKwkJCQkgeyAuYWRkciA9IGlyLT5jLT5hZGRyLCAuZmxhZ3MgPSBJMkNfTV9SRCwgLmJ1
ZiA9ICZrZXlkZXRlY3QsIC5sZW4gPSAxfSB9OworCQkJCSAgCisJc3ViYWRkciA9IDB4MTA7CisJ
aWYgKDIgIT0gaTJjX3RyYW5zZmVyKGlyLT5jLT5hZGFwdGVyLCBtc2csIDIpKSB7CisJCWkyY2Rw
cmludGsoInJlYWQgZXJyb3JcbiIpOworCQlyZXR1cm4gLUVJTzsKKwl9CisJaWYgKGtleWRldGVj
dCA9PSAweDAwKQorCQlyZXR1cm4gMDsKKworCXN1YmFkZHIgPSAweDAwOworCW1zZ1sxXS5idWYg
PSAma2V5OworCWlmICgyICE9IGkyY190cmFuc2Zlcihpci0+Yy0+YWRhcHRlciwgbXNnLCAyKSkg
eworCQlpMmNkcHJpbnRrKCJyZWFkIGVycm9yXG4iKTsKKwkJcmV0dXJuIC1FSU87CisJfQorCWlm
IChrZXkgPT0gMHgwMCkKKwkJcmV0dXJuIDA7CisJCisJKmlyX2tleSA9IGtleTsKKwkqaXJfcmF3
ID0ga2V5OworCXJldHVybiAxOworfQorI2VuZGlmCiAvKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgogIFBvbGwgYmFzZWQgZ2V0IGtleWNv
ZGUgZnVuY3Rpb25zCiAgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKi8KLS0tIG9yZy92NGwtZHZiL2xpbnV4L2RyaXZlcnMvbWVkaWEvdmlk
ZW8vZW0yOHh4L2VtMjh4eC5oCTIwMDktMTAtMjkgMTM6MDM6NDIuMDY1MDYxMzQ1ICswMTAwCisr
KyBleDMvdjRsLWR2Yi9saW51eC9kcml2ZXJzL21lZGlhL3ZpZGVvL2VtMjh4eC9lbTI4eHguaAky
MDA5LTEwLTI5IDEzOjUzOjQyLjUxNTM5NjM2MCArMDEwMApAQCAtNzA4LDYgKzcwOCw5IEBACiBp
bnQgZW0yOHh4X2dldF9rZXlfZW1faGF1cChzdHJ1Y3QgSVJfaTJjICppciwgdTMyICppcl9rZXks
IHUzMiAqaXJfcmF3KTsKIGludCBlbTI4eHhfZ2V0X2tleV9waW5uYWNsZV91c2JfZ3JleShzdHJ1
Y3QgSVJfaTJjICppciwgdTMyICppcl9rZXksCiAJCQkJICAgICB1MzIgKmlyX3Jhdyk7CisjaWYg
TElOVVhfVkVSU0lPTl9DT0RFID4gS0VSTkVMX1ZFUlNJT04oMiwgNiwgMzApCitpbnQgZW0yOHh4
X2dldF9rZXlfbHd0dTJkKHN0cnVjdCBJUl9pMmMgKmlyLCB1MzIgKmlyX2tleSwgdTMyICppcl9y
YXcpOworI2VuZGlmCiB2b2lkIGVtMjh4eF9yZWdpc3Rlcl9zbmFwc2hvdF9idXR0b24oc3RydWN0
IGVtMjh4eCAqZGV2KTsKIHZvaWQgZW0yOHh4X2RlcmVnaXN0ZXJfc25hcHNob3RfYnV0dG9uKHN0
cnVjdCBlbTI4eHggKmRldik7CiAK
--001636417d5fb3ef7f0477131086--
