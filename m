Return-path: <linux-media-owner@vger.kernel.org>
Received: from vl18780.dinaserver.com ([82.98.188.50]:54883 "EHLO
        vl18780.dinaserver.com" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S1751652AbeCNOf4 (ORCPT
        <rfc822;linux-media@vger.kernel.org>);
        Wed, 14 Mar 2018 10:35:56 -0400
Subject: Re: [CN] Re: [DE] Re: coda: i.MX6 decoding performance issues for
 multi-streaming
To: Philipp Zabel <p.zabel@pengutronix.de>,
        linux-media <linux-media@vger.kernel.org>
References: <c18549be-d55e-54d2-1524-1c51d05807ec@by.com.es>
 <1520940054.3965.10.camel@pengutronix.de>
 <dfd0fe98-4e5e-bc28-c325-6c52f1964a03@by.com.es>
 <1521035853.4490.7.camel@pengutronix.de>
From: Javier Martin <javiermartin@by.com.es>
Message-ID: <2df2ad29-6173-08ea-e0d1-bf54c93ee456@by.com.es>
Date: Wed, 14 Mar 2018 15:35:48 +0100
MIME-Version: 1.0
In-Reply-To: <1521035853.4490.7.camel@pengutronix.de>
Content-Type: text/plain; charset=utf-8; format=flowed
Content-Language: en-US
Content-Transfer-Encoding: 7bit
Sender: linux-media-owner@vger.kernel.org
List-ID: <linux-media.vger.kernel.org>

Hello,


On 14/03/18 14:57, Philipp Zabel wrote:
> On Wed, 2018-03-14 at 13:05 +0100, Javier Martin wrote:
>> Sorry everyone about my previous e-mail with all the HTML garbage. Here
>> is the plain text answer instead.
>>
>> Hi Philipp,
>>
>> thanks for your answer.
>>
>> On 13/03/18 12:20, Philipp Zabel wrote:
>>   > Hi Javier,
>>   >
>>   > On Mon, 2018-03-12 at 17:54 +0100, Javier Martin wrote:
>>   >> Hi,
>>   >> we have an i.MX6 Solo based board running the latest mainline kernel
>>   >> (4.15.3).
>>   >>
>>   >> As part of our development we were measuring the decoding
>> performance of
>>   >> the i.MX6 coda chip.
>>   >>
>>   >> For that purpose we are feeding the decoder with 640x368 @ 30fps H.264
>>   >> streams that have been generated by another i.MX6 coda encoder
>>   >> configured with fixed qp = 25 and gopsize = 16.
> 
> Those are the defaults. Is the encoder running on the same system, at
> the same time? Or are you decoding a previously encoded stream (multiple
> previously encoded streams)?
>

The encoder is running on a different system with an older 4.1.0 kernel. 
Altough the firmware version in the code is 3.1.1 as well.

Do you think I should try updating the system in the encoder to kernel 
4.15 too and see if that makes any difference?


> [...]
>> I'm currently using 3.1.1 both for encoding and decoding. I think I got
>> it from the latest BSP provided by NXP. Now that you mention it the
>> driver is printing these messages at probe time which I had ignored so far:
>>
>> coda 2040000.vpu: Firmware code revision: 46056
>> coda 2040000.vpu: Initialized CODA960.
>> coda 2040000.vpu: Unsupported firmware version: 3.1.1
>> coda 2040000.vpu: codec registered as /dev/video[3-4]
> 
> That is strange, commit be7f1ab26f42 ("media: coda: mark CODA960
> firmware versions 2.3.10 and 3.1.1 as supported") was merged
> in v4.14.

You are right, those messages where taken from an old 4.1 kernel and not 
from the latest 4.15 where they don't appear any longer. Sorry for the 
noise.

> 
>> Do you think I should use an older version instead?
> 
> Unfortunately I have no indication that this would help.
> 
>> Also, do you think it would be worth trying different parameters in the
>> encoder to see how the decoder responds in those cases?
> 
> Possibly. It would be interesting to know if this happens more often for
> low resolutions / low quality / static frames than high resolutions /
> high quality / high movement.


I can easily prepare a test matrix with several resolutions, QPs and 
content and let you know the results. Although first I'd like to know 
your opinion on whether I should update the encoder to kernel 4.15 too.


Regards,
Javier.
