Return-path: <linux-media-owner@vger.kernel.org>
Received: from mailmxout14.mailmx.agnat.pl ([193.239.45.94]:36991 "EHLO
	mailmxout14.mailmx.agnat.pl" rhost-flags-OK-OK-OK-OK)
	by vger.kernel.org with ESMTP id S1752327Ab3JJPli (ORCPT
	<rfc822;linux-media@vger.kernel.org>);
	Thu, 10 Oct 2013 11:41:38 -0400
Message-ID: <73471B3C909F4F1A84322E325902C56B@laptop2>
From: "Janusz Uzycki" <j.uzycki@elproma.com.pl>
To: "\"Manu Abraham\"" <manu@linuxtv.org>
Cc: "\"Linux Media Mailing List\"" <linux-media@vger.kernel.org>
Subject: Fw: dvb-apps/util/scan: zap compatible with w_scan (option)
Date: Thu, 10 Oct 2013 17:41:28 +0200
MIME-Version: 1.0
Content-Type: multipart/mixed;
	boundary="----=_NextPart_000_0242_01CEC5DF.F2F58A80"
Sender: linux-media-owner@vger.kernel.org
List-ID: <linux-media.vger.kernel.org>

This is a multi-part message in MIME format.

------=_NextPart_000_0242_01CEC5DF.F2F58A80
Content-Type: text/plain;
	format=flowed;
	charset="UTF-8";
	reply-type=original
Content-Transfer-Encoding: 7bit

> Hi.
>
> The feature is useful if you have file generated by "w_scan -X" and
> your card is just tuned and works. I could use "scan -c -o zap -a 0" to
> update the file but it wan't full compatible with w_scan. Now it can be
> with "-p" option like for VDR output format, ie. "scan -c -o zap -a 0
> -p". I would be nice to have the feature in mainline.
>
> best regards
> Janusz Uzycki
> ELPROMA

From: Janusz Uzycki <j.uzycki@elproma.com.pl>
Date: Wed Oct 9 14:51:39 2013 +0200
Subject: scan: zap output compatible with w_scan

"w_scan -X" selects tzap/czap/xine output format.
It starts zap output as "service_name(provider_name):", not "service_name:".
Thanks to the patch "scan -o zap -p" generates compatible output.

Signed-off-by: Janusz Uzycki <j.uzycki@elproma.com.pl>
---

diff -r 3ee111da5b3a util/scan/dump-zap.c
--- a/util/scan/dump-zap.c Mon May 13 15:49:02 2013 +0530
+++ b/util/scan/dump-zap.c Wed Oct 09 17:49:35 2013 +0200
@@ -110,14 +110,19 @@

 void zap_dump_service_parameter_set (FILE *f,
      const char *service_name,
+     const char *provider_name,
      fe_type_t type,
      struct dvb_frontend_parameters *p,
      char polarity,
      int sat_number,
      uint16_t video_pid,
      uint16_t *audio_pid,
-     uint16_t service_id)
+     uint16_t service_id,
+     int dump_provider)
 {
+ if (dump_provider == 1)
+  fprintf (f, "%s(%s):", service_name, provider_name); /* w_scan 
tzap/czap/xine output format */
+ else
  fprintf (f, "%s:", service_name);
  zap_dump_dvb_parameters (f, type, p, polarity, sat_number);
  fprintf (f, ":%i:%i:%i", video_pid, audio_pid[0], service_id);
diff -r 3ee111da5b3a util/scan/dump-zap.h
--- a/util/scan/dump-zap.h Mon May 13 15:49:02 2013 +0530
+++ b/util/scan/dump-zap.h Wed Oct 09 17:49:35 2013 +0200
@@ -9,11 +9,13 @@

 extern void zap_dump_service_parameter_set (FILE *f,
      const char *service_name,
+     const char *provider_name,
      fe_type_t type,
      struct dvb_frontend_parameters *t,
      char polarity, int sat,
      uint16_t video_pid,
      uint16_t *audio_pid,
-     uint16_t service_id);
+     uint16_t service_id,
+     int dump_provider);

 #endif
diff -r 3ee111da5b3a util/scan/scan.c
--- a/util/scan/scan.c Mon May 13 15:49:02 2013 +0530
+++ b/util/scan/scan.c Wed Oct 09 17:49:35 2013 +0200
@@ -2471,13 +2471,15 @@
      case OUTPUT_ZAP:
     zap_dump_service_parameter_set (stdout,
           s->service_name,
+          s->provider_name,
           t->type,
           &t->param,
           sat_polarisation(t),
           sat_number(t),
           s->video_pid,
           s->audio_pid,
-          s->service_id);
+          s->service_id,
+          vdr_dump_provider);
      default:
     break;
      }
@@ -2539,7 +2541,7 @@
  "  N=xxx sets ca field in vdr output to :xxx:\n"
  " -t N Service select, Combined bitfield parameter.\n"
  "  1 = TV, 2 = Radio, 4 = Other, (default 7)\n"
- " -p for vdr output format: dump provider name\n"
+ " -p for vdr / zap output format: dump provider name\n"
  " -e N VDR version, default 3 for VDR-1.3.x and newer\n"
  "  value 2 sets NIT and TID to zero\n"
  "  Vdr version 1.3.x and up implies -p.\n"

------=_NextPart_000_0242_01CEC5DF.F2F58A80
Content-Type: application/octet-stream;
	name="zap_provider.patch"
Content-Transfer-Encoding: quoted-printable
Content-Disposition: attachment;
	filename="zap_provider.patch"

From: Janusz Uzycki <j.uzycki@elproma.com.pl>=0A=
Date: Wed Oct 9 14:51:39 2013 +0200=0A=
Subject: scan: zap output compatible with w_scan=0A=
=0A=
"w_scan -X" selects tzap/czap/xine output format.=0A=
It starts zap output as "service_name(provider_name):", not =
"service_name:".=0A=
Thanks to the patch "scan -o zap -p" generates compatible output.=0A=
=0A=
Signed-off-by: Janusz Uzycki <j.uzycki@elproma.com.pl>=0A=
---=0A=
=0A=
diff -r 3ee111da5b3a util/scan/dump-zap.c=0A=
--- a/util/scan/dump-zap.c	Mon May 13 15:49:02 2013 +0530=0A=
+++ b/util/scan/dump-zap.c	Wed Oct 09 17:49:35 2013 +0200=0A=
@@ -110,14 +110,19 @@=0A=
 =0A=
 void zap_dump_service_parameter_set (FILE *f,=0A=
 				 const char *service_name,=0A=
+				 const char *provider_name,=0A=
 				 fe_type_t type,=0A=
 				 struct dvb_frontend_parameters *p,=0A=
 				 char polarity,=0A=
 				 int sat_number,=0A=
 				 uint16_t video_pid,=0A=
 				 uint16_t *audio_pid,=0A=
-				 uint16_t service_id)=0A=
+				 uint16_t service_id,=0A=
+				 int dump_provider)=0A=
 {=0A=
+	if (dump_provider =3D=3D 1)=0A=
+		fprintf (f, "%s(%s):", service_name, provider_name); /* w_scan =
tzap/czap/xine output format */=0A=
+	else=0A=
 	fprintf (f, "%s:", service_name);=0A=
 	zap_dump_dvb_parameters (f, type, p, polarity, sat_number);=0A=
 	fprintf (f, ":%i:%i:%i", video_pid, audio_pid[0], service_id);=0A=
diff -r 3ee111da5b3a util/scan/dump-zap.h=0A=
--- a/util/scan/dump-zap.h	Mon May 13 15:49:02 2013 +0530=0A=
+++ b/util/scan/dump-zap.h	Wed Oct 09 17:49:35 2013 +0200=0A=
@@ -9,11 +9,13 @@=0A=
 =0A=
 extern void zap_dump_service_parameter_set (FILE *f,=0A=
 				 const char *service_name,=0A=
+				 const char *provider_name,=0A=
 				 fe_type_t type,=0A=
 				 struct dvb_frontend_parameters *t,=0A=
 				 char polarity, int sat,=0A=
 				 uint16_t video_pid,=0A=
 				 uint16_t *audio_pid,=0A=
-				 uint16_t service_id);=0A=
+				 uint16_t service_id,=0A=
+				 int dump_provider);=0A=
 =0A=
 #endif=0A=
diff -r 3ee111da5b3a util/scan/scan.c=0A=
--- a/util/scan/scan.c	Mon May 13 15:49:02 2013 +0530=0A=
+++ b/util/scan/scan.c	Wed Oct 09 17:49:35 2013 +0200=0A=
@@ -2471,13 +2471,15 @@=0A=
 			  case OUTPUT_ZAP:=0A=
 				zap_dump_service_parameter_set (stdout,=0A=
 						    s->service_name,=0A=
+						    s->provider_name,=0A=
 						    t->type,=0A=
 						    &t->param,=0A=
 						    sat_polarisation(t),=0A=
 						    sat_number(t),=0A=
 						    s->video_pid,=0A=
 						    s->audio_pid,=0A=
-						    s->service_id);=0A=
+						    s->service_id,=0A=
+						    vdr_dump_provider);=0A=
 			  default:=0A=
 				break;=0A=
 			  }=0A=
@@ -2539,7 +2541,7 @@=0A=
 	"		N=3Dxxx sets ca field in vdr output to :xxx:\n"=0A=
 	"	-t N	Service select, Combined bitfield parameter.\n"=0A=
 	"		1 =3D TV, 2 =3D Radio, 4 =3D Other, (default 7)\n"=0A=
-	"	-p	for vdr output format: dump provider name\n"=0A=
+	"	-p	for vdr / zap output format: dump provider name\n"=0A=
 	"	-e N	VDR version, default 3 for VDR-1.3.x and newer\n"=0A=
 	"		value 2 sets NIT and TID to zero\n"=0A=
 	"		Vdr version 1.3.x and up implies -p.\n"=0A=

------=_NextPart_000_0242_01CEC5DF.F2F58A80--

