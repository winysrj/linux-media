Return-path: <linux-media-owner@vger.kernel.org>
Received: from mail-ww0-f44.google.com ([74.125.82.44]:36985 "EHLO
	mail-ww0-f44.google.com" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
	with ESMTP id S1753990Ab1LJEoN (ORCPT
	<rfc822;linux-media@vger.kernel.org>); Fri, 9 Dec 2011 23:44:13 -0500
Received: by mail-ww0-f44.google.com with SMTP id dr13so6983961wgb.1
        for <linux-media@vger.kernel.org>; Fri, 09 Dec 2011 20:44:12 -0800 (PST)
MIME-Version: 1.0
Date: Sat, 10 Dec 2011 10:14:12 +0530
Message-ID: <CAHFNz9+=T5XGok+LvhVqeSVdWt=Ng6wgXqcHdtdw19a+whx1bw@mail.gmail.com>
Subject: v4 [PATCH 09/10] CXD2820r: Query DVB frontend delivery capabilities
From: Manu Abraham <abraham.manu@gmail.com>
To: Linux Media Mailing List <linux-media@vger.kernel.org>
Content-Type: multipart/mixed; boundary=bcaec52c623390cee504b3b58d4a
Sender: linux-media-owner@vger.kernel.org
List-ID: <linux-media.vger.kernel.org>

--bcaec52c623390cee504b3b58d4a
Content-Type: text/plain; charset=ISO-8859-1



--bcaec52c623390cee504b3b58d4a
Content-Type: text/x-patch; charset=UTF-8;
	name="0009-CXD2820r-Query-DVB-frontend-delivery-capabilities.patch"
Content-Disposition: attachment;
	filename="0009-CXD2820r-Query-DVB-frontend-delivery-capabilities.patch"
Content-Transfer-Encoding: base64
X-Attachment-Id: file0

RnJvbSA0ZmRmZmRjYzc3MjI4YTE0MGM5NDRjMjBjZTJhOWYyYjZjNWI3NjU4IE1vbiBTZXAgMTcg
MDA6MDA6MDAgMjAwMQpGcm9tOiBNYW51IEFicmFoYW0gPGFicmFoYW0ubWFudUBnbWFpbC5jb20+
CkRhdGU6IFRodSwgMjQgTm92IDIwMTEgMjA6Mjk6NTMgKzA1MzAKU3ViamVjdDogW1BBVENIIDA5
LzEwXSBDWEQyODIwcjogUXVlcnkgRFZCIGZyb250ZW5kIGRlbGl2ZXJ5IGNhcGFiaWxpdGllcwoK
T3ZlcnJpZGUgZGVmYXVsdCBkZWxpdmVyeSBzeXN0ZW0gaW5mb3JtYXRpb24gcHJvdmlkZWQgYnkg
RkVfR0VUX0lORk8sIHNvCnRoYXQgYXBwbGljYXRpb25zIGNhbiBlbnVtZXJhdGUgZGVsaXZlcnkg
c3lzdGVtcyBwcm92aWRlZCBieSB0aGUgZnJvbnRlbmQuCgpTaWduZWQtb2ZmLWJ5OiBNYW51IEFi
cmFoYW0gPGFicmFoYW0ubWFudUBnbWFpbC5jb20+Ci0tLQogZHJpdmVycy9tZWRpYS9kdmIvZnJv
bnRlbmRzL2N4ZDI4MjByX2MuYyAgICB8ICAgIDIgKy0KIGRyaXZlcnMvbWVkaWEvZHZiL2Zyb250
ZW5kcy9jeGQyODIwcl9jb3JlLmMgfCAgNjUxICsrKysrKysrKy0tLS0tLS0tLS0tLS0tLS0tLQog
ZHJpdmVycy9tZWRpYS9kdmIvZnJvbnRlbmRzL2N4ZDI4MjByX3ByaXYuaCB8ICAgIDUgKy0KIGRy
aXZlcnMvbWVkaWEvZHZiL2Zyb250ZW5kcy9jeGQyODIwcl90LmMgICAgfCAgICAyICstCiBkcml2
ZXJzL21lZGlhL2R2Yi9mcm9udGVuZHMvY3hkMjgyMHJfdDIuYyAgIHwgICAgMiArLQogNSBmaWxl
cyBjaGFuZ2VkLCAyMjEgaW5zZXJ0aW9ucygrKSwgNDQxIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdp
dCBhL2RyaXZlcnMvbWVkaWEvZHZiL2Zyb250ZW5kcy9jeGQyODIwcl9jLmMgYi9kcml2ZXJzL21l
ZGlhL2R2Yi9mcm9udGVuZHMvY3hkMjgyMHJfYy5jCmluZGV4IGI4NWY1MDEuLjAxYmFlYWUgMTAw
NjQ0Ci0tLSBhL2RyaXZlcnMvbWVkaWEvZHZiL2Zyb250ZW5kcy9jeGQyODIwcl9jLmMKKysrIGIv
ZHJpdmVycy9tZWRpYS9kdmIvZnJvbnRlbmRzL2N4ZDI4MjByX2MuYwpAQCAtMjIsNyArMjIsNyBA
QAogI2luY2x1ZGUgImN4ZDI4MjByX3ByaXYuaCIKIAogaW50IGN4ZDI4MjByX3NldF9mcm9udGVu
ZF9jKHN0cnVjdCBkdmJfZnJvbnRlbmQgKmZlLAotCXN0cnVjdCBkdmJfZnJvbnRlbmRfcGFyYW1l
dGVycyAqcGFyYW1zKQorCQkJICAgIHN0cnVjdCBkdmJfZnJvbnRlbmRfcGFyYW1ldGVycyAqcGFy
YW1zKQogewogCXN0cnVjdCBjeGQyODIwcl9wcml2ICpwcml2ID0gZmUtPmRlbW9kdWxhdG9yX3By
aXY7CiAJc3RydWN0IGR0dl9mcm9udGVuZF9wcm9wZXJ0aWVzICpjID0gJmZlLT5kdHZfcHJvcGVy
dHlfY2FjaGU7CmRpZmYgLS1naXQgYS9kcml2ZXJzL21lZGlhL2R2Yi9mcm9udGVuZHMvY3hkMjgy
MHJfY29yZS5jIGIvZHJpdmVycy9tZWRpYS9kdmIvZnJvbnRlbmRzL2N4ZDI4MjByX2NvcmUuYwpp
bmRleCAwMzY0ODBmLi41YjAxMjBhIDEwMDY0NAotLS0gYS9kcml2ZXJzL21lZGlhL2R2Yi9mcm9u
dGVuZHMvY3hkMjgyMHJfY29yZS5jCisrKyBiL2RyaXZlcnMvbWVkaWEvZHZiL2Zyb250ZW5kcy9j
eGQyODIwcl9jb3JlLmMKQEAgLTI0MCw0MyArMjQwLDYgQEAgZXJyb3I6CiAJcmV0dXJuIHJldDsK
IH0KIAotLyogbG9jayBGRSAqLwotc3RhdGljIGludCBjeGQyODIwcl9sb2NrKHN0cnVjdCBjeGQy
ODIwcl9wcml2ICpwcml2LCBpbnQgYWN0aXZlX2ZlKQotewotCWludCByZXQgPSAwOwotCWRiZygi
JXM6IGFjdGl2ZV9mZT0lZCIsIF9fZnVuY19fLCBhY3RpdmVfZmUpOwotCi0JbXV0ZXhfbG9jaygm
cHJpdi0+ZmVfbG9jayk7Ci0KLQkvKiAtMT1OT05FLCAwPURWQi1UL1QyLCAxPURWQi1DICovCi0J
aWYgKHByaXYtPmFjdGl2ZV9mZSA9PSBhY3RpdmVfZmUpCi0JCTsKLQllbHNlIGlmIChwcml2LT5h
Y3RpdmVfZmUgPT0gLTEpCi0JCXByaXYtPmFjdGl2ZV9mZSA9IGFjdGl2ZV9mZTsKLQllbHNlCi0J
CXJldCA9IC1FQlVTWTsKLQotCW11dGV4X3VubG9jaygmcHJpdi0+ZmVfbG9jayk7Ci0KLQlyZXR1
cm4gcmV0OwotfQotCi0vKiB1bmxvY2sgRkUgKi8KLXN0YXRpYyB2b2lkIGN4ZDI4MjByX3VubG9j
ayhzdHJ1Y3QgY3hkMjgyMHJfcHJpdiAqcHJpdiwgaW50IGFjdGl2ZV9mZSkKLXsKLQlkYmcoIiVz
OiBhY3RpdmVfZmU9JWQiLCBfX2Z1bmNfXywgYWN0aXZlX2ZlKTsKLQotCW11dGV4X2xvY2soJnBy
aXYtPmZlX2xvY2spOwotCi0JLyogLTE9Tk9ORSwgMD1EVkItVC9UMiwgMT1EVkItQyAqLwotCWlm
IChwcml2LT5hY3RpdmVfZmUgPT0gYWN0aXZlX2ZlKQotCQlwcml2LT5hY3RpdmVfZmUgPSAtMTsK
LQotCW11dGV4X3VubG9jaygmcHJpdi0+ZmVfbG9jayk7Ci0KLQlyZXR1cm47Ci19Ci0KIC8qIDY0
IGJpdCBkaXYgd2l0aCByb3VuZCBjbG9zZXN0LCBsaWtlIERJVl9ST1VORF9DTE9TRVNUIGJ1dCA2
NCBiaXQgKi8KIHUzMiBjeGQyODIwcl9kaXZfdTY0X3JvdW5kX2Nsb3Nlc3QodTY0IGRpdmlkZW5k
LCB1MzIgZGl2aXNvcikKIHsKQEAgLTI4NCwzNzggKzI0NywyMzAgQEAgdTMyIGN4ZDI4MjByX2Rp
dl91NjRfcm91bmRfY2xvc2VzdCh1NjQgZGl2aWRlbmQsIHUzMiBkaXZpc29yKQogfQogCiBzdGF0
aWMgaW50IGN4ZDI4MjByX3NldF9mcm9udGVuZChzdHJ1Y3QgZHZiX2Zyb250ZW5kICpmZSwKLQlz
dHJ1Y3QgZHZiX2Zyb250ZW5kX3BhcmFtZXRlcnMgKnApCisJCQkJIHN0cnVjdCBkdmJfZnJvbnRl
bmRfcGFyYW1ldGVycyAqcCkKIHsKLQlzdHJ1Y3QgY3hkMjgyMHJfcHJpdiAqcHJpdiA9IGZlLT5k
ZW1vZHVsYXRvcl9wcml2OwogCXN0cnVjdCBkdHZfZnJvbnRlbmRfcHJvcGVydGllcyAqYyA9ICZm
ZS0+ZHR2X3Byb3BlcnR5X2NhY2hlOwogCWludCByZXQ7Ci0JZGJnKCIlczogZGVsc3lzPSVkIiwg
X19mdW5jX18sIGZlLT5kdHZfcHJvcGVydHlfY2FjaGUuZGVsaXZlcnlfc3lzdGVtKTsKLQotCWlm
IChmZS0+b3BzLmluZm8udHlwZSA9PSBGRV9PRkRNKSB7Ci0JCS8qIERWQi1UL1QyICovCi0JCXJl
dCA9IGN4ZDI4MjByX2xvY2socHJpdiwgMCk7Ci0JCWlmIChyZXQpCi0JCQlyZXR1cm4gcmV0Owot
Ci0JCXN3aXRjaCAocHJpdi0+ZGVsaXZlcnlfc3lzdGVtKSB7Ci0JCWNhc2UgU1lTX1VOREVGSU5F
RDoKLQkJCWlmIChjLT5kZWxpdmVyeV9zeXN0ZW0gPT0gU1lTX0RWQlQpIHsKLQkJCQkvKiBTTEVF
UCA9PiBEVkItVCAqLwotCQkJCXJldCA9IGN4ZDI4MjByX3NldF9mcm9udGVuZF90KGZlLCBwKTsK
LQkJCX0gZWxzZSB7Ci0JCQkJLyogU0xFRVAgPT4gRFZCLVQyICovCi0JCQkJcmV0ID0gY3hkMjgy
MHJfc2V0X2Zyb250ZW5kX3QyKGZlLCBwKTsKLQkJCX0KLQkJCWJyZWFrOwotCQljYXNlIFNZU19E
VkJUOgotCQkJaWYgKGMtPmRlbGl2ZXJ5X3N5c3RlbSA9PSBTWVNfRFZCVCkgewotCQkJCS8qIERW
Qi1UID0+IERWQi1UICovCi0JCQkJcmV0ID0gY3hkMjgyMHJfc2V0X2Zyb250ZW5kX3QoZmUsIHAp
OwotCQkJfSBlbHNlIGlmIChjLT5kZWxpdmVyeV9zeXN0ZW0gPT0gU1lTX0RWQlQyKSB7Ci0JCQkJ
LyogRFZCLVQgPT4gRFZCLVQyICovCi0JCQkJcmV0ID0gY3hkMjgyMHJfc2xlZXBfdChmZSk7Ci0J
CQkJaWYgKHJldCkKLQkJCQkJYnJlYWs7Ci0JCQkJcmV0ID0gY3hkMjgyMHJfc2V0X2Zyb250ZW5k
X3QyKGZlLCBwKTsKLQkJCX0KLQkJCWJyZWFrOwotCQljYXNlIFNZU19EVkJUMjoKLQkJCWlmIChj
LT5kZWxpdmVyeV9zeXN0ZW0gPT0gU1lTX0RWQlQyKSB7Ci0JCQkJLyogRFZCLVQyID0+IERWQi1U
MiAqLwotCQkJCXJldCA9IGN4ZDI4MjByX3NldF9mcm9udGVuZF90MihmZSwgcCk7Ci0JCQl9IGVs
c2UgaWYgKGMtPmRlbGl2ZXJ5X3N5c3RlbSA9PSBTWVNfRFZCVCkgewotCQkJCS8qIERWQi1UMiA9
PiBEVkItVCAqLwotCQkJCXJldCA9IGN4ZDI4MjByX3NsZWVwX3QyKGZlKTsKLQkJCQlpZiAocmV0
KQotCQkJCQlicmVhazsKLQkJCQlyZXQgPSBjeGQyODIwcl9zZXRfZnJvbnRlbmRfdChmZSwgcCk7
Ci0JCQl9Ci0JCQlicmVhazsKLQkJZGVmYXVsdDoKLQkJCWRiZygiJXM6IGVycm9yIHN0YXRlPSVk
IiwgX19mdW5jX18sCi0JCQkJcHJpdi0+ZGVsaXZlcnlfc3lzdGVtKTsKLQkJCXJldCA9IC1FSU5W
QUw7Ci0JCX0KLQl9IGVsc2UgewotCQkvKiBEVkItQyAqLwotCQlyZXQgPSBjeGQyODIwcl9sb2Nr
KHByaXYsIDEpOwotCQlpZiAocmV0KQotCQkJcmV0dXJuIHJldDsKIAorCWRiZygiJXM6IGRlbHN5
cz0lZCIsIF9fZnVuY19fLCBmZS0+ZHR2X3Byb3BlcnR5X2NhY2hlLmRlbGl2ZXJ5X3N5c3RlbSk7
CisJc3dpdGNoIChjLT5kZWxpdmVyeV9zeXN0ZW0pIHsKKwljYXNlIFNZU19EVkJUOgorCQlyZXQg
PSBjeGQyODIwcl9pbml0X3QoZmUpOworCQlpZiAocmV0IDwgMCkKKwkJCWdvdG8gZXJyOworCQly
ZXQgPSBjeGQyODIwcl9zZXRfZnJvbnRlbmRfdChmZSwgcCk7CisJCWlmIChyZXQgPCAwKQorCQkJ
Z290byBlcnI7CisJCWJyZWFrOworCWNhc2UgU1lTX0RWQlQyOgorCQlyZXQgPSBjeGQyODIwcl9p
bml0X3QoZmUpOworCQlpZiAocmV0IDwgMCkKKwkJCWdvdG8gZXJyOworCQlyZXQgPSBjeGQyODIw
cl9zZXRfZnJvbnRlbmRfdDIoZmUsIHApOworCQlpZiAocmV0IDwgMCkKKwkJCWdvdG8gZXJyOwor
CQlicmVhazsKKwljYXNlIFNZU19EVkJDX0FOTkVYX0FDOgorCQlyZXQgPSBjeGQyODIwcl9pbml0
X2MoZmUpOworCQlpZiAocmV0IDwgMCkKKwkJCWdvdG8gZXJyOwogCQlyZXQgPSBjeGQyODIwcl9z
ZXRfZnJvbnRlbmRfYyhmZSwgcCk7CisJCWlmIChyZXQgPCAwKQorCQkJZ290byBlcnI7CisJCWJy
ZWFrOworCWRlZmF1bHQ6CisJCWRiZygiJXM6IGVycm9yIHN0YXRlPSVkIiwgX19mdW5jX18sIGZl
LT5kdHZfcHJvcGVydHlfY2FjaGUuZGVsaXZlcnlfc3lzdGVtKTsKKwkJcmV0ID0gLUVJTlZBTDsK
KwkJYnJlYWs7CiAJfQotCitlcnI6CiAJcmV0dXJuIHJldDsKIH0KLQogc3RhdGljIGludCBjeGQy
ODIwcl9yZWFkX3N0YXR1cyhzdHJ1Y3QgZHZiX2Zyb250ZW5kICpmZSwgZmVfc3RhdHVzX3QgKnN0
YXR1cykKIHsKLQlzdHJ1Y3QgY3hkMjgyMHJfcHJpdiAqcHJpdiA9IGZlLT5kZW1vZHVsYXRvcl9w
cml2OwogCWludCByZXQ7Ci0JZGJnKCIlczogZGVsc3lzPSVkIiwgX19mdW5jX18sIGZlLT5kdHZf
cHJvcGVydHlfY2FjaGUuZGVsaXZlcnlfc3lzdGVtKTsKLQotCWlmIChmZS0+b3BzLmluZm8udHlw
ZSA9PSBGRV9PRkRNKSB7Ci0JCS8qIERWQi1UL1QyICovCi0JCXJldCA9IGN4ZDI4MjByX2xvY2so
cHJpdiwgMCk7Ci0JCWlmIChyZXQpCi0JCQlyZXR1cm4gcmV0OwotCi0JCXN3aXRjaCAoZmUtPmR0
dl9wcm9wZXJ0eV9jYWNoZS5kZWxpdmVyeV9zeXN0ZW0pIHsKLQkJY2FzZSBTWVNfRFZCVDoKLQkJ
CXJldCA9IGN4ZDI4MjByX3JlYWRfc3RhdHVzX3QoZmUsIHN0YXR1cyk7Ci0JCQlicmVhazsKLQkJ
Y2FzZSBTWVNfRFZCVDI6Ci0JCQlyZXQgPSBjeGQyODIwcl9yZWFkX3N0YXR1c190MihmZSwgc3Rh
dHVzKTsKLQkJCWJyZWFrOwotCQlkZWZhdWx0OgotCQkJcmV0ID0gLUVJTlZBTDsKLQkJfQotCX0g
ZWxzZSB7Ci0JCS8qIERWQi1DICovCi0JCXJldCA9IGN4ZDI4MjByX2xvY2socHJpdiwgMSk7Ci0J
CWlmIChyZXQpCi0JCQlyZXR1cm4gcmV0OwogCisJZGJnKCIlczogZGVsc3lzPSVkIiwgX19mdW5j
X18sIGZlLT5kdHZfcHJvcGVydHlfY2FjaGUuZGVsaXZlcnlfc3lzdGVtKTsKKwlzd2l0Y2ggKGZl
LT5kdHZfcHJvcGVydHlfY2FjaGUuZGVsaXZlcnlfc3lzdGVtKSB7CisJY2FzZSBTWVNfRFZCVDoK
KwkJcmV0ID0gY3hkMjgyMHJfcmVhZF9zdGF0dXNfdChmZSwgc3RhdHVzKTsKKwkJYnJlYWs7CisJ
Y2FzZSBTWVNfRFZCVDI6CisJCXJldCA9IGN4ZDI4MjByX3JlYWRfc3RhdHVzX3QyKGZlLCBzdGF0
dXMpOworCQlicmVhazsKKwljYXNlIFNZU19EVkJDX0FOTkVYX0FDOgogCQlyZXQgPSBjeGQyODIw
cl9yZWFkX3N0YXR1c19jKGZlLCBzdGF0dXMpOworCQlicmVhazsKKwlkZWZhdWx0OgorCQlyZXQg
PSAtRUlOVkFMOworCQlicmVhazsKIAl9Ci0KIAlyZXR1cm4gcmV0OwogfQogCiBzdGF0aWMgaW50
IGN4ZDI4MjByX2dldF9mcm9udGVuZChzdHJ1Y3QgZHZiX2Zyb250ZW5kICpmZSwKLQlzdHJ1Y3Qg
ZHZiX2Zyb250ZW5kX3BhcmFtZXRlcnMgKnApCisJCQkJIHN0cnVjdCBkdmJfZnJvbnRlbmRfcGFy
YW1ldGVycyAqcCkKIHsKLQlzdHJ1Y3QgY3hkMjgyMHJfcHJpdiAqcHJpdiA9IGZlLT5kZW1vZHVs
YXRvcl9wcml2OwogCWludCByZXQ7Ci0JZGJnKCIlczogZGVsc3lzPSVkIiwgX19mdW5jX18sIGZl
LT5kdHZfcHJvcGVydHlfY2FjaGUuZGVsaXZlcnlfc3lzdGVtKTsKLQotCWlmIChmZS0+b3BzLmlu
Zm8udHlwZSA9PSBGRV9PRkRNKSB7Ci0JCS8qIERWQi1UL1QyICovCi0JCXJldCA9IGN4ZDI4MjBy
X2xvY2socHJpdiwgMCk7Ci0JCWlmIChyZXQpCi0JCQlyZXR1cm4gcmV0OwotCi0JCXN3aXRjaCAo
ZmUtPmR0dl9wcm9wZXJ0eV9jYWNoZS5kZWxpdmVyeV9zeXN0ZW0pIHsKLQkJY2FzZSBTWVNfRFZC
VDoKLQkJCXJldCA9IGN4ZDI4MjByX2dldF9mcm9udGVuZF90KGZlLCBwKTsKLQkJCWJyZWFrOwot
CQljYXNlIFNZU19EVkJUMjoKLQkJCXJldCA9IGN4ZDI4MjByX2dldF9mcm9udGVuZF90MihmZSwg
cCk7Ci0JCQlicmVhazsKLQkJZGVmYXVsdDoKLQkJCXJldCA9IC1FSU5WQUw7Ci0JCX0KLQl9IGVs
c2UgewotCQkvKiBEVkItQyAqLwotCQlyZXQgPSBjeGQyODIwcl9sb2NrKHByaXYsIDEpOwotCQlp
ZiAocmV0KQotCQkJcmV0dXJuIHJldDsKIAorCWRiZygiJXM6IGRlbHN5cz0lZCIsIF9fZnVuY19f
LCBmZS0+ZHR2X3Byb3BlcnR5X2NhY2hlLmRlbGl2ZXJ5X3N5c3RlbSk7CisJc3dpdGNoIChmZS0+
ZHR2X3Byb3BlcnR5X2NhY2hlLmRlbGl2ZXJ5X3N5c3RlbSkgeworCWNhc2UgU1lTX0RWQlQ6CisJ
CXJldCA9IGN4ZDI4MjByX2dldF9mcm9udGVuZF90KGZlLCBwKTsKKwkJYnJlYWs7CisJY2FzZSBT
WVNfRFZCVDI6CisJCXJldCA9IGN4ZDI4MjByX2dldF9mcm9udGVuZF90MihmZSwgcCk7CisJCWJy
ZWFrOworCWNhc2UgU1lTX0RWQkNfQU5ORVhfQUM6CiAJCXJldCA9IGN4ZDI4MjByX2dldF9mcm9u
dGVuZF9jKGZlLCBwKTsKKwkJYnJlYWs7CisJZGVmYXVsdDoKKwkJcmV0ID0gLUVJTlZBTDsKKwkJ
YnJlYWs7CiAJfQotCiAJcmV0dXJuIHJldDsKIH0KIAogc3RhdGljIGludCBjeGQyODIwcl9yZWFk
X2JlcihzdHJ1Y3QgZHZiX2Zyb250ZW5kICpmZSwgdTMyICpiZXIpCiB7Ci0Jc3RydWN0IGN4ZDI4
MjByX3ByaXYgKnByaXYgPSBmZS0+ZGVtb2R1bGF0b3JfcHJpdjsKIAlpbnQgcmV0OwotCWRiZygi
JXM6IGRlbHN5cz0lZCIsIF9fZnVuY19fLCBmZS0+ZHR2X3Byb3BlcnR5X2NhY2hlLmRlbGl2ZXJ5
X3N5c3RlbSk7Ci0KLQlpZiAoZmUtPm9wcy5pbmZvLnR5cGUgPT0gRkVfT0ZETSkgewotCQkvKiBE
VkItVC9UMiAqLwotCQlyZXQgPSBjeGQyODIwcl9sb2NrKHByaXYsIDApOwotCQlpZiAocmV0KQot
CQkJcmV0dXJuIHJldDsKLQotCQlzd2l0Y2ggKGZlLT5kdHZfcHJvcGVydHlfY2FjaGUuZGVsaXZl
cnlfc3lzdGVtKSB7Ci0JCWNhc2UgU1lTX0RWQlQ6Ci0JCQlyZXQgPSBjeGQyODIwcl9yZWFkX2Jl
cl90KGZlLCBiZXIpOwotCQkJYnJlYWs7Ci0JCWNhc2UgU1lTX0RWQlQyOgotCQkJcmV0ID0gY3hk
MjgyMHJfcmVhZF9iZXJfdDIoZmUsIGJlcik7Ci0JCQlicmVhazsKLQkJZGVmYXVsdDoKLQkJCXJl
dCA9IC1FSU5WQUw7Ci0JCX0KLQl9IGVsc2UgewotCQkvKiBEVkItQyAqLwotCQlyZXQgPSBjeGQy
ODIwcl9sb2NrKHByaXYsIDEpOwotCQlpZiAocmV0KQotCQkJcmV0dXJuIHJldDsKIAorCWRiZygi
JXM6IGRlbHN5cz0lZCIsIF9fZnVuY19fLCBmZS0+ZHR2X3Byb3BlcnR5X2NhY2hlLmRlbGl2ZXJ5
X3N5c3RlbSk7CisJc3dpdGNoIChmZS0+ZHR2X3Byb3BlcnR5X2NhY2hlLmRlbGl2ZXJ5X3N5c3Rl
bSkgeworCWNhc2UgU1lTX0RWQlQ6CisJCXJldCA9IGN4ZDI4MjByX3JlYWRfYmVyX3QoZmUsIGJl
cik7CisJCWJyZWFrOworCWNhc2UgU1lTX0RWQlQyOgorCQlyZXQgPSBjeGQyODIwcl9yZWFkX2Jl
cl90MihmZSwgYmVyKTsKKwkJYnJlYWs7CisJY2FzZSBTWVNfRFZCQ19BTk5FWF9BQzoKIAkJcmV0
ID0gY3hkMjgyMHJfcmVhZF9iZXJfYyhmZSwgYmVyKTsKKwkJYnJlYWs7CisJZGVmYXVsdDoKKwkJ
cmV0ID0gLUVJTlZBTDsKKwkJYnJlYWs7CiAJfQotCiAJcmV0dXJuIHJldDsKIH0KIAogc3RhdGlj
IGludCBjeGQyODIwcl9yZWFkX3NpZ25hbF9zdHJlbmd0aChzdHJ1Y3QgZHZiX2Zyb250ZW5kICpm
ZSwgdTE2ICpzdHJlbmd0aCkKIHsKLQlzdHJ1Y3QgY3hkMjgyMHJfcHJpdiAqcHJpdiA9IGZlLT5k
ZW1vZHVsYXRvcl9wcml2OwogCWludCByZXQ7Ci0JZGJnKCIlczogZGVsc3lzPSVkIiwgX19mdW5j
X18sIGZlLT5kdHZfcHJvcGVydHlfY2FjaGUuZGVsaXZlcnlfc3lzdGVtKTsKLQotCWlmIChmZS0+
b3BzLmluZm8udHlwZSA9PSBGRV9PRkRNKSB7Ci0JCS8qIERWQi1UL1QyICovCi0JCXJldCA9IGN4
ZDI4MjByX2xvY2socHJpdiwgMCk7Ci0JCWlmIChyZXQpCi0JCQlyZXR1cm4gcmV0OwotCi0JCXN3
aXRjaCAoZmUtPmR0dl9wcm9wZXJ0eV9jYWNoZS5kZWxpdmVyeV9zeXN0ZW0pIHsKLQkJY2FzZSBT
WVNfRFZCVDoKLQkJCXJldCA9IGN4ZDI4MjByX3JlYWRfc2lnbmFsX3N0cmVuZ3RoX3QoZmUsIHN0
cmVuZ3RoKTsKLQkJCWJyZWFrOwotCQljYXNlIFNZU19EVkJUMjoKLQkJCXJldCA9IGN4ZDI4MjBy
X3JlYWRfc2lnbmFsX3N0cmVuZ3RoX3QyKGZlLCBzdHJlbmd0aCk7Ci0JCQlicmVhazsKLQkJZGVm
YXVsdDoKLQkJCXJldCA9IC1FSU5WQUw7Ci0JCX0KLQl9IGVsc2UgewotCQkvKiBEVkItQyAqLwot
CQlyZXQgPSBjeGQyODIwcl9sb2NrKHByaXYsIDEpOwotCQlpZiAocmV0KQotCQkJcmV0dXJuIHJl
dDsKIAorCWRiZygiJXM6IGRlbHN5cz0lZCIsIF9fZnVuY19fLCBmZS0+ZHR2X3Byb3BlcnR5X2Nh
Y2hlLmRlbGl2ZXJ5X3N5c3RlbSk7CisJc3dpdGNoIChmZS0+ZHR2X3Byb3BlcnR5X2NhY2hlLmRl
bGl2ZXJ5X3N5c3RlbSkgeworCWNhc2UgU1lTX0RWQlQ6CisJCXJldCA9IGN4ZDI4MjByX3JlYWRf
c2lnbmFsX3N0cmVuZ3RoX3QoZmUsIHN0cmVuZ3RoKTsKKwkJYnJlYWs7CisJY2FzZSBTWVNfRFZC
VDI6CisJCXJldCA9IGN4ZDI4MjByX3JlYWRfc2lnbmFsX3N0cmVuZ3RoX3QyKGZlLCBzdHJlbmd0
aCk7CisJCWJyZWFrOworCWNhc2UgU1lTX0RWQkNfQU5ORVhfQUM6CiAJCXJldCA9IGN4ZDI4MjBy
X3JlYWRfc2lnbmFsX3N0cmVuZ3RoX2MoZmUsIHN0cmVuZ3RoKTsKKwkJYnJlYWs7CisJZGVmYXVs
dDoKKwkJcmV0ID0gLUVJTlZBTDsKKwkJYnJlYWs7CiAJfQotCiAJcmV0dXJuIHJldDsKIH0KIAog
c3RhdGljIGludCBjeGQyODIwcl9yZWFkX3NucihzdHJ1Y3QgZHZiX2Zyb250ZW5kICpmZSwgdTE2
ICpzbnIpCiB7Ci0Jc3RydWN0IGN4ZDI4MjByX3ByaXYgKnByaXYgPSBmZS0+ZGVtb2R1bGF0b3Jf
cHJpdjsKIAlpbnQgcmV0OwotCWRiZygiJXM6IGRlbHN5cz0lZCIsIF9fZnVuY19fLCBmZS0+ZHR2
X3Byb3BlcnR5X2NhY2hlLmRlbGl2ZXJ5X3N5c3RlbSk7Ci0KLQlpZiAoZmUtPm9wcy5pbmZvLnR5
cGUgPT0gRkVfT0ZETSkgewotCQkvKiBEVkItVC9UMiAqLwotCQlyZXQgPSBjeGQyODIwcl9sb2Nr
KHByaXYsIDApOwotCQlpZiAocmV0KQotCQkJcmV0dXJuIHJldDsKLQotCQlzd2l0Y2ggKGZlLT5k
dHZfcHJvcGVydHlfY2FjaGUuZGVsaXZlcnlfc3lzdGVtKSB7Ci0JCWNhc2UgU1lTX0RWQlQ6Ci0J
CQlyZXQgPSBjeGQyODIwcl9yZWFkX3Nucl90KGZlLCBzbnIpOwotCQkJYnJlYWs7Ci0JCWNhc2Ug
U1lTX0RWQlQyOgotCQkJcmV0ID0gY3hkMjgyMHJfcmVhZF9zbnJfdDIoZmUsIHNucik7Ci0JCQli
cmVhazsKLQkJZGVmYXVsdDoKLQkJCXJldCA9IC1FSU5WQUw7Ci0JCX0KLQl9IGVsc2UgewotCQkv
KiBEVkItQyAqLwotCQlyZXQgPSBjeGQyODIwcl9sb2NrKHByaXYsIDEpOwotCQlpZiAocmV0KQot
CQkJcmV0dXJuIHJldDsKIAorCWRiZygiJXM6IGRlbHN5cz0lZCIsIF9fZnVuY19fLCBmZS0+ZHR2
X3Byb3BlcnR5X2NhY2hlLmRlbGl2ZXJ5X3N5c3RlbSk7CisJc3dpdGNoIChmZS0+ZHR2X3Byb3Bl
cnR5X2NhY2hlLmRlbGl2ZXJ5X3N5c3RlbSkgeworCWNhc2UgU1lTX0RWQlQ6CisJCXJldCA9IGN4
ZDI4MjByX3JlYWRfc25yX3QoZmUsIHNucik7CisJCWJyZWFrOworCWNhc2UgU1lTX0RWQlQyOgor
CQlyZXQgPSBjeGQyODIwcl9yZWFkX3Nucl90MihmZSwgc25yKTsKKwkJYnJlYWs7CisJY2FzZSBT
WVNfRFZCQ19BTk5FWF9BQzoKIAkJcmV0ID0gY3hkMjgyMHJfcmVhZF9zbnJfYyhmZSwgc25yKTsK
KwkJYnJlYWs7CisJZGVmYXVsdDoKKwkJcmV0ID0gLUVJTlZBTDsKKwkJYnJlYWs7CiAJfQotCiAJ
cmV0dXJuIHJldDsKIH0KIAogc3RhdGljIGludCBjeGQyODIwcl9yZWFkX3VjYmxvY2tzKHN0cnVj
dCBkdmJfZnJvbnRlbmQgKmZlLCB1MzIgKnVjYmxvY2tzKQogewotCXN0cnVjdCBjeGQyODIwcl9w
cml2ICpwcml2ID0gZmUtPmRlbW9kdWxhdG9yX3ByaXY7CiAJaW50IHJldDsKLQlkYmcoIiVzOiBk
ZWxzeXM9JWQiLCBfX2Z1bmNfXywgZmUtPmR0dl9wcm9wZXJ0eV9jYWNoZS5kZWxpdmVyeV9zeXN0
ZW0pOwotCi0JaWYgKGZlLT5vcHMuaW5mby50eXBlID09IEZFX09GRE0pIHsKLQkJLyogRFZCLVQv
VDIgKi8KLQkJcmV0ID0gY3hkMjgyMHJfbG9jayhwcml2LCAwKTsKLQkJaWYgKHJldCkKLQkJCXJl
dHVybiByZXQ7Ci0KLQkJc3dpdGNoIChmZS0+ZHR2X3Byb3BlcnR5X2NhY2hlLmRlbGl2ZXJ5X3N5
c3RlbSkgewotCQljYXNlIFNZU19EVkJUOgotCQkJcmV0ID0gY3hkMjgyMHJfcmVhZF91Y2Jsb2Nr
c190KGZlLCB1Y2Jsb2Nrcyk7Ci0JCQlicmVhazsKLQkJY2FzZSBTWVNfRFZCVDI6Ci0JCQlyZXQg
PSBjeGQyODIwcl9yZWFkX3VjYmxvY2tzX3QyKGZlLCB1Y2Jsb2Nrcyk7Ci0JCQlicmVhazsKLQkJ
ZGVmYXVsdDoKLQkJCXJldCA9IC1FSU5WQUw7Ci0JCX0KLQl9IGVsc2UgewotCQkvKiBEVkItQyAq
LwotCQlyZXQgPSBjeGQyODIwcl9sb2NrKHByaXYsIDEpOwotCQlpZiAocmV0KQotCQkJcmV0dXJu
IHJldDsKIAorCWRiZygiJXM6IGRlbHN5cz0lZCIsIF9fZnVuY19fLCBmZS0+ZHR2X3Byb3BlcnR5
X2NhY2hlLmRlbGl2ZXJ5X3N5c3RlbSk7CisJc3dpdGNoIChmZS0+ZHR2X3Byb3BlcnR5X2NhY2hl
LmRlbGl2ZXJ5X3N5c3RlbSkgeworCWNhc2UgU1lTX0RWQlQ6CisJCXJldCA9IGN4ZDI4MjByX3Jl
YWRfdWNibG9ja3NfdChmZSwgdWNibG9ja3MpOworCQlicmVhazsKKwljYXNlIFNZU19EVkJUMjoK
KwkJcmV0ID0gY3hkMjgyMHJfcmVhZF91Y2Jsb2Nrc190MihmZSwgdWNibG9ja3MpOworCQlicmVh
azsKKwljYXNlIFNZU19EVkJDX0FOTkVYX0FDOgogCQlyZXQgPSBjeGQyODIwcl9yZWFkX3VjYmxv
Y2tzX2MoZmUsIHVjYmxvY2tzKTsKKwkJYnJlYWs7CisJZGVmYXVsdDoKKwkJcmV0ID0gLUVJTlZB
TDsKKwkJYnJlYWs7CiAJfQotCiAJcmV0dXJuIHJldDsKIH0KIAogc3RhdGljIGludCBjeGQyODIw
cl9pbml0KHN0cnVjdCBkdmJfZnJvbnRlbmQgKmZlKQogewotCXN0cnVjdCBjeGQyODIwcl9wcml2
ICpwcml2ID0gZmUtPmRlbW9kdWxhdG9yX3ByaXY7Ci0JaW50IHJldDsKLQlkYmcoIiVzOiBkZWxz
eXM9JWQiLCBfX2Z1bmNfXywgZmUtPmR0dl9wcm9wZXJ0eV9jYWNoZS5kZWxpdmVyeV9zeXN0ZW0p
OwotCi0JcHJpdi0+ZGVsaXZlcnlfc3lzdGVtID0gU1lTX1VOREVGSU5FRDsKLQkvKiBkZWxpdmVy
eSBzeXN0ZW0gaXMgdW5rbm93biBhdCB0aGF0IChpbml0KSBwaGFzZSAqLwotCi0JaWYgKGZlLT5v
cHMuaW5mby50eXBlID09IEZFX09GRE0pIHsKLQkJLyogRFZCLVQvVDIgKi8KLQkJcmV0ID0gY3hk
MjgyMHJfbG9jayhwcml2LCAwKTsKLQkJaWYgKHJldCkKLQkJCXJldHVybiByZXQ7Ci0KLQkJcmV0
ID0gY3hkMjgyMHJfaW5pdF90KGZlKTsKLQl9IGVsc2UgewotCQkvKiBEVkItQyAqLwotCQlyZXQg
PSBjeGQyODIwcl9sb2NrKHByaXYsIDEpOwotCQlpZiAocmV0KQotCQkJcmV0dXJuIHJldDsKLQot
CQlyZXQgPSBjeGQyODIwcl9pbml0X2MoZmUpOwotCX0KLQotCXJldHVybiByZXQ7CisJcmV0dXJu
IDA7CiB9CiAKIHN0YXRpYyBpbnQgY3hkMjgyMHJfc2xlZXAoc3RydWN0IGR2Yl9mcm9udGVuZCAq
ZmUpCiB7Ci0Jc3RydWN0IGN4ZDI4MjByX3ByaXYgKnByaXYgPSBmZS0+ZGVtb2R1bGF0b3JfcHJp
djsKIAlpbnQgcmV0OwotCWRiZygiJXM6IGRlbHN5cz0lZCIsIF9fZnVuY19fLCBmZS0+ZHR2X3By
b3BlcnR5X2NhY2hlLmRlbGl2ZXJ5X3N5c3RlbSk7Ci0KLQlpZiAoZmUtPm9wcy5pbmZvLnR5cGUg
PT0gRkVfT0ZETSkgewotCQkvKiBEVkItVC9UMiAqLwotCQlyZXQgPSBjeGQyODIwcl9sb2NrKHBy
aXYsIDApOwotCQlpZiAocmV0KQotCQkJcmV0dXJuIHJldDsKLQotCQlzd2l0Y2ggKGZlLT5kdHZf
cHJvcGVydHlfY2FjaGUuZGVsaXZlcnlfc3lzdGVtKSB7Ci0JCWNhc2UgU1lTX0RWQlQ6Ci0JCQly
ZXQgPSBjeGQyODIwcl9zbGVlcF90KGZlKTsKLQkJCWJyZWFrOwotCQljYXNlIFNZU19EVkJUMjoK
LQkJCXJldCA9IGN4ZDI4MjByX3NsZWVwX3QyKGZlKTsKLQkJCWJyZWFrOwotCQlkZWZhdWx0Ogot
CQkJcmV0ID0gLUVJTlZBTDsKLQkJfQotCi0JCWN4ZDI4MjByX3VubG9jayhwcml2LCAwKTsKLQl9
IGVsc2UgewotCQkvKiBEVkItQyAqLwotCQlyZXQgPSBjeGQyODIwcl9sb2NrKHByaXYsIDEpOwot
CQlpZiAocmV0KQotCQkJcmV0dXJuIHJldDsKIAorCWRiZygiJXM6IGRlbHN5cz0lZCIsIF9fZnVu
Y19fLCBmZS0+ZHR2X3Byb3BlcnR5X2NhY2hlLmRlbGl2ZXJ5X3N5c3RlbSk7CisJc3dpdGNoIChm
ZS0+ZHR2X3Byb3BlcnR5X2NhY2hlLmRlbGl2ZXJ5X3N5c3RlbSkgeworCWNhc2UgU1lTX0RWQlQ6
CisJCXJldCA9IGN4ZDI4MjByX3NsZWVwX3QoZmUpOworCQlicmVhazsKKwljYXNlIFNZU19EVkJU
MjoKKwkJcmV0ID0gY3hkMjgyMHJfc2xlZXBfdDIoZmUpOworCQlicmVhazsKKwljYXNlIFNZU19E
VkJDX0FOTkVYX0FDOgogCQlyZXQgPSBjeGQyODIwcl9zbGVlcF9jKGZlKTsKLQotCQljeGQyODIw
cl91bmxvY2socHJpdiwgMSk7CisJCWJyZWFrOworCWRlZmF1bHQ6CisJCXJldCA9IC1FSU5WQUw7
CisJCWJyZWFrOwogCX0KLQogCXJldHVybiByZXQ7CiB9CiAKIHN0YXRpYyBpbnQgY3hkMjgyMHJf
Z2V0X3R1bmVfc2V0dGluZ3Moc3RydWN0IGR2Yl9mcm9udGVuZCAqZmUsCi0Jc3RydWN0IGR2Yl9m
cm9udGVuZF90dW5lX3NldHRpbmdzICpzKQorCQkJCSAgICAgIHN0cnVjdCBkdmJfZnJvbnRlbmRf
dHVuZV9zZXR0aW5ncyAqcykKIHsKLQlzdHJ1Y3QgY3hkMjgyMHJfcHJpdiAqcHJpdiA9IGZlLT5k
ZW1vZHVsYXRvcl9wcml2OwogCWludCByZXQ7Ci0JZGJnKCIlczogZGVsc3lzPSVkIiwgX19mdW5j
X18sIGZlLT5kdHZfcHJvcGVydHlfY2FjaGUuZGVsaXZlcnlfc3lzdGVtKTsKLQotCWlmIChmZS0+
b3BzLmluZm8udHlwZSA9PSBGRV9PRkRNKSB7Ci0JCS8qIERWQi1UL1QyICovCi0JCXJldCA9IGN4
ZDI4MjByX2xvY2socHJpdiwgMCk7Ci0JCWlmIChyZXQpCi0JCQlyZXR1cm4gcmV0OwotCi0JCXN3
aXRjaCAoZmUtPmR0dl9wcm9wZXJ0eV9jYWNoZS5kZWxpdmVyeV9zeXN0ZW0pIHsKLQkJY2FzZSBT
WVNfRFZCVDoKLQkJCXJldCA9IGN4ZDI4MjByX2dldF90dW5lX3NldHRpbmdzX3QoZmUsIHMpOwot
CQkJYnJlYWs7Ci0JCWNhc2UgU1lTX0RWQlQyOgotCQkJcmV0ID0gY3hkMjgyMHJfZ2V0X3R1bmVf
c2V0dGluZ3NfdDIoZmUsIHMpOwotCQkJYnJlYWs7Ci0JCWRlZmF1bHQ6Ci0JCQlyZXQgPSAtRUlO
VkFMOwotCQl9Ci0JfSBlbHNlIHsKLQkJLyogRFZCLUMgKi8KLQkJcmV0ID0gY3hkMjgyMHJfbG9j
ayhwcml2LCAxKTsKLQkJaWYgKHJldCkKLQkJCXJldHVybiByZXQ7CiAKKwlkYmcoIiVzOiBkZWxz
eXM9JWQiLCBfX2Z1bmNfXywgZmUtPmR0dl9wcm9wZXJ0eV9jYWNoZS5kZWxpdmVyeV9zeXN0ZW0p
OworCXN3aXRjaCAoZmUtPmR0dl9wcm9wZXJ0eV9jYWNoZS5kZWxpdmVyeV9zeXN0ZW0pIHsKKwlj
YXNlIFNZU19EVkJUOgorCQlyZXQgPSBjeGQyODIwcl9nZXRfdHVuZV9zZXR0aW5nc190KGZlLCBz
KTsKKwkJYnJlYWs7CisJY2FzZSBTWVNfRFZCVDI6CisJCXJldCA9IGN4ZDI4MjByX2dldF90dW5l
X3NldHRpbmdzX3QyKGZlLCBzKTsKKwkJYnJlYWs7CisJY2FzZSBTWVNfRFZCQ19BTk5FWF9BQzoK
IAkJcmV0ID0gY3hkMjgyMHJfZ2V0X3R1bmVfc2V0dGluZ3NfYyhmZSwgcyk7CisJCWJyZWFrOwor
CWRlZmF1bHQ6CisJCXJldCA9IC1FSU5WQUw7CisJCWJyZWFrOwogCX0KLQogCXJldHVybiByZXQ7
CiB9CiAKIHN0YXRpYyBlbnVtIGR2YmZlX3NlYXJjaCBjeGQyODIwcl9zZWFyY2goc3RydWN0IGR2
Yl9mcm9udGVuZCAqZmUsCi0Jc3RydWN0IGR2Yl9mcm9udGVuZF9wYXJhbWV0ZXJzICpwKQorCQkJ
CQkgc3RydWN0IGR2Yl9mcm9udGVuZF9wYXJhbWV0ZXJzICpwKQogewogCXN0cnVjdCBjeGQyODIw
cl9wcml2ICpwcml2ID0gZmUtPmRlbW9kdWxhdG9yX3ByaXY7CiAJc3RydWN0IGR0dl9mcm9udGVu
ZF9wcm9wZXJ0aWVzICpjID0gJmZlLT5kdHZfcHJvcGVydHlfY2FjaGU7CkBAIC02NjQsNyArNDc5
LDcgQEAgc3RhdGljIGVudW0gZHZiZmVfc2VhcmNoIGN4ZDI4MjByX3NlYXJjaChzdHJ1Y3QgZHZi
X2Zyb250ZW5kICpmZSwKIAlkYmcoIiVzOiBkZWxzeXM9JWQiLCBfX2Z1bmNfXywgZmUtPmR0dl9w
cm9wZXJ0eV9jYWNoZS5kZWxpdmVyeV9zeXN0ZW0pOwogCiAJLyogc3dpdGNoIGJldHdlZW4gRFZC
LVQgYW5kIERWQi1UMiB3aGVuIHR1bmUgZmFpbHMgKi8KLQlpZiAocHJpdi0+bGFzdF90dW5lX2Zh
aWxlZCkgeworCWlmIChwcml2LT5sYXN0X3R1bmVfZmFpbGVkICYmIChwcml2LT5kZWxpdmVyeV9z
eXN0ZW0gIT0gU1lTX0RWQkNfQU5ORVhfQUMpKSB7CiAJCWlmIChwcml2LT5kZWxpdmVyeV9zeXN0
ZW0gPT0gU1lTX0RWQlQpCiAJCQljLT5kZWxpdmVyeV9zeXN0ZW0gPSBTWVNfRFZCVDI7CiAJCWVs
c2UKQEAgLTcyNyw5ICs1NDIsNyBAQCBzdGF0aWMgdm9pZCBjeGQyODIwcl9yZWxlYXNlKHN0cnVj
dCBkdmJfZnJvbnRlbmQgKmZlKQogCXN0cnVjdCBjeGQyODIwcl9wcml2ICpwcml2ID0gZmUtPmRl
bW9kdWxhdG9yX3ByaXY7CiAJZGJnKCIlcyIsIF9fZnVuY19fKTsKIAotCWlmIChmZS0+b3BzLmlu
Zm8udHlwZSA9PSBGRV9PRkRNKQotCQlrZnJlZShwcml2KTsKLQorCWtmcmVlKHByaXYpOwogCXJl
dHVybjsKIH0KIApAQCAtNzQyLDEyOCArNTU1LDk4IEBAIHN0YXRpYyBpbnQgY3hkMjgyMHJfaTJj
X2dhdGVfY3RybChzdHJ1Y3QgZHZiX2Zyb250ZW5kICpmZSwgaW50IGVuYWJsZSkKIAlyZXR1cm4g
Y3hkMjgyMHJfd3JfcmVnX21hc2socHJpdiwgMHhkYiwgZW5hYmxlID8gMSA6IDAsIDB4MSk7CiB9
CiAKLXN0YXRpYyBjb25zdCBzdHJ1Y3QgZHZiX2Zyb250ZW5kX29wcyBjeGQyODIwcl9vcHNbMl07
Ci0KLXN0cnVjdCBkdmJfZnJvbnRlbmQgKmN4ZDI4MjByX2F0dGFjaChjb25zdCBzdHJ1Y3QgY3hk
MjgyMHJfY29uZmlnICpjZmcsCi0Jc3RydWN0IGkyY19hZGFwdGVyICppMmMsIHN0cnVjdCBkdmJf
ZnJvbnRlbmQgKmZlKQorc3RhdGljIGludCBjeGQyODIwcl9nZXRfcHJvcGVydHkoc3RydWN0IGR2
Yl9mcm9udGVuZCAqZmUsIHN0cnVjdCBkdHZfcHJvcGVydHkgKnApCiB7Ci0JaW50IHJldDsKLQlz
dHJ1Y3QgY3hkMjgyMHJfcHJpdiAqcHJpdiA9IE5VTEw7Ci0JdTggdG1wOworCWRiZygiJXMoKVxu
IiwgX19mdW5jX18pOworCisJc3dpdGNoIChwLT5jbWQpIHsKKwljYXNlIERUVl9FTlVNX0RFTFNZ
UzoKKwkJcC0+dS5idWZmZXIuZGF0YVswXSA9IFNZU19EVkJUOworCQlwLT51LmJ1ZmZlci5kYXRh
WzFdID0gU1lTX0RWQlQyOworCQlwLT51LmJ1ZmZlci5kYXRhWzJdID0gU1lTX0RWQkNfQU5ORVhf
QUM7CisJCXAtPnUuYnVmZmVyLmxlbiA9IDM7CisJCWJyZWFrOworCWRlZmF1bHQ6CisJCWJyZWFr
OworCX0KKwlyZXR1cm4gMDsKK30KIAotCWlmIChmZSA9PSBOVUxMKSB7Ci0JCS8qIEZFMCAqLwot
CQkvKiBhbGxvY2F0ZSBtZW1vcnkgZm9yIHRoZSBpbnRlcm5hbCBwcml2ICovCi0JCXByaXYgPSBr
emFsbG9jKHNpemVvZihzdHJ1Y3QgY3hkMjgyMHJfcHJpdiksIEdGUF9LRVJORUwpOwotCQlpZiAo
cHJpdiA9PSBOVUxMKQotCQkJZ290byBlcnJvcjsKK3N0YXRpYyBjb25zdCBzdHJ1Y3QgZHZiX2Zy
b250ZW5kX29wcyBjeGQyODIwcl9vcHMgPSB7CisJLyogZGVmYXVsdDogRFZCLVQvVDIgKi8KKwku
aW5mbyA9IHsKKwkJLm5hbWUgPSAiU29ueSBDWEQyODIwUiAoRFZCLVQvVDIpIiwKKwkJLnR5cGUg
PSBGRV9PRkRNLAorCisJCS5jYXBzID0JRkVfQ0FOX0ZFQ18xXzIJCQl8CisJCQlGRV9DQU5fRkVD
XzJfMwkJCXwKKwkJCUZFX0NBTl9GRUNfM180CQkJfAorCQkJRkVfQ0FOX0ZFQ181XzYJCQl8CisJ
CQlGRV9DQU5fRkVDXzdfOAkJCXwKKwkJCUZFX0NBTl9GRUNfQVVUTwkJCXwKKwkJCUZFX0NBTl9R
UFNLCQkJfAorCQkJRkVfQ0FOX1FBTV8xNgkJCXwKKwkJCUZFX0NBTl9RQU1fNjQJCQl8CisJCQlG
RV9DQU5fUUFNXzI1NgkJCXwKKwkJCUZFX0NBTl9RQU1fQVVUTwkJCXwKKwkJCUZFX0NBTl9UUkFO
U01JU1NJT05fTU9ERV9BVVRPCXwKKwkJCUZFX0NBTl9HVUFSRF9JTlRFUlZBTF9BVVRPCXwKKwkJ
CUZFX0NBTl9ISUVSQVJDSFlfQVVUTwkJfAorCQkJRkVfQ0FOX01VVEVfVFMJCQl8CisJCQlGRV9D
QU5fMkdfTU9EVUxBVElPTgorCQl9LAogCi0JCS8qIHNldHVwIHRoZSBwcml2ICovCi0JCXByaXYt
PmkyYyA9IGkyYzsKLQkJbWVtY3B5KCZwcml2LT5jZmcsIGNmZywgc2l6ZW9mKHN0cnVjdCBjeGQy
ODIwcl9jb25maWcpKTsKLQkJbXV0ZXhfaW5pdCgmcHJpdi0+ZmVfbG9jayk7CisJLnJlbGVhc2UJ
CT0gY3hkMjgyMHJfcmVsZWFzZSwKKwkuaW5pdAkJCT0gY3hkMjgyMHJfaW5pdCwKKwkuc2xlZXAJ
CQk9IGN4ZDI4MjByX3NsZWVwLAogCi0JCXByaXYtPmFjdGl2ZV9mZSA9IC0xOyAvKiBOT05FICov
CisJLmdldF90dW5lX3NldHRpbmdzCT0gY3hkMjgyMHJfZ2V0X3R1bmVfc2V0dGluZ3MsCisJLmky
Y19nYXRlX2N0cmwJCT0gY3hkMjgyMHJfaTJjX2dhdGVfY3RybCwKIAotCQkvKiBjaGVjayBpZiB0
aGUgZGVtb2QgaXMgdGhlcmUgKi8KLQkJcHJpdi0+YmFua1swXSA9IHByaXYtPmJhbmtbMV0gPSAw
eGZmOwotCQlyZXQgPSBjeGQyODIwcl9yZF9yZWcocHJpdiwgMHgwMDBmZCwgJnRtcCk7Ci0JCWRi
ZygiJXM6IGNoaXAgaWQ9JTAyeCIsIF9fZnVuY19fLCB0bXApOwotCQlpZiAocmV0IHx8IHRtcCAh
PSAweGUxKQotCQkJZ290byBlcnJvcjsKKwkuZ2V0X2Zyb250ZW5kCQk9IGN4ZDI4MjByX2dldF9m
cm9udGVuZCwKIAotCQkvKiBjcmVhdGUgZnJvbnRlbmRzICovCi0JCW1lbWNweSgmcHJpdi0+ZmVb
MF0ub3BzLCAmY3hkMjgyMHJfb3BzWzBdLAotCQkJc2l6ZW9mKHN0cnVjdCBkdmJfZnJvbnRlbmRf
b3BzKSk7Ci0JCW1lbWNweSgmcHJpdi0+ZmVbMV0ub3BzLCAmY3hkMjgyMHJfb3BzWzFdLAotCQkJ
c2l6ZW9mKHN0cnVjdCBkdmJfZnJvbnRlbmRfb3BzKSk7CisJLmdldF9mcm9udGVuZF9hbGdvCT0g
Y3hkMjgyMHJfZ2V0X2Zyb250ZW5kX2FsZ28sCisJLnNlYXJjaAkJCT0gY3hkMjgyMHJfc2VhcmNo
LAogCi0JCXByaXYtPmZlWzBdLmRlbW9kdWxhdG9yX3ByaXYgPSBwcml2OwotCQlwcml2LT5mZVsx
XS5kZW1vZHVsYXRvcl9wcml2ID0gcHJpdjsKKwkucmVhZF9zdGF0dXMJCT0gY3hkMjgyMHJfcmVh
ZF9zdGF0dXMsCisJLnJlYWRfc25yCQk9IGN4ZDI4MjByX3JlYWRfc25yLAorCS5yZWFkX2JlcgkJ
PSBjeGQyODIwcl9yZWFkX2JlciwKKwkucmVhZF91Y2Jsb2NrcwkJPSBjeGQyODIwcl9yZWFkX3Vj
YmxvY2tzLAorCS5yZWFkX3NpZ25hbF9zdHJlbmd0aAk9IGN4ZDI4MjByX3JlYWRfc2lnbmFsX3N0
cmVuZ3RoLAogCi0JCXJldHVybiAmcHJpdi0+ZmVbMF07CisJLmdldF9wcm9wZXJ0eQkJPSBjeGQy
ODIwcl9nZXRfcHJvcGVydHksCit9OwogCi0JfSBlbHNlIHsKLQkJLyogRkUxOiBGRTAgZ2l2ZW4g
YXMgcG9pbnRlciwganVzdCByZXR1cm4gRkUxIHdlIGhhdmUKLQkJICogYWxyZWFkeSBjcmVhdGVk
ICovCi0JCXByaXYgPSBmZS0+ZGVtb2R1bGF0b3JfcHJpdjsKLQkJcmV0dXJuICZwcml2LT5mZVsx
XTsKLQl9CitzdHJ1Y3QgZHZiX2Zyb250ZW5kICpjeGQyODIwcl9hdHRhY2goY29uc3Qgc3RydWN0
IGN4ZDI4MjByX2NvbmZpZyAqY2ZnLAorCQkJCSAgICAgc3RydWN0IGkyY19hZGFwdGVyICppMmMs
CisJCQkJICAgICBzdHJ1Y3QgZHZiX2Zyb250ZW5kICpmZSkKK3sKKwlzdHJ1Y3QgY3hkMjgyMHJf
cHJpdiAqcHJpdiA9IE5VTEw7CisJaW50IHJldDsKKwl1OCB0bXA7CisKKwlwcml2ID0ga3phbGxv
YyhzaXplb2YgKHN0cnVjdCBjeGQyODIwcl9wcml2KSwgR0ZQX0tFUk5FTCk7CisJaWYgKCFwcml2
KQorCQlnb3RvIGVycm9yOwogCisJcHJpdi0+aTJjID0gaTJjOworCW1lbWNweSgmcHJpdi0+Y2Zn
LCBjZmcsIHNpemVvZiAoc3RydWN0IGN4ZDI4MjByX2NvbmZpZykpOworCisJcHJpdi0+YmFua1sw
XSA9IHByaXYtPmJhbmtbMV0gPSAweGZmOworCXJldCA9IGN4ZDI4MjByX3JkX3JlZyhwcml2LCAw
eDAwMGZkLCAmdG1wKTsKKwlkYmcoIiVzOiBjaGlwIGlkPSUwMngiLCBfX2Z1bmNfXywgdG1wKTsK
KwlpZiAocmV0IHx8IHRtcCAhPSAweGUxKQorCQlnb3RvIGVycm9yOworCisJbWVtY3B5KCZwcml2
LT5mZS5vcHMsICZjeGQyODIwcl9vcHMsIHNpemVvZiAoc3RydWN0IGR2Yl9mcm9udGVuZF9vcHMp
KTsKKwlwcml2LT5mZS5kZW1vZHVsYXRvcl9wcml2ID0gcHJpdjsKKwlyZXR1cm4gJnByaXYtPmZl
OwogZXJyb3I6CiAJa2ZyZWUocHJpdik7CiAJcmV0dXJuIE5VTEw7CiB9CiBFWFBPUlRfU1lNQk9M
KGN4ZDI4MjByX2F0dGFjaCk7CiAKLXN0YXRpYyBjb25zdCBzdHJ1Y3QgZHZiX2Zyb250ZW5kX29w
cyBjeGQyODIwcl9vcHNbMl0gPSB7Ci0JewotCQkvKiBEVkItVC9UMiAqLwotCQkuaW5mbyA9IHsK
LQkJCS5uYW1lID0gIlNvbnkgQ1hEMjgyMFIgKERWQi1UL1QyKSIsCi0JCQkudHlwZSA9IEZFX09G
RE0sCi0JCQkuY2FwcyA9Ci0JCQkJRkVfQ0FOX0ZFQ18xXzIgfCBGRV9DQU5fRkVDXzJfMyB8Ci0J
CQkJRkVfQ0FOX0ZFQ18zXzQgfCBGRV9DQU5fRkVDXzVfNiB8Ci0JCQkJRkVfQ0FOX0ZFQ183Xzgg
fCBGRV9DQU5fRkVDX0FVVE8gfAotCQkJCUZFX0NBTl9RUFNLIHwgRkVfQ0FOX1FBTV8xNiB8Ci0J
CQkJRkVfQ0FOX1FBTV82NCB8IEZFX0NBTl9RQU1fMjU2IHwKLQkJCQlGRV9DQU5fUUFNX0FVVE8g
fAotCQkJCUZFX0NBTl9UUkFOU01JU1NJT05fTU9ERV9BVVRPIHwKLQkJCQlGRV9DQU5fR1VBUkRf
SU5URVJWQUxfQVVUTyB8Ci0JCQkJRkVfQ0FOX0hJRVJBUkNIWV9BVVRPIHwKLQkJCQlGRV9DQU5f
TVVURV9UUyB8Ci0JCQkJRkVfQ0FOXzJHX01PRFVMQVRJT04KLQkJfSwKLQotCQkucmVsZWFzZSA9
IGN4ZDI4MjByX3JlbGVhc2UsCi0JCS5pbml0ID0gY3hkMjgyMHJfaW5pdCwKLQkJLnNsZWVwID0g
Y3hkMjgyMHJfc2xlZXAsCi0KLQkJLmdldF90dW5lX3NldHRpbmdzID0gY3hkMjgyMHJfZ2V0X3R1
bmVfc2V0dGluZ3MsCi0JCS5pMmNfZ2F0ZV9jdHJsID0gY3hkMjgyMHJfaTJjX2dhdGVfY3RybCwK
LQotCQkuZ2V0X2Zyb250ZW5kID0gY3hkMjgyMHJfZ2V0X2Zyb250ZW5kLAotCi0JCS5nZXRfZnJv
bnRlbmRfYWxnbyA9IGN4ZDI4MjByX2dldF9mcm9udGVuZF9hbGdvLAotCQkuc2VhcmNoID0gY3hk
MjgyMHJfc2VhcmNoLAotCi0JCS5yZWFkX3N0YXR1cyA9IGN4ZDI4MjByX3JlYWRfc3RhdHVzLAot
CQkucmVhZF9zbnIgPSBjeGQyODIwcl9yZWFkX3NuciwKLQkJLnJlYWRfYmVyID0gY3hkMjgyMHJf
cmVhZF9iZXIsCi0JCS5yZWFkX3VjYmxvY2tzID0gY3hkMjgyMHJfcmVhZF91Y2Jsb2NrcywKLQkJ
LnJlYWRfc2lnbmFsX3N0cmVuZ3RoID0gY3hkMjgyMHJfcmVhZF9zaWduYWxfc3RyZW5ndGgsCi0J
fSwKLQl7Ci0JCS8qIERWQi1DICovCi0JCS5pbmZvID0gewotCQkJLm5hbWUgPSAiU29ueSBDWEQy
ODIwUiAoRFZCLUMpIiwKLQkJCS50eXBlID0gRkVfUUFNLAotCQkJLmNhcHMgPQotCQkJCUZFX0NB
Tl9RQU1fMTYgfCBGRV9DQU5fUUFNXzMyIHwgRkVfQ0FOX1FBTV82NCB8Ci0JCQkJRkVfQ0FOX1FB
TV8xMjggfCBGRV9DQU5fUUFNXzI1NiB8Ci0JCQkJRkVfQ0FOX0ZFQ19BVVRPCi0JCX0sCi0KLQkJ
LnJlbGVhc2UgPSBjeGQyODIwcl9yZWxlYXNlLAotCQkuaW5pdCA9IGN4ZDI4MjByX2luaXQsCi0J
CS5zbGVlcCA9IGN4ZDI4MjByX3NsZWVwLAotCi0JCS5nZXRfdHVuZV9zZXR0aW5ncyA9IGN4ZDI4
MjByX2dldF90dW5lX3NldHRpbmdzLAotCQkuaTJjX2dhdGVfY3RybCA9IGN4ZDI4MjByX2kyY19n
YXRlX2N0cmwsCi0KLQkJLnNldF9mcm9udGVuZCA9IGN4ZDI4MjByX3NldF9mcm9udGVuZCwKLQkJ
LmdldF9mcm9udGVuZCA9IGN4ZDI4MjByX2dldF9mcm9udGVuZCwKLQotCQkucmVhZF9zdGF0dXMg
PSBjeGQyODIwcl9yZWFkX3N0YXR1cywKLQkJLnJlYWRfc25yID0gY3hkMjgyMHJfcmVhZF9zbnIs
Ci0JCS5yZWFkX2JlciA9IGN4ZDI4MjByX3JlYWRfYmVyLAotCQkucmVhZF91Y2Jsb2NrcyA9IGN4
ZDI4MjByX3JlYWRfdWNibG9ja3MsCi0JCS5yZWFkX3NpZ25hbF9zdHJlbmd0aCA9IGN4ZDI4MjBy
X3JlYWRfc2lnbmFsX3N0cmVuZ3RoLAotCX0sCi19OwotCi0KIE1PRFVMRV9BVVRIT1IoIkFudHRp
IFBhbG9zYWFyaSA8Y3JvcGVAaWtpLmZpPiIpOwogTU9EVUxFX0RFU0NSSVBUSU9OKCJTb255IENY
RDI4MjBSIGRlbW9kdWxhdG9yIGRyaXZlciIpOwogTU9EVUxFX0xJQ0VOU0UoIkdQTCIpOwpkaWZm
IC0tZ2l0IGEvZHJpdmVycy9tZWRpYS9kdmIvZnJvbnRlbmRzL2N4ZDI4MjByX3ByaXYuaCBiL2Ry
aXZlcnMvbWVkaWEvZHZiL2Zyb250ZW5kcy9jeGQyODIwcl9wcml2LmgKaW5kZXggOTU1MzkxMy4u
OTRkY2Y3ZiAxMDA2NDQKLS0tIGEvZHJpdmVycy9tZWRpYS9kdmIvZnJvbnRlbmRzL2N4ZDI4MjBy
X3ByaXYuaAorKysgYi9kcml2ZXJzL21lZGlhL2R2Yi9mcm9udGVuZHMvY3hkMjgyMHJfcHJpdi5o
CkBAIC00OCwxMiArNDgsOSBAQCBzdHJ1Y3QgcmVnX3ZhbF9tYXNrIHsKIAogc3RydWN0IGN4ZDI4
MjByX3ByaXYgewogCXN0cnVjdCBpMmNfYWRhcHRlciAqaTJjOwotCXN0cnVjdCBkdmJfZnJvbnRl
bmQgZmVbMl07CisJc3RydWN0IGR2Yl9mcm9udGVuZCBmZTsKIAlzdHJ1Y3QgY3hkMjgyMHJfY29u
ZmlnIGNmZzsKIAotCXN0cnVjdCBtdXRleCBmZV9sb2NrOyAvKsKgRkUgbG9jayAqLwotCWludCBh
Y3RpdmVfZmU6MjsgLyogRkUgbG9jaywgLTE9Tk9ORSwgMD1EVkItVC9UMiwgMT1EVkItQyAqLwot
CiAJYm9vbCBiZXJfcnVubmluZzsKIAogCXU4IGJhbmtbMl07CmRpZmYgLS1naXQgYS9kcml2ZXJz
L21lZGlhL2R2Yi9mcm9udGVuZHMvY3hkMjgyMHJfdC5jIGIvZHJpdmVycy9tZWRpYS9kdmIvZnJv
bnRlbmRzL2N4ZDI4MjByX3QuYwppbmRleCBhMDRmOWM4Li5jMTUzZjBhIDEwMDY0NAotLS0gYS9k
cml2ZXJzL21lZGlhL2R2Yi9mcm9udGVuZHMvY3hkMjgyMHJfdC5jCisrKyBiL2RyaXZlcnMvbWVk
aWEvZHZiL2Zyb250ZW5kcy9jeGQyODIwcl90LmMKQEAgLTIyLDcgKzIyLDcgQEAKICNpbmNsdWRl
ICJjeGQyODIwcl9wcml2LmgiCiAKIGludCBjeGQyODIwcl9zZXRfZnJvbnRlbmRfdChzdHJ1Y3Qg
ZHZiX2Zyb250ZW5kICpmZSwKLQlzdHJ1Y3QgZHZiX2Zyb250ZW5kX3BhcmFtZXRlcnMgKnApCisJ
CQkgICAgc3RydWN0IGR2Yl9mcm9udGVuZF9wYXJhbWV0ZXJzICpwKQogewogCXN0cnVjdCBjeGQy
ODIwcl9wcml2ICpwcml2ID0gZmUtPmRlbW9kdWxhdG9yX3ByaXY7CiAJc3RydWN0IGR0dl9mcm9u
dGVuZF9wcm9wZXJ0aWVzICpjID0gJmZlLT5kdHZfcHJvcGVydHlfY2FjaGU7CmRpZmYgLS1naXQg
YS9kcml2ZXJzL21lZGlhL2R2Yi9mcm9udGVuZHMvY3hkMjgyMHJfdDIuYyBiL2RyaXZlcnMvbWVk
aWEvZHZiL2Zyb250ZW5kcy9jeGQyODIwcl90Mi5jCmluZGV4IDY1NDg1ODguLjU4M2I1ZDIgMTAw
NjQ0Ci0tLSBhL2RyaXZlcnMvbWVkaWEvZHZiL2Zyb250ZW5kcy9jeGQyODIwcl90Mi5jCisrKyBi
L2RyaXZlcnMvbWVkaWEvZHZiL2Zyb250ZW5kcy9jeGQyODIwcl90Mi5jCkBAIC0yMiw3ICsyMiw3
IEBACiAjaW5jbHVkZSAiY3hkMjgyMHJfcHJpdi5oIgogCiBpbnQgY3hkMjgyMHJfc2V0X2Zyb250
ZW5kX3QyKHN0cnVjdCBkdmJfZnJvbnRlbmQgKmZlLAotCXN0cnVjdCBkdmJfZnJvbnRlbmRfcGFy
YW1ldGVycyAqcGFyYW1zKQorCQkJICAgICBzdHJ1Y3QgZHZiX2Zyb250ZW5kX3BhcmFtZXRlcnMg
KnBhcmFtcykKIHsKIAlzdHJ1Y3QgY3hkMjgyMHJfcHJpdiAqcHJpdiA9IGZlLT5kZW1vZHVsYXRv
cl9wcml2OwogCXN0cnVjdCBkdHZfZnJvbnRlbmRfcHJvcGVydGllcyAqYyA9ICZmZS0+ZHR2X3By
b3BlcnR5X2NhY2hlOwotLSAKMS43LjEKCg==
--bcaec52c623390cee504b3b58d4a--
