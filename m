Return-path: <video4linux-list-bounces@redhat.com>
Received: from mx3.redhat.com (mx3.redhat.com [172.16.48.32])
	by int-mx2.corp.redhat.com (8.13.1/8.13.1) with ESMTP id m8Q1nQ0a006728
	for <video4linux-list@redhat.com>; Thu, 25 Sep 2008 21:49:26 -0400
Received: from fg-out-1718.google.com (fg-out-1718.google.com [72.14.220.158])
	by mx3.redhat.com (8.13.8/8.13.8) with ESMTP id m8Q1nF0S031645
	for <video4linux-list@redhat.com>; Thu, 25 Sep 2008 21:49:15 -0400
Received: by fg-out-1718.google.com with SMTP id e21so507030fga.7
	for <video4linux-list@redhat.com>; Thu, 25 Sep 2008 18:49:15 -0700 (PDT)
Message-ID: <30353c3d0809251849t561c6c9dr4fd0ac26bf2924f5@mail.gmail.com>
Date: Thu, 25 Sep 2008 21:49:14 -0400
From: "David Ellingsworth" <david@identd.dyndns.org>
To: "Jaime Velasco Juan" <jsagarribay@gmail.com>
In-Reply-To: <30353c3d0809251203q4f09a237xd08aa227d96e62b0@mail.gmail.com>
MIME-Version: 1.0
Content-Type: multipart/mixed;
	boundary="----=_Part_11174_2937365.1222393754737"
References: <30353c3d0809202112i6f1b7f5do48dd7c9e299ba877@mail.gmail.com>
	<20080923195137.GA4038@singular.sob>
	<30353c3d0809251203q4f09a237xd08aa227d96e62b0@mail.gmail.com>
Cc: v4l <video4linux-list@redhat.com>
Subject: Re: [PATCH RFT]: stk-webcam: release via video_device release
	callback
List-Unsubscribe: <https://www.redhat.com/mailman/listinfo/video4linux-list>,
	<mailto:video4linux-list-request@redhat.com?subject=unsubscribe>
List-Archive: <https://www.redhat.com/mailman/private/video4linux-list>
List-Post: <mailto:video4linux-list@redhat.com>
List-Help: <mailto:video4linux-list-request@redhat.com?subject=help>
List-Subscribe: <https://www.redhat.com/mailman/listinfo/video4linux-list>,
	<mailto:video4linux-list-request@redhat.com?subject=subscribe>
Sender: video4linux-list-bounces@redhat.com
Errors-To: video4linux-list-bounces@redhat.com
List-ID: <video4linux-list@redhat.com>

------=_Part_11174_2937365.1222393754737
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: 7bit
Content-Disposition: inline

Jamie,

After re-examining stk-webcam, I believe the crash you experienced
would occur despite having applied my patch. In the current version of
stk-webcam.c there are two if conditions at the very beginning of the
v4l_stk_release function that checks for NULL. In the case of a close
occuring after disconnect, neither of these variable will be NULL. The
sequence would be as follows:

v4l_stk_release
  stk_free_buffers
    stk_clean_iso
      usb_kill_urb
        (crash)

After the camera has been disconnected, usb_kill_urb should not be
called since usb_disconnect already takes care of killing all urbs
associated with a disconnected device. usb_free_urb however still
needs to be called for every urb allocated. Therefore I believe the
proper fix for this should be to checke that the camera is present
before calling usb_kill_urb.

Attached are a series of patches, the first of which should correct
the crash you experienced.

Regards,

David Ellingsworth

------=_Part_11174_2937365.1222393754737
Content-Type: text/x-diff;
	name=0001-stkwebcam-fix-crash-on-disconnect-before-close.patch
Content-Transfer-Encoding: base64
X-Attachment-Id: f_flk5d3nz0
Content-Disposition: attachment;
	filename=0001-stkwebcam-fix-crash-on-disconnect-before-close.patch

RnJvbSAyY2FhZTIyZjkzNDY5OTc2YmZkMTI2Njg5NWRhMzliY2Y3YmZiYmUyIE1vbiBTZXAgMTcg
MDA6MDA6MDAgMjAwMQpGcm9tOiBEYXZpZCBFbGxpbmdzd29ydGggPGRhdmlkQGlkZW50ZC5keW5k
bnMub3JnPgpEYXRlOiBUaHUsIDI1IFNlcCAyMDA4IDIwOjU5OjM0IC0wNDAwClN1YmplY3Q6IFtQ
QVRDSF0gc3Rrd2ViY2FtOiBmaXggY3Jhc2ggb24gZGlzY29ubmVjdCBiZWZvcmUgY2xvc2UKCgpT
aWduZWQtb2ZmLWJ5OiBEYXZpZCBFbGxpbmdzd29ydGggPGRhdmlkQGlkZW50ZC5keW5kbnMub3Jn
PgotLS0KIGRyaXZlcnMvbWVkaWEvdmlkZW8vc3RrLXdlYmNhbS5jIHwgICAgMiArLQogMSBmaWxl
cyBjaGFuZ2VkLCAxIGluc2VydGlvbnMoKyksIDEgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9tZWRpYS92aWRlby9zdGstd2ViY2FtLmMgYi9kcml2ZXJzL21lZGlhL3ZpZGVvL3N0
ay13ZWJjYW0uYwppbmRleCA4ZGRhNTY4Li5iYmYzNjc3IDEwMDY0NAotLS0gYS9kcml2ZXJzL21l
ZGlhL3ZpZGVvL3N0ay13ZWJjYW0uYworKysgYi9kcml2ZXJzL21lZGlhL3ZpZGVvL3N0ay13ZWJj
YW0uYwpAQCAtNTc2LDcgKzU3Niw3IEBAIHN0YXRpYyB2b2lkIHN0a19jbGVhbl9pc28oc3RydWN0
IHN0a19jYW1lcmEgKmRldikKIAogCQl1cmIgPSBkZXYtPmlzb2J1ZnNbaV0udXJiOwogCQlpZiAo
dXJiKSB7Ci0JCQlpZiAoYXRvbWljX3JlYWQoJmRldi0+dXJic191c2VkKSkKKwkJCWlmIChhdG9t
aWNfcmVhZCgmZGV2LT51cmJzX3VzZWQpICYmIGlzX3ByZXNlbnQoZGV2KSkKIAkJCQl1c2Jfa2ls
bF91cmIodXJiKTsKIAkJCXVzYl9mcmVlX3VyYih1cmIpOwogCQl9Ci0tIAoxLjUuNgoK
------=_Part_11174_2937365.1222393754737
Content-Type: text/x-diff;
	name=0002-stkwebcam-release-via-video_device-release-callback.patch
Content-Transfer-Encoding: base64
X-Attachment-Id: f_flk5eywx1
Content-Disposition: attachment;
	filename=0002-stkwebcam-release-via-video_device-release-callback.patch

RnJvbSAzMDA4OGZjNzFjYWI1YWYwNjk2NjhhNTYyOWZjNzQ5ZDU3MTNjYWM4IE1vbiBTZXAgMTcg
MDA6MDA6MDAgMjAwMQpGcm9tOiBEYXZpZCBFbGxpbmdzd29ydGggPGRhdmlkQGlkZW50ZC5keW5k
bnMub3JnPgpEYXRlOiBUaHUsIDI1IFNlcCAyMDA4IDIxOjAwOjIxIC0wNDAwClN1YmplY3Q6IFtQ
QVRDSF0gc3Rrd2ViY2FtOiByZWxlYXNlIHZpYSB2aWRlb19kZXZpY2UgcmVsZWFzZSBjYWxsYmFj
awoKClNpZ25lZC1vZmYtYnk6IERhdmlkIEVsbGluZ3N3b3J0aCA8ZGF2aWRAaWRlbnRkLmR5bmRu
cy5vcmc+Ci0tLQogZHJpdmVycy9tZWRpYS92aWRlby9zdGstd2ViY2FtLmMgfCAgIDQ0ICsrKysr
KysrKysrKysrKy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KIGRyaXZlcnMvbWVkaWEvdmlkZW8vc3Rr
LXdlYmNhbS5oIHwgICAgMiAtCiAyIGZpbGVzIGNoYW5nZWQsIDE4IGluc2VydGlvbnMoKyksIDI4
IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvbWVkaWEvdmlkZW8vc3RrLXdlYmNh
bS5jIGIvZHJpdmVycy9tZWRpYS92aWRlby9zdGstd2ViY2FtLmMKaW5kZXggYmJmMzY3Ny4uN2Fk
OTdjNyAxMDA2NDQKLS0tIGEvZHJpdmVycy9tZWRpYS92aWRlby9zdGstd2ViY2FtLmMKKysrIGIv
ZHJpdmVycy9tZWRpYS92aWRlby9zdGstd2ViY2FtLmMKQEAgLTY1LDIyICs2NSw2IEBAIHN0YXRp
YyBzdHJ1Y3QgdXNiX2RldmljZV9pZCBzdGt3ZWJjYW1fdGFibGVbXSA9IHsKIH07CiBNT0RVTEVf
REVWSUNFX1RBQkxFKHVzYiwgc3Rrd2ViY2FtX3RhYmxlKTsKIAotc3RhdGljIHZvaWQgc3RrX2Nh
bWVyYV9jbGVhbnVwKHN0cnVjdCBrcmVmICprcmVmKQotewotCXN0cnVjdCBzdGtfY2FtZXJhICpk
ZXYgPSB0b19zdGtfY2FtZXJhKGtyZWYpOwotCi0JU1RLX0lORk8oIlN5bnRlayBVU0IyLjAgQ2Ft
ZXJhIHJlbGVhc2UgcmVzb3VyY2VzIgotCQkiIHZpZGVvIGRldmljZSAvZGV2L3ZpZGVvJWRcbiIs
IGRldi0+dmRldi5taW5vcik7Ci0JdmlkZW9fdW5yZWdpc3Rlcl9kZXZpY2UoJmRldi0+dmRldik7
Ci0JdmlkZW9fc2V0X2RydmRhdGEoJmRldi0+dmRldiwgTlVMTCk7Ci0KLQlpZiAoZGV2LT5zaW9f
YnVmcyAhPSBOVUxMIHx8IGRldi0+aXNvYnVmcyAhPSBOVUxMKQotCQlTVEtfRVJST1IoIldlIGFy
ZSBsZWFraW5nIG1lbW9yeVxuIik7Ci0JdXNiX3B1dF9pbnRmKGRldi0+aW50ZXJmYWNlKTsKLQlr
ZnJlZShkZXYpOwotfQotCi0KIC8qCiAgKiBCYXNpYyBzdHVmZgogICovCkBAIC02OTUsNyArNjc5
LDYgQEAgc3RhdGljIGludCB2NGxfc3RrX29wZW4oc3RydWN0IGlub2RlICppbm9kZSwgc3RydWN0
IGZpbGUgKmZwKQogCQlyZXR1cm4gLUVOWElPOwogCX0KIAlmcC0+cHJpdmF0ZV9kYXRhID0gdmRl
djsKLQlrcmVmX2dldCgmZGV2LT5rcmVmKTsKIAl1c2JfYXV0b3BtX2dldF9pbnRlcmZhY2UoZGV2
LT5pbnRlcmZhY2UpOwogCXVubG9ja19rZXJuZWwoKTsKIApAQCAtNzIwLDcgKzcwMyw2IEBAIHN0
YXRpYyBpbnQgdjRsX3N0a19yZWxlYXNlKHN0cnVjdCBpbm9kZSAqaW5vZGUsIHN0cnVjdCBmaWxl
ICpmcCkKIAogCWlmIChkZXYtPm93bmVyICE9IGZwKSB7CiAJCXVzYl9hdXRvcG1fcHV0X2ludGVy
ZmFjZShkZXYtPmludGVyZmFjZSk7Ci0JCWtyZWZfcHV0KCZkZXYtPmtyZWYsIHN0a19jYW1lcmFf
Y2xlYW51cCk7CiAJCXJldHVybiAwOwogCX0KIApAQCAtNzMxLDcgKzcxMyw2IEBAIHN0YXRpYyBp
bnQgdjRsX3N0a19yZWxlYXNlKHN0cnVjdCBpbm9kZSAqaW5vZGUsIHN0cnVjdCBmaWxlICpmcCkK
IAlkZXYtPm93bmVyID0gTlVMTDsKIAogCXVzYl9hdXRvcG1fcHV0X2ludGVyZmFjZShkZXYtPmlu
dGVyZmFjZSk7Ci0Ja3JlZl9wdXQoJmRldi0+a3JlZiwgc3RrX2NhbWVyYV9jbGVhbnVwKTsKIAog
CXJldHVybiAwOwogfQpAQCAtMTM1OSw2ICsxMzQwLDEyIEBAIHN0YXRpYyBjb25zdCBzdHJ1Y3Qg
djRsMl9pb2N0bF9vcHMgdjRsX3N0a19pb2N0bF9vcHMgPSB7CiAKIHN0YXRpYyB2b2lkIHN0a192
NGxfZGV2X3JlbGVhc2Uoc3RydWN0IHZpZGVvX2RldmljZSAqdmQpCiB7CisJc3RydWN0IHN0a19j
YW1lcmEgKmRldiA9IHZkZXZfdG9fY2FtZXJhKHZkKTsKKworCWlmIChkZXYtPnNpb19idWZzICE9
IE5VTEwgfHwgZGV2LT5pc29idWZzICE9IE5VTEwpCisJCVNUS19FUlJPUigiV2UgYXJlIGxlYWtp
bmcgbWVtb3J5XG4iKTsKKwl1c2JfcHV0X2ludGYoZGV2LT5pbnRlcmZhY2UpOworCWtmcmVlKGRl
dik7CiB9CiAKIHN0YXRpYyBzdHJ1Y3QgdmlkZW9fZGV2aWNlIHN0a192NGxfZGF0YSA9IHsKQEAg
LTEzOTYsNyArMTM4Myw3IEBAIHN0YXRpYyBpbnQgc3RrX2NhbWVyYV9wcm9iZShzdHJ1Y3QgdXNi
X2ludGVyZmFjZSAqaW50ZXJmYWNlLAogCQljb25zdCBzdHJ1Y3QgdXNiX2RldmljZV9pZCAqaWQp
CiB7CiAJaW50IGk7Ci0JaW50IGVycjsKKwlpbnQgZXJyID0gMDsKIAogCXN0cnVjdCBzdGtfY2Ft
ZXJhICpkZXYgPSBOVUxMOwogCXN0cnVjdCB1c2JfZGV2aWNlICp1ZGV2ID0gaW50ZXJmYWNlX3Rv
X3VzYmRldihpbnRlcmZhY2UpOwpAQCAtMTQwOSw3ICsxMzk2LDYgQEAgc3RhdGljIGludCBzdGtf
Y2FtZXJhX3Byb2JlKHN0cnVjdCB1c2JfaW50ZXJmYWNlICppbnRlcmZhY2UsCiAJCXJldHVybiAt
RU5PTUVNOwogCX0KIAotCWtyZWZfaW5pdCgmZGV2LT5rcmVmKTsKIAlzcGluX2xvY2tfaW5pdCgm
ZGV2LT5zcGlubG9jayk7CiAJaW5pdF93YWl0cXVldWVfaGVhZCgmZGV2LT53YWl0X2ZyYW1lKTsK
IApAQCAtMTQ0Miw4ICsxNDI4LDggQEAgc3RhdGljIGludCBzdGtfY2FtZXJhX3Byb2JlKHN0cnVj
dCB1c2JfaW50ZXJmYWNlICppbnRlcmZhY2UsCiAJfQogCWlmICghZGV2LT5pc29jX2VwKSB7CiAJ
CVNUS19FUlJPUigiQ291bGQgbm90IGZpbmQgaXNvYy1pbiBlbmRwb2ludCIpOwotCQlrcmVmX3B1
dCgmZGV2LT5rcmVmLCBzdGtfY2FtZXJhX2NsZWFudXApOwotCQlyZXR1cm4gLUVOT0RFVjsKKwkJ
ZXJyID0gLUVOT0RFVjsKKwkJZ290byBlcnJvcjsKIAl9CiAJZGV2LT52c2V0dGluZ3MuYnJpZ2h0
bmVzcyA9IDB4N2ZmZjsKIAlkZXYtPnZzZXR0aW5ncy5wYWxldHRlID0gVjRMMl9QSVhfRk1UX1JH
QjU2NTsKQEAgLTE0NTcsMTQgKzE0NDMsMTcgQEAgc3RhdGljIGludCBzdGtfY2FtZXJhX3Byb2Jl
KHN0cnVjdCB1c2JfaW50ZXJmYWNlICppbnRlcmZhY2UsCiAKIAllcnIgPSBzdGtfcmVnaXN0ZXJf
dmlkZW9fZGV2aWNlKGRldik7CiAJaWYgKGVycikgewotCQlrcmVmX3B1dCgmZGV2LT5rcmVmLCBz
dGtfY2FtZXJhX2NsZWFudXApOwotCQlyZXR1cm4gZXJyOworCQlnb3RvIGVycm9yOwogCX0KIAog
CXN0a19jcmVhdGVfc3lzZnNfZmlsZXMoJmRldi0+dmRldik7CiAJdXNiX2F1dG9wbV9lbmFibGUo
ZGV2LT5pbnRlcmZhY2UpOwogCiAJcmV0dXJuIDA7CisKK2Vycm9yOgorCWtmcmVlKGRldik7CisJ
cmV0dXJuIGVycjsKIH0KIAogc3RhdGljIHZvaWQgc3RrX2NhbWVyYV9kaXNjb25uZWN0KHN0cnVj
dCB1c2JfaW50ZXJmYWNlICppbnRlcmZhY2UpCkBAIC0xNDc3LDcgKzE0NjYsMTAgQEAgc3RhdGlj
IHZvaWQgc3RrX2NhbWVyYV9kaXNjb25uZWN0KHN0cnVjdCB1c2JfaW50ZXJmYWNlICppbnRlcmZh
Y2UpCiAJd2FrZV91cF9pbnRlcnJ1cHRpYmxlKCZkZXYtPndhaXRfZnJhbWUpOwogCXN0a19yZW1v
dmVfc3lzZnNfZmlsZXMoJmRldi0+dmRldik7CiAKLQlrcmVmX3B1dCgmZGV2LT5rcmVmLCBzdGtf
Y2FtZXJhX2NsZWFudXApOworCVNUS19JTkZPKCJTeW50ZWsgVVNCMi4wIENhbWVyYSByZWxlYXNl
IHJlc291cmNlcyIKKwkJInZpZGVvIGRldmljZSAvZGV2L3ZpZGVvJWRcbiIsIGRldi0+dmRldi5t
aW5vcik7CisKKwl2aWRlb191bnJlZ2lzdGVyX2RldmljZSgmZGV2LT52ZGV2KTsKIH0KIAogI2lm
ZGVmIENPTkZJR19QTQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9tZWRpYS92aWRlby9zdGstd2ViY2Ft
LmggYi9kcml2ZXJzL21lZGlhL3ZpZGVvL3N0ay13ZWJjYW0uaAppbmRleCBkZjRkZmVmLi4wODRh
ODViIDEwMDY0NAotLS0gYS9kcml2ZXJzL21lZGlhL3ZpZGVvL3N0ay13ZWJjYW0uaAorKysgYi9k
cml2ZXJzL21lZGlhL3ZpZGVvL3N0ay13ZWJjYW0uaApAQCAtOTksNyArOTksNiBAQCBzdHJ1Y3Qg
c3RrX2NhbWVyYSB7CiAKIAl1OCBpc29jX2VwOwogCi0Jc3RydWN0IGtyZWYga3JlZjsKIAkvKiBO
b3Qgc3VyZSBpZiB0aGlzIGlzIHJpZ2h0ICovCiAJYXRvbWljX3QgdXJic191c2VkOwogCkBAIC0x
MjEsNyArMTIwLDYgQEAgc3RydWN0IHN0a19jYW1lcmEgewogCXVuc2lnbmVkIHNlcXVlbmNlOwog
fTsKIAotI2RlZmluZSB0b19zdGtfY2FtZXJhKGQpIGNvbnRhaW5lcl9vZihkLCBzdHJ1Y3Qgc3Rr
X2NhbWVyYSwga3JlZikKICNkZWZpbmUgdmRldl90b19jYW1lcmEoZCkgY29udGFpbmVyX29mKGQs
IHN0cnVjdCBzdGtfY2FtZXJhLCB2ZGV2KQogCiB2b2lkIHN0a19jYW1lcmFfZGVsZXRlKHN0cnVj
dCBrcmVmICopOwotLSAKMS41LjYKCg==
------=_Part_11174_2937365.1222393754737
Content-Type: text/x-diff;
	name=0003-stkwebcam-simplify-access-to-stk_camera-struct.patch
Content-Transfer-Encoding: base64
X-Attachment-Id: f_flk5f4hy2
Content-Disposition: attachment;
	filename=0003-stkwebcam-simplify-access-to-stk_camera-struct.patch

RnJvbSBiNTg4NjMwN2ZlMTFlZDNlNzY4NDEzN2NmZWYyNzY2ZGM2YjExZWM0IE1vbiBTZXAgMTcg
MDA6MDA6MDAgMjAwMQpGcm9tOiBEYXZpZCBFbGxpbmdzd29ydGggPGRhdmlkQGlkZW50ZC5keW5k
bnMub3JnPgpEYXRlOiBUaHUsIDI1IFNlcCAyMDA4IDIxOjAwOjU3IC0wNDAwClN1YmplY3Q6IFtQ
QVRDSF0gc3Rrd2ViY2FtOiBzaW1wbGlmeSBhY2Nlc3MgdG8gc3RrX2NhbWVyYSBzdHJ1Y3QKCgpT
aWduZWQtb2ZmLWJ5OiBEYXZpZCBFbGxpbmdzd29ydGggPGRhdmlkQGlkZW50ZC5keW5kbnMub3Jn
PgotLS0KIGRyaXZlcnMvbWVkaWEvdmlkZW8vc3RrLXdlYmNhbS5jIHwgICA0MCArKysrLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAxIGZpbGVzIGNoYW5nZWQsIDUgaW5zZXJ0aW9u
cygrKSwgMzUgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9tZWRpYS92aWRlby9z
dGstd2ViY2FtLmMgYi9kcml2ZXJzL21lZGlhL3ZpZGVvL3N0ay13ZWJjYW0uYwppbmRleCA3YWQ5
N2M3Li5jM2U3ZDY2IDEwMDY0NAotLS0gYS9kcml2ZXJzL21lZGlhL3ZpZGVvL3N0ay13ZWJjYW0u
YworKysgYi9kcml2ZXJzL21lZGlhL3ZpZGVvL3N0ay13ZWJjYW0uYwpAQCAtNjc4LDcgKzY3OCw3
IEBAIHN0YXRpYyBpbnQgdjRsX3N0a19vcGVuKHN0cnVjdCBpbm9kZSAqaW5vZGUsIHN0cnVjdCBm
aWxlICpmcCkKIAkJdW5sb2NrX2tlcm5lbCgpOwogCQlyZXR1cm4gLUVOWElPOwogCX0KLQlmcC0+
cHJpdmF0ZV9kYXRhID0gdmRldjsKKwlmcC0+cHJpdmF0ZV9kYXRhID0gZGV2OwogCXVzYl9hdXRv
cG1fZ2V0X2ludGVyZmFjZShkZXYtPmludGVyZmFjZSk7CiAJdW5sb2NrX2tlcm5lbCgpOwogCkBA
IC02ODcsMTkgKzY4Nyw3IEBAIHN0YXRpYyBpbnQgdjRsX3N0a19vcGVuKHN0cnVjdCBpbm9kZSAq
aW5vZGUsIHN0cnVjdCBmaWxlICpmcCkKIAogc3RhdGljIGludCB2NGxfc3RrX3JlbGVhc2Uoc3Ry
dWN0IGlub2RlICppbm9kZSwgc3RydWN0IGZpbGUgKmZwKQogewotCXN0cnVjdCBzdGtfY2FtZXJh
ICpkZXY7Ci0Jc3RydWN0IHZpZGVvX2RldmljZSAqdmRldjsKLQotCXZkZXYgPSB2aWRlb19kZXZk
YXRhKGZwKTsKLQlpZiAodmRldiA9PSBOVUxMKSB7Ci0JCVNUS19FUlJPUigidjRsX3JlbGVhc2Ug
Y2FsbGVkIHcvbyB2aWRlbyBkZXZkYXRhXG4iKTsKLQkJcmV0dXJuIC1FRkFVTFQ7Ci0JfQotCWRl
diA9IHZkZXZfdG9fY2FtZXJhKHZkZXYpOwotCWlmIChkZXYgPT0gTlVMTCkgewotCQlTVEtfRVJS
T1IoInY0bF9yZWxlYXNlIGNhbGxlZCBvbiByZW1vdmVkIGRldmljZVxuIik7Ci0JCXJldHVybiAt
RU5PREVWOwotCX0KKwlzdHJ1Y3Qgc3RrX2NhbWVyYSAqZGV2ID0gZnAtPnByaXZhdGVfZGF0YTsK
IAogCWlmIChkZXYtPm93bmVyICE9IGZwKSB7CiAJCXVzYl9hdXRvcG1fcHV0X2ludGVyZmFjZShk
ZXYtPmludGVyZmFjZSk7CkBAIC03MjMsMTQgKzcxMSw4IEBAIHN0YXRpYyBzc2l6ZV90IHY0bF9z
dGtfcmVhZChzdHJ1Y3QgZmlsZSAqZnAsIGNoYXIgX191c2VyICpidWYsCiAJaW50IGk7CiAJaW50
IHJldDsKIAl1bnNpZ25lZCBsb25nIGZsYWdzOwotCXN0cnVjdCBzdGtfY2FtZXJhICpkZXY7Ci0J
c3RydWN0IHZpZGVvX2RldmljZSAqdmRldjsKIAlzdHJ1Y3Qgc3RrX3Npb19idWZmZXIgKnNidWY7
Ci0KLQl2ZGV2ID0gdmlkZW9fZGV2ZGF0YShmcCk7Ci0JaWYgKHZkZXYgPT0gTlVMTCkKLQkJcmV0
dXJuIC1FRkFVTFQ7Ci0JZGV2ID0gdmRldl90b19jYW1lcmEodmRldik7CisJc3RydWN0IHN0a19j
YW1lcmEgKmRldiA9IGZwLT5wcml2YXRlX2RhdGE7CiAKIAlpZiAoZGV2ID09IE5VTEwpCiAJCXJl
dHVybiAtRUlPOwpAQCAtNzg5LDE1ICs3NzEsOCBAQCBzdGF0aWMgc3NpemVfdCB2NGxfc3RrX3Jl
YWQoc3RydWN0IGZpbGUgKmZwLCBjaGFyIF9fdXNlciAqYnVmLAogCiBzdGF0aWMgdW5zaWduZWQg
aW50IHY0bF9zdGtfcG9sbChzdHJ1Y3QgZmlsZSAqZnAsIHBvbGxfdGFibGUgKndhaXQpCiB7Ci0J
c3RydWN0IHN0a19jYW1lcmEgKmRldjsKLQlzdHJ1Y3QgdmlkZW9fZGV2aWNlICp2ZGV2OwotCi0J
dmRldiA9IHZpZGVvX2RldmRhdGEoZnApOwotCi0JaWYgKHZkZXYgPT0gTlVMTCkKLQkJcmV0dXJu
IC1FRkFVTFQ7CisJc3RydWN0IHN0a19jYW1lcmEgKmRldiA9IGZwLT5wcml2YXRlX2RhdGE7CiAK
LQlkZXYgPSB2ZGV2X3RvX2NhbWVyYSh2ZGV2KTsKIAlpZiAoZGV2ID09IE5VTEwpCiAJCXJldHVy
biAtRU5PREVWOwogCkBAIC04MzUsMTYgKzgxMCwxMiBAQCBzdGF0aWMgaW50IHY0bF9zdGtfbW1h
cChzdHJ1Y3QgZmlsZSAqZnAsIHN0cnVjdCB2bV9hcmVhX3N0cnVjdCAqdm1hKQogCXVuc2lnbmVk
IGludCBpOwogCWludCByZXQ7CiAJdW5zaWduZWQgbG9uZyBvZmZzZXQgPSB2bWEtPnZtX3Bnb2Zm
IDw8IFBBR0VfU0hJRlQ7Ci0Jc3RydWN0IHN0a19jYW1lcmEgKmRldjsKLQlzdHJ1Y3QgdmlkZW9f
ZGV2aWNlICp2ZGV2OworCXN0cnVjdCBzdGtfY2FtZXJhICpkZXYgPSBmcC0+cHJpdmF0ZV9kYXRh
OwogCXN0cnVjdCBzdGtfc2lvX2J1ZmZlciAqc2J1ZiA9IE5VTEw7CiAKIAlpZiAoISh2bWEtPnZt
X2ZsYWdzICYgVk1fV1JJVEUpIHx8ICEodm1hLT52bV9mbGFncyAmIFZNX1NIQVJFRCkpCiAJCXJl
dHVybiAtRUlOVkFMOwogCi0JdmRldiA9IHZpZGVvX2RldmRhdGEoZnApOwotCWRldiA9IHZkZXZf
dG9fY2FtZXJhKHZkZXYpOwotCiAJZm9yIChpID0gMDsgaSA8IGRldi0+bl9zYnVmczsgaSsrKSB7
CiAJCWlmIChkZXYtPnNpb19idWZzW2ldLnY0bGJ1Zi5tLm9mZnNldCA9PSBvZmZzZXQpIHsKIAkJ
CXNidWYgPSBkZXYtPnNpb19idWZzICsgaTsKQEAgLTEzNjYsNyArMTMzNyw2IEBAIHN0YXRpYyBp
bnQgc3RrX3JlZ2lzdGVyX3ZpZGVvX2RldmljZShzdHJ1Y3Qgc3RrX2NhbWVyYSAqZGV2KQogCWRl
di0+dmRldiA9IHN0a192NGxfZGF0YTsKIAlkZXYtPnZkZXYuZGVidWcgPSBkZWJ1ZzsKIAlkZXYt
PnZkZXYucGFyZW50ID0gJmRldi0+aW50ZXJmYWNlLT5kZXY7Ci0JdmlkZW9fc2V0X2RydmRhdGEo
JmRldi0+dmRldiwgZGV2KTsKIAllcnIgPSB2aWRlb19yZWdpc3Rlcl9kZXZpY2UoJmRldi0+dmRl
diwgVkZMX1RZUEVfR1JBQkJFUiwgLTEpOwogCWlmIChlcnIpCiAJCVNUS19FUlJPUigidjRsIHJl
Z2lzdHJhdGlvbiBmYWlsZWRcbiIpOwotLSAKMS41LjYKCg==
------=_Part_11174_2937365.1222393754737
Content-Type: text/plain; charset="us-ascii"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
Content-Disposition: inline

--
video4linux-list mailing list
Unsubscribe mailto:video4linux-list-request@redhat.com?subject=unsubscribe
https://www.redhat.com/mailman/listinfo/video4linux-list
------=_Part_11174_2937365.1222393754737--
