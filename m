Return-path: <linux-media-owner@vger.kernel.org>
Received: from mail.renesas.com ([202.234.163.13]:44346 "EHLO
	mail05.idc.renesas.com" rhost-flags-OK-OK-OK-FAIL) by vger.kernel.org
	with ESMTP id S1753766AbZCaGT3 (ORCPT
	<rfc822;linux-media@vger.kernel.org>);
	Tue, 31 Mar 2009 02:19:29 -0400
Date: Tue, 31 Mar 2009 14:34:46 +0900
From: Kuninori Morimoto <morimoto.kuninori@renesas.com>
Subject: [PATCH] soc_camera: Add soc_camera_match function
To: Guennadi Liakhovetski <g.liakhovetski@gmx.de>
Cc: Linux Media <linux-media@vger.kernel.org>
Message-id: <uzlf2uscy.wl%morimoto.kuninori@renesas.com>
MIME-version: 1.0 (generated by SEMI 1.14.6 - "Maruoka")
Content-type: text/plain; charset=US-ASCII
Sender: linux-media-owner@vger.kernel.org
List-ID: <linux-media.vger.kernel.org>


${LINUX}/drivers/base/dd.c :: __device_attach
use driver_match_device function.
It needs bus->match function.

Signed-off-by: Kuninori Morimoto <morimoto.kuninori@renesas.com>
---

> Guennadi

I tried latest Linux 2.6.29 from Paul's git
 git://git.kernel.org/pub/scm/linux/kernel/git/lethal/sh-2.6.git

Then, soc_camera doesn't works.
please check 49b420a13ff95b449947181190b08367348e3e1b
But I'm not sure is this patch correct fix ? 

 drivers/media/video/soc_camera.c |    9 +++++++++
 1 files changed, 9 insertions(+), 0 deletions(-)

diff --git a/drivers/media/video/soc_camera.c b/drivers/media/video/soc_camera.c
index 6d8bfd4..a10828b 100644
--- a/drivers/media/video/soc_camera.c
+++ b/drivers/media/video/soc_camera.c
@@ -929,12 +929,21 @@ static int soc_camera_resume(struct device *dev)
 	return ret;
 }
 
+int soc_camera_match(struct device *dev, struct device_driver *drv)
+{
+	struct soc_camera_device *icd = to_soc_camera_dev(dev);
+	struct soc_camera_host *ici = to_soc_camera_host(icd->dev.parent);
+
+	return ici->nr == icd->iface;
+}
+
 static struct bus_type soc_camera_bus_type = {
 	.name		= "soc-camera",
 	.probe		= soc_camera_probe,
 	.remove		= soc_camera_remove,
 	.suspend	= soc_camera_suspend,
 	.resume		= soc_camera_resume,
+	.match		= soc_camera_match,
 };
 
 static struct device_driver ic_drv = {
-- 
1.5.6.3

