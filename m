Return-path: <video4linux-list-bounces@redhat.com>
Received: from mx3.redhat.com (mx3.redhat.com [172.16.48.32])
	by int-mx1.corp.redhat.com (8.13.1/8.13.1) with ESMTP id mBJHZGxu004146
	for <video4linux-list@redhat.com>; Fri, 19 Dec 2008 12:35:16 -0500
Received: from web32107.mail.mud.yahoo.com (web32107.mail.mud.yahoo.com
	[68.142.207.121])
	by mx3.redhat.com (8.13.8/8.13.8) with SMTP id mBJHY5En001753
	for <video4linux-list@redhat.com>; Fri, 19 Dec 2008 12:34:05 -0500
Date: Fri, 19 Dec 2008 09:34:04 -0800 (PST)
From: Agustin <gatoguan-os@yahoo.com>
To: Guennadi Liakhovetski <g.liakhovetski@gmx.de>
In-Reply-To: <Pine.LNX.4.64.0812191319090.4536@axis700.grange>
MIME-Version: 1.0
Content-Type: multipart/mixed; boundary="0-151166100-1229708044=:96900"
Message-ID: <879100.96900.qm@web32107.mail.mud.yahoo.com>
Cc: video4linux-list@redhat.com
Subject: Success with mx3_camera, panic at mx3_cam_dma_done
Reply-To: gatoguan-os@yahoo.com
List-Unsubscribe: <https://www.redhat.com/mailman/listinfo/video4linux-list>,
	<mailto:video4linux-list-request@redhat.com?subject=unsubscribe>
List-Archive: <https://www.redhat.com/mailman/private/video4linux-list>
List-Post: <mailto:video4linux-list@redhat.com>
List-Help: <mailto:video4linux-list-request@redhat.com?subject=help>
List-Subscribe: <https://www.redhat.com/mailman/listinfo/video4linux-list>,
	<mailto:video4linux-list-request@redhat.com?subject=subscribe>
Sender: video4linux-list-bounces@redhat.com
Errors-To: video4linux-list-bounces@redhat.com
List-ID: <video4linux-list@redhat.com>

--0-151166100-1229708044=:96900
Content-Type: text/plain; charset=utf-8
Content-Transfer-Encoding: quoted-printable

Hi again,

On Fri, 19/12/08, Guennadi Liakhovetski wrote:
> On Fri, 19 Dec 2008, Agustin wrote:
> > I can't tell if I am having a hardware issue...
> > Do you have any modification or fix in your
> > Phytec i.MX31 dev-kit?
>=20
> Nothing ground-breaking. The snapshot I uploaded
> for you in November worked for me and it should work
> for you too. By "select timeout" I suspect you're not
> getting any interrupts at all, right?

Indeed.

> That's your first task - to get your setup generate
> at least one interrupt, then it'll be easier:-) You
> say "haven't been able to retrieve a VGA sized dummy
> image" - does it mean you can retrieve other (smaller)
> sizes?

Nope!

> If not, I would check signalling. Check the master
> clock, whether the pixel clock is generated. You're
> using master mode, right? If both clocks are ok, check
> syncs. You said before your logic analyser showed a
> plausible picture...

Indeed I could see those signals quite fine, all the way to devkit connecto=
r. Later on it is a pain to attach probes...

I tried swapping the devkit for an older one, and voila! I got my dearest f=
irst image right away.

It might be that the connector was not pushed to the end, or it might be so=
me issue with the new devkit Phytec sent me last month, it is quite differe=
nt, has some manual rework, and it is missing the white ink layer so I can'=
t tell jumpers apart.

> Are you doing 8 or 16 bits? Check output of /proc/interrupts
> _while_ a task is waiting in select, you should be getting
> irq #167 - one per frame.

Yeah but fortunately I didn't have to go that far debugging.

However, I still managed to make mx3_camera driver crash. It is probably a =
race condition around end-of-capture event, because I can retrieve an arbit=
rary number of frames without issues, then when application exits the dma g=
ets triggered again and mx3_cam_dma_done() fails, probably trying to access=
 an already freed buffer. If I only use one buffer, there are no issues eit=
her, I think it is because mx3_cam_dma_done() anticipates the lack of buffe=
rs each time. However, I might be loosing frames in this case.

I attach a log of the crash, along with the still capture test application =
I am using (a simplification of the 'official' V4L2 example). 'Sixcam' is t=
he name of my project, BTW.

I will try to provide a fix as soon as I get off this Christmas work crunch=
 I am having... But now that I got the data through to userspace (and the p=
rototype boards apparently working) my next weeks of work promise some happ=
y results.

Thanks & regards,
--Agust=C3=ADn.

--
Agustin Ferrin Pozuelo
Embedded Systems Consultant
http://embedded.ferrin.org/
Tel. +34 610502587

--0-151166100-1229708044=:96900
Content-Type: application/octet-stream; name="mx3_cam_dma_done-panic.log"
Content-Transfer-Encoding: base64
Content-Disposition: attachment; filename="mx3_cam_dma_done-panic.log"

c2l4Y2FtX21vZHVsZV9pbml0KCk6NDA2CnNpeGNhbTogVFJJR0dFUiBIaWdo
LgpjYW1lcmEgMC0wOiBNWDMgQ2FtZXJhIGRyaXZlciBhdHRhY2hlZCB0byBj
YW1lcmEgMApzaXhjYW1fdmlkZW9fcHJvYmUoKToyODQKY2FtZXJhIDAtMDog
TVgzIENhbWVyYSBkcml2ZXIgZGV0YWNoZWQgZnJvbSBjYW1lcmEgMApjYW1l
cmEgMC0wOiBNWDMgQ2FtZXJhIGRyaXZlciBhdHRhY2hlZCB0byBjYW1lcmEg
MApzaXhjYW1fc2V0X2ZtdCgpOjI0NApyZWN0LT53aWR0aD02NDAgcmVjdC0+
aGVpZ2h0PTQ4MC4Kc2l4Y2FtOiBjYW1lcmEgIzAgcmVnIDVoIHdhcyAwLCBz
ZXQgdG8gMjUuCnNpeGNhbTogY2FtZXJhICMwIHJlZyA2aCB3YXMgMCwgc2V0
IHRvIDkuCnNpeGNhbTogY2FtZXJhICMwIHJlZyAyaCB3YXMgMCwgc2V0IHRv
IDAuCnNpeGNhbTogY2FtZXJhICMwIHJlZyAxaCB3YXMgMCwgc2V0IHRvIDAu
CnNpeGNhbTogY2FtZXJhICMwIHJlZyA0aCB3YXMgMCwgc2V0IHRvIDYzOS4K
c2l4Y2FtOiBjYW1lcmEgIzAgcmVnIDNoIHdhcyAwLCBzZXQgdG8gNDc5Lgpz
aXhjYW06IGNhbWVyYSAjMCByZWcgOWggd2FzIDAsIHNldCB0byA0ODkuCnNp
eGNhbV9xdWVyeV9idXNfcGFyYW0oKToyMjkKc2l4Y2FtX3RyeV9mbXQoKToy
NjYKaWNkLT53aWR0aD02NDAgaWNkLT5oZWlnaHQ9NDgwLgpmbXQucGl4Lndp
ZHRoPTY0MCBmbXQucGl4LmhlaWdodD00ODAuCnNpeGNhbV9zZXRfZm10KCk6
MjQ0CnJlY3QtPndpZHRoPTY0MCByZWN0LT5oZWlnaHQ9NDgwLgpzaXhjYW06
IGNhbWVyYSAjMCByZWcgNWggd2FzIDI1LCBzZXQgdG8gMjUuCnNpeGNhbTog
Y2FtZXJhICMwIHJlZyA2aCB3YXMgOSwgc2V0IHRvIDkuCnNpeGNhbTogY2Ft
ZXJhICMwIHJlZyAyaCB3YXMgMCwgc2V0IHRvIDAuCnNpeGNhbTogY2FtZXJh
ICMwIHJlZyAxaCB3YXMgMCwgc2V0IHRvIDAuCnNpeGNhbTogY2FtZXJhICMw
IHJlZyA0aCB3YXMgNjM5LCBzZXQgdG8gNjM5LgpzaXhjYW06IGNhbWVyYSAj
MCByZWcgM2ggd2FzIDQ3OSwgc2V0IHRvIDQ3OS4Kc2l4Y2FtOiBjYW1lcmEg
IzAgcmVnIDloIHdhcyA0ODksIHNldCB0byA0ODkuCnNpeGNhbV9xdWVyeV9i
dXNfcGFyYW0oKToyMjkKc2l4Y2FtX3NldF9idXNfcGFyYW0oKToyMTgKc2l4
Y2FtOiBzaXhjYW1fYnVzX3BhcmFtcyA8PSAweDIyMTUuCnNpeGNhbV9zdGFy
dF9jYXB0dXJlKCk6MTk2CnNpeGNhbTogVFJJR0dFUiBIaWdoLgpzaXhjYW06
IFRSSUdHRVIgTG93LgpzaXhjYW1fc3RvcF9jYXB0dXJlKCk6MjA4ClVuYWJs
ZSB0byBoYW5kbGUga2VybmVsIE5VTEwgcG9pbnRlciBkZXJlZmVyZW5jZSBh
dCB2aXJ0dWFsIGFkZHJlc3MgMDAwMDAwMmMKcGdkID0gYzAwMDQwMDAKWzAw
MDAwMDJjXSAqcGdkPTAwMDAwMDAwCkludGVybmFsIGVycm9yOiBPb3BzOiAx
NyBbIzFdIFBSRUVNUFQKTW9kdWxlcyBsaW5rZWQgaW46IHNpeGNhbSBteDNf
Y2FtZXJhIHNvY19jYW1lcmEgdmlkZW9idWZfZG1hX2NvbnRpZyB2aWRlb2J1
Zl9jb3JlCkNQVTogMCAgICBOb3QgdGFpbnRlZCAgKDIuNi4yOC1yYzMtbmV4
dC0yMDA4MTEwNWdhdG8tMDMwNDItZzI1YTQwNTUtZGlydHkgIzQwKQpQQyBp
cyBhdCBteDNfY2FtX2RtYV9kb25lKzB4MjgvMHgxMDggW214M19jYW1lcmFd
CkxSIGlzIGF0IGlkbWFjX2ludGVycnVwdCsweDE3NC8weDM1MApwYyA6IFs8
YmYwMTM0ZTg+XSAgICBsciA6IFs8YzAxOTI2MzA+XSAgICBwc3I6IGEwMDAw
MTEzCnNwIDogYzAzMjllNDggIGlwIDogMDAwMDAwMmMgIGZwIDogYzAzMjll
NjQKcjEwOiAwMDAwMDAwNyAgcjkgOiBjMDM2Mzg2MCAgcjggOiBjODhiNDNj
MApyNyA6IGMwMzI4MDAwICByNiA6IGM4OGE2MDAwICByNSA6IGM4OGE2MDMw
ICByNCA6IDAwMDAwMDAwCnIzIDogMDAyMDAyMDAgIHIyIDogMDAwMDAwMDQg
IHIxIDogMDAwMDAwODAgIHIwIDogYzg4YjQzYzAKRmxhZ3M6IE56Q3YgIElS
UXMgb24gIEZJUXMgb24gIE1vZGUgU1ZDXzMyICBJU0EgQVJNICBTZWdtZW50
IGtlcm5lbApDb250cm9sOiAwMGM1Mzg3ZiAgVGFibGU6IDg2MWI0MDAwICBE
QUM6IDAwMDAwMDE3ClByb2Nlc3Mgc3dhcHBlciAocGlkOiAwLCBzdGFjayBs
aW1pdCA9IDB4YzAzMjgyNjApClN0YWNrOiAoMHhjMDMyOWU0OCB0byAweGMw
MzJhMDAwKQo5ZTQwOiAgICAgICAgICAgICAgICAgICBjMDMyOWU2NCBjMDM2
MzcwMCAwMDAwMDAwMSBjNjFkNjk2YyBjMDMyOWVhYyBjMDMyOWU2OCAKOWU2
MDogYzAxOTI2MzAgYmYwMTM0Y2MgMTRkY2IxODQgMDAwMDAwMDAgMDAwMDAw
MDMgYzAzNTQ5MDAgYzAzMjllOTQgYzAzNjM4NzAgCjllODA6IGMwMDkwM2I4
IGM2MjQzZGUwIDAwMDAwMDAwIDAwMDAwMDAwIDAwMDAwMGE3IGMwMzQyNzgw
IGMwMzI4MDAwIDgwMDFlMGI4IAo5ZWEwOiBjMDMyOWVjYyBjMDMyOWViMCBj
MDA2MGE2MCBjMDE5MjRjOCBjMDMyODAwMCBjMDMzMjc1YyBjNjI0M2RlMCAw
MDAwMDBhNyAKOWVjMDogYzAzMjllZWMgYzAzMjllZDAgYzAwNjJiYjAgYzAw
NjBhMzAgMDAwMDAwMDAgYzAzNDI3NDQgYzAzMzAwMzQgYzAzNjJiOTAgCjll
ZTA6IGMwMzI5ZjE0IGMwMzI5ZWYwIGMwMTkwNzVjIGMwMDYyYjE0IGMwMzI5
ZjE0IDAwMDAwMDJhIGMwMzVmNzUwIDAwMDAwMDAwIAo5ZjAwOiAwMDAwMDAw
MiAwMDAwMDAwMSBjMDMyOWYzNCBjMDMyOWYxOCBjMDAyMjA2MCBjMDE5MDZj
YyBjMDMyOWY0NCAwMDAwMDAxZiAKOWYyMDogZmM0MDAwMDAgMDAyYTAwMDAg
YzAzMjlmOGMgYzAzMjlmMzggYzAwMjJhNmMgYzAwMjIwMGMgYzAzNGQ0MTgg
MDAwMDAwMDAgCjlmNDA6IDAwMDAwMDAwIGMwMzI4MDAwIGMwMDIzZTdjIGMw
MzI4MDAwIGMwMzRjYzY4IGMwMzJiY2Q0IDgwMDFlMGVjIDQxMDdiMzY0IAo5
ZjYwOiA4MDAxZTBiOCBjMDMyOWY4YyBjMDMyOWY5MCBjMDMyOWY4MCBjMDAy
M2ViOCBjMDAyM2ViYyA2MDAwMDAxMyBmZmZmZmZmZiAKOWY4MDogYzAzMjlm
YWMgYzAzMjlmOTAgYzAwMjNkYTQgYzAwMjNlODggYzAzMmJjZDQgYzAzMjgw
MDAgYzAzNGM3ZjQgYzAzNGM3ZTQgCjlmYTA6IGMwMzI5ZmM0IGMwMzI5ZmIw
IGMwMjg3YTIwIGMwMDIzZDdjIGMwMzRjN2Y0IGMwMzU0YzQ4IGMwMzI5ZmY0
IGMwMzI5ZmM4IAo5ZmMwOiBjMDAwOGEwOCBjMDI4NzliOCBjMDAwODNhYyAw
MDAwMDAwMCAwMDAwMDAwMCBjMDAxZmQ1OCAwMDAwMDAwMCAwMGM1Mzg3ZCAK
OWZlMDogYzAzNGNjZDQgYzAwMjAxNWMgMDAwMDAwMDAgYzAzMjlmZjggODAw
MDgwMzQgYzAwMDg4MjAgMDAwMDAwMDAgMDAwMDAwMDAgCkJhY2t0cmFjZTog
Cls8YmYwMTM0YzA+XSAobXgzX2NhbV9kbWFfZG9uZSsweDAvMHgxMDggW214
M19jYW1lcmFdKSBmcm9tIFs8YzAxOTI2MzA+XSAoaWRtYWNfaW50ZXJydXB0
KzB4MTc0LzB4MzUwKQogcjY6YzYxZDY5NmMgcjU6MDAwMDAwMDEgcjQ6YzAz
NjM3MDAKWzxjMDE5MjRiYz5dIChpZG1hY19pbnRlcnJ1cHQrMHgwLzB4MzUw
KSBmcm9tIFs8YzAwNjBhNjA+XSAoaGFuZGxlX0lSUV9ldmVudCsweDNjLzB4
NzQpCls8YzAwNjBhMjQ+XSAoaGFuZGxlX0lSUV9ldmVudCsweDAvMHg3NCkg
ZnJvbSBbPGMwMDYyYmIwPl0gKGhhbmRsZV9sZXZlbF9pcnErMHhhOC8weDE1
MCkKIHI3OjAwMDAwMGE3IHI2OmM2MjQzZGUwIHI1OmMwMzMyNzVjIHI0OmMw
MzI4MDAwCls8YzAwNjJiMDg+XSAoaGFuZGxlX2xldmVsX2lycSsweDAvMHgx
NTApIGZyb20gWzxjMDE5MDc1Yz5dIChpcHVfaXJxX2ZuKzB4OWMvMHhkMCkK
IHI3OmMwMzYyYjkwIHI2OmMwMzMwMDM0IHI1OmMwMzQyNzQ0IHI0OjAwMDAw
MDAwCls8YzAxOTA2YzA+XSAoaXB1X2lycV9mbisweDAvMHhkMCkgZnJvbSBb
PGMwMDIyMDYwPl0gKGFzbV9kb19JUlErMHg2MC8weDhjKQogcjg6MDAwMDAw
MDEgcjc6MDAwMDAwMDIgcjY6MDAwMDAwMDAgcjU6YzAzNWY3NTAgcjQ6MDAw
MDAwMmEKWzxjMDAyMjAwMD5dIChhc21fZG9fSVJRKzB4MC8weDhjKSBmcm9t
IFs8YzAwMjJhNmM+XSAoX19pcnFfc3ZjKzB4NGMvMHg5OCkKRXhjZXB0aW9u
IHN0YWNrKDB4YzAzMjlmMzggdG8gMHhjMDMyOWY4MCkKOWYyMDogICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgYzAzNGQ0MTggMDAwMDAwMDAgCjlmNDA6IDAwMDAwMDAwIGMwMzI4MDAw
IGMwMDIzZTdjIGMwMzI4MDAwIGMwMzRjYzY4IGMwMzJiY2Q0IDgwMDFlMGVj
IDQxMDdiMzY0IAo5ZjYwOiA4MDAxZTBiOCBjMDMyOWY4YyBjMDMyOWY5MCBj
MDMyOWY4MCBjMDAyM2ViOCBjMDAyM2ViYyA2MDAwMDAxMyBmZmZmZmZmZiAK
IHI2OjAwMmEwMDAwIHI1OmZjNDAwMDAwIHI0OjAwMDAwMDFmCls8YzAwMjNl
N2M+XSAoZGVmYXVsdF9pZGxlKzB4MC8weDQ4KSBmcm9tIFs8YzAwMjNkYTQ+
XSAoY3B1X2lkbGUrMHgzNC8weDY4KQpbPGMwMDIzZDcwPl0gKGNwdV9pZGxl
KzB4MC8weDY4KSBmcm9tIFs8YzAyODdhMjA+XSAocmVzdF9pbml0KzB4NzQv
MHg4OCkKIHI2OmMwMzRjN2U0IHI1OmMwMzRjN2Y0IHI0OmMwMzI4MDAwCls8
YzAyODc5YWM+XSAocmVzdF9pbml0KzB4MC8weDg4KSBmcm9tIFs8YzAwMDhh
MDg+XSAoc3RhcnRfa2VybmVsKzB4MWY0LzB4MjcwKQogcjQ6YzAzNTRjNDgK
WzxjMDAwODgxND5dIChzdGFydF9rZXJuZWwrMHgwLzB4MjcwKSBmcm9tIFs8
ODAwMDgwMzQ+XSAoMHg4MDAwODAzNCkKIHI2OmMwMDIwMTVjIHI1OmMwMzRj
Y2Q0IHI0OjAwYzUzODdkCkNvZGU6IGU1OWYzMGUwIGUyNDU2MDMwIGU1OTY0
MDJjIGUyODRjMDJjIChlNTk0MTAyYykgCktlcm5lbCBwYW5pYyAtIG5vdCBz
eW5jaW5nOiBGYXRhbCBleGNlcHRpb24gaW4gaW50ZXJydXB0Cg==

--0-151166100-1229708044=:96900
Content-Type: text/x-csrc; name="still.c"
Content-Transfer-Encoding: base64
Content-Disposition: attachment; filename="still.c"

LyoKICogIEJhc2VkIG9uIFY0TDIgdmlkZW8gY2FwdHVyZSBleGFtcGxlCiAq
CiAqLwoKI2luY2x1ZGUgPHN0ZGlvLmg+CiNpbmNsdWRlIDxzdGRsaWIuaD4K
I2luY2x1ZGUgPHN0cmluZy5oPgojaW5jbHVkZSA8YXNzZXJ0Lmg+CgojaW5j
bHVkZSA8ZmNudGwuaD4gICAgICAgICAgICAgIC8qIGxvdy1sZXZlbCBpL28g
Ki8KI2luY2x1ZGUgPHVuaXN0ZC5oPgojaW5jbHVkZSA8ZXJybm8uaD4KI2lu
Y2x1ZGUgPG1hbGxvYy5oPgojaW5jbHVkZSA8c3lzL3N0YXQuaD4KI2luY2x1
ZGUgPHN5cy90eXBlcy5oPgojaW5jbHVkZSA8c3lzL3RpbWUuaD4KI2luY2x1
ZGUgPHN5cy9tbWFuLmg+CiNpbmNsdWRlIDxzeXMvaW9jdGwuaD4KCiNpbmNs
dWRlIDxhc20vdHlwZXMuaD4gICAgICAgICAgLyogZm9yIHZpZGVvZGV2Mi5o
ICovCiNpbmNsdWRlIDxsaW51eC92aWRlb2RldjIuaD4KCiNpbmNsdWRlICJz
aXhjYW0uaCIKCiNkZWZpbmUgemVyb2ZpbGwoeCkgbWVtc2V0KCYoeCksMCxz
aXplb2YoeCkpCgpzdHJ1Y3QgYnVmZmVyIHsKICAgIHZvaWQgKiBzdGFydDsK
ICAgIHNpemVfdCBsZW5ndGg7Cn07CgpzdGF0aWMgY2hhciAqIGRldl9uYW1l
ID0gIi9kZXYvdjRsL3ZpZGVvMCI7CnN0YXRpYyBpbnQgZmQgPSAtMTsKc3Ry
dWN0IGJ1ZmZlciAqIGJ1ZmZlcnMgPSBOVUxMOwpzdGF0aWMgdW5zaWduZWQg
aW50IG5fYnVmZmVycyA9IDA7CgpzdGF0aWMgdm9pZCBlcnJub19leGl0KGNv
bnN0IGNoYXIgKiBzKQp7CiAgICBmcHJpbnRmKHN0ZGVyciwgIiVzIGVycm9y
ICVkLCAlc1xuIiwgcywgZXJybm8sIHN0cmVycm9yKGVycm5vKSk7CiAgICBl
eGl0KEVYSVRfRkFJTFVSRSk7Cn0KCnN0YXRpYyBpbnQgeGlvY3RsKGludCBm
ZCwgaW50IHJlcXVlc3QsIHZvaWQgKmFyZykKewogICAgaW50IHI7CgogICAg
ZG8gciA9IGlvY3RsKGZkLCByZXF1ZXN0LCBhcmcpOwogICAgd2hpbGUoLTEg
PT0gciAmJiBFSU5UUiA9PSBlcnJubyk7CgogICAgcmV0dXJuIHI7Cn0KCnN0
YXRpYyB2b2lkIHByb2Nlc3NfaW1hZ2UoY29uc3Qgdm9pZCAqcCkKewogICAg
cHJpbnRmKCJHb3Qgb25lIGltYWdlLlxuIik7Cn0KCnN0YXRpYyBpbnQgcmVh
ZF9mcmFtZSh2b2lkKQp7CiAgICBzdHJ1Y3QgdjRsMl9idWZmZXIgYnVmOwoK
ICAgIHplcm9maWxsKGJ1Zik7CiAgICBidWYudHlwZSA9IFY0TDJfQlVGX1RZ
UEVfVklERU9fQ0FQVFVSRTsKICAgIGJ1Zi5tZW1vcnkgPSBWNEwyX01FTU9S
WV9NTUFQOwoKICAgIGlmKCAtMSA9PSB4aW9jdGwoZmQsIFZJRElPQ19EUUJV
RiwgJmJ1ZikpCiAgICB7CiAgICAgICAgc3dpdGNoKCBlcnJubykgewogICAg
ICAgIGNhc2UgRUFHQUlOOgogICAgICAgICAgICBmcHJpbnRmKHN0ZGVyciwg
IlZJRElPQ19EUUJVRiAtRUFHQUlOLlxuIik7CiAgICAgICAgICAgIHJldHVy
biAwOwoKICAgICAgICBjYXNlIEVJTzoKICAgICAgICAgICAgLyogQ291bGQg
aWdub3JlIEVJTywgc2VlIHNwZWMuICovCgogICAgICAgICAgICAvKiBmYWxs
IHRocm91Z2ggKi8KCiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgZXJy
bm9fZXhpdCgiVklESU9DX0RRQlVGIik7CiAgICAgICAgfQogICAgfQoKICAg
IGFzc2VydChidWYuaW5kZXggPCBuX2J1ZmZlcnMpOwoKICAgIHByb2Nlc3Nf
aW1hZ2UoYnVmZmVyc1tidWYuaW5kZXhdLnN0YXJ0KTsKCiAgICBpZigtMSA9
PSB4aW9jdGwoZmQsIFZJRElPQ19RQlVGLCAmYnVmKSkKICAgICAgICBlcnJu
b19leGl0KCJWSURJT0NfUUJVRiIpOwoKICAgIHJldHVybiAxOwp9CgpzdGF0
aWMgdm9pZCBvcGVuX2RldmljZSh2b2lkKQp7CiAgICBzdHJ1Y3Qgc3RhdCBz
dDsgCgogICAgaWYoLTEgPT0gc3RhdChkZXZfbmFtZSwgJnN0KSkgewogICAg
ICAgIGZwcmludGYoc3RkZXJyLCAiQ2Fubm90IGlkZW50aWZ5ICclcyc6ICVk
LCAlc1xuIiwKICAgICAgICAgICAgIGRldl9uYW1lLCBlcnJubywgc3RyZXJy
b3IoZXJybm8pKTsKICAgICAgICBleGl0KEVYSVRfRkFJTFVSRSk7CiAgICB9
CgogICAgaWYoIVNfSVNDSFIoc3Quc3RfbW9kZSkpIHsKICAgICAgICBmcHJp
bnRmKHN0ZGVyciwgIiVzIGlzIG5vIGRldmljZVxuIiwgZGV2X25hbWUpOwog
ICAgICAgIGV4aXQoRVhJVF9GQUlMVVJFKTsKICAgIH0KCiAgICBmZCA9IG9w
ZW4oZGV2X25hbWUsIE9fUkRXUiAvKiByZXF1aXJlZCAqLyB8IE9fTk9OQkxP
Q0ssIDApOwoKICAgIGlmKC0xID09IGZkKSB7CiAgICAgICAgZnByaW50Zihz
dGRlcnIsICJDYW5ub3Qgb3BlbiAnJXMnOiAlZCwgJXNcbiIsCiAgICAgICAg
ICAgICBkZXZfbmFtZSwgZXJybm8sIHN0cmVycm9yKGVycm5vKSk7CiAgICAg
ICAgZXhpdChFWElUX0ZBSUxVUkUpOwogICAgfQp9CgpzdGF0aWMgdm9pZCBp
bml0X21tYXAodm9pZCkKewogICAgc3RydWN0IHY0bDJfcmVxdWVzdGJ1ZmZl
cnMgcmVxOwogICAgaW50IGk7CgogICAgemVyb2ZpbGwocmVxKTsKCiAgICBy
ZXEuY291bnQgICAgICAgICAgICAgICA9IDI7CiAgICByZXEudHlwZSAgICAg
ICAgICAgICAgICA9IFY0TDJfQlVGX1RZUEVfVklERU9fQ0FQVFVSRTsKICAg
IHJlcS5tZW1vcnkgICAgICAgICAgICAgID0gVjRMMl9NRU1PUllfTU1BUDsK
CiAgICBpZigtMSA9PSB4aW9jdGwoZmQsIFZJRElPQ19SRVFCVUZTLCAmcmVx
KSkgewogICAgICAgIGlmKEVJTlZBTCA9PSBlcnJubykgewogICAgICAgICAg
ICBmcHJpbnRmKHN0ZGVyciwgIiVzIGRvZXMgbm90IHN1cHBvcnQgIgogICAg
ICAgICAgICAgICAgICJtZW1vcnkgbWFwcGluZ1xuIiwgZGV2X25hbWUpOwog
ICAgICAgICAgICBleGl0KEVYSVRfRkFJTFVSRSk7CiAgICAgICAgfSBlbHNl
IHsKICAgICAgICAgICAgZXJybm9fZXhpdCgiVklESU9DX1JFUUJVRlMiKTsK
ICAgICAgICB9CiAgICB9CgogICAgcHJpbnRmKCJHb3QgJWkgYnVmZmVyc1xu
IiwgcmVxLmNvdW50KTsKICAgIGlmKHJlcS5jb3VudCA8IDEpIHsKICAgICAg
ICBmcHJpbnRmKHN0ZGVyciwgIkluc3VmZmljaWVudCBidWZmZXIgbWVtb3J5
IG9uICVzXG4iLCBkZXZfbmFtZSk7CiAgICAgICAgZXhpdChFWElUX0ZBSUxV
UkUpOwogICAgfQoKICAgIGJ1ZmZlcnMgPSBjYWxsb2MocmVxLmNvdW50LCBz
aXplb2YoKmJ1ZmZlcnMpKTsKCiAgICBpZighYnVmZmVycykgewogICAgICAg
IGZwcmludGYoc3RkZXJyLCAiT3V0IG9mIG1lbW9yeVxuIik7CiAgICAgICAg
ZXhpdChFWElUX0ZBSUxVUkUpOwogICAgfQoKICAgIGZvcihpID0gMDsgaSA8
IHJlcS5jb3VudDsgKytpKSB7CiAgICAgICAgc3RydWN0IHY0bDJfYnVmZmVy
IGJ1ZjsKCiAgICAgICAgemVyb2ZpbGwoYnVmKTsKCiAgICAgICAgYnVmLnR5
cGUgICAgICAgID0gVjRMMl9CVUZfVFlQRV9WSURFT19DQVBUVVJFOwogICAg
ICAgIGJ1Zi5tZW1vcnkgICAgICA9IFY0TDJfTUVNT1JZX01NQVA7CiAgICAg
ICAgYnVmLmluZGV4ICAgICAgID0gaTsKCiAgICAgICAgaWYoLTEgPT0geGlv
Y3RsKGZkLCBWSURJT0NfUVVFUllCVUYsICZidWYpKQogICAgICAgICAgICBl
cnJub19leGl0KCJWSURJT0NfUVVFUllCVUYiKTsKCiAgICAgICAgcHJpbnRm
KCJtLW1hcHBpbmcgYnVmZmVyICMlaSBhdCAlcCwgc2l6ZSAweCVYLi4uXG4i
LCBpLCBidWYubS5vZmZzZXQKICAgICAgICAgICAgICAgICwgYnVmLmxlbmd0
aCk7CiAgICAgICAgYnVmZmVyc1tpXS5sZW5ndGggPSBidWYubGVuZ3RoOwog
ICAgICAgIGJ1ZmZlcnNbaV0uc3RhcnQgPQogICAgICAgICAgICBtbWFwKE5V
TEwgLyogc3RhcnQgYW55d2hlcmUgKi8sCiAgICAgICAgICAgICAgICAgIGJ1
Zi5sZW5ndGgsCiAgICAgICAgICAgICAgICAgIFBST1RfUkVBRCB8IFBST1Rf
V1JJVEUgICAgICAgIC8qIHJlY29tbWVuZGVkICovLAogICAgICAgICAgICAg
ICAgICBNQVBfU0hBUkVEICAgICAgICAgICAgICAgICAgICAvKiByZWNvbW1l
bmRlZCAqLywKICAgICAgICAgICAgICAgICAgZmQsIGJ1Zi5tLm9mZnNldCk7
CgogICAgICAgIGlmKE1BUF9GQUlMRUQgPT0gYnVmZmVyc1tpXS5zdGFydCkK
ICAgICAgICAgICAgZXJybm9fZXhpdCgibW1hcCIpOwogICAgfQogICAgbl9i
dWZmZXJzID0gaTsKfQoKc3RhdGljIHZvaWQgaW5pdF9kZXZpY2Uodm9pZCkK
ewogICAgc3RydWN0IHY0bDJfY2FwYWJpbGl0eSBjYXA7CiAgICBzdHJ1Y3Qg
djRsMl9jcm9wY2FwIGNyb3BjYXA7CiAgICBzdHJ1Y3QgdjRsMl9jcm9wIGNy
b3A7CiAgICBzdHJ1Y3QgdjRsMl9mb3JtYXQgZm10OwogICAgdW5zaWduZWQg
aW50IG1pbjsKCiAgICBpZigtMSA9PSB4aW9jdGwoZmQsIFZJRElPQ19RVUVS
WUNBUCwgJmNhcCkpIHsKICAgICAgICBpZihFSU5WQUwgPT0gZXJybm8pIHsK
ICAgICAgICAgICAgZnByaW50ZihzdGRlcnIsICIlcyBpcyBubyBWNEwyIGRl
dmljZVxuIiwKICAgICAgICAgICAgICAgICBkZXZfbmFtZSk7CiAgICAgICAg
ICAgIGV4aXQoRVhJVF9GQUlMVVJFKTsKICAgICAgICB9IGVsc2UgewogICAg
ICAgICAgICBlcnJub19leGl0KCJWSURJT0NfUVVFUllDQVAiKTsKICAgICAg
ICB9CiAgICB9CgogICAgaWYoIShjYXAuY2FwYWJpbGl0aWVzICYgVjRMMl9D
QVBfVklERU9fQ0FQVFVSRSkpIHsKICAgICAgICBmcHJpbnRmKHN0ZGVyciwg
IiVzIGlzIG5vIHZpZGVvIGNhcHR1cmUgZGV2aWNlXG4iLAogICAgICAgICAg
ICAgZGV2X25hbWUpOwogICAgICAgIGV4aXQoRVhJVF9GQUlMVVJFKTsKICAg
IH0KCiAgICBpZighKGNhcC5jYXBhYmlsaXRpZXMgJiBWNEwyX0NBUF9TVFJF
QU1JTkcpKSB7CiAgICAgICAgZnByaW50ZihzdGRlcnIsICIlcyBkb2VzIG5v
dCBzdXBwb3J0IHN0cmVhbWluZyBpL29cbiIsCiAgICAgICAgICAgICBkZXZf
bmFtZSk7CiAgICAgICAgZXhpdChFWElUX0ZBSUxVUkUpOwogICAgfQoKICAg
IC8qIFNlbGVjdCB2aWRlbyBpbnB1dCwgdmlkZW8gc3RhbmRhcmQgYW5kIHR1
bmUgaGVyZS4gKi8KCiAgICB6ZXJvZmlsbChjcm9wY2FwKTsKCiAgICBjcm9w
Y2FwLnR5cGUgPSBWNEwyX0JVRl9UWVBFX1ZJREVPX0NBUFRVUkU7CgogICAg
aWYoMCA9PSB4aW9jdGwoZmQsIFZJRElPQ19DUk9QQ0FQLCAmY3JvcGNhcCkp
IHsKICAgICAgICBjcm9wLnR5cGUgPSBWNEwyX0JVRl9UWVBFX1ZJREVPX0NB
UFRVUkU7CiAgICAgICAgY3JvcC5jID0gY3JvcGNhcC5kZWZyZWN0OyAvKiBy
ZXNldCB0byBkZWZhdWx0ICovCgogICAgICAgIGlmKC0xID09IHhpb2N0bChm
ZCwgVklESU9DX1NfQ1JPUCwgJmNyb3ApKSB7CiAgICAgICAgICAgIHN3aXRj
aChlcnJubykgewogICAgICAgICAgICBjYXNlIEVJTlZBTDoKICAgICAgICAg
ICAgICAgIC8qIENyb3BwaW5nIG5vdCBzdXBwb3J0ZWQuICovCiAgICAgICAg
ICAgICAgICBicmVhazsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAg
ICAgICAgIC8qIEVycm9ycyBpZ25vcmVkLiAqLwogICAgICAgICAgICAgICAg
YnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IGVsc2UgeyAg
ICAgICAgCiAgICAgICAgLyogRXJyb3JzIGlnbm9yZWQuICovCiAgICB9CgoK
ICAgIHplcm9maWxsKGZtdCk7CgogICAgZm10LnR5cGUgICAgICAgICAgICAg
ICAgPSBWNEwyX0JVRl9UWVBFX1ZJREVPX0NBUFRVUkU7CiAgICBmbXQuZm10
LnBpeC53aWR0aCAgICAgICA9IDY0MDsgCiAgICBmbXQuZm10LnBpeC5oZWln
aHQgICAgICA9IDQ4MDsKICAgIGZtdC5mbXQucGl4LnBpeGVsZm9ybWF0ID0g
VjRMMl9QSVhfRk1UX0dSRVk7CiAgICBmbXQuZm10LnBpeC5maWVsZCAgICAg
ICA9IFY0TDJfRklFTERfQU5ZOwoKICAgIGlmKC0xID09IHhpb2N0bChmZCwg
VklESU9DX1NfRk1ULCAmZm10KSkKICAgICAgICBlcnJub19leGl0KCJWSURJ
T0NfU19GTVQiKTsKCiAgICAvKiBOb3RlIFZJRElPQ19TX0ZNVCBtYXkgY2hh
bmdlIHdpZHRoIGFuZCBoZWlnaHQuICovCiAgICBwcmludGYoIlZJRElPQ19T
X0ZNVCByZXR1cm5lZCB3aWR0aCAlaSBhbmQgaGVpZ2h0ICVpLlxuIgogICAg
ICAgICwgZm10LmZtdC5waXgud2lkdGgsIGZtdC5mbXQucGl4LmhlaWdodCk7
CgogICAgaW5pdF9tbWFwKCk7Cn0KCnN0YXRpYyB2b2lkIHN0YXJ0X2NhcHR1
cmluZyh2b2lkKQp7CiAgICB1bnNpZ25lZCBpbnQgaTsKICAgIGVudW0gdjRs
Ml9idWZfdHlwZSB0eXBlOwoKICAgIGZvcihpID0gMDsgaSA8IG5fYnVmZmVy
czsgaSsrKQogICAgewogICAgICAgIHN0cnVjdCB2NGwyX2J1ZmZlciBidWY7
CgogICAgICAgIHplcm9maWxsKGJ1Zik7CgogICAgICAgIGJ1Zi50eXBlICAg
ICAgICA9IFY0TDJfQlVGX1RZUEVfVklERU9fQ0FQVFVSRTsKICAgICAgICBi
dWYubWVtb3J5ICAgICAgPSBWNEwyX01FTU9SWV9NTUFQOwogICAgICAgIGJ1
Zi5pbmRleCAgICAgICA9IGk7CgogICAgICAgIC8qIEVucXVldWUgYnVmZmVy
ICovCiAgICAgICAgaWYoLTEgPT0geGlvY3RsKGZkLCBWSURJT0NfUUJVRiwg
JmJ1ZikpCiAgICAgICAgICAgIGVycm5vX2V4aXQoIlZJRElPQ19RQlVGIik7
CiAgICB9CiAgICAKICAgIHR5cGUgPSBWNEwyX0JVRl9UWVBFX1ZJREVPX0NB
UFRVUkU7CgogICAgaWYoLTEgPT0geGlvY3RsKGZkLCBWSURJT0NfU1RSRUFN
T04sICZ0eXBlKSkKICAgICAgICBlcnJub19leGl0KCJWSURJT0NfU1RSRUFN
T04iKTsKfQoKc3RhdGljIHZvaWQgbWFpbmxvb3Aodm9pZCkKewogICAgdW5z
aWduZWQgaW50IGNvdW50OwoKICAgIGNvdW50ID0gNzsKCiAgICB3aGlsZShj
b3VudC0tID4gMCkgewogICAgICAgIGZvcig7OykgewogICAgICAgICAgICBm
ZF9zZXQgZmRzOwogICAgICAgICAgICBzdHJ1Y3QgdGltZXZhbCB0djsKICAg
ICAgICAgICAgaW50IHI7CgogICAgICAgICAgICBGRF9aRVJPKCZmZHMpOwog
ICAgICAgICAgICBGRF9TRVQoZmQsICZmZHMpOwoKICAgICAgICAgICAgLyog
VGltZW91dC4gKi8KICAgICAgICAgICAgdHYudHZfc2VjID0gMTA7CiAgICAg
ICAgICAgIHR2LnR2X3VzZWMgPSAwOwoKICAgICAgICAgICAgciA9IHNlbGVj
dChmZCArIDEsICZmZHMsIE5VTEwsIE5VTEwsICZ0dik7CgogICAgICAgICAg
ICBpZigtMSA9PSByKSB7CiAgICAgICAgICAgICAgICBpZihFSU5UUiA9PSBl
cnJubykKICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAg
ICAgICAgICBlcnJub19leGl0KCJzZWxlY3QiKTsKICAgICAgICAgICAgfQoK
ICAgICAgICAgICAgaWYoMCA9PSByKSB7CiAgICAgICAgICAgICAgICBmcHJp
bnRmKHN0ZGVyciwgIlNlbGVjdCB0aW1lb3V0LlxuIik7CiAgICAgICAgICAg
ICAgICBleGl0KEVYSVRfRkFJTFVSRSk7CiAgICAgICAgICAgIH0KCiAgICAg
ICAgICAgIGlmKHJlYWRfZnJhbWUoKSkKICAgICAgICAgICAgICAgIGJyZWFr
OwogICAgCiAgICAgICAgICAgIC8qIEVBR0FJTiAtIGNvbnRpbnVlIHNlbGVj
dCBsb29wLiAqLwogICAgICAgIH0KICAgIH0KfQoKc3RhdGljIHZvaWQgc3Rv
cF9jYXB0dXJpbmcodm9pZCkKewogICAgZW51bSB2NGwyX2J1Zl90eXBlIHR5
cGUgPSBWNEwyX0JVRl9UWVBFX1ZJREVPX0NBUFRVUkU7CgogICAgaWYoLTEg
PT0geGlvY3RsKGZkLCBWSURJT0NfU1RSRUFNT0ZGLCAmdHlwZSkpCiAgICAg
ICAgZXJybm9fZXhpdCgiVklESU9DX1NUUkVBTU9GRiIpOwp9CgpzdGF0aWMg
dm9pZCB1bmluaXRfZGV2aWNlKHZvaWQpCnsKICAgIHVuc2lnbmVkIGludCBp
OwoKICAgIGZvcihpID0gMDsgaSA8IG5fYnVmZmVyczsgKytpKQogICAgICAg
IGlmKC0xID09IG11bm1hcChidWZmZXJzW2ldLnN0YXJ0LCBidWZmZXJzW2ld
Lmxlbmd0aCkpCiAgICAgICAgICAgIGVycm5vX2V4aXQoIm11bm1hcCIpOwoK
ICAgIGZyZWUoYnVmZmVycyk7Cn0KCnN0YXRpYyB2b2lkIGNsb3NlX2Rldmlj
ZSh2b2lkKQp7CiAgICBpZigtMSA9PSBjbG9zZShmZCkpCiAgICAgICAgZXJy
bm9fZXhpdCgiY2xvc2UiKTsKCiAgICBmZCA9IC0xOwp9CgppbnQgbWFpbihp
bnQgYXJnYywgY2hhciAqKiBhcmd2KQp7CiAgICBpZiggYXJnYyA+IDEgKSBk
ZXZfbmFtZSA9IGFyZ3ZbMV07CiAgICBvcGVuX2RldmljZSgpOwogICAgaW5p
dF9kZXZpY2UoKTsKICAgIHN0YXJ0X2NhcHR1cmluZygpOwogICAgbWFpbmxv
b3AoKTsKICAgIHN0b3BfY2FwdHVyaW5nKCk7CiAgICB1bmluaXRfZGV2aWNl
KCk7CiAgICBjbG9zZV9kZXZpY2UoKTsKCiAgICByZXR1cm4gMDsKfQo=

--0-151166100-1229708044=:96900
Content-Type: text/plain; charset="us-ascii"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
Content-Disposition: inline

--
video4linux-list mailing list
Unsubscribe mailto:video4linux-list-request@redhat.com?subject=unsubscribe
https://www.redhat.com/mailman/listinfo/video4linux-list
--0-151166100-1229708044=:96900--
