Return-path: <linux-media-owner@vger.kernel.org>
Received: from perceval.ideasonboard.com ([95.142.166.194]:60432 "EHLO
	perceval.ideasonboard.com" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
	with ESMTP id S1753136Ab2KEKdS (ORCPT
	<rfc822;linux-media@vger.kernel.org>); Mon, 5 Nov 2012 05:33:18 -0500
From: Laurent Pinchart <laurent.pinchart@ideasonboard.com>
To: Florian Neuhaus <florian.neuhaus@reberinformatik.ch>
Cc: Laurent Pinchart <laurent.pinchart@ideasonboard.com>,
	linux-media@vger.kernel.org, sakari.ailus@iki.fi, dacohen@gmail.com
Subject: Re: [omap3-isp-live] Autofocus buffer interpretation of H3A engine
Date: Sun, 04 Nov 2012 12:47:25 +0100
Message-ID: <1588578.t5rbryooTj@avalon>
In-Reply-To: <6EE9CD707FBED24483D4CB0162E854671007E05D@AM2PRD0710MB375.eurprd07.prod.outlook.com>
References: <6EE9CD707FBED24483D4CB0162E854671007E05D@AM2PRD0710MB375.eurprd07.prod.outlook.com>
MIME-Version: 1.0
Content-Transfer-Encoding: 7Bit
Content-Type: text/plain; charset="us-ascii"
Sender: linux-media-owner@vger.kernel.org
List-ID: <linux-media.vger.kernel.org>

Hi Florian,

On Thursday 01 November 2012 11:17:44 Florian Neuhaus wrote:
> Hi Laurent
> 
> I am adapting your current omap3-isp-live application to fit our needs
> (http://git.ideasonboard.org/omap3-isp-live.git/commit/619164a994c8d878249d
> 6c1b8b16c27074a04209). For this I need to implement an autofocus algorithm
> to control an attached actuator. Let me summarize what components I use:
> 
> - beagleboard-xm
> - mt9p031 on leopardimaging li-5m03
> - own developed voice-coil-motor (vcm) driven by current regulator ad5821

The AD5821 is similar to the AD5820, for which I have a driver that I need to 
clean up and post. Would you be interested in that ?

> - kernel 3.5 out of the linux-omap tree
> 
> To generate a control signal for my vcm, I need to interpret the values
> generated by the AF engine of the omap3isp, h3a module. I see, that you
> have already implemented a working auto-exposure functionality with the
> AEWB module - so I have done the same with the AF module. But now I have
> problems to interpret the generated values in omap3_isp_af_process. Do you
> know how the paxel-buffer is structured?

Even though that buffer structure is pretty simple, I'm afraid I can't provide 
that information as it's covered by an NDA.

Note that a description of the buffer's contents won't help you much, as you 
wouldn't know how to compute the IIR filters coefficients.

There's two way to move forward here. We could ask TI to release the required 
information to produce an open-source AF implementation, or we could try to 
figure it out ourselves. Looking at the FCam project, I've found

http://vcs.maemo.org/svn/fcam/fcam-dev/tags/1.1.0/src/N900/V4L2Sensor.cpp

Does that help figuring out what the buffer contains ?

> I see that the received buffer has the size of
> 
> buf_size = af->paxel.h_cnt * af->paxel.v_cnt * OMAP3ISP_AF_PAXEL_SIZE;
> 
> where  OMAP3ISP_AF_PAXEL_SIZE is 48 bytes, but what is in the 48 bytes?
> 
> Have you made some progress in implementing an autofocus algorithm?

I haven't started, and it's currently not on my to-do list I'm afraid.

-- 
Regards,

Laurent Pinchart

