Return-path: <linux-media-owner@vger.kernel.org>
Received: from moutng.kundenserver.de ([212.227.126.186]:52558 "EHLO
	moutng.kundenserver.de" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
	with ESMTP id S1753091Ab2FEPrx (ORCPT
	<rfc822;linux-media@vger.kernel.org>); Tue, 5 Jun 2012 11:47:53 -0400
Date: Tue, 5 Jun 2012 17:47:50 +0200 (CEST)
From: Guennadi Liakhovetski <g.liakhovetski@gmx.de>
To: Janusz Uzycki <janusz.uzycki@elproma.com.pl>
cc: Linux Media Mailing List <linux-media@vger.kernel.org>,
	Laurent Pinchart <laurent.pinchart@ideasonboard.com>
Subject: Re: SH7724, VOU, PAL mode
In-Reply-To: <CEA83F28AF7C47E7B83AE1DBFFBC8514@laptop2>
Message-ID: <Pine.LNX.4.64.1206051651220.2145@axis700.grange>
References: <1E539FC23CF84B8A91428720570395E0@laptop2>
 <Pine.LNX.4.64.1101241720001.17567@axis700.grange> <AD14536027B946D6B4504D4F43E352A5@laptop2>
 <Pine.LNX.4.64.1101262045550.3989@axis700.grange> <F95361ABAE1D4A70A10790A798004482@laptop2>
 <Pine.LNX.4.64.1101271809030.8916@axis700.grange> <8026191608244DB98F002E983C866149@laptop2>
 <Pine.LNX.4.64.1102011420540.6673@axis700.grange> <18BE1662A1F04B6C8B39AA46440A3FBB@laptop2>
 <Pine.LNX.4.64.1102011532360.6673@axis700.grange> <2F2263A44E0F466F898DD3E2F1D19F12@laptop2>
 <Pine.LNX.4.64.1102081427500.1393@axis700.grange> <CEA83F28AF7C47E7B83AE1DBFFBC8514@laptop2>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
Sender: linux-media-owner@vger.kernel.org
List-ID: <linux-media.vger.kernel.org>

Hi Janusz

Sorry, this is not going to be a very detailed reply. It's been a long 
time since I've worked with VOU and AK8813(4).

On Mon, 4 Jun 2012, Janusz Uzycki wrote:

> Hi Guennadi.
> 
> I am trying to force to proper work CS4954 encoder with sh4.
> I want to use sh4 VOU in PAL mode (kernel 3.2.7). Do you have any experience
> with AK881x and PAL?

Yes, I think, I tested both PAL and NTSC modes.

> If I set PAL mode (v4l2-ctl -s) VOUCR::MD is still configured for NTSC.

This shouldn't be the case: look at sh_vou_s_std(). Can you try to add 
debugging to the driver to see, whether that function gets called, when 
you run v4l2-ctl? If not - either you're calling it wrongly, or there's a 
bug in it. If it is - see, whether it's not configuring VOUCR properly or 
somehow it gets reset again later.

> I
> noticed that VOU is limited to NTSC resolution: "Maximum destination image
> size: 720 x 240 per field".

You mean in the datasheet? I don't have it currently at hand, but I seem 
to remember, that there was a bug and the VOU does actually support a full 
PAL resolution too. I'm not 100% certain, though.

> And indeed I had to change my encoder settings to
> NTSC-M CCIR601 timing 720x480 (PAL synch freq. only) for synced (stable) color
> video picture of BAR generated by the encoder (not VOU). On the other hand
> VOUDSR register has bit-limit 1024x512 (enough for PAL 768x576 interlaced).
> Another method for stable PAL picture (but 768x576) is change both VOUCR::MD
> to PAL output mode and set the encoder to PAL mode. Then the green picture has
> a bound about 480 line I think.
> Unfortunately I can't still manage to work video data from VOU to the encoder
> - green picture only. Do you have any test program for video v4l2 output?

You can use gstreamer, e.g.:

gst-launch -v filesrc location=x.avi ! decodebin ! ffmpegcolorspace ! \ 
video/x-raw-rgb,bpp=24 ! v4l2sink device=/dev/video0 tv-norm=PAL-B

I also used a (possibly modified) program by Laurent (cc'ed) which either 
I - with his agreement - can re-send to you, or maybe he'd send you the 
original.

> Does
> the idea fb->v4l2 output
> http://www.spinics.net/lists/linux-fbdev/msg01102.html is alive?

More dead, than alive, I think.

Thanks
Guennadi
---
Guennadi Liakhovetski, Ph.D.
Freelance Open-Source Software Developer
http://www.open-technology.de/
